
<table>
<thead>
    <tr><th>nr</th><th>file:line</th><th>original_query</th><th>create_query query</th><th>new create_columns</th><th>select_query</th></tr>
</thead>
<tbody>
   <tr><td>1</td><td>commissions/scripts/generate_sales_comp_data.php:173</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> qcpr_snapshot_$snapshot_date <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qcpr_source</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> qcpr_snapshot_$snapshot_date</td><td style="border-bottom: solid 1px black;">record_type <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_entity <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_district <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_region <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_channel <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scope <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state <span class="sql-reserved">CHAR</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_district <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;effective_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_order_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;lead_source <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_amount <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_total <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quota_credit_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">24</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multiyear <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">DATETIME</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qcpr_source</td></tr>
   <tr><td>2</td><td>cron/ns_sync/archived/release_orders_sync.php:20</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1500</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">45</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multiple_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;process_without_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) <span class="sql-reserved">AS</span> replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) <span class="sql-reserved">AS</span> expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) <span class="sql-reserved">AS</span> sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td></tr>
   <tr><td>3</td><td>cron/ns_sync/archived/release_orders_sync.php:60</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No '</span> no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span> p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'PENDING'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_po <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) <span class="sql-reserved">AS</span> total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No '</span> <span class="sql-reserved">AS</span> no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span> p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'PENDING'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td></tr>
   <tr><td>4</td><td>finance/payments/import/insert_payments_do.php:140</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_tax(<span class="sql-reserved">PRIMARY KEY</span>(il_order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;il_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) sales_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;il_order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_tax(<span class="sql-reserved">PRIMARY KEY</span>(il_order_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;il_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) <span class="sql-reserved">AS</span> sales_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;il_order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>5</td><td>finance/payments/import/insert_payments_do.php:150</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> payments_tax(<span class="sql-reserved">PRIMARY KEY</span>(payment_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.payment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total / i.invoice_total * i.sales_tax payment_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.payments p<br/><span class="sql-reserved">INNER JOIN</span> billing.invoices i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.ns_invoice_id = i.ns_invoice_id<br/><span class="sql-reserved">INNER JOIN</span> order_tax ot <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.il_order_id = i.il_order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> i.sales_tax &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> payments_tax(<span class="sql-reserved">PRIMARY KEY</span>(payment_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.payment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total / i.invoice_total * i.sales_tax <span class="sql-reserved">AS</span> payment_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.payments p<br/><span class="sql-reserved">INNER JOIN</span> billing.invoices i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.ns_invoice_id = i.ns_invoice_id<br/><span class="sql-reserved">INNER JOIN</span> order_tax ot <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.il_order_id = i.il_order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> i.sales_tax &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>6</td><td>finance/payments/import/insert_payments_do.php:166</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_invoices_split(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(<span class="sql-keyword">IO</span>.invoice_amount) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> i.invoice_total <span class="sql-number">-5</span> <span class="sql-reserved">AND</span> i.invoice_total <span class="sql-number">+5</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_invoices_split(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(<span class="sql-keyword">IO</span>.invoice_amount) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> i.invoice_total - <span class="sql-number">5</span> <span class="sql-reserved">AND</span> i.invoice_total + <span class="sql-number">5</span></td></tr>
   <tr><td>7</td><td>finance/payments/import/insert_payments_do.php:175</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> invoice_credits(<span class="sql-reserved">PRIMARY KEY</span>(invoice_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id credit_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.transaction_date credit_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.transaction_amount * <span class="sql-number">-1</span> credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.date_modified date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$payment_table t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id = t.invoice_id <span class="sql-reserved">AND</span> t.transaction_type = <span class="sql-string">'Credit Memo'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> invoice_credits(<span class="sql-reserved">PRIMARY KEY</span>(invoice_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id <span class="sql-reserved">AS</span> credit_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.transaction_date <span class="sql-reserved">AS</span> credit_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.transaction_amount * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.date_modified <span class="sql-reserved">AS</span> date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$payment_table t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id = t.invoice_id <span class="sql-reserved">AND</span> t.transaction_type = <span class="sql-string">'Credit Memo'</span></td></tr>
   <tr><td>8</td><td>finance/payments/import/insert_payments_do.php:197</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> invoice_payments(<span class="sql-reserved">PRIMARY KEY</span>(invoice_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) payment_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payments<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_total &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> invoice_payments(<span class="sql-reserved">PRIMARY KEY</span>(invoice_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) <span class="sql-reserved">AS</span> payment_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payments<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_total &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_id</td></tr>
   <tr><td>9</td><td>finance/payments/import/insert_payments_do.php:231</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_total_after_credits(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">IFNULL</span>(credit_amount, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(commission_credit, <span class="sql-number">0</span>) order_total_after_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax - <span class="sql-keyword">IFNULL</span>(tax_credit_amount, <span class="sql-number">0</span>) sales_tax_after_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax - <span class="sql-keyword">IFNULL</span>(tax_credit_amount, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">IFNULL</span>(credit_amount, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(commission_credit, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sales_tax_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_summary os<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_amount) credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(tax_credit_amount) tax_credit_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) oc <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) payment_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.payments<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) p <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;il_order_id order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_total) commission_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.commission_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;il_order_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">GREATEST</span>(invoice_date, post_date) &lt; <span class="sql-keyword">NOW</span>()<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;il_order_id) commission_credits <span class="sql-reserved">USING</span>(order_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id &gt;= <span class="sql-number">5227</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_total_after_credits(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total_after_credits <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_after_credits <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">35</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_perc <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">25</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">IFNULL</span>(credit_amount, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(commission_credit, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> order_total_after_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax - <span class="sql-keyword">IFNULL</span>(tax_credit_amount, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> sales_tax_after_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax - <span class="sql-keyword">IFNULL</span>(tax_credit_amount, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">IFNULL</span>(credit_amount, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(commission_credit, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sales_tax_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_summary os<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_amount) <span class="sql-reserved">AS</span> credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(tax_credit_amount) <span class="sql-reserved">AS</span> tax_credit_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) oc <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) <span class="sql-reserved">AS</span> payment_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.payments<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) p <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> il_order_id <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_total) <span class="sql-reserved">AS</span> commission_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.commission_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;il_order_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">GREATEST</span>(invoice_date, post_date) &lt; <span class="sql-keyword">NOW</span>()<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;il_order_id) commission_credits <span class="sql-reserved">USING</span>(order_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id &gt;= <span class="sql-number">5227</span></td></tr>
   <tr><td>10</td><td>finance/payments/import/insert_payments_do.php:246</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_payments_update_sales_tax(<span class="sql-reserved">PRIMARY KEY</span>(payment_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payments_to_update.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;payments_to_update.payment_total * os.sales_tax_perc new_payment_sales_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_order_total_after_credits os<br/><span class="sql-reserved">INNER JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) payment_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) payment_sales_tax<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.payments<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) p <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">INNER JOIN</span> billing.payments payments_to_update <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total - os.order_total_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> p.payment_total &gt; os.order_total_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">-- order is paid in full</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payment_sales_tax - os.sales_tax_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">.5</span> <span class="sql-comment">-- sales tax on paymments don't match order's sales tax</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_payments_update_sales_tax(<span class="sql-reserved">PRIMARY KEY</span>(payment_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payments_to_update.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;payments_to_update.payment_total * os.sales_tax_perc <span class="sql-reserved">AS</span> new_payment_sales_tax<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_order_total_after_credits os<br/><span class="sql-reserved">INNER JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(payment_total) <span class="sql-reserved">AS</span> payment_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) <span class="sql-reserved">AS</span> payment_sales_tax<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.payments<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) p <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">INNER JOIN</span> billing.payments payments_to_update <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.payment_total - os.order_total_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> p.payment_total &gt; os.order_total_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">-- order is paid in full</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payment_sales_tax - os.sales_tax_after_credits<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">.5</span> <span class="sql-comment">-- sales tax on paymments don't match order's sales tax</span></td></tr>
   <tr><td>11</td><td>finance/payments/import/insert_payments_do.php:260</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_payments_previously_logged(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(payment_id, rank_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">CASE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_id <span class="sql-reserved">WHEN</span> <span class="sql-variable">@curr_payment</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@curr_payment</span> := payment_id<br/><span class="sql-keyword">END</span> rank_id,<br/>payment_id,<br/>old_value,<br/>new_value,<br/>date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record_id payment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_value,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_value,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.history_log<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'billing.payments'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COLUMN_NAME</span> = <span class="sql-string">'sales_tax'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>) hl<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curr_payment</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_payments_previously_logged(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(payment_id, rank_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">rank_id <span class="sql-reserved">DOUBLE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">23</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">CASE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_id <span class="sql-reserved">WHEN</span> <span class="sql-variable">@curr_payment</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> + <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<span class="sql-variable">@curr_payment</span> := payment_id)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> rank_id,<br/>payment_id,<br/>old_value,<br/>new_value,<br/>date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record_id <span class="sql-reserved">AS</span> payment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_value,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_value,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.history_log<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'billing.payments'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COLUMN_NAME</span> = <span class="sql-string">'sales_tax'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>) hl<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-variable">@curr_payment</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r</td></tr>
   <tr><td>12</td><td>orders/convert_pd.php:103</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $pd_products(<span class="sql-reserved">PRIMARY KEY</span>(product_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pg.product_group_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.parent_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">14</span>, <span class="sql-number">24</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) initial_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) followup_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">24</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">14</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) followup_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_groups pg<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = sp.product_id <span class="sql-reserved">AND</span> pg.product_group_id = p.product_group_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(onsite_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> online_pd &gt; <span class="sql-number">0</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $pd_products(<span class="sql-reserved">PRIMARY KEY</span>(product_id))</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/><span class="sql-keyword">STATUS</span> <span class="sql-reserved">TINYINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;teacher_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;initial_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;followup_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;followup_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">39</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pg.product_group_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.parent_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">14</span>, <span class="sql-number">24</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> initial_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> followup_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">24</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">14</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> followup_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_groups pg<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = sp.product_id <span class="sql-reserved">AND</span> pg.product_group_id = p.product_group_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> online_pd &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>13</td><td>util/function/order_validation.php:22</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.tmp_order_total_logs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_month)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.order_date &lt;= <span class="sql-variable">@amort_locked_through</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_prior_year_order,<br/><span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) order_month,<br/><span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y%m01'</span>) report_month_string,<br/><span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>) amort_month_end,<br/>os.order_total,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> lon.date_entered &lt; <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(o.date_entered, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> lon.log_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) max_month_end_log_id,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> lon.date_entered &gt; <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(o.date_entered, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> lon.log_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) max_after_month_end_log_id,<br/><span class="sql-keyword">MIN</span>(lon.log_id) min_log_id_all_time<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = lon.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon.is_order_deleted = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.tmp_order_total_logs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_month)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_prior_year_order <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_month <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_month_string <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_month_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_month_end_log_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_after_month_end_log_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_log_id_all_time <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.order_date &lt;= <span class="sql-variable">@amort_locked_through</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_prior_year_order,<br/><span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> order_month,<br/><span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y%m01'</span>) <span class="sql-reserved">AS</span> report_month_string,<br/><span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>) <span class="sql-reserved">AS</span> amort_month_end,<br/>os.order_total,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> lon.date_entered &lt; <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(o.date_entered, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> lon.log_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> max_month_end_log_id,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> lon.date_entered &gt; <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_day(o.order_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">3</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(o.date_entered, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> lon.log_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> max_after_month_end_log_id,<br/><span class="sql-keyword">MIN</span>(lon.log_id) <span class="sql-reserved">AS</span> min_log_id_all_time<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = lon.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon.is_order_deleted = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>14</td><td>util/function/order_validation.php:47</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.tmp_order_totals_changed(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.report_month_string,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.is_prior_year_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon1.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon3.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon2.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) current_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;lon2.date_entered last_audit_log_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ar.date_entered amort_locked_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">LOG</span>.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_reviewed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.tmp_order_total_logs tol<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = tol.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon1.log_id = max_month_end_log_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon2.log_id = max_after_month_end_log_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon3.log_id = min_log_id_all_time <span class="sql-reserved">AND</span> lon3.date_entered &lt; <span class="sql-string">'2020-11-30'</span> <span class="sql-comment"># order totals changes logged after this date; beforehand data missing</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.amortization_reports ar<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ar.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ar.report_month = tol.order_month<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_review <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.order_id = tol.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">LOG</span>.review_category = <span class="sql-string">'data_check'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">LOG</span>.review_type = <span class="sql-string">'order_total'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon2.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - <span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon1.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon3.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">.05</span> <span class="sql-reserved">AND</span> lon2.date_entered &gt; ar.date_entered <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() &gt; tol.amort_month_end<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.tmp_order_totals_changed(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.report_month_string,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tol.is_prior_year_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon1.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon3.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon2.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> current_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;lon2.date_entered <span class="sql-reserved">AS</span> last_audit_log_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ar.date_entered <span class="sql-reserved">AS</span> amort_locked_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">LOG</span>.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_reviewed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.tmp_order_total_logs tol<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = tol.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon1.log_id = max_month_end_log_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon2.log_id = max_after_month_end_log_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_new_renew lon3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lon3.log_id = min_log_id_all_time <span class="sql-reserved">AND</span> lon3.date_entered &lt; <span class="sql-string">'2020-11-30'</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.amortization_reports ar<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ar.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ar.report_month = tol.order_month<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_review <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.order_id = tol.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">LOG</span>.review_category = <span class="sql-string">'data_check'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">LOG</span>.review_type = <span class="sql-string">'order_total'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon2.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - <span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon1.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lon3.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">.05</span> <span class="sql-reserved">AND</span> lon2.date_entered &gt; ar.date_entered <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() &gt; tol.amort_month_end<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>15</td><td>cron/ns_sync/archived/pre_release_orders_sync.php:20</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1500</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">45</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multiple_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;process_without_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) <span class="sql-reserved">AS</span> replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) <span class="sql-reserved">AS</span> expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) <span class="sql-reserved">AS</span> sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td></tr>
   <tr><td>16</td><td>cron/ns_sync/archived/pre_release_orders_sync.php:60</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No '</span> no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span> p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'PENDING'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_po <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) <span class="sql-reserved">AS</span> total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No '</span> <span class="sql-reserved">AS</span> no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span> p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'PENDING'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td></tr>
   <tr><td>17</td><td>cron/sa_products.php:22</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_textbooks(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'textbook_alignment_products'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.academic_year_id) <span class="sql-string">'txtbk_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@start_date</span> &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-variable">@end_date</span> &gt;= od.start_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-number">61</span><br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_textbooks(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;textbook_alignment_products <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;txtbk_ay <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'textbook_alignment_products'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.academic_year_id) <span class="sql-reserved">AS</span> <span class="sql-string">'txtbk_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@start_date</span> &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-variable">@end_date</span> &gt;= od.start_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-number">61</span><br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>18</td><td>cron/sa_products.php:43</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_smartyants(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) <span class="sql-string">'sa_licenses'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(aos.academic_year_id) <span class="sql-string">'sa_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> od.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span><br/><span class="sql-reserved">JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = od.account_id <span class="sql-reserved">AND</span> aos.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_smartyants(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sa_licenses <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">31</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sa_ay <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) <span class="sql-reserved">AS</span> <span class="sql-string">'sa_licenses'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(aos.academic_year_id) <span class="sql-reserved">AS</span> <span class="sql-string">'sa_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> od.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">'.SMARTY_ANTS_PROGRAM.'</span><br/><span class="sql-reserved">JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = od.account_id <span class="sql-reserved">AND</span> aos.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>19</td><td>cron/sa_products.php:62</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_textbook_smartyants <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.textbook_alignment_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tay.academic_year_name <span class="sql-string">'txtbk_ay'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(b.sa_licenses, <span class="sql-string">''</span>) <span class="sql-string">'smartyants_licenses'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(say.academic_year_name, <span class="sql-string">''</span>) <span class="sql-string">'sa_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00612920_textbooks a<br/><span class="sql-reserved">JOIN</span> academic_years tay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.txtbk_ay = tay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.fm_00612920_smartyants b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = b.account_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years say <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_id = b.sa_ay<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(a.textbook_alignment_products, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(tay.academic_year_name, <span class="sql-string">''</span>) <span class="sql-string">'txtbk_ay'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.sa_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00612920_textbooks a<br/><span class="sql-reserved">LEFT JOIN</span> academic_years tay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.txtbk_ay = tay.academic_year_id<br/><span class="sql-reserved">RIGHT JOIN</span> tech.fm_00612920_smartyants b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = b.account_id<br/><span class="sql-reserved">JOIN</span> academic_years say <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_id = b.sa_ay</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00612920_textbook_smartyants</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.textbook_alignment_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tay.academic_year_name <span class="sql-reserved">AS</span> <span class="sql-string">'txtbk_ay'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(b.sa_licenses, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'smartyants_licenses'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(say.academic_year_name, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'sa_ay'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00612920_textbooks a<br/><span class="sql-reserved">JOIN</span> academic_years tay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.txtbk_ay = tay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.fm_00612920_smartyants b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = b.account_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years say <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_id = b.sa_ay<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.textbook_alignment_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(tay.academic_year_name, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'txtbk_ay'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.sa_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00612920_textbooks a<br/><span class="sql-reserved">LEFT JOIN</span> academic_years tay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.txtbk_ay = tay.academic_year_id<br/><span class="sql-reserved">RIGHT JOIN</span> tech.fm_00612920_smartyants b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = b.account_id<br/><span class="sql-reserved">JOIN</span> academic_years say <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;say.academic_year_id = b.sa_ay</td></tr>
   <tr><td>20</td><td>cron/sa_products.php:89</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ <span class="sql-string">"create table tech.fm_00612920_final_results SELECT account_id 'Account ID', sa_ay 'SA AY', if(smartyants_licenses = 9999, 'Unlimited', smartyants_licenses) 'SA Licenses', txtbk_ay 'Textbook Products AY',\",
query_text,
\" FROM tech.fm_00612920_textbook_smartyants;\"
) final_query into @querytext
FROM
(
SELECT GROUP_CONCAT(DISTINCT CONCAT(\"IF(FIND_IN_SET('\",
IFNULL(pr.program_name, pl.product_line_str),
\"', textbook_alignment_products)&gt;0,'Yes','') AS '\",
IFNULL(pr.program_name, pl.product_line_str),\"'\") )query_text
FROM products p
JOIN product_lines pl ON pl.product_line_id = p.product_line_id
LEFT JOIN programs pr ON pr.program_id = p.program_id AND pl.product_line_id IN(3, 4, 11)
WHERE product_group_id = 61
) a;</span></td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>21</td><td>cron/trainings_num_attendees.php:10</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> mykidbiz_tmp.training_attendees <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ts.training_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> tst.trainee_id) num_attendees<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.training_session_trainees tst,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.trainees t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.training_session ts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tst.trainee_id = t.trainee_id <span class="sql-reserved">AND</span> tst.training_id = ts.training_id <span class="sql-reserved">AND</span> training_date &gt;= <span class="sql-keyword">DATE_ADD</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-2</span> <span class="sql-keyword">DAY</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ts.training_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> mykidbiz_tmp.training_attendees</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ts.training_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> tst.trainee_id) <span class="sql-reserved">AS</span> num_attendees<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.training_session_trainees tst,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.trainees t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.training_session ts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tst.trainee_id = t.trainee_id <span class="sql-reserved">AND</span> tst.training_id = ts.training_id <span class="sql-reserved">AND</span> training_date &gt;= <span class="sql-keyword">DATE_ADD</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-2</span> <span class="sql-keyword">DAY</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ts.training_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id</td></tr>
   <tr><td>22</td><td>cron/usage_report.php:474</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(daily_date)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(daily_date)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;yearmonth <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_year <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;week_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;grade_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;language_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_reading_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_lexile_num <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bayes_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;math_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_for_you_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bayes_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bonus_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_stretch_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_math_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;open_ended_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;dnd_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;vocabulary_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_vocabulary_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;writing_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reading_connections <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;poll_pairs <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;before_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;after_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;refer_to_clicks <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_points <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_achievements <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekday_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekend_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span></td></tr>
   <tr><td>23</td><td>cron/usage_report.php:490</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary_time(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_time<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary_time(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;yearmonth <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_year <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;grade_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;language_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;mail_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;news_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;news_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;writing_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;technology_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stock_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;vocabulary_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;lesson_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;chapter_test_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;grading_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reports_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;admin_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;other_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_mail_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stretch_news_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_news_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stretch_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_news_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_activity_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_tq_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_writing_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_technology_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stock_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_vocabulary_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_lesson_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_admin_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_other_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_time<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span></td></tr>
   <tr><td>24</td><td>cron/usage_report.php:506</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_details_all(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date academic_year_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>, <span class="sql-string">'Y'</span>, <span class="sql-string">'N'</span>) reportable_exclude,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pre.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> $start_date_str &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) renewal_extension<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.editions e<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.program_id = e.program_id)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.product_editions pe<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = pe.product_id <span class="sql-reserved">AND</span> e.edition_id = pe.edition_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_reportable_excludes <span class="sql-keyword">X</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = <span class="sql-keyword">X</span>.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.pre_post_adjustment_info pre<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pre.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> pre.adjust_reason_id <span class="sql-reserved">IN</span>(<span class="sql-number">6</span>, <span class="sql-number">7</span>, <span class="sql-number">8</span>) <span class="sql-comment">#Renewal Extensions</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.program_id &lt;&gt; <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-comment">### exclude smarty ants</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".($accounts ? ("</span> <span class="sql-reserved">AND</span> od.account_id <span class="sql-reserved">IN</span>($accounts) <span class="sql-string">") : "")."</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_details_all(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>25</td><td>cron/usage_report.php:547</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(tech.wu_order_details_all od)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt;= od.start_date</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details_all od<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt;= od.start_date</td></tr>
   <tr><td>26</td><td>cron/usage_report.php:560</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od</td></tr>
   <tr><td>27</td><td>cron/usage_report.php:572</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(os.order_total) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_orders ao,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.order_id = os.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(os.order_total) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_orders ao,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.order_id = os.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id</td></tr>
   <tr><td>28</td><td>cron/usage_report.php:588</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_school_timezones(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone_name time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.districts d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.schools s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.state_timezone st,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.time_zones tz<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id = d.district_id <span class="sql-reserved">AND</span> s.state_code = st.state <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_timezone = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> s.state_code != d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;st.time_zone_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_timezone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = tz.time_zone_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_school_timezones(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone_name <span class="sql-reserved">AS</span> time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.districts d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.schools s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.state_timezone st,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.time_zones tz<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id = d.district_id <span class="sql-reserved">AND</span> s.state_code = st.state <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_timezone = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> s.state_code != d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;st.time_zone_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_timezone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = tz.time_zone_id</td></tr>
   <tr><td>29</td><td>cron/usage_report.php:603</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_schools(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;schools.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;schools.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;schools.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(ay.summer) summer_only,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> od.order_id) order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.districts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_timezones tz<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = schools.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">',$start_date)."'</span> &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-string">'".date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">',$end_date)."'</span> &gt;= od.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.school_profile <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;schools.school_id = school_profile.school_id <span class="sql-reserved">AND</span> school_profile.profile_start &lt; school_profile.profile_end <span class="sql-reserved">AND</span> $start_date_str &lt;= <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_profile.post_end &gt; school_profile.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_profile.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_profile.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_profile.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;districts.district_id = schools.district_id <span class="sql-reserved">AND</span> schools.school_id = tz.school_id <span class="sql-reserved">AND</span> districts.user_type <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">2</span>) <span class="sql-reserved">AND</span> districts.district_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">48</span>, <span class="sql-number">78</span>, <span class="sql-number">129</span>, <span class="sql-number">132</span>, <span class="sql-number">196</span>, <span class="sql-number">14</span>) <span class="sql-reserved">AND</span> school_name != <span class="sql-string">''</span> <span class="sql-reserved">AND</span> school_name <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%demo school%'</span> <span class="sql-reserved">AND</span> a.account_type &lt;&gt; <span class="sql-number">16</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> od.reportable_exclude &lt;&gt; <span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_profile.school_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> school_profile.order_detail_id = <span class="sql-number">39096</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment"># temp orders</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">OR</span> od.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">".($accounts ? ("</span> <span class="sql-reserved">AND</span> schools.account_id <span class="sql-reserved">IN</span>($accounts) <span class="sql-string">") : "")."</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;schools.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;schools.school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_schools(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>30</td><td>cron/usage_report.php:641</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_detail_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od3.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od3.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.opportunity_product_id = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details_all od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools s<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = od2.order_id <span class="sql-reserved">AND</span> od.account_id = od2.account_id <span class="sql-reserved">AND</span> od.academic_year_id = od2.academic_year_id <span class="sql-reserved">AND</span> od2.program_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.account_id = od3.account_id <span class="sql-reserved">AND</span> od.academic_year_id = od3.academic_year_id <span class="sql-reserved">AND</span> od3.program_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> aos.purchased_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.account_id = aos.account_id <span class="sql-reserved">AND</span> od.program_id = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_detail_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od3.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od3.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.opportunity_product_id = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details_all od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools s<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = od2.order_id <span class="sql-reserved">AND</span> od.account_id = od2.account_id <span class="sql-reserved">AND</span> od.academic_year_id = od2.academic_year_id <span class="sql-reserved">AND</span> od2.program_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.account_id = od3.account_id <span class="sql-reserved">AND</span> od.academic_year_id = od3.academic_year_id <span class="sql-reserved">AND</span> od3.program_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> aos.purchased_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.account_id = aos.account_id <span class="sql-reserved">AND</span> od.program_id = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td></tr>
   <tr><td>31</td><td>cron/usage_report.php:677</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(purchased_pd) purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(scheduled_pd) scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(fulfilled_pd) fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_purchased_pd + followup_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) onsite_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_online_purchased_pd + online_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(onsite_scheduled_pd) onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(online_scheduled_pd) online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online_remaining_pd + onsite_remaining_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) remaining_pls<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details_all od<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;remaining_pls <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(purchased_pd) <span class="sql-reserved">AS</span> purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(scheduled_pd) <span class="sql-reserved">AS</span> scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(fulfilled_pd) <span class="sql-reserved">AS</span> fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_purchased_pd + followup_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> onsite_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_online_purchased_pd + online_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(onsite_scheduled_pd) <span class="sql-reserved">AS</span> onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(online_scheduled_pd) <span class="sql-reserved">AS</span> online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online_remaining_pd + onsite_remaining_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> remaining_pls<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details_all od<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td></tr>
   <tr><td>32</td><td>cron/usage_report.php:707</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_academic_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.academic_year_id) &gt; <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od2.academic_year_id) = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.academic_year_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = od2.account_id <span class="sql-reserved">AND</span> od.program_id = od2.program_id <span class="sql-reserved">AND</span> $start_date_str &lt;= od2.end_date <span class="sql-reserved">AND</span> od2.academic_year_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_academic_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.academic_year_id) &gt; <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od2.academic_year_id) = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.academic_year_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = od2.account_id <span class="sql-reserved">AND</span> od.program_id = od2.program_id <span class="sql-reserved">AND</span> $start_date_str &lt;= od2.end_date <span class="sql-reserved">AND</span> od2.academic_year_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id</td></tr>
   <tr><td>33</td><td>cron/usage_report.php:727</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_academic_year ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.account_id = od.account_id <span class="sql-reserved">AND</span> ay.program_id = od.program_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end &gt; od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_academic_year ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.account_id = od.account_id <span class="sql-reserved">AND</span> ay.program_id = od.program_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id</td></tr>
   <tr><td>34</td><td>cron/usage_report.php:745</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_profile_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'                                 '</span> time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber_profile sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end &gt; <span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND sp.profile_start &lt; date_add($end_date_str, interval 2 day)*/</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_profile_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'                                 '</span> <span class="sql-reserved">AS</span> time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber_profile sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end &gt; <span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">/*AND sp.profile_start &lt; date_add($end_date_str, interval 2 day)*/</span></td></tr>
   <tr><td>35</td><td>cron/usage_report.php:768</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_users_all(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_profile_tz sp<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_schools sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(sp.school_id = sc.school_id)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(sc.account_id = o.account_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sp.user_id <span class="sql-reserved">AND</span> s.district_id = sp.district_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.grade_level &lt;&gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> s.district_id &lt;&gt; <span class="sql-number">233</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt; s.subscription_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.system_generated = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> $end_date_str <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> s.status = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_users_all(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_profile_tz sp<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_schools sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.school_id = sc.school_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.account_id = o.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sp.user_id <span class="sql-reserved">AND</span> s.district_id = sp.district_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.grade_level &lt;&gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> s.district_id &lt;&gt; <span class="sql-number">233</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $start_date_str &lt; s.subscription_end <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.system_generated = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> $end_date_str <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> s.status = <span class="sql-number">0</span></td></tr>
   <tr><td>36</td><td>cron/usage_report.php:811</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools tz<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.school_id = c.school_id <span class="sql-reserved">AND</span> c.status <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">2</span>) <span class="sql-reserved">AND</span> c.class_id <span class="sql-reserved">NOT IN</span>($classIds)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools tz<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tz.school_id = c.school_id <span class="sql-reserved">AND</span> c.status <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">2</span>) <span class="sql-reserved">AND</span> c.class_id <span class="sql-reserved">NOT IN</span>($classIds)</td></tr>
   <tr><td>37</td><td>cron/usage_report.php:826</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_class_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'                             '</span> time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber_class sc<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end &gt; <span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sc.class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND sc.profile_start &lt; date_add($end_date_str, interval 2 day)*/</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_class_tz(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'                             '</span> <span class="sql-reserved">AS</span> time_zone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.subscriber_class sc<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end &gt; <span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">DAY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sc.class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span> <span class="sql-comment">/*AND sc.profile_start &lt; date_add($end_date_str, interval 2 day)*/</span></td></tr>
   <tr><td>38</td><td>cron/usage_report.php:848</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_class(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class_tz sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_tz c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.class_profile cp<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_schools s<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.school_id = a.school_id)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.account_id = o.account_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id = sc.user_id <span class="sql-reserved">AND</span> c.class_id = sc.class_id <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.system_generated = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> $end_date_str <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = sc.school_id <span class="sql-reserved">AND</span> c.class_id = cp.class_id <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_subscriber_class(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class_tz sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_tz c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.class_profile cp<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_schools s<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id = a.school_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_id = o.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id = sc.user_id <span class="sql-reserved">AND</span> c.class_id = sc.class_id <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.system_generated = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> $end_date_str <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = sc.school_id <span class="sql-reserved">AND</span> c.class_id = cp.class_id <span class="sql-reserved">AND</span> $start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">### future users</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id</td></tr>
   <tr><td>39</td><td>cron/usage_report.php:884</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">district_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class</td></tr>
   <tr><td>40</td><td>cron/usage_report.php:933</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_programs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(se2.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) special_editions<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = o.account_id <span class="sql-reserved">AND</span> u.program_id = o.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.subscriber_editions se<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.user_id = se.user_id <span class="sql-reserved">AND</span> $edition_str <span class="sql-reserved">AND</span> u.school_id = se.school_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> se.end_date = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'US/Eastern'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.subscriber_editions se2 <span class="sql-comment">### future users</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> sc.user_id = se2.user_id <span class="sql-reserved">AND</span> <span class="sql-string">" . str_replace("</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se <span class="sql-string">", "</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se2 <span class="sql-string">", $edition_str) . "</span> <span class="sql-reserved">AND</span> u.school_id = se2.school_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> se2.end_date = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'US/Eastern'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.start_date &lt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'US/Eastern'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> se2.end_date = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.end_date &gt;= <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;se2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'US/Eastern'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.school_id = sc.school_id <span class="sql-reserved">AND</span> c.class_id = sc.class_id <span class="sql-reserved">AND</span> t.user_id = sc.user_id <span class="sql-reserved">AND</span> c.program_id = u.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_programs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>41</td><td>cron/usage_report.php:1016</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_max_lit_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id, school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(program_id) max_lit_program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $LITERACY_PROGRAMS) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_max_lit_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id, school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_lit_program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(program_id) <span class="sql-reserved">AS</span> max_lit_program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $LITERACY_PROGRAMS) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id</td></tr>
   <tr><td>42</td><td>cron/usage_report.php:1154</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total3,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total4<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id = u.school_id <span class="sql-reserved">AND</span> $tmp_users.district_id = u.district_id <span class="sql-reserved">AND</span> $tmp_users.user_id = up.user_id <span class="sql-reserved">AND</span> $tmp_users.school_id = up.school_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total3,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total4<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id = u.school_id <span class="sql-reserved">AND</span> $tmp_users.district_id = u.district_id <span class="sql-reserved">AND</span> $tmp_users.user_id = up.user_id <span class="sql-reserved">AND</span> $tmp_users.school_id = up.school_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>43</td><td>cron/usage_report.php:1189</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total3<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id = u.school_id <span class="sql-reserved">AND</span> $tmp_users_all.district_id = u.district_id <span class="sql-reserved">AND</span> $tmp_users_all.user_id = up.user_id <span class="sql-reserved">AND</span> $tmp_users_all.school_id = up.school_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total3<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id = u.school_id <span class="sql-reserved">AND</span> $tmp_users_all.district_id = u.district_id <span class="sql-reserved">AND</span> $tmp_users_all.user_id = up.user_id <span class="sql-reserved">AND</span> $tmp_users_all.school_id = up.school_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>44</td><td>cron/usage_report.php:1221</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_logins) total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(daily_date) first_login,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(daily_date) last_login<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_logins) <span class="sql-reserved">AS</span> total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(daily_date) <span class="sql-reserved">AS</span> first_login,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(daily_date) <span class="sql-reserved">AS</span> last_login<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td></tr>
   <tr><td>45</td><td>cron/usage_report.php:1241</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) login_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.total) total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(l.first_login) first_login,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(l.last_login) last_login<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) <span class="sql-reserved">AS</span> login_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.total) <span class="sql-reserved">AS</span> total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(l.first_login) <span class="sql-reserved">AS</span> first_login,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(l.last_login) <span class="sql-reserved">AS</span> last_login<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions</td></tr>
   <tr><td>46</td><td>cron/usage_report.php:1273</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_log_active(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.class_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.class_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_logins) total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_subscriber_class sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sc.user_id <span class="sql-reserved">AND</span> s.class_id = sc.class_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.classes c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.program_id = up.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = $tmp_users.user_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.school_id = $tmp_users.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> $tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_log_active(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id, user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.class_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.class_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_logins) <span class="sql-reserved">AS</span> total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_subscriber_class sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sc.user_id <span class="sql-reserved">AND</span> s.class_id = sc.class_id<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.classes c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.program_id = up.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = $tmp_users.user_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.school_id = $tmp_users.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> $tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>47</td><td>cron/usage_report.php:1303</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_log_active_teachers(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.daily_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_subscriber_class sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sc.user_id <span class="sql-reserved">AND</span> s.class_id = sc.class_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.classes c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.program_id = up.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = $tmp_users.user_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.school_id = $tmp_users.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> $tmp_users.subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_login_log_active_teachers(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.daily_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_subscriber_class sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = sc.user_id <span class="sql-reserved">AND</span> s.class_id = sc.class_id<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.classes c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.program_id = up.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = $tmp_users.user_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.school_id = $tmp_users.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> $tmp_users.subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span></td></tr>
   <tr><td>48</td><td>cron/usage_report.php:1366</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_active_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_logins) total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_teacher_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_active_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">district_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_logins <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_logins) <span class="sql-reserved">AS</span> total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_teacher_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>49</td><td>cron/usage_report.php:1382</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_admins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">district_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_students <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_teachers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_admins <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_admins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions</td></tr>
   <tr><td>50</td><td>cron/usage_report.php:1409</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_teachers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions</td></tr>
   <tr><td>51</td><td>cron/usage_report.php:1502</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_assessment_completed(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ast.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.school_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_profile_tz sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.assessment_score_totals ast,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts ac<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_check_schools c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.school_id = s.school_id <span class="sql-reserved">AND</span> ay.academic_year_id = c.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id = ast.user_id <span class="sql-reserved">AND</span> ast.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> ay.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> s.school_id = a.school_id <span class="sql-reserved">AND</span> ac.account_id = s.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#US12087 fix for LS pre-test count. Count regular pre-test into summer bucket when taken during summer dates and count into academic year bucket when taken during regular school dates</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.school_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> d.assessment_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ast.time_ended &lt;= <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ast.time_ended &gt; <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sp.user_id = a.user_id <span class="sql-reserved">AND</span> sp.school_id = a.school_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> ast.time_ended &lt; sp.profile_end <span class="sql-reserved">AND</span> ast.time_ended &lt; $end_date_str <span class="sql-reserved">AND</span> a.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> a.user_id = p.user_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ast.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_assessment_completed(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ast.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.school_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users_all a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_profile_tz sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.assessment_score_totals ast,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_schools s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts ac<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_check_schools c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.school_id = s.school_id <span class="sql-reserved">AND</span> ay.academic_year_id = c.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id = ast.user_id <span class="sql-reserved">AND</span> ast.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> ay.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> s.school_id = a.school_id <span class="sql-reserved">AND</span> ac.account_id = s.account_id <span class="sql-comment">#US12087 fix for LS pre-test count. Count regular pre-test into summer bucket when taken during summer dates and count into academic year bucket when taken during regular school dates</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.school_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> d.assessment_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ast.time_ended &lt;= <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ast.time_ended &gt; <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sp.user_id = a.user_id <span class="sql-reserved">AND</span> sp.school_id = a.school_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$start_date_str &lt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> $end_date_str &gt; <span class="sql-keyword">CONVERT_TZ</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.profile_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$SERVER_TIMEZONE'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.time_zone<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> ast.time_ended &lt; sp.profile_end <span class="sql-reserved">AND</span> ast.time_ended &lt; $end_date_str <span class="sql-reserved">AND</span> a.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> a.user_id = p.user_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ast.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td></tr>
   <tr><td>52</td><td>cron/usage_report.php:1532</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_pre,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["mid"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_inter,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["post"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_post,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["summer_pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_summer_pre<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> a.academic_year_id = d.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_pre <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_inter <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_post <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_summer_pre <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_pre,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["mid"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_inter,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["post"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_post,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["summer_pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_summer_pre<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> a.academic_year_id = d.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td></tr>
   <tr><td>53</td><td>cron/usage_report.php:1566</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ls_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = u.program_id <span class="sql-reserved">AND</span> a.academic_year_id = u.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ls_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = u.program_id <span class="sql-reserved">AND</span> a.academic_year_id = u.academic_year_id</td></tr>
   <tr><td>54</td><td>cron/usage_report.php:1583</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> s.user_id) fidelity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = up.user_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> s.basic_news_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id = l.user_id <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> s.user_id) <span class="sql-reserved">AS</span> fidelity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = up.user_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> s.basic_news_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id = l.user_id <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>55</td><td>cron/usage_report.php:1619</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_active_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> user_id) active_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> class_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_active_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> user_id) <span class="sql-reserved">AS</span> active_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> class_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id</td></tr>
   <tr><td>56</td><td>cron/usage_report.php:1633</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_active(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(sc.user_id) total_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active_temp.active_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(sc.user_id) &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wu_classes_active_temp.active_users / <span class="sql-keyword">COUNT</span>(sc.user_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) perc_active<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_classes_active_temp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id = wu_classes_active_temp.class_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = sc.user_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_active(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(sc.user_id) <span class="sql-reserved">AS</span> total_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active_temp.active_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(sc.user_id) &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wu_classes_active_temp.active_users / <span class="sql-keyword">COUNT</span>(sc.user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> perc_active<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_classes_active_temp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id = wu_classes_active_temp.class_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = sc.user_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> c.class_id = sc.class_id <span class="sql-reserved">AND</span> c.class_id <span class="sql-reserved">NOT IN</span>($classIds) / * * - - us34738 - - * <span class="sql-comment">*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id</td></tr>
   <tr><td>57</td><td>cron/usage_report.php:1653</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">district_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;active_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) <span class="sql-reserved">AS</span> total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id</td></tr>
   <tr><td>58</td><td>cron/usage_report.php:1678</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_se(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> sc.user_id = up.user_id <span class="sql-reserved">AND</span> c.program_id = up.program_id <span class="sql-reserved">AND</span> u.user_id = sc.user_id <span class="sql-reserved">AND</span> up.school_id = sc.school_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_classes_se(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id, class_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id, class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_subscriber_class sc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.classes c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.class_id = sc.class_id <span class="sql-reserved">AND</span> sc.user_id = up.user_id <span class="sql-reserved">AND</span> c.program_id = up.program_id <span class="sql-reserved">AND</span> u.user_id = sc.user_id <span class="sql-reserved">AND</span> up.school_id = sc.school_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sc.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>59</td><td>cron/usage_report.php:1697</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_se a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.class_id = b.class_id <span class="sql-reserved">AND</span> a.program_id = b.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">district_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;active_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) <span class="sql-reserved">AS</span> total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_se a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.class_id = b.class_id <span class="sql-reserved">AND</span> a.program_id = b.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions</td></tr>
   <tr><td>60</td><td>cron/usage_report.php:1725</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_afterschool_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.afterschool_weekday_logins + s.afterschool_weekend_logins<br/>&nbsp;&nbsp;&nbsp;&nbsp;) login_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.afterschool_weekday_logins + s.afterschool_weekend_logins<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_afterschool_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.afterschool_weekday_logins + s.afterschool_weekend_logins<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> login_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.afterschool_weekday_logins + s.afterschool_weekend_logins &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> $start_date_str <span class="sql-reserved">AND</span> $end_date_str <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td></tr>
   <tr><td>61</td><td>cron/usage_report.php:1744</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) login_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.login_total) login_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_afterschool_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(district_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) <span class="sql-reserved">AS</span> login_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.login_total) <span class="sql-reserved">AS</span> login_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_afterschool_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.special_editions</td></tr>
   <tr><td>62</td><td>cron/usage_report.php:1774</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.sf_product_id) <span class="sql-reserved">AS</span> sf_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> aos.student_licenses &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sf_product_id <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">31</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.sf_product_id) <span class="sql-reserved">AS</span> sf_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(aos.student_licenses) <span class="sql-reserved">AS</span> student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> aos.student_licenses &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td></tr>
   <tr><td>63</td><td>cron/usage_report.php:1812</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(e.event_date) last_training_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) trainer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, e.event_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) event_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.events e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_accounts ea,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_accounts ea2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_users eu,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> e.event_id = eu.event_id <span class="sql-reserved">AND</span> u.user_id = eu.user_id <span class="sql-reserved">AND</span> e.event_type_id = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-keyword">NOW</span>() <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.event_status <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'X'</span>, <span class="sql-string">'T'</span>) <span class="sql-reserved">AND</span> e.event_id = ea2.event_id <span class="sql-string">".($accounts ? ("</span> <span class="sql-reserved">AND</span> ea.account_id <span class="sql-reserved">IN</span>($accounts) <span class="sql-string">") : "")."</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>64</td><td>cron/usage_report.php:1841</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ea.account_id) num_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) last_training_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_trainings t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.event_id = ew.event_id)<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(w.workshop_id = ew.workshop_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id = ea.event_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_accounts <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_training_session_title <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ea.account_id) <span class="sql-reserved">AS</span> num_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> last_training_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_trainings t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id = ew.event_id<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_id = ew.workshop_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id = ea.event_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td></tr>
   <tr><td>65</td><td>cron/usage_report.php:1866</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_events(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(e.event_date) last_event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et.event_type_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) last_event_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) trainer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, e.event_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) event_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.events e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_accounts ea,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_users eu,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_types et<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> e.event_id = eu.event_id <span class="sql-reserved">AND</span> u.user_id = eu.user_id <span class="sql-reserved">AND</span> e.event_type_id &lt;&gt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.event_date &lt;= <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.event_status <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'X'</span>, <span class="sql-string">'T'</span>) <span class="sql-reserved">AND</span> et.event_type_id = e.event_type_id <span class="sql-string">".($accounts ? ("</span> <span class="sql-reserved">AND</span> ea.account_id <span class="sql-reserved">IN</span>($accounts) <span class="sql-string">") : "")."</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_events(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>66</td><td>cron/usage_report.php:1896</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) last_event_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(tech.wu_events t)<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.event_id = ew.event_id)<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(w.workshop_id = ew.workshop_id)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_event_session_title <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> last_event_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_events t<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id = ew.event_id<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_id = ew.workshop_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td></tr>
   <tr><td>67</td><td>cron/usage_report.php:1919</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_next_event(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(e.event_type_id, <span class="sql-number">2</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(e.event_type_id, <span class="sql-number">2</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et.event_type_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_event_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(e.event_type_id, <span class="sql-number">2</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status = <span class="sql-string">'T'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Tentative'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status = <span class="sql-string">'S'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Scheduled'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status = <span class="sql-string">'C'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Confirmed'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_event_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(e.event_type_id, <span class="sql-number">2</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_event_trainer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(e.event_type_id, <span class="sql-number">2</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) event_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.events e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_accounts ea,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_users eu,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.event_types et<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> e.event_id = eu.event_id <span class="sql-reserved">AND</span> u.user_id = eu.user_id <span class="sql-reserved">AND</span> e.event_date &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.event_status <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'X'</span> <span class="sql-comment">/*, 'T'*/</span>) <span class="sql-string">".($accounts ? ("</span> <span class="sql-reserved">AND</span> ea.account_id <span class="sql-reserved">IN</span>($accounts) <span class="sql-string">") : "")."</span> <span class="sql-reserved">AND</span> et.event_type_id = e.event_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_next_event(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>68</td><td>cron/usage_report.php:1949</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_next_event_titles(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_event_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(tech.wu_next_event t)<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.event_id = ew.event_id)<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(w.workshop_id = ew.workshop_id)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_next_event_titles(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(event_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_event_session_title <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> next_event_session_title<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_next_event t<br/><span class="sql-reserved">LEFT JOIN</span> event_workshops ew <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id = ew.event_id<br/><span class="sql-reserved">LEFT JOIN</span> workshops w <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;w.workshop_id = ew.workshop_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.event_id</td></tr>
   <tr><td>69</td><td>cron/usage_report.php:1975</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / $num_weeks<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / u.total_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_weekly_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_emails) total_emails,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_time) total_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.mail_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_mail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_time + t.bonus_news_time + t.stretch_news_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_activity_time + t.bonus_activity_time + stretch_activity_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_tq_time + t.bonus_tq_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_activity_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_tq_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.writing_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_writing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.stock_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_stocks,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.other_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_other<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_summary_time t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = t.user_id <span class="sql-reserved">AND</span> s.class_id = t.class_id <span class="sql-reserved">AND</span> s.daily_date = t.daily_date <span class="sql-reserved">AND</span> s.school_id = t.school_id <span class="sql-reserved">AND</span> s.program_id = t.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_users l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.program_id = l.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> u.school_id = s.school_id <span class="sql-reserved">AND</span> u.program_id = s.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">wrong<br/>&nbsp;&nbsp;&nbsp;&nbsp;db</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities + average_biology_score * s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / $num_weeks / u.total_students <span class="sql-reserved">AS</span> avg_weekly_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_emails) <span class="sql-reserved">AS</span> total_emails,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_time) <span class="sql-reserved">AS</span> total_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.mail_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_mail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_time + t.bonus_news_time + t.stretch_news_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_activity_time + t.bonus_activity_time + stretch_activity_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_tq_time + t.bonus_tq_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_activity_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_tq_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.writing_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_writing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.stock_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_stocks,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.other_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_other<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_summary_time t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = t.user_id <span class="sql-reserved">AND</span> s.class_id = t.class_id <span class="sql-reserved">AND</span> s.daily_date = t.daily_date <span class="sql-reserved">AND</span> s.school_id = t.school_id <span class="sql-reserved">AND</span> s.program_id = t.program_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_users l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.program_id = l.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> u.school_id = s.school_id <span class="sql-reserved">AND</span> u.program_id = s.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions</td></tr>
   <tr><td>70</td><td>cron/usage_report.php:2052</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.basic_news_activities_YTD,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.biology_activities_YTD<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_totals <span class="sql-keyword">Y</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users_all u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = <span class="sql-keyword">Y</span>.user_id <span class="sql-reserved">AND</span> u.school_id = <span class="sql-keyword">Y</span>.school_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_year <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $school_years) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.user_id = l.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = l.school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(class_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_year <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_YTD <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_activities_YTD <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.basic_news_activities_YTD,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.biology_activities_YTD<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_totals <span class="sql-keyword">Y</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_users_all u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = <span class="sql-keyword">Y</span>.user_id <span class="sql-reserved">AND</span> u.school_id = <span class="sql-keyword">Y</span>.school_id <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_year <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $school_years) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.user_id = l.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = l.school_id</td></tr>
   <tr><td>71</td><td>cron/usage_report.php:2123</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_activities(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_YTD + biology_activities_YTD<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_totals t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id = up.user_id <span class="sql-reserved">AND</span> t.school_id = up.school_id <span class="sql-reserved">AND</span> t.program_id = up.program_id <span class="sql-reserved">AND</span> u.school_id = up.school_id <span class="sql-reserved">AND</span> u.program_id = up.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions <span class="sql-reserved">AND</span> ay.academic_year_id = u.academic_year_id <span class="sql-reserved">AND</span> t.school_year = <span class="sql-keyword">YEAR</span>(ay.end_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_activities(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_YTD + biology_activities_YTD<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_totals t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id = up.user_id <span class="sql-reserved">AND</span> t.school_id = up.school_id <span class="sql-reserved">AND</span> t.program_id = up.program_id <span class="sql-reserved">AND</span> u.school_id = up.school_id <span class="sql-reserved">AND</span> u.program_id = up.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions <span class="sql-reserved">AND</span> ay.academic_year_id = u.academic_year_id <span class="sql-reserved">AND</span> t.school_year = <span class="sql-keyword">YEAR</span>(ay.end_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id</td></tr>
   <tr><td>72</td><td>cron/usage_report.php:2150</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary_sub(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $yesterday)."'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_summary_sub(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;yearmonth <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_year <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;week_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;grade_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;language_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_reading_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_lexile_num <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bayes_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;math_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_for_you_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bayes_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bonus_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_stretch_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_math_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;open_ended_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;dnd_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;vocabulary_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_vocabulary_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;writing_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reading_connections <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;poll_pairs <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;before_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;after_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;refer_to_clicks <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_points <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_achievements <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekday_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekend_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $yesterday)."'</span></td></tr>
   <tr><td>73</td><td>cron/usage_report.php:2164</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_activities_sub(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary_sub s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_user_activities_sub(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary_sub s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td></tr>
   <tr><td>74</td><td>cron/usage_report.php:2193</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">30</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_30_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_activities a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_1_19_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_0_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_1_9_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_10_19_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_20_39_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_30_39_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_40_79_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_80_plus_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">30</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_30_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_activities a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.special_editions</td></tr>
   <tr><td>75</td><td>cron/usage_report.php:2229</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od_old.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Renew'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'New'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) renewal_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> o.order_id) order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.order_date) order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od_myo.end_date) contract_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.renewal_extension) renewal_extension<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> u.program_id = od.program_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> od.academic_year_id = u.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_old<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_old.account_id <span class="sql-reserved">AND</span> od_old.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_old.academic_year_end &lt; ay.end_date <span class="sql-reserved">AND</span>(od_old.summer = ay.summer) <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_myo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_myo.account_id <span class="sql-reserved">AND</span> u.program_id = od_myo.program_id <span class="sql-reserved">AND</span> od.order_id = od_myo.order_id <span class="sql-reserved">AND</span> od_myo.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_myo.reportable_exclude = <span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">16</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_extension <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od_old.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Renew'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'New'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> renewal_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> o.order_id) <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.order_date) <span class="sql-reserved">AS</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od_myo.end_date) <span class="sql-reserved">AS</span> contract_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.renewal_extension) <span class="sql-reserved">AS</span> renewal_extension<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> u.program_id = od.program_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> od.academic_year_id = u.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_old<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_old.account_id <span class="sql-reserved">AND</span> od_old.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_old.academic_year_end &lt; ay.end_date <span class="sql-reserved">AND</span> od_old.summer = ay.summer <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span><br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_myo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_myo.account_id <span class="sql-reserved">AND</span> u.program_id = od_myo.program_id <span class="sql-reserved">AND</span> od.order_id = od_myo.order_id <span class="sql-reserved">AND</span> od_myo.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_myo.reportable_exclude = <span class="sql-string">'N'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id</td></tr>
   <tr><td>76</td><td>cron/usage_report.php:2266</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;was.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.onsite_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.remaining_pls<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_info o<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_summary was<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = was.account_id <span class="sql-reserved">AND</span> o.program_id = was.program_id <span class="sql-reserved">AND</span> o.academic_year_id = was.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_pd pd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = pd.account_id <span class="sql-reserved">AND</span> o.program_id = pd.program_id <span class="sql-reserved">AND</span> o.academic_year_id = pd.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_account_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">16</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_extension <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_scheduled_pd <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;remaining_pls <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;was.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.onsite_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd.remaining_pls<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_info o<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_summary was<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = was.account_id <span class="sql-reserved">AND</span> o.program_id = was.program_id <span class="sql-reserved">AND</span> o.academic_year_id = was.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_pd pd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = pd.account_id <span class="sql-reserved">AND</span> o.program_id = pd.program_id <span class="sql-reserved">AND</span> o.academic_year_id = pd.academic_year_id</td></tr>
   <tr><td>77</td><td>cron/usage_report.php:2294</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_school_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.start_date school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.end_date school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_info i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = i.account_id <span class="sql-reserved">AND</span> u.program_id = i.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id = <span class="sql-number">11</span> <span class="sql-reserved">AND</span> a.account_id = u.account_id <span class="sql-reserved">AND</span> a.summer = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_school_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.start_date <span class="sql-reserved">AS</span> school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.end_date <span class="sql-reserved">AS</span> school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_account_info i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = i.account_id <span class="sql-reserved">AND</span> u.program_id = i.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id = <span class="sql-number">11</span> <span class="sql-reserved">AND</span> a.account_id = u.account_id <span class="sql-reserved">AND</span> a.summer = <span class="sql-number">0</span></td></tr>
   <tr><td>78</td><td>cron/usage_report.php:2340</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_tables(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.db,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.sub_table,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.report_summary_tables t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.main_table = <span class="sql-string">'user_summary'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_start <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">OR</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">OR</span> t.start_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_tables(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.db,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.sub_table,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$db_pick.report_summary_tables t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.main_table = <span class="sql-string">'user_summary'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_start <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">OR</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">OR</span> t.start_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-reserved">IF</span>(t.end_date, t.end_date, <span class="sql-keyword">NOW</span>()) <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</td></tr>
   <tr><td>79</td><td>cron/usage_report.php:2366</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_user_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.daily_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.basic_news_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.average_basic_news_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.average_biology_score<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary <span class="sql-keyword">Y</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_school_dates t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id = t.school_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = t.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id = up.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = up.school_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = up.program_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.daily_date <span class="sql-reserved">BETWEEN</span> t.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.user_id = l.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = l.program_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = l.school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_user_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.daily_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.basic_news_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.average_basic_news_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.average_biology_score<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary <span class="sql-keyword">Y</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_school_dates t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.school_id = t.school_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = t.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">Y</span>.user_id = up.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = up.school_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = up.program_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.daily_date <span class="sql-reserved">BETWEEN</span> t.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.school_end &gt; <span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . date("Y-m-d", $end_date) . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.user_id = l.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.program_id = l.program_id <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.school_id = l.school_id</td></tr>
   <tr><td>80</td><td>cron/usage_report.php:2389</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score * biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score * biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_user_summary<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;avg_score <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">27</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_score <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_activities <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities + average_biology_score * biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities + average_biology_score * biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_user_summary<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td></tr>
   <tr><td>81</td><td>cron/usage_report.php:2566</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = d.account_id <span class="sql-reserved">AND</span> u.program_name = d.program_name <span class="sql-reserved">AND</span> u.special_editions = d.special_editions <span class="sql-reserved">AND</span> u.academic_year = d.academic_year <span class="sql-reserved">AND</span> u.report_end_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> d.school_end</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;special_editions <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_students <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;active_students <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = d.account_id <span class="sql-reserved">AND</span> u.program_name = d.program_name <span class="sql-reserved">AND</span> u.special_editions = d.special_editions <span class="sql-reserved">AND</span> u.academic_year = d.academic_year <span class="sql-reserved">AND</span> u.report_end_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> d.school_end</td></tr>
   <tr><td>82</td><td>cron/usage_report.php:2585</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.total_students) total_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.active_students) active_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.student_licenses) total_licenses_ytd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_usage_ytd u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = d.account_id <span class="sql-reserved">AND</span> u.program_name = d.program_name <span class="sql-reserved">AND</span> u.special_editions = d.special_editions<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#	AND u.academic_year = d.academic_year</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(u.report_start_date) = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(u.report_end_date) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> u.report_end_date &lt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>83</td><td>cron/usage_report.php:2610</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_usage_ytd_totals <span class="sql-keyword">Y</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">AND</span> u.program_name = <span class="sql-keyword">Y</span>.program_name <span class="sql-reserved">AND</span> u.special_editions = <span class="sql-keyword">Y</span>.special_editions<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $start_date) . "'</span> <span class="sql-reserved">AND</span> u.report_end_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>84</td><td>cron/usage_report.php:2717</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">WEEKDAY</span>(report_start_date) = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(report_end_date) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> report_end_date &lt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;report_end_date<br/><span class="sql-reserved">DESC</span><br/><span class="sql-reserved">LIMIT</span> <span class="sql-number">4</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>85</td><td>cron/usage_report.php:2734</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.total_students) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.active_students) active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.student_licenses) total_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_usage_ytd u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_usage_4w_dates f<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">WEEKDAY</span>(u.report_start_date) = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(u.report_end_date) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> u.report_end_date &lt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> u.report_start_date = f.report_start_date <span class="sql-reserved">AND</span> u.report_end_date = f.report_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">4</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(special_editions)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>86</td><td>cron/usage_report.php:2758</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_4w_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.special_editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_usage_4w w<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = w.account_id <span class="sql-reserved">AND</span> u.program_name = w.program_name <span class="sql-reserved">AND</span> u.special_editions = w.special_editions<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $start_date) . "'</span> <span class="sql-reserved">AND</span> u.report_end_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> w.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_4w_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>87</td><td>cron/usage_report.php:2967</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_licenses_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(student_licenses) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . ($hisd_run ? "</span> program_id = <span class="sql-string">'15'</span> <span class="sql-string">" : "</span> program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">") . "</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_licenses_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>88</td><td>cron/usage_report.php:2988</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> $tmp_users_all s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(u.school_id = s.school_id)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_programs up<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.school_id = up.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> u.program_id = up.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> $tmp_users_all s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id = s.school_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_programs up<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id = up.school_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> u.program_id = up.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td></tr>
   <tr><td>89</td><td>cron/usage_report.php:3020</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_active_users_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.total_logins),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.total_logins<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> l.school_id = u.school_id <span class="sql-reserved">AND</span> l.program_id = u.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_teacher_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_active_users_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_logins <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.subscriber_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(l.total_logins),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.total_logins<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_logins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_login_log_active l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> l.school_id = u.school_id <span class="sql-reserved">AND</span> l.program_id = u.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type &lt;&gt; <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> total_logins &gt;= <span class="sql-string">'$num_teacher_logins'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>90</td><td>cron/usage_report.php:3039</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_admins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users_by_program<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_students <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_teachers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_admins <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["school"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_admins<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users_by_program<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>91</td><td>cron/usage_report.php:3065</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_teachers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["teacher"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_teachers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_active_users<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td></tr>
   <tr><td>92</td><td>cron/usage_report.php:3088</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> s.user_id) fidelity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = up.user_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> s.basic_news_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id = l.user_id <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id <span class="sql-reserved">AND</span> s.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> s.user_id) <span class="sql-reserved">AS</span> fidelity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = up.user_id <span class="sql-reserved">AND</span> s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id = u.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> u.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> s.basic_news_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id = l.user_id <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> s.program_id = l.program_id <span class="sql-reserved">AND</span> s.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = up.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id</td></tr>
   <tr><td>93</td><td>cron/usage_report.php:3123</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = u.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;active_classes <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> a.class_id) <span class="sql-reserved">AS</span> total_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perc_active &gt;= <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.class_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> active_classes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_classes_active a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.school_id = u.school_id <span class="sql-reserved">AND</span> a.program_id = u.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td></tr>
   <tr><td>94</td><td>cron/usage_report.php:3149</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) login_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_afterschool_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> l.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> u.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> l.user_id) <span class="sql-reserved">AS</span> login_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_users tmp_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_afterschool_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.user_id = tmp_users.user_id <span class="sql-reserved">AND</span> l.school_id = tmp_users.school_id <span class="sql-reserved">AND</span> tmp_users.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> l.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.school_id = l.school_id <span class="sql-reserved">AND</span> u.program_id = l.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td></tr>
   <tr><td>95</td><td>cron/usage_report.php:3177</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_pre,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["mid"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_inter,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["post"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_post,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["summer_pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_summer_pre<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> a.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> a.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_pre <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_inter <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_post <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_summer_pre <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_pre,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["mid"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_inter,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["post"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_post,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.assessment_id = <span class="sql-string">'" . $ASSESSMENT["summer_pre"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_summer_pre<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = d.assessment_date_id <span class="sql-reserved">AND</span> a.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> a.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td></tr>
   <tr><td>96</td><td>cron/usage_report.php:3209</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / $num_weeks<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / p.total_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_weekly_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_time) total_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.mail_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_mail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_time + t.bonus_news_time + t.stretch_news_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_activity_time + t.bonus_activity_time + stretch_activity_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_tq_time + t.bonus_tq_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_news_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_activity_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_tq_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_bio_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.writing_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_writing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.stock_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_stocks,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.other_time) /(<span class="sql-keyword">SUM</span>(s.total_time)) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) time_spent_other<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage_by_program p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_summary_time t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = t.user_id <span class="sql-reserved">AND</span> s.class_id = t.class_id <span class="sql-reserved">AND</span> s.daily_date = t.daily_date <span class="sql-reserved">AND</span> s.school_id = t.school_id <span class="sql-reserved">AND</span> s.program_id = t.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_users l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.program_id = l.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> u.school_id = s.school_id <span class="sql-reserved">AND</span> u.program_id = s.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions <span class="sql-reserved">AND</span> u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.school_id = p.school_id <span class="sql-reserved">AND</span> u.academic_year_id = p.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score * basic_news_activities + average_biology_score * s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / $num_weeks / p.total_students <span class="sql-reserved">AS</span> avg_weekly_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(s.total_time) <span class="sql-reserved">AS</span> total_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.mail_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_mail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_time + t.bonus_news_time + t.stretch_news_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_activity_time + t.bonus_activity_time + stretch_activity_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.news_tq_time + t.bonus_tq_time<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_news_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_activity_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio_mc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.biology_tq_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_bio_tq,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.writing_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_writing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.stock_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_stocks,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(t.other_time) / <span class="sql-keyword">SUM</span>(s.total_time) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> time_spent_other<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage_by_program p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_user_summary_time t<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = t.user_id <span class="sql-reserved">AND</span> s.class_id = t.class_id <span class="sql-reserved">AND</span> s.daily_date = t.daily_date <span class="sql-reserved">AND</span> s.school_id = t.school_id <span class="sql-reserved">AND</span> s.program_id = t.program_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_ls_users l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = l.user_id <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.program_id = l.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = up.user_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.program_id = up.program_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $start_date)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'".date("Y-m-d", $end_date)."'</span> <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-string">'" . $SUBSCRIBER_TYPES["student"] . "'</span> <span class="sql-reserved">AND</span> u.school_id = s.school_id <span class="sql-reserved">AND</span> u.program_id = s.program_id <span class="sql-reserved">AND</span> u.special_editions = up.special_editions <span class="sql-reserved">AND</span> u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.school_id = p.school_id <span class="sql-reserved">AND</span> u.academic_year_id = p.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id</td></tr>
   <tr><td>97</td><td>cron/usage_report.php:3273</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">30</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_30_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/* Because we can have records for more than one academic year, we need to group by academic year */</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ua.ytd_activities) ytd_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_activities ua<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> tech.wu_schools s<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.school_id = ua.school_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> tech.wu_account_academic_year ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.account_id = s.account_id <span class="sql-reserved">AND</span> ua.program_id = ay.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>) a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">INT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_1_19_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_0_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_1_9_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_10_19_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_20_39_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_30_39_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_40_79_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ytd_80_plus_activity_users <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">30</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_30_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ua.ytd_activities) <span class="sql-reserved">AS</span> ytd_activities,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_activities ua<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> tech.wu_schools s<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.school_id = ua.school_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> tech.wu_account_academic_year ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.account_id = s.account_id <span class="sql-reserved">AND</span> ua.program_id = ay.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>) a<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id</td></tr>
   <tr><td>98</td><td>cron/usage_report.php:3317</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_user_summary s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> counts_temp2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;avg_score <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">27</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_score <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_activities <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities + s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> avg_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities + s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_score,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ytd_user_summary s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id</td></tr>
   <tr><td>99</td><td>cron/usage_report.php:3343</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info_by_order(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od_myo.end_date) contract_end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> u.program_id = od.program_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> od.academic_year_id = u.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_myo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_myo.account_id <span class="sql-reserved">AND</span> u.program_id = od_myo.program_id <span class="sql-reserved">AND</span> od.order_id = od_myo.order_id <span class="sql-reserved">AND</span> od_myo.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_myo.reportable_exclude = <span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = os.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info_by_order(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od_myo.end_date) <span class="sql-reserved">AS</span> contract_end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_account_usage u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> u.program_id = od.program_id <span class="sql-reserved">AND</span> od.reportable_exclude = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> od.academic_year_id = u.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_order_details_all od_myo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od_myo.account_id <span class="sql-reserved">AND</span> u.program_id = od_myo.program_id <span class="sql-reserved">AND</span> od.order_id = od_myo.order_id <span class="sql-reserved">AND</span> od_myo.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od_myo.reportable_exclude = <span class="sql-string">'N'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>100</td><td>cron/usage_report.php:3377</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> order_id) order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(order_total) order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(order_date) order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(contract_end_date) contract_end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_info_by_order<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_order_info_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(school_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> order_id) <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(order_total) <span class="sql-reserved">AS</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(order_date) <span class="sql-reserved">AS</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(contract_end_date) <span class="sql-reserved">AS</span> contract_end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_order_info_by_order<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>101</td><td>cron/usage_report.php:3475</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$program_rollup_table u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = d.account_id <span class="sql-reserved">AND</span> u.academic_year = d.academic_year <span class="sql-reserved">AND</span> d.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $use_programs) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.report_end_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> d.school_end</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$program_rollup_table u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = d.account_id <span class="sql-reserved">AND</span> u.academic_year = d.academic_year <span class="sql-reserved">AND</span> d.program_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $use_programs) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> u.report_end_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> d.school_end</td></tr>
   <tr><td>102</td><td>cron/usage_report.php:3492</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_totals_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.total_students) total_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.active_students) active_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.student_licenses) total_licenses_ytd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(tech.wu_usage_ytd_by_program u)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">WEEKDAY</span>(u.report_start_date) = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(u.report_end_date) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> u.report_end_date &lt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_ytd_totals_by_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>103</td><td>cron/usage_report.php:3513</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_by_program_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$program_rollup_table u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_usage_ytd_totals_by_program <span class="sql-keyword">Y</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">AND</span> u.academic_year = <span class="sql-keyword">Y</span>.academic_year<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $start_date) . "'</span> <span class="sql-reserved">AND</span> u.report_end_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_ytd_by_program_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>104</td><td>cron/usage_report.php:3553</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.total_students) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.active_students) active_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(u.student_licenses) student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_usage_ytd_by_program u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_usage_4w_dates f<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">WEEKDAY</span>(u.report_start_date) = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">WEEKDAY</span>(u.report_end_date) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> u.report_end_date &lt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> u.report_start_date = f.report_start_date <span class="sql-reserved">AND</span> u.report_end_date = f.report_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">4</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_usage_4w(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>105</td><td>cron/usage_report.php:3577</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_4w_by_program_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$program_rollup_table u<br/><span class="sql-reserved">LEFT JOIN</span> tech.wu_usage_4w <span class="sql-keyword">Y</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">AND</span> u.academic_year = <span class="sql-keyword">Y</span>.academic_year<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.report_start_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $start_date) . "'</span> <span class="sql-reserved">AND</span> u.report_end_date = <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', $end_date) . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">Y</span>.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.wu_4w_by_program_missing_accounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id)<br/>) <span class="sql-keyword">ENGINE</span> = INNODB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>106</td><td>reports/qcpr/renewals/generate_data.php:101</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(il_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(nvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(vp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(rvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(srvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(dm_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*Manager/User Group Data*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) nvp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No NVP'</span>) nvp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) nvp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) vp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No VP'</span>) vp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) vp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.srvp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) srvp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.srvp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>) srvp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.srvp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) srvp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) rvp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No RVP'</span>) rvp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) rvp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.dm_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) dm_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.dm, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>) dm,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.dm_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) dm_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.area_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.<span class="sql-variable">`area`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id il_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_f_last renewal_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.status user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.renewal_qcpr_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.termination_date termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.area_comp_plan_type <span class="sql-reserved">IN</span>(<span class="sql-string">'nvp'</span>, <span class="sql-string">'vp'</span>, <span class="sql-string">'rvp'</span>, <span class="sql-string">'srvp'</span>, <span class="sql-string">'dm'</span>, <span class="sql-string">'a3k'</span>) <span class="sql-reserved">THEN</span> u.area_comp_plan_type <span class="sql-reserved">ELSE</span> <span class="sql-string">'renewal_user'</span><br/><span class="sql-keyword">END</span> comp_plan_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.users_cp u<br/><span class="sql-reserved">LEFT JOIN</span> commissions.compensation_plans cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id = u.comp_plan_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.areas a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.area_id = cp.area_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.qcpr_manager_permissions m<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;m.manager_id = <span class="sql-string">'$curr_user_id'</span> <span class="sql-reserved">AND</span> m.user_id = u.user_id <span class="sql-reserved">AND</span> m.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> u.year = $year <span class="sql-reserved">AND</span> u.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> u.renewal_qcpr_status = <span class="sql-number">0</span> <span class="sql-comment">#Has current year order/QC/credit OR non-terminated rep with quota</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$user_where<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.sales_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(il_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(nvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(vp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(rvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(srvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(dm_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>107</td><td>reports/qcpr/renewals/generate_data.php:153</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source_copy(<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_user_data_source</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source_copy(<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_user_data_source</td></tr>
   <tr><td>108</td><td>reports/qcpr/renewals/generate_data.php:172</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;/ * * * * * * * <span class="sql-keyword">USER</span> INFO * * * * * * <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.orig_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.is_primary_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;/ * * * * * * * <span class="sql-keyword">ACCOUNT</span> PROGRAM INFO * * * * * * <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;act.display_sort district_type_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;act.district_type_id district_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;act.district_type_name district_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.auto_credit_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_name district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code district_state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.has_district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_name account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.ultimate_parent_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.ultimate_parent_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.on_target,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'z'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'n'</span><br/><span class="sql-keyword">END</span> on_target_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> orig_on_target,<br/>base.purchaser_level purchaser_level_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.purchaser_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District Purchase'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'School Purchase'</span><br/><span class="sql-keyword">END</span> purchaser_level,<br/>base.program_id,<br/>/ * * * * * * * EXPIRING <span class="sql-keyword">ACCOUNT</span> * * * * * * <span class="sql-comment">*/</span><br/>base.is_myo,<br/><span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'p'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id<br/>) expiring_account_id,<br/>tad.account_name expiring_account,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rq.max_on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> orig_expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rq.max_expiring_school_count = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> base.auto_credit_type_id != <span class="sql-number">4</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> expiring_order_account_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated_myo <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> myo_expiring_order_account_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> total_expiring_order_account_value,<br/>rq.max_on_target,<br/>base.non_quota_account,<br/>district_re_allocated,<br/>/ * * * * * * * <span class="sql-keyword">NEW</span> <span class="sql-reserved">ORDER</span> * * * * * * <span class="sql-comment">*/</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">2</span><br/><span class="sql-keyword">END</span> rank,<br/>base.school_rank,<br/>base.user_account_display_sort,<br/>base.order_id booked_order_id,<br/>base.order_id booked_order,<br/>co.cancel,<br/><span class="sql-keyword">IFNULL</span>(co.order_total, os.order_total) order_total,<br/><span class="sql-keyword">IFNULL</span>(base.orig_school_count, <span class="sql-number">0</span>) orig_booked_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.max_booked_school_count <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> booked_school_count,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1 + more_schools_yr_1<br/>) booked_order_account_value_yr_1,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1 + more_schools_yr_1<br/>) <span class="sql-reserved">ELSE</span> base.all_yr_value<br/><span class="sql-keyword">END</span> booked_order_account_value,<br/>/ * * * * * * QC * * * * * <span class="sql-comment">*/</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> qc_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> qc_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> myo_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.qc_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) qc_percent,<br/>upsell_qc_total,<br/>qc_total + upsell_qc_total acv_upsell_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(qc_total + upsell_qc_total) / rq.renewal_quota_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) acv_upsell_qc_percent,<br/>/ * * * * * * ACV * * * * * <span class="sql-comment">*/</span><br/>base.single_year_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> acv_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> acv_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> acv_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> myo_acv_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> acv_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota_myo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> myo_acv_percent,<br/>/ * * * * * * Target <span class="sql-keyword">EXPANSION</span> * * * * * <span class="sql-comment">*/</span><br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1<br/>) -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>) target_school_upsell,<br/><span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) more_schools_target_year,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1<br/>&nbsp;&nbsp;&nbsp;&nbsp;) -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) + <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) expansion_total_target_yr,<br/>/ * * * * * * * <span class="sql-keyword">ACCOUNT</span> <span class="sql-keyword">LEVEL</span> ADDTL INFO * * * * * * <span class="sql-comment">*/</span><br/>rq.expiring_orders,<br/>rq.expiring_orders_myo,<br/>rq.expiring_sub_programs,<br/>rq.expiring_sub_programs_myo,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rq.expiring_sub_programs &gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> rq.expiring_sub_programs_myo &gt; <span class="sql-string">''</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' | '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs_myo<br/>) <span class="sql-reserved">WHEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs_myo, <span class="sql-string">''</span>)<br/>) &gt; <span class="sql-string">''</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs_myo<br/>) <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> exp_sub_program,<br/>tad.account_trainer,<br/>tad.account_imp_rvp,<br/><span class="sql-string">'data'</span> row_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users base<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.account_id = base.account_id <span class="sql-reserved">AND</span> rb.order_id = base.order_id <span class="sql-reserved">AND</span> rb.user_id = base.user_id <span class="sql-reserved">AND</span> rb.is_myo = base.is_myo <span class="sql-reserved">AND</span> rb.program_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;co.order_id = base.order_id <span class="sql-reserved">AND</span> co.cmonth = <span class="sql-string">'$data_ref_month'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products op<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.qcpr_account_districts tad<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = base.account_id <span class="sql-reserved">AND</span> tad.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.users_cp cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id = base.user_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_renewal_quotas_reporting rq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id = rq.account_id <span class="sql-reserved">AND</span> base.user_id = rq.user_id <span class="sql-reserved">AND</span> base.base_user_id = rq.base_user_id <span class="sql-reserved">AND</span> base.program_id = rq.program_id <span class="sql-reserved">AND</span> base.purchaser_level = rq.purchaser_level <span class="sql-reserved">AND</span> rq.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.auto_credit_types act<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.auto_credit_type_id = act.auto_credit_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> base.user_id = base.base_user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#TESTING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#LIMIT 1000</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id <span class="sql-reserved">AS</span> renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.orig_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.is_primary_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;act.display_sort <span class="sql-reserved">AS</span> district_type_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;act.district_type_id <span class="sql-reserved">AS</span> district_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;act.district_type_name <span class="sql-reserved">AS</span> district_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.auto_credit_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id <span class="sql-reserved">AS</span> district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_name <span class="sql-reserved">AS</span> district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code <span class="sql-reserved">AS</span> district_state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code <span class="sql-reserved">AS</span> district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.has_district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_name <span class="sql-reserved">AS</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code <span class="sql-reserved">AS</span> state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code <span class="sql-reserved">AS</span> state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.ultimate_parent_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.ultimate_parent_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.on_target,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'z'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'n'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> on_target_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> orig_on_target,<br/>base.purchaser_level <span class="sql-reserved">AS</span> purchaser_level_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.purchaser_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District Purchase'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'School Purchase'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> purchaser_level,<br/>base.program_id,<br/>base.is_myo,<br/><span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'p'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id<br/>) <span class="sql-reserved">AS</span> expiring_account_id,<br/>tad.account_name <span class="sql-reserved">AS</span> expiring_account,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rq.max_on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> orig_expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rq.max_expiring_school_count = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> base.auto_credit_type_id != <span class="sql-number">4</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> expiring_order_account_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated_myo <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> myo_expiring_order_account_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.renewal_quota_updated_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> total_expiring_order_account_value,<br/>rq.max_on_target,<br/>base.non_quota_account,<br/>district_re_allocated,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">2</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> rank,<br/>base.school_rank,<br/>base.user_account_display_sort,<br/>base.order_id <span class="sql-reserved">AS</span> booked_order_id,<br/>base.order_id <span class="sql-reserved">AS</span> booked_order,<br/>co.cancel,<br/><span class="sql-keyword">IFNULL</span>(co.order_total, os.order_total) <span class="sql-reserved">AS</span> order_total,<br/><span class="sql-keyword">IFNULL</span>(base.orig_school_count, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> orig_booked_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_account_display_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> rq.max_booked_school_count <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> booked_school_count,<br/>single_year_value + more_products_yr_1 + more_schools_yr_1 <span class="sql-reserved">AS</span> booked_order_account_value_yr_1,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> single_year_value + more_products_yr_1 + more_schools_yr_1 <span class="sql-reserved">ELSE</span> base.all_yr_value<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> booked_order_account_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> qc_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> qc_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> myo_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.qc_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> qc_percent,<br/>upsell_qc_total,<br/>qc_total + upsell_qc_total <span class="sql-reserved">AS</span> acv_upsell_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(qc_total + upsell_qc_total) / rq.renewal_quota_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> acv_upsell_qc_percent,<br/>base.single_year_value,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> acv_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> acv_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> acv_total <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> myo_acv_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> acv_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota_myo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> myo_acv_percent,<br/>/ * * * * * * Target <span class="sql-keyword">EXPANSION</span> * * * * * <span class="sql-comment">*/</span><br/>single_year_value + more_products_yr_1 -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>) <span class="sql-reserved">AS</span> target_school_upsell,<br/><span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> more_schools_target_year,<br/>single_year_value + more_products_yr_1 -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>) + <span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> expansion_total_target_yr,<br/>rq.expiring_orders,<br/>rq.expiring_orders_myo,<br/>rq.expiring_sub_programs,<br/>rq.expiring_sub_programs_myo,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rq.expiring_sub_programs &gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> rq.expiring_sub_programs_myo &gt; <span class="sql-string">''</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' | '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs_myo<br/>) <span class="sql-reserved">WHEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs_myo, <span class="sql-string">''</span>)<br/>) &gt; <span class="sql-string">''</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(rq.expiring_sub_programs, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rq.expiring_sub_programs_myo<br/>) <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> exp_sub_program,<br/>tad.account_trainer,<br/>tad.account_imp_rvp,<br/><span class="sql-string">'data'</span> <span class="sql-reserved">AS</span> row_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users base<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.account_id = base.account_id <span class="sql-reserved">AND</span> rb.order_id = base.order_id <span class="sql-reserved">AND</span> rb.user_id = base.user_id <span class="sql-reserved">AND</span> rb.is_myo = base.is_myo <span class="sql-reserved">AND</span> rb.program_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;co.order_id = base.order_id <span class="sql-reserved">AND</span> co.cmonth = <span class="sql-string">'$data_ref_month'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products op<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.qcpr_account_districts tad<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = base.account_id <span class="sql-reserved">AND</span> tad.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.users_cp cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id = base.user_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_renewal_quotas_reporting rq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id = rq.account_id <span class="sql-reserved">AND</span> base.user_id = rq.user_id <span class="sql-reserved">AND</span> base.base_user_id = rq.base_user_id <span class="sql-reserved">AND</span> base.program_id = rq.program_id <span class="sql-reserved">AND</span> base.purchaser_level = rq.purchaser_level <span class="sql-reserved">AND</span> rq.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.auto_credit_types act<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.auto_credit_type_id = act.auto_credit_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> base.user_id = base.base_user_id <span class="sql-comment">#TESTING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#LIMIT 1000</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
   <tr><td>109</td><td>reports/qcpr/renewals/generate_data.php:280</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source_copy(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_qc_data_source</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source_copy(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_qc_data_source</td></tr>
   <tr><td>110</td><td>reports/qcpr/renewals/generate_data.php:571</td><td style="border-bottom: solid 1px black;"><span class="sql-comment">/* CREATE /* $temporary  */</span><br/><span class="sql-reserved">TABLE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_renewal_export_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">*/</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.last_name <span class="sql-variable">`User`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name <span class="sql-variable">`Renewal Rep User`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account_id <span class="sql-variable">`District ID`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account <span class="sql-variable">`District`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_state <span class="sql-variable">`District State`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_id <span class="sql-variable">`Account ID`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_name <span class="sql-variable">`Account`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tier.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_tier.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-variable">`Account Tier Jan $year`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.state <span class="sql-variable">`State`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.ultimate_parent_id <span class="sql-variable">`Ultimate Parent ID`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.ultimate_parent_name <span class="sql-variable">`Ultimate Parent Name`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District'</span> <span class="sql-reserved">WHEN</span> qc.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'School'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Account Type`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.expiring_sub_programs_myo <span class="sql-reserved">ELSE</span> qc.expiring_sub_programs<br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Program`</span>,<br/>qc.district_type <span class="sql-variable">`District Type`</span>,<br/>qc.purchaser_level <span class="sql-variable">`Purchaser Level`</span>,<br/><span class="sql-comment"># qc.orig_expiring_order_account_value  `Expiring Renewal Quota`,</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rou.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Total Expiring &amp; Non-Expiring`</span>,<br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.expiring_orders_myo <span class="sql-reserved">ELSE</span> qc.expiring_orders<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">','</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">';'</span><br/>) <span class="sql-variable">`Expiring Orders`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> qc.expiring_school_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring # Schools`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> qc.booked_school_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`$year - $year_to # Schools`</span>,<br/><span class="sql-comment">/*school count can be overridden to 1 even if not on target*/</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.orig_on_target = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> qc.booked_school_count = <span class="sql-number">0</span><br/>) <span class="sql-reserved">THEN</span> <span class="sql-string">''</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = rou.base_user_id <span class="sql-reserved">AND</span> qcu.comp_plan_type = <span class="sql-string">'renewal_user'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> rou.is_primary_user = <span class="sql-number">1</span><br/>) <span class="sql-reserved">AND</span> rou.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.rank <span class="sql-reserved">ELSE</span><br/><span class="sql-comment">/*non primary rank*/</span> <span class="sql-string">'1+'</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Order Count (Target Acct)`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Is MYO Row`</span>,<br/><span class="sql-comment"># Expiring ACV</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rou.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Total`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> qc.acv_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring $year - $year_to Renewed`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> qc.acv_percent <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring $year - $year_to Renewed %`</span>,<br/><span class="sql-comment"># MYO ACV</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rou.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`MYO Prior Year`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.myo_acv_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`MYO $year - $year_to Retained`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.is_myo = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.myo_acv_percent <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`MYO $year - $year_to Retained %`</span>,<br/><span class="sql-comment"># UPSELL</span><br/>rou.single_year_value - rou.single_year_acv <span class="sql-variable">`Target School Product Upsell  $year - $year_to`</span>,<br/>rou.more_products_yr_1 - rou.more_products_acv <span class="sql-variable">`Target School More Products Upsell  $year - $year_to Year`</span>,<br/>qc.more_schools_target_year <span class="sql-variable">`More Schools  $year - $year_to Year`</span>,<br/>qc.expansion_total_target_yr <span class="sql-variable">`Total  $year - $year_to Expansion`</span>,<br/>rou.more_schools_more_years + rou.more_products_more_years + rou.target_more_years <span class="sql-variable">`More Years`</span>,<br/>qc.qc_total <span class="sql-variable">`Expiring $year - $year_to Renewed QC`</span>,<br/>qc.myo_qc_total <span class="sql-variable">`MYO $year - $year_to Retained QC`</span>,<br/>rou.upsell_qc_total <span class="sql-variable">`Expansion QC`</span>,<br/>rou.qc_total + rou.upsell_qc_total <span class="sql-comment">/*acv_upsell_qc_total*/</span> <span class="sql-variable">`Total Net Retention QC`</span>,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rou.qc_total + rou.upsell_qc_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / rq.renewal_quota_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-comment">/*qc.acv_upsell_qc_percent*/</span> <span class="sql-variable">`Total Net Retention QC %`</span>,<br/>qc.booked_order_account_value_yr_1 <span class="sql-variable">`Booked $year - $year_to Total`</span>,<br/>qc.booked_order_account_value <span class="sql-variable">`Booked Total`</span>,<br/>qc.booked_order_id <span class="sql-variable">`Booked Order`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District'</span> <span class="sql-reserved">WHEN</span> qc.orig_on_target = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Within Quota'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Not Within Quota'</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Quota Bucket`</span>,<br/>ioc.orig_order_date <span class="sql-variable">`Order Date`</span>,<br/>o.start_date <span class="sql-variable">`Start Date`</span>,<br/>o.end_date <span class="sql-variable">`End Date`</span>,<br/><span class="sql-string">". ( $year &gt;= 2019 ? "</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.increase_due_to_overage = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Increase due to Overage`</span>,<br/><span class="sql-string">" : "" ) ."</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.Cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Is Cancelled`</span>,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_revenue_total<br/>) <span class="sql-variable">`Order Total`</span>,<br/>oi.credit_revenue_total + oi.bad_debt_total <span class="sql-variable">`Credits (Cancels/Bad Debt)`</span>,<br/>o.sales_rep <span class="sql-variable">`Opportunity Owner`</span>,<br/>oi.order_renewal_rep <span class="sql-variable">`Renewal Rep`</span>,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(oi.order_field_rep, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.account_sales_rep<br/>) <span class="sql-variable">`Field Rep`</span>,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oi.order_field_region,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'National Renewal Region'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.area_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>) <span class="sql-variable">`Region`</span>,<br/>qc.account_trainer <span class="sql-variable">`Account Trainer`</span>,<br/>qc.account_imp_rvp <span class="sql-variable">`Account Imp. RVP`</span>,<br/>rou.po_total <span class="sql-variable">`PO Total`</span>,<br/>rou.year_po_total <span class="sql-variable">`$year - $year_to PO Total`</span> <span class="sql-string">"
            .($corporate_report?
            "</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> l.is_domestic = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> l.location_code <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> international<br/><span class="sql-comment">-- EXPIRING</span><br/>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_conf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Conf`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_pre_conf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Pre-Conf`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.teachonomy <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Teachonomy`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd + rxb.imf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_summer + rxb.imf_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rxb.smarty_ants_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rxb.smarty_ants_count<br/><span class="sql-keyword">END</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_conf_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Conf Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_pre_conf_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Pre-Conf Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.teachonomy_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Teachonomy Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rxb.smarty_ants_summer_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rxb.smarty_ants_summer_count<br/><span class="sql-keyword">END</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.math_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Math Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Summer Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Summer Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Summer Count`</span><br/><span class="sql-comment">-- BOOKED</span><br/>,<br/>rbb.literacy <span class="sql-variable">`Literacy`</span>,<br/>rbb.levelset <span class="sql-variable">`Levelset`</span>,<br/>rbb.bae <span class="sql-variable">`BAE`</span>,<br/>rbb.smarty_ants <span class="sql-variable">`Smarty Ants`</span>,<br/>rbb.actively_learn <span class="sql-variable">`Actively Learn`</span>,<br/>rbb.math <span class="sql-variable">`Math`</span>,<br/>rbb.nls_conf <span class="sql-variable">`NLS Conf`</span>,<br/>rbb.nls_pre_conf <span class="sql-variable">`NLS Pre-Conf`</span>,<br/>rbb.teachonomy <span class="sql-variable">`Teachonomy`</span>,<br/>rbb.literacy_misc <span class="sql-variable">`Literacy Misc`</span>,<br/>rbb.smarty_ants_misc <span class="sql-variable">`Smarty Ants Misc`</span>,<br/>rbb.actively_learn_misc <span class="sql-variable">`Actively Learn Misc`</span>,<br/>rbb.math_misc <span class="sql-variable">`Math Misc`</span>,<br/>rbb.science <span class="sql-variable">`Science`</span>,<br/>rbb.onsite_pd + rbb.imf <span class="sql-variable">`Onsite PD`</span>,<br/>rbb.online_pd <span class="sql-variable">`Online PD`</span>,<br/>rbb.pm <span class="sql-variable">`PM`</span>,<br/>rbb.literacy_summer <span class="sql-variable">`Literacy Summer`</span>,<br/>rbb.levelset_summer <span class="sql-variable">`Levelset Summer`</span>,<br/>rbb.bae_summer <span class="sql-variable">`BAE Summer`</span>,<br/>rbb.smarty_ants_summer <span class="sql-variable">`Smarty Ants Summer`</span>,<br/>rbb.actively_learn_summer <span class="sql-variable">`Actively Learn Summer`</span>,<br/>rbb.math_summer <span class="sql-variable">`Math Summer`</span>,<br/>rbb.literacy_misc_summer <span class="sql-variable">`Literacy Misc Summer`</span>,<br/>rbb.smarty_ants_misc_summer <span class="sql-variable">`Smarty Ants Misc Summer`</span>,<br/>rbb.actively_learn_misc_summer <span class="sql-variable">`Actively Learn Misc Summer`</span>,<br/>rbb.math_misc_summer <span class="sql-variable">`Math Misc Summer`</span>,<br/>rbb.science_summer <span class="sql-variable">`Science Summer`</span>,<br/>rbb.onsite_pd_summer + rbb.imf_summer <span class="sql-variable">`Onsite PD Summer`</span>,<br/>rbb.online_pd_summer <span class="sql-variable">`Online PD Summer`</span>,<br/>rbb.pm_summer <span class="sql-variable">`PM Summer`</span>,<br/>rbb.literacy_count <span class="sql-variable">`Literacy License Count`</span>,<br/>rbb.levelset_count <span class="sql-variable">`Levelset License Count`</span>,<br/>rbb.bae_count <span class="sql-variable">`BAE License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rbb.smarty_ants_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rbb.smarty_ants_count<br/><span class="sql-keyword">END</span> <span class="sql-variable">`Smarty Ants License Count`</span>,<br/>rbb.actively_learn_count <span class="sql-variable">`Actively Learn License Count`</span>,<br/>rbb.math_count <span class="sql-variable">`Math License Count`</span>,<br/>rbb.nls_conf_count <span class="sql-variable">`NLS Conf Count`</span>,<br/>rbb.nls_pre_conf_count <span class="sql-variable">`NLS Pre-Conf Count`</span>,<br/>rbb.teachonomy_count <span class="sql-variable">`Teachonomy Count`</span>,<br/>rbb.literacy_misc_count <span class="sql-variable">`Literacy Misc Count`</span>,<br/>rbb.smarty_ants_misc_count <span class="sql-variable">`Smarty Ants Misc Count`</span>,<br/>rbb.actively_learn_misc_count <span class="sql-variable">`Actively Learn Misc Count`</span>,<br/>rbb.math_misc_count <span class="sql-variable">`Math Misc Count`</span>,<br/>rbb.science_count <span class="sql-variable">`Science License Count`</span>,<br/>rbb.onsite_pd_count <span class="sql-variable">`Onsite PD Count`</span>,<br/>rbb.online_pd_count <span class="sql-variable">`Online PD Count`</span>,<br/>rbb.pm_count <span class="sql-variable">`PM Count`</span>,<br/>rbb.literacy_summer_count <span class="sql-variable">`Literacy Summer License Count`</span>,<br/>rbb.levelset_summer_count <span class="sql-variable">`Levelset Summer License Count`</span>,<br/>rbb.bae_summer_count <span class="sql-variable">`BAE Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rbb.smarty_ants_summer_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rbb.smarty_ants_summer_count<br/><span class="sql-keyword">END</span> <span class="sql-variable">`Smarty Ants Summer License Count`</span>,<br/>rbb.actively_learn_summer_count <span class="sql-variable">`Actively Learn Summer License Count`</span>,<br/>rbb.math_summer_count <span class="sql-variable">`Math Summer License Count`</span>,<br/>rbb.literacy_misc_summer_count <span class="sql-variable">`Literacy Misc Summer Count`</span>,<br/>rbb.smarty_ants_misc_summer_count <span class="sql-variable">`Smarty Ants Misc Summer Count`</span>,<br/>rbb.actively_learn_misc_summer_count <span class="sql-variable">` Actively Learn Misc Summer Count`</span>,<br/>rbb.math_misc_summer_count <span class="sql-variable">`Math Misc Summer Count`</span>,<br/>rbb.science_summer_count <span class="sql-variable">`Science Summer License Count`</span>,<br/>rbb.onsite_pd_summer_count <span class="sql-variable">`Onsite PD Summer Count`</span>,<br/>rbb.online_pd_summer_count <span class="sql-variable">`Online PD Summer Count`</span>,<br/>rbb.pm_summer_count <span class="sql-variable">`PM Summer Count`</span> <span class="sql-string">"
            : "")
            ."</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users rou<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = rou.account_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_tiers tier<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = tier.account_id <span class="sql-reserved">AND</span> tier.cmonth = <span class="sql-keyword">CONCAT</span>(<span class="sql-string">'$year-01-01'</span>)<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_tiers d_tier<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d_tier.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> d_tier.cmonth = <span class="sql-keyword">CONCAT</span>(<span class="sql-string">'$year-01-01'</span>)<br/><span class="sql-reserved">INNER JOIN</span> interlink.temp_renew_qcpr_user_data_source qcu<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = qcu.il_user_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.temp_renew_qcpr_qc_data_source qc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.order_id = qc.booked_order_id <span class="sql-reserved">AND</span> rou.account_id = qc.account_id <span class="sql-reserved">AND</span> rou.program_id = qc.program_id <span class="sql-reserved">AND</span> rou.base_user_id = qc.user_id <span class="sql-reserved">AND</span> qc.is_myo = rou.is_myo<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.base_user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = rou.order_id <span class="sql-reserved">AND</span> o.cmonth = <span class="sql-string">'$data_ref_month'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = rou.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-string">'$data_ref_month'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.interlink_orders_copy ioc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ioc.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.qcpr_account_sales_rep asr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.account_id = rou.account_id <span class="sql-reserved">AND</span> asr.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_renewal_quotas_reporting rq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.account_id = rq.account_id <span class="sql-reserved">AND</span> rou.user_id = rq.user_id <span class="sql-reserved">AND</span> rou.base_user_id = rq.base_user_id <span class="sql-reserved">AND</span> rou.program_id = rq.program_id <span class="sql-reserved">AND</span> rou.purchaser_level = rq.purchaser_level <span class="sql-reserved">AND</span> rq.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-string">".($corporate_report?
            "</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_user_order_booked_buckets rbb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rbb.order_id = rou.order_id <span class="sql-reserved">AND</span> rbb.account_id = rou.account_id <span class="sql-reserved">AND</span> rbb.user_id = rou.user_id <span class="sql-reserved">AND</span> rbb.is_myo = rou.is_myo <span class="sql-reserved">AND</span> rbb.program_id = rou.program_id <span class="sql-reserved">AND</span> rbb.base_user_id = rou.base_user_id <span class="sql-reserved">AND</span> rbb.ay_bucket_id = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rbb.cmonth = rou.cmonth<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_user_account_expiring_buckets rxb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rxb.account_id = rou.account_id <span class="sql-reserved">AND</span> rxb.user_id = rou.user_id <span class="sql-reserved">AND</span> rxb.is_myo = rou.is_myo <span class="sql-reserved">AND</span> rxb.program_id = rou.program_id <span class="sql-reserved">AND</span> rxb.base_user_id = rou.base_user_id <span class="sql-reserved">AND</span> rxb.cmonth = rou.cmonth <span class="sql-string">": "</span> <span class="sql-string">").
            "</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.has_district<br/><span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.on_target_id<br/><span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.booked_order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-comment">/* CREATE /* $temporary  */</span> <span class="sql-reserved">TABLE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_renewal_export_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>111</td><td>reports/renewal/index.php:100</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exclude_orders_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = os.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> os.order_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*OR o.se_0_order = 1*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exclude_orders_$table_suffix</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = os.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> os.order_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>112</td><td>reports/renewal/index.php:136</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price * b.quantity) total_purchased,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.list_price * b.quantity) total_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(b.end_date) order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(ay.end_date) academic_year_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> c.user_id) user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.opportunity_type_name opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> user_orders c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = c.order_id <span class="sql-reserved">AND</span> c.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(bc.contact_id = oc.contact_id)<br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = e.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.order_id = a.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_types ot <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.opportunity_type_id = p.opportunity_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id $whereStr <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>113</td><td>reports/renewal/index.php:185</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> p.product_id = sp.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>114</td><td>reports/renewal/index.php:209</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date = o.order_detail_end <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">28</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date = o.order_detail_end <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">28</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td></tr>
   <tr><td>115</td><td>reports/renewal/index.php:227</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_future_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">DATE_FORMAT</span>(a.order_date, <span class="sql-string">'%c/%e/%y'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products pr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.order_id = e.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.order_id = a.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> pr.product_id = b.product_id <span class="sql-reserved">AND</span> pr.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = pr.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.se_0_order = o.se_0_order <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span> <span class="sql-reserved">AND</span> ay.end_date &gt; o.academic_year_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">DATE_FORMAT</span>(a.order_date, <span class="sql-string">'%c/%e/%y'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products pr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = e.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_id = a.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> pr.product_id = b.product_id <span class="sql-reserved">AND</span> pr.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = pr.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.se_0_order = o.se_0_order <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span> <span class="sql-reserved">AND</span> ay.end_date &gt; o.academic_year_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td></tr>
   <tr><td>116</td><td>reports/renewal/index.php:269</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">STATUS</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id = b.quote_id <span class="sql-reserved">AND</span> c.opportunity_id = a.opportunity_id <span class="sql-reserved">AND</span> c.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.probability_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", array_keys($opportunity_probabilities)) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> op.probability_id = c.probability_id <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = p.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.lead_source_id = <span class="sql-number">7</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> a.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m)-3, 1, date(Y))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span> <span class="sql-reserved">AND</span> ay.end_date &gt; o.academic_year_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span><br/><span class="sql-keyword">STATUS</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = opm.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id = b.quote_id <span class="sql-reserved">AND</span> c.opportunity_id = a.opportunity_id <span class="sql-reserved">AND</span> c.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.probability_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', array_keys($opportunity_probabilities)) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> op.probability_id = c.probability_id <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = p.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.lead_source_id = <span class="sql-number">7</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> a.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m)-3, 1, date(Y))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span> <span class="sql-reserved">AND</span> ay.end_date &gt; o.academic_year_end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td></tr>
   <tr><td>117</td><td>reports/renewal/index.php:304</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id</td></tr>
   <tr><td>118</td><td>reports/renewal/index.php:314</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>)) order_total_plus_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>) total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_non_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) standard_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_standard_discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> b.product_id = c.product_id <span class="sql-reserved">AND</span> product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> order_total_plus_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_non_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> standard_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_standard_discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> b.product_id = c.product_id <span class="sql-reserved">AND</span> product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td></tr>
   <tr><td>119</td><td>reports/renewal/index.php:346</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> exception_products_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.sku <span class="sql-reserved">LIKE</span> <span class="sql-string">'%bbcp%'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Blackbelt'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["pd"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["project_management"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Project Management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["levelset"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Levelset'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . implode("'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' ", $upgrade_product_groups) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Upgrade'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) exception_product<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PRODUCT_GROUPS["fee"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) $whereStr</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> exception_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>120</td><td>reports/renewal/index.php:367</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> no_exception_products_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_product = <span class="sql-string">''</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> no_exception_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_product = <span class="sql-string">''</span></td></tr>
   <tr><td>121</td><td>reports/renewal/index.php:396</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exception_orders_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> exception_product<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception_product <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' only'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exception_orders_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> exception_product<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception_product <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' only'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>122</td><td>reports/renewal/index.php:533</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_years_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_length total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date first_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date last_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-string">'$summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ay_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = c.order_id <span class="sql-reserved">AND</span> b.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.order_id = os.order_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*HAVING total_years &gt; 1*/</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_years_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_length <span class="sql-reserved">AS</span> total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date <span class="sql-reserved">AS</span> order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date <span class="sql-reserved">AS</span> order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date <span class="sql-reserved">AS</span> first_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date <span class="sql-reserved">AS</span> last_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total <span class="sql-reserved">AS</span> multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-string">'$summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ay_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = c.order_id <span class="sql-reserved">AND</span> b.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.order_id = os.order_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>123</td><td>reports/renewal/index.php:549</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_details_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_name buyer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased) total_purchased_no_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(standard_discount_amount) standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_standard_discount_amount) non_standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_new) total_purchased_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_standard) total_purchased_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(order_detail_end) order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u.user_id) sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u2.user_id) account_sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(ur.first_name, <span class="sql-string">' '</span>, ur.last_name) renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u2.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u2.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u3.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u3.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) final_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;final_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.trainer_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;first_start multi_order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_end multi_order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tiers.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ordering_account_id = e.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d.account_id<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_user_id = u2.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.final_user_id = u3.user_id<br/><span class="sql-reserved">LEFT JOIN</span> order_years_$table_suffix nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = nr.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts uar <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = uar.account_id <span class="sql-reserved">AND</span> uar.role_id = <span class="sql-number">25</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment"># renewal rep</span><br/><span class="sql-reserved">LEFT JOIN</span> users ur <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(ur.user_id = uar.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> counties c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(c.county_id = a.county_id)<br/><span class="sql-reserved">LEFT JOIN</span> tiers <span class="sql-reserved">ON</span>(a.tier_id = tiers.tier_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_details_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code <span class="sql-reserved">AS</span> state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id <span class="sql-reserved">AS</span> buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_name <span class="sql-reserved">AS</span> buyer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased) <span class="sql-reserved">AS</span> total_purchased_no_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(standard_discount_amount) <span class="sql-reserved">AS</span> standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_standard_discount_amount) <span class="sql-reserved">AS</span> non_standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_new) <span class="sql-reserved">AS</span> total_purchased_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_standard) <span class="sql-reserved">AS</span> total_purchased_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(order_detail_end) <span class="sql-reserved">AS</span> order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u.user_id) <span class="sql-reserved">AS</span> sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u2.user_id) <span class="sql-reserved">AS</span> account_sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(ur.first_name, <span class="sql-string">' '</span>, ur.last_name) <span class="sql-reserved">AS</span> renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u2.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u2.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u3.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u3.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> final_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;final_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.trainer_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;first_start <span class="sql-reserved">AS</span> multi_order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_end <span class="sql-reserved">AS</span> multi_order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tiers.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ordering_account_id = e.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d.account_id<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_user_id = u2.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.final_user_id = u3.user_id<br/><span class="sql-reserved">LEFT JOIN</span> order_years_$table_suffix nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts uar <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = uar.account_id <span class="sql-reserved">AND</span> uar.role_id = <span class="sql-number">25</span><br/><span class="sql-reserved">LEFT JOIN</span> users ur <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ur.user_id = uar.user_id<br/><span class="sql-reserved">LEFT JOIN</span> counties c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_id = a.county_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers <span class="sql-reserved">ON</span> a.tier_id = tiers.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name</td></tr>
   <tr><td>124</td><td>reports/renewal/index.php:607</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> product_lines_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) products_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">JOIN</span> order_details b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = b.academic_year_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = b.product_id<br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> product_lines_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>125</td><td>reports/renewal/index.php:634</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> licenses_$table_suffix(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) literacy_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">10</span>, <span class="sql-number">11</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> p.program_id = <span class="sql-number">11</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) literacy_summer_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>) <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) bae_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">10</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) levelset_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) science_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#If SmartyAnts licenses contain a 9999, then display 'Unlimited'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Unlimited'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) smartyants_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Unlimited'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) smartyants_summer_license_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = aos.order_id <span class="sql-reserved">AND</span> aos.account_id = o.account_id<br/><span class="sql-reserved">JOIN</span> order_details b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_detail_id = aos.order_detail_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = b.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> licenses_$table_suffix(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>126</td><td>cron/daily/update_amortization_prior_years.php:199</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink_products { $tmp_table_nm }(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(product_id, row_num)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">CASE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.product_id <span class="sql-reserved">WHEN</span> <span class="sql-variable">@product_id</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@row_num</span> := <span class="sql-variable">@row_num</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@row_num</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@product_id</span> := a.product_id<br/><span class="sql-keyword">END</span> row_num,<br/>a.product_id,<br/>a.sku,<br/>a.product_name,<br/>a.student_licenses,<br/>a.domain_id,<br/>a.program_id,<br/>a.product_group_id,<br/>a.product_set_id,<br/>a.partner_id,<br/>a.sub_product_id,<br/>a.sub_product_type_id,<br/>a.pd_deliverable,<br/>a.orig_list_price,<br/>a.list_price,<br/><span class="sql-number">1</span> quantity,<br/>a.orig_quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.domain_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_set_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.partner_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price orig_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> sp.list_price * sp.sub_product_qty <span class="sql-reserved">ELSE</span> sp.list_price<br/><span class="sql-keyword">END</span> list_price,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> sp.sub_product_qty<br/><span class="sql-keyword">END</span> orig_quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">INNER JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = sp.product_id)<br/><span class="sql-reserved">INNER JOIN</span> sub_product_types spt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = spt.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;list_price<br/>) a<br/><span class="sql-reserved">INNER JOIN</span> pd_quantity q <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(q.quantity &lt;= a.orig_quantity)<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@product_id</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@row_num</span> := <span class="sql-number">0</span><br/>) r<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;list_price</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink_products { $tmp_table_nm }(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(product_id, row_num)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>127</td><td>cron/pro_spk_ytd_mc_fields.php:13</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_user_summary(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19215</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22560</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6353</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6352</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20800</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17677</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">15193</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17777</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17776</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17774</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17773</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17778</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17779</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18989</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">21092</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22063</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_user_summary(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id))</td><td style="border-bottom: solid 1px black;">user_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;class_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;daily_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;yearmonth <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_year <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;week_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;grade_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscriber_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;language_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_reading_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activity_lexile_num <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bayes_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;math_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_for_you_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_basic_news_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bayes_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_bonus_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_stretch_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_math_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_passing <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;stretch_activities_at_100 <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;open_ended_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_basic_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_bonus_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_stretch_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_invalid_news_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;dnd_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;vocabulary_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_vocabulary_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;average_biology_score <span class="sql-reserved">FLOAT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_biology_activities <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;writing_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_news_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_tq <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;biology_submissions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reading_connections <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;basic_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_summarize <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_generate_questions <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_setting_purpose <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;poll_pairs <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;before_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;after_polls <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;refer_to_clicks <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_points <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_achievements <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_total_time <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_emails <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekday_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;afterschool_weekend_logins <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary.ytd_user_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19215</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22560</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6353</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6352</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20800</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17677</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">15193</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17777</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17776</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17774</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17773</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17778</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17779</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18989</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">21092</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22063</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>)</td></tr>
   <tr><td>128</td><td>cron/pro_spk_ytd_mc_fields.php:25</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_user_dates(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;up.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.school_start) school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.school_end) school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;mykidbiz.schools s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = s.account_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19215</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22560</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6353</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6352</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20800</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17677</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">15193</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17777</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17776</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17774</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17773</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17778</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17779</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18989</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">21092</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22063</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> d.program_name <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Language Arts'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Boost'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Access'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'EspaÃ±ol'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Espanol'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Pro'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> up.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.user_id = l.user_id <span class="sql-reserved">AND</span> l.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_user_dates(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id))</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;up.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.school_start) <span class="sql-reserved">AS</span> school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.school_end) <span class="sql-reserved">AS</span> school_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_school_dates d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_user_programs up,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_ls_users l,<br/>&nbsp;&nbsp;&nbsp;&nbsp;mykidbiz.schools s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = s.account_id <span class="sql-reserved">AND</span> s.school_id = up.school_id <span class="sql-reserved">AND</span> s.school_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20100</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19215</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22560</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6353</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6352</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20800</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17677</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">15193</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17777</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17776</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17774</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17773</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17778</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17779</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18989</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">19775</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">21092</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22063</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> d.program_name <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Language Arts'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Boost'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Access'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'EspaÃ±ol'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Espanol'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Pro'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> up.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> s.school_id = l.school_id <span class="sql-reserved">AND</span> up.user_id = l.user_id <span class="sql-reserved">AND</span> l.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> up.subscriber_type = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;up.user_id</td></tr>
   <tr><td>129</td><td>cron/pro_spk_ytd_mc_fields.php:52</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_avg_activity_score(<span class="sql-reserved">KEY</span>(school_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_avg_activity_score_by_account<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_ytd_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = d.user_id <span class="sql-reserved">AND</span> s.school_id = d.school_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_avg_activity_score(<span class="sql-reserved">KEY</span>(school_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.average_basic_news_score * s.basic_news_activities + s.average_biology_score * s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_avg_activity_score_by_account<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_ytd_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = d.user_id <span class="sql-reserved">AND</span> s.school_id = d.school_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id</td></tr>
   <tr><td>130</td><td>cron/pro_spk_ytd_mc_fields.php:117</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_user_activities(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_ytd_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = d.user_id <span class="sql-reserved">AND</span> s.school_id = d.school_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . $report_end_date ."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_user_activities(<span class="sql-reserved">KEY</span>(school_id), <span class="sql-reserved">KEY</span>(user_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.basic_news_activities + s.biology_activities<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_activities<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_ytd_user_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id = d.user_id <span class="sql-reserved">AND</span> s.school_id = d.school_id <span class="sql-reserved">AND</span> s.daily_date <span class="sql-reserved">BETWEEN</span> d.school_start <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end &gt; <span class="sql-string">'" . $report_end_date ."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $report_end_date . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.user_id</td></tr>
   <tr><td>131</td><td>cron/pro_spk_ytd_mc_fields.php:130</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_activities(<span class="sql-reserved">KEY</span>(school_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_activities<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_ytd_activities(<span class="sql-reserved">KEY</span>(school_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities = <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_0_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_1_9_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">10</span> <span class="sql-reserved">AND</span> <span class="sql-number">19</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_10_19_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">20</span> <span class="sql-reserved">AND</span> <span class="sql-number">39</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_20_39_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ytd_activities <span class="sql-reserved">BETWEEN</span> <span class="sql-number">40</span> <span class="sql-reserved">AND</span> <span class="sql-number">79</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_40_79_activity_users,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ytd_activities &gt;= <span class="sql-number">80</span>, <span class="sql-number">1</span>, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ytd_80_plus_activity_users<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_user_activities<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id</td></tr>
   <tr><td>132</td><td>finance/amortization/wizard/generate/generate_data.inc:142</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> convert_pd_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(parent_order_detail_id) parent_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(convert_time) convert_time<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_convert_parents<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_time &gt; <span class="sql-string">'$last_run_date'</span> <span class="sql-reserved">OR</span> convert_time &gt; <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> convert_pd_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_time <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(parent_order_detail_id) <span class="sql-reserved">AS</span> parent_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(convert_time) <span class="sql-reserved">AS</span> convert_time<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_convert_parents<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_time &gt; <span class="sql-string">'$last_run_date'</span> <span class="sql-reserved">OR</span> convert_time &gt; <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td></tr>
   <tr><td>133</td><td>finance/amortization/wizard/generate/generate_data.inc:156</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> prior_years_order_detail_edits(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_detail_id log_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> is_pd_conversion,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> is_detail_update<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_pd_details cpd<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = cpd.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt;= <span class="sql-string">'$lock_year-12-31'</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> prior_years_order_detail_edits(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_detail_id <span class="sql-reserved">AS</span> log_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cpd.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AS</span> is_pd_conversion,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> is_detail_update<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_pd_details cpd<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = cpd.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt;= <span class="sql-string">'$lock_year-12-31'</span></td></tr>
   <tr><td>134</td><td>finance/amortization/wizard/generate/generate_data.inc:169</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_amort_prior_years_updated_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_update_log odl<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odl.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> amortization.lock_month lm<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odl.date_modified &gt; LAST_DAY(lm.lock_month)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'$report_year-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_amort_prior_years_updated_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_update_log odl<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odl.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> amortization.lock_month lm<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odl.date_modified &gt; LAST_DAY(lm.lock_month)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'$report_year-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td></tr>
   <tr><td>135</td><td>finance/amortization/wizard/generate/generate_data.inc:188</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_amort_prior_years_updated_order_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odl.log_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odl.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orn.order_total il_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_total amort_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orn.order_total - oda.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">.01</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> order_totals_match<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_update_log odl<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odl.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders upo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;upo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rn.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_new_renewal_data rn<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders pyo<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = rn.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) orn<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orn.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization_ { $lock_year } <span class="sql-number">1201</span> oda<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders pyo<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = oda.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oda.cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>) oda<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id = o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_amort_prior_years_updated_order_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>136</td><td>finance/amortization/wizard/generate/generate_data.inc:236</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_total_temp(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_total_temp(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>137</td><td>finance/amortization/wizard/generate/generate_data.inc:250</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> include_om_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total il_data_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_total om_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.om_total om_om_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total_temp t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders i<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> multi_year_orders my <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(i.order_id = my.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = i.om_order_id <span class="sql-reserved">AND</span> my.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> i.order_id = t.order_id <span class="sql-reserved">AND</span> i.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4502</span>) <span class="sql-reserved">AND</span> i.order_date &lt; <span class="sql-string">'2009-08-11'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> include_om_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total <span class="sql-reserved">AS</span> il_data_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_total <span class="sql-reserved">AS</span> om_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.om_total <span class="sql-reserved">AS</span> om_om_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total_temp t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders i<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> multi_year_orders my <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id = my.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = i.om_order_id <span class="sql-reserved">AND</span> my.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> i.order_id = t.order_id <span class="sql-reserved">AND</span> i.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4502</span>) <span class="sql-reserved">AND</span> i.order_date &lt; <span class="sql-string">'2009-08-11'</span></td></tr>
   <tr><td>138</td><td>finance/amortization/wizard/generate/generate_data.inc:267</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_future_full_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'f'</span> <span class="sql-reserved">AND</span> oc.cancel_date &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_future_full_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'f'</span> <span class="sql-reserved">AND</span> oc.cancel_date &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>139</td><td>finance/amortization/wizard/generate/generate_data.inc:276</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_future_partial_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'p'</span> <span class="sql-reserved">AND</span> oc.cancel_date &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> oc.cancel_id = od.cancel_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_future_partial_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'p'</span> <span class="sql-reserved">AND</span> oc.cancel_date &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id <span class="sql-reserved">AND</span> oc.cancel_id = od.cancel_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td></tr>
   <tr><td>140</td><td>finance/amortization/wizard/generate/generate_data.inc:291</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.om_om_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> fcn.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CURDATE</span>() cancel_date, <span class="sql-number">9999999999.99</span> cancel_total, <span class="sql-number">9999999999.99</span> tax_cancel_total, <span class="sql-number">9999999999.99</span> cancel_total1, <span class="sql-number">9999999999.99</span> cancel_total2, <span class="sql-number">9999999999.99</span> cancel_total3, <span class="sql-keyword">CURDATE</span>() last_cancel_date, <span class="sql-keyword">CURDATE</span>() first_cancel_date, <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billto,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ns_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.replacement_order_id second_replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.order_date <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) replacement_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total_temp t<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.account_id = a.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> include_om_orders i <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = i.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = p.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts bill<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_id = bill.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.replacement_order_id = r.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders r2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.replacement_order_id = r2.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_future_full_cancels fcn <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fcn.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.order_date != <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &gt; <span class="sql-string">'$lock_year-12-31'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#orders that yael recreated</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(old_order_id, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.recreate_orders_insert<br/>) <span class="sql-reserved">AND</span> o.order_id = t.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.om_om_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> fcn.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> tax_cancel_total, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total1, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total2, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total3, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> last_cancel_date, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> first_cancel_date, <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bill.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billto,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ns_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.replacement_order_id <span class="sql-reserved">AS</span> second_replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.order_date <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> replacement_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total_temp t<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> include_om_orders i <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = i.order_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = p.account_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts bill<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_id = bill.account_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.replacement_order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders r2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.replacement_order_id = r2.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_future_full_cancels fcn <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fcn.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.order_date != <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &gt; <span class="sql-string">'$lock_year-12-31'</span> <span class="sql-comment">#orders that yael recreated</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(old_order_id, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.recreate_orders_insert<br/>) <span class="sql-reserved">AND</span> o.order_id = t.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td></tr>
   <tr><td>141</td><td>finance/amortization/wizard/generate/generate_data.inc:367</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> first_cancel_date(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(oc.cancel_date) cancel_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id = oc.cancel_id <span class="sql-reserved">AND</span> od.order_id = oc.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">OR</span> od.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> first_cancel_date(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(oc.cancel_date) <span class="sql-reserved">AS</span> cancel_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id = oc.cancel_id <span class="sql-reserved">AND</span> od.order_id = oc.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">OR</span> od.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id</td></tr>
   <tr><td>142</td><td>finance/amortization/wizard/generate/generate_data.inc:400</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_no_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.orders_remove_discount r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_id = r.order_id <span class="sql-reserved">AND</span> i.order_date &lt; <span class="sql-string">'2009-07-01'</span> <span class="sql-reserved">AND</span> i.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">0</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_no_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.orders_remove_discount r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_id = r.order_id <span class="sql-reserved">AND</span> i.order_date &lt; <span class="sql-string">'2009-07-01'</span> <span class="sql-reserved">AND</span> i.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">0</span>)</td></tr>
   <tr><td>143</td><td>finance/amortization/wizard/generate/generate_data.inc:411</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> od_quantities(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(od.quantity * sp.sub_product_qty) quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.sub_product_qty &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(od.quantity * sp.sub_product_qty) quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_detail_sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = sp.order_detail_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.sub_product_qty &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CEIL</span>(closed_amount)<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.closed_deliverables d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> od_quantities(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.sub_product_qty &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_detail_sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = sp.order_detail_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.sub_product_qty &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CEIL</span>(closed_amount)<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.closed_deliverables d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td></tr>
   <tr><td>144</td><td>finance/amortization/wizard/generate/generate_data.inc:477</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_sub_products_use(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_detail_sub_products</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_sub_products_use(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_detail_sub_products</td></tr>
   <tr><td>145</td><td>finance/amortization/wizard/generate/generate_data.inc:486</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> products_non_discountable(<span class="sql-reserved">PRIMARY KEY</span>(product_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products pp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_types spt<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> spt.discountable = <span class="sql-string">'Y'</span><br/>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> products_non_discountable(<span class="sql-reserved">PRIMARY KEY</span>(product_id))</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products pp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_types spt<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> spt.discountable = <span class="sql-string">'Y'</span><br/>)</td></tr>
   <tr><td>146</td><td>finance/amortization/wizard/generate/generate_data.inc:503</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_product_list(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(product_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$fee_str fee_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.price - $fee_str) /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - $fee_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_discount_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_detail_sub_products odsp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odsp.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> products_non_discountable nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.product_id = nd.product_id)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sp_list_price_changes slpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;slpc.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> slpc.sub_product_id = sp.sub_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_product_list(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(product_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$fee_str <span class="sql-reserved">AS</span> fee_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.price - $fee_str) /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price * sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - $fee_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_discount_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_detail_sub_products odsp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odsp.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> products_non_discountable nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = nd.product_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sp_list_price_changes slpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;slpc.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> slpc.sub_product_id = sp.sub_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td></tr>
   <tr><td>147</td><td>finance/amortization/wizard/generate/generate_data.inc:524</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, orig_cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, cancel)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id <span class="sql-reserved">AND</span> odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;) orig_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &gt;= spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id <span class="sql-reserved">AND</span> odsp.sub_product_qty &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.quantity = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id <span class="sql-reserved">AND</span> odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &gt;= spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id <span class="sql-reserved">AND</span> odsp.sub_product_qty &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.quantity = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> after_prod_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> after_my_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> after_std_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">199</span> sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.list_price product_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;) list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.quantity orig_quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sub_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &lt; spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable<br/>&nbsp;&nbsp;&nbsp;&nbsp;) pd_deliverable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2009-07-01'</span> <span class="sql-reserved">AND</span> spt.sub_product_type_id = <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.domain_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_set_id = <span class="sql-number">11</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_set_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_set_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.partner_id product_partner_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id orig_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> fpc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">99999</span> cancel_id1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CURDATE</span>() cancel_date1, <span class="sql-number">9999999999.99999999</span> cancel_total1, <span class="sql-number">99999</span> cancel_id2, <span class="sql-keyword">CURDATE</span>() cancel_date2, <span class="sql-number">9999999999.99999999</span> cancel_total2, <span class="sql-number">99999</span> cancel_id3, <span class="sql-keyword">CURDATE</span>() cancel_date3, <span class="sql-number">9999999999.99999999</span> cancel_total3, <span class="sql-number">99999</span> cancel_id4, <span class="sql-keyword">CURDATE</span>() cancel_date4, <span class="sql-number">9999999999.99</span> cancel_total4, <span class="sql-number">99999</span> cancel_id5, <span class="sql-keyword">CURDATE</span>() cancel_date5, <span class="sql-number">9999999999.99</span> cancel_total5, <span class="sql-number">9999999999</span> pd_event_id, od.academic_year_id, ay.academic_year_name academic_year, ay.sort academic_year_sort, <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> slpc.order_detail_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span> list_price_changed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_quantity q<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = od.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts ao<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(ao.account_id = o.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_product_list pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products_use odspu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = odspu.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_discounts nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = nd.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_detail_sub_products odsp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odspu.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders_before_oct06 co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = co.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_future_partial_cancels fpc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> prior_years_order_detail_edits convert_pd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_pd.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> convert_pd.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sp_list_price_changes slpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;slpc.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> slpc.sub_product_id = sp.sub_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt; <span class="sql-string">'$lock_year-12-31'</span> <span class="sql-reserved">OR</span> convert_pd.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * od.quantity &lt;= <span class="sql-number">1</span> <span class="sql-reserved">OR</span> spt.pd_deliverable != <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> od.start_date &lt; spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = q.pd_quantity <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2109</span>) <span class="sql-comment">#remove pd</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1637</span>) <span class="sql-reserved">OR</span> od.price != <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> odsp.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status != <span class="sql-number">2</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> o.om_order_id = od.om_order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odsp.price</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, orig_cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, cancel)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id <span class="sql-reserved">AND</span> odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> orig_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &gt;= spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id <span class="sql-reserved">AND</span> odsp.sub_product_qty &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.quantity = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id <span class="sql-reserved">AND</span> odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &gt;= spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id <span class="sql-reserved">AND</span> odsp.sub_product_qty &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.quantity = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> <span class="sql-reserved">AS</span> after_prod_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> <span class="sql-reserved">AS</span> after_my_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> <span class="sql-reserved">AS</span> after_std_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">999999999.99999999</span> <span class="sql-reserved">AS</span> discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">199</span> <span class="sql-reserved">AS</span> sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.list_price <span class="sql-reserved">AS</span> product_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slpc.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.quantity <span class="sql-reserved">AS</span> orig_quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sub_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.start_date &lt; spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> pd_deliverable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2009-07-01'</span> <span class="sql-reserved">AND</span> spt.sub_product_type_id = <span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.domain_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_set_id = <span class="sql-number">11</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_set_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_set_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.partner_id <span class="sql-reserved">AS</span> product_partner_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">AS</span> orig_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> fpc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">99999</span> <span class="sql-reserved">AS</span> cancel_id1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date1, <span class="sql-number">9999999999.99999999</span> <span class="sql-reserved">AS</span> cancel_total1, <span class="sql-number">99999</span> <span class="sql-reserved">AS</span> cancel_id2, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date2, <span class="sql-number">9999999999.99999999</span> <span class="sql-reserved">AS</span> cancel_total2, <span class="sql-number">99999</span> <span class="sql-reserved">AS</span> cancel_id3, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date3, <span class="sql-number">9999999999.99999999</span> <span class="sql-reserved">AS</span> cancel_total3, <span class="sql-number">99999</span> <span class="sql-reserved">AS</span> cancel_id4, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date4, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total4, <span class="sql-number">99999</span> <span class="sql-reserved">AS</span> cancel_id5, <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">AS</span> cancel_date5, <span class="sql-number">9999999999.99</span> <span class="sql-reserved">AS</span> cancel_total5, <span class="sql-number">9999999999</span> <span class="sql-reserved">AS</span> pd_event_id, od.academic_year_id, ay.academic_year_name <span class="sql-reserved">AS</span> academic_year, ay.sort <span class="sql-reserved">AS</span> academic_year_sort, <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> slpc.order_detail_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> list_price_changed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_quantity q<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.accounts ao<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ao.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_product_list pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products_use odspu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = odspu.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_no_discounts nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nd.order_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_detail_sub_products odsp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odspu.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.orders_before_oct06 co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = co.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_future_partial_cancels fpc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> prior_years_order_detail_edits convert_pd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;convert_pd.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> convert_pd.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.sp_list_price_changes slpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;slpc.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> slpc.sub_product_id = sp.sub_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt; <span class="sql-string">'$lock_year-12-31'</span> <span class="sql-reserved">OR</span> convert_pd.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * od.quantity &lt;= <span class="sql-number">1</span> <span class="sql-reserved">OR</span> spt.pd_deliverable != <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> od.start_date &lt; spt.pd_deliverable_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = q.pd_quantity <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2109</span>) <span class="sql-comment">#remove pd</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1637</span>) <span class="sql-reserved">OR</span> od.price != <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> odsp.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status != <span class="sql-number">2</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> o.om_order_id = od.om_order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odsp.price</td></tr>
   <tr><td>148</td><td>finance/amortization/wizard/generate/generate_data.inc:650</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_parents(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.old_order_detail_id parent_order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_update_log <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = <span class="sql-keyword">LOG</span>.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.old_order_detail_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &lt; <span class="sql-string">'{$report_year}-01-01'</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_parents(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.old_order_detail_id <span class="sql-reserved">AS</span> parent_order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_update_log <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = <span class="sql-keyword">LOG</span>.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.old_order_detail_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &lt; <span class="sql-string">'{$report_year}-01-01'</span></td></tr>
   <tr><td>149</td><td>finance/amortization/wizard/generate/generate_data.inc:735</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> py_order_detail_conversion_sub_product_type_mapping(<span class="sql-reserved">PRIMARY KEY</span>(line_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) mapping_sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.*<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> amortization.prior_years_order_detail_edits pyde<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyde.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd_orig<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd_orig.order_detail_id = pyde.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd_orig.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> pyde.is_pd_conversion = <span class="sql-number">1</span><br/>) od<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_detail_min_convert_parent mcp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;mcp.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt2.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt2.pd_sort = spt.pd_sort<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt3.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt3.pd_sort &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd2.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd2.sub_product_type_id = spt2.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd3.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd3.sub_product_type_id = spt3.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> py_order_detail_conversion_sub_product_type_mapping(<span class="sql-reserved">PRIMARY KEY</span>(line_id))</td><td style="border-bottom: solid 1px black;">line_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;mapping_sub_product_type_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> mapping_sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd3.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.*<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> amortization.prior_years_order_detail_edits pyde<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyde.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd_orig<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd_orig.order_detail_id = pyde.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pyd_orig.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> pyde.is_pd_conversion = <span class="sql-number">1</span><br/>) od<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_detail_min_convert_parent mcp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;mcp.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt2.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt2.pd_sort = spt.pd_sort<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt3.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'y'</span> <span class="sql-reserved">AND</span> spt3.pd_sort &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd2<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd2.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd2.sub_product_type_id = spt2.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.prior_years_order_details pyd3<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyd3.order_detail_id = mcp.parent_order_detail_id <span class="sql-reserved">AND</span> pyd3.sub_product_type_id = spt3.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id</td></tr>
   <tr><td>150</td><td>finance/amortization/wizard/generate/generate_data.inc:903</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> update_levelset_to_license(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(orig_price) orig_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(price) price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(list_price) list_price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">16</span>, <span class="sql-number">17</span>, <span class="sql-number">18</span>) <span class="sql-reserved">AND</span> o.order_date &lt; <span class="sql-string">'2010-07-01'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">OR</span> o.start_date &lt; <span class="sql-string">'2010-07-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> update_levelset_to_license(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(orig_price) <span class="sql-reserved">AS</span> orig_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(price) <span class="sql-reserved">AS</span> price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(list_price) <span class="sql-reserved">AS</span> list_price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">16</span>, <span class="sql-number">17</span>, <span class="sql-number">18</span>) <span class="sql-reserved">AND</span> o.order_date &lt; <span class="sql-string">'2010-07-01'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">OR</span> o.start_date &lt; <span class="sql-string">'2010-07-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td></tr>
   <tr><td>151</td><td>finance/amortization/wizard/generate/generate_data.inc:1174</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> my_license_order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.after_prod_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.per_month_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">PERIOD_DIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(od.end_date) &lt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(od.end_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%Y%m'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y%m'</span>) &gt;= <span class="sql-keyword">DATE_FORMAT</span>(od.start_date, <span class="sql-string">'%Y%m'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%Y%m'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-number">+1</span> total_months,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;my_license_orders m,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = m.order_id <span class="sql-reserved">AND</span> m.order_id = o.order_id <span class="sql-reserved">AND</span> od.account_id = m.account_id <span class="sql-reserved">AND</span> od.student_licenses = m.student_licenses <span class="sql-reserved">AND</span> od.quantity = m.quantity <span class="sql-reserved">AND</span> od.summer = m.summer <span class="sql-reserved">AND</span> od.program_id = m.program_id <span class="sql-reserved">AND</span> od.sub_product_type_id = m.sub_product_type_id $licenseStr<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> my_license_order_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>152</td><td>finance/amortization/wizard/generate/generate_data.inc:1207</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details_sort(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, sub_product_type_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(total_records)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">24</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(*) total_records,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(academic_year_sort &gt;= <span class="sql-number">15</span>, <span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) all_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">24</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details_sort(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, sub_product_type_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(total_records)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">24</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(*) <span class="sql-reserved">AS</span> total_records,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(academic_year_sort &gt;= <span class="sql-number">15</span>, <span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> all_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">24</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>153</td><td>finance/amortization/wizard/generate/generate_data.inc:1256</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details_sort2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> <span class="sql-variable">@cur_detail_online_sort</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_order_details_copy od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>) od<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_details_sort2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ONLINE,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> <span class="sql-variable">@cur_detail_online_sort</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> + <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_order_details_copy od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id<br/>) od<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r</td></tr>
   <tr><td>154</td><td>finance/amortization/wizard/generate/generate_data.inc:1273</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_no_revenue(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tax_credit_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">10</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> tax_credit_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id <span class="sql-reserved">AND</span> p.revenue = <span class="sql-string">'N'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_no_revenue(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tax_credit_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">10</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) <span class="sql-reserved">AS</span> no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> tax_credit_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id <span class="sql-reserved">AND</span> p.revenue = <span class="sql-string">'N'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td></tr>
   <tr><td>155</td><td>finance/amortization/wizard/generate/generate_data.inc:1282</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_product_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total) product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.std_discount = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span>(o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span>(o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(od.discounted_total) - <span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) discount_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_details od)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = r.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_product_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total) <span class="sql-reserved">AS</span> product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.std_discount = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(od.discounted_total) - <span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> discount_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_details od)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = r.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td></tr>
   <tr><td>156</td><td>finance/amortization/wizard/generate/generate_data.inc:1303</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_std_discounts_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> p.product_name) product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(lpc.price, od.list_price) * quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) std_discount_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.discounts d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.od_list_price_changes lpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = d.product_id <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(od.status = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>) <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">",$NON_STD_DISCOUNT_PRODUCTS)."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_std_discounts_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> p.product_name) <span class="sql-reserved">AS</span> product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(lpc.price, od.list_price) * quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> std_discount_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.discounts d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.od_list_price_changes lpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = d.product_id <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(od.status = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>) <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'.implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">',$NON_STD_DISCOUNT_PRODUCTS).'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>157</td><td>finance/amortization/wizard/generate/generate_data.inc:1345</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_product_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total) product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.std_discount = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span>(o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span>(o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(od.discounted_total) - <span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) discount_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_details od)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = r.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_product_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total) <span class="sql-reserved">AS</span> product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.std_discount = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discountable = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2009-07-01'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> no_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(od.discounted_total) - <span class="sql-keyword">IFNULL</span>(r.no_revenue_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> discount_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_details od)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = r.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>158</td><td>finance/amortization/wizard/generate/generate_data.inc:1401</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_std_discounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(discount_percent, <span class="sql-number">10</span>) std_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(discount_percent, <span class="sql-number">10</span>) std_discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(lpc.price, od.list_price) * quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) std_discount_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.discounts d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.od_list_price_changes lpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = d.product_id <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(od.status = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>) <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">",$NON_STD_DISCOUNT_PRODUCTS)."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">1</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_std_discounts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(discount_percent, <span class="sql-number">10</span>) <span class="sql-reserved">AS</span> std_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(discount_percent, <span class="sql-number">10</span>) <span class="sql-reserved">AS</span> std_discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(lpc.price, od.list_price) * quantity <span class="sql-reserved">AS</span> std_discount_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.product_groups pg,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.discounts d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.od_list_price_changes lpc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lpc.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = d.product_id <span class="sql-reserved">AND</span> p.product_group_id = pg.product_group_id <span class="sql-reserved">AND</span>(od.status = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> o.cancel = <span class="sql-string">'Y'</span>) <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'.implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">',$NON_STD_DISCOUNT_PRODUCTS).'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> pg.discount = <span class="sql-number">1</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td></tr>
   <tr><td>159</td><td>finance/amortization/wizard/generate/generate_data.inc:1428</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> om_std_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first_discount_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TRIM</span>(second_discount_name) != <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<span class="sql-string">'; '</span>, second_discount_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.second_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount + ad.second_discount total_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount_perc + ad.second_discount_perc discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount + ad.second_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) / pt.no_mfee_total total_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_discounts ad,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_total t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_product_total pt<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> multi_year_orders m <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = m.my_order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_std_discounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = d.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> m.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.om_order_id = ad.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#and o.om_order_id not in (55903)</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.date_entered &lt; <span class="sql-string">'2009-08-11'</span> <span class="sql-reserved">AND</span> o.order_id = pt.order_id <span class="sql-reserved">AND</span> ad.order_id = t.order_id <span class="sql-reserved">AND</span> ad.first_discount != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> om_std_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first_discount_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TRIM</span>(second_discount_name) != <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<span class="sql-string">'; '</span>, second_discount_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.second_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount + ad.second_discount <span class="sql-reserved">AS</span> total_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount_perc + ad.second_discount_perc <span class="sql-reserved">AS</span> discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ad.first_discount + ad.second_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> / pt.no_mfee_total <span class="sql-reserved">AS</span> total_perc<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_discounts ad,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_total t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_product_total pt<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> multi_year_orders m <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = m.my_order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_std_discounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> m.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.om_order_id = ad.order_id <span class="sql-comment">#and o.om_order_id not in (55903)</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.date_entered &lt; <span class="sql-string">'2009-08-11'</span> <span class="sql-reserved">AND</span> o.order_id = pt.order_id <span class="sql-reserved">AND</span> ad.order_id = t.order_id <span class="sql-reserved">AND</span> ad.first_discount != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>160</td><td>finance/amortization/wizard/generate/generate_data.inc:1492</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(d.std_discount_perc_report) std_discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> product_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) std_discount_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_stddiscount_total = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_stddiscount_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) std_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total -($std_discount_str),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total -($std_discount_str),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_std_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_mfee_total = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) use_mfee,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(order_date &lt; <span class="sql-string">'2009-07-01'</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>) force_mfee<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_product_total t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_std_discounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.order_id = d.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_no_discounts nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.order_id = nd.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_discounts(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.product_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.no_stddiscount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(d.std_discount_perc_report) <span class="sql-reserved">AS</span> std_discount_perc_report,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> product_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> std_discount_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) <span class="sql-reserved">AS</span> std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_stddiscount_total = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_stddiscount_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> std_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total - $std_discount_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_std_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.discount_total - $std_discount_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">4</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mfee_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_std_discount_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_mfee_total + <span class="sql-keyword">ROUND</span>($std_discount_str, <span class="sql-number">4</span>) = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_mfee_total = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> use_mfee,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(order_date &lt; <span class="sql-string">'2009-07-01'</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> force_mfee<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_product_total t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_std_discounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = d.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_no_discounts nd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = nd.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id</td></tr>
   <tr><td>161</td><td>finance/amortization/wizard/generate/generate_data.inc:1635</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_perc <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(credit_om_order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;delivered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.orig_order_total order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_amount - c.tax_credit_amount credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.tax_credit_amount tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.order_detail_id) linked_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od2.order_detail_id) cancel_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od3.discounted_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od2.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_amount - c.tax_credit_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od3.discounted_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od2.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) credit_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.om_order_id credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_cancels c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.orig_cancel_id = c.cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">#linked to cancel id</span><br/><span class="sql-reserved">LEFT JOIN</span> order_details od2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od2.order_id <span class="sql-reserved">AND</span> od2.cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od2.orig_cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">#cancel lines not linked to cancel_id</span><br/><span class="sql-reserved">LEFT JOIN</span> order_details od3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od3.order_id <span class="sql-reserved">AND</span> od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">#spread over all order details</span><br/><span class="sql-reserved">LEFT JOIN</span> order_product_total t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = t.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = o.order_id <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.cancel_date &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(c.credit_amount &lt; <span class="sql-number">0</span>, <span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.order_detail_id) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_perc <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(credit_om_order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;delivered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.orig_order_total <span class="sql-reserved">AS</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_amount - c.tax_credit_amount <span class="sql-reserved">AS</span> credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.tax_credit_amount <span class="sql-reserved">AS</span> tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.order_detail_id) <span class="sql-reserved">AS</span> linked_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od2.order_detail_id) <span class="sql-reserved">AS</span> cancel_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od3.discounted_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od2.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_amount - c.tax_credit_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od3.discounted_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od2.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> credit_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.om_order_id <span class="sql-reserved">AS</span> credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data_db.order_cancels c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.orig_cancel_id = c.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> order_details od2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od2.order_id <span class="sql-reserved">AND</span> od2.cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od2.orig_cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> order_details od3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od3.order_id <span class="sql-reserved">AND</span> od2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">LEFT JOIN</span> order_product_total t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = t.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = o.order_id <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.cancel_date &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(c.credit_amount &lt; <span class="sql-number">0</span>, <span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.order_detail_id) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>162</td><td>finance/amortization/wizard/generate/generate_data.inc:1668</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancel_ids(<span class="sql-reserved">PRIMARY KEY</span>(id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.id) id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancel_ids(<span class="sql-reserved">PRIMARY KEY</span>(id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.id) <span class="sql-reserved">AS</span> id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id</td></tr>
   <tr><td>163</td><td>finance/amortization/wizard/generate/generate_data.inc:1728</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_cancel_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(c.tax_credit_total) tax_credit_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_cancel_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(c.tax_credit_total) <span class="sql-reserved">AS</span> tax_credit_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>164</td><td>finance/amortization/wizard/generate/generate_data.inc:1803</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_perc <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id2 <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.linked_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>($ctotal = <span class="sql-number">0</span>, discounted_total, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) rest_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) remaining_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= credit_total <span class="sql-reserved">AND</span> credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= credit_total <span class="sql-reserved">AND</span> credit_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>($ctotal = <span class="sql-number">0</span>, discounted_total, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>($ctotal = <span class="sql-number">0</span>, discounted_total, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) credit_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= credit_total <span class="sql-reserved">AND</span> credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= credit_total <span class="sql-reserved">AND</span> credit_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>($ctotal = <span class="sql-number">0</span>, discounted_total, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) only_remaining,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> use_all<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = c.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>($ctotal) &lt; <span class="sql-keyword">ROUND</span>(discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> c.credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.sort = $loop <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id = c.cancel_id <span class="sql-reserved">OR</span> c.linked_lines = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linked_lines = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.cancel = <span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> cancel_lines = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_perc <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id2 <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.linked_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_lines,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctotal = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> rest_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> remaining_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= credit_total <span class="sql-reserved">AND</span> credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= credit_total <span class="sql-reserved">AND</span> credit_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctotal = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctotal = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> credit_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= credit_total <span class="sql-reserved">AND</span> credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cvalue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - $ctotal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= credit_total <span class="sql-reserved">AND</span> credit_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ctotal = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> only_remaining,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> <span class="sql-reserved">AS</span> use_all<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = c.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>($ctotal) &lt; <span class="sql-keyword">ROUND</span>(discounted_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> c.credit_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.sort = $loop <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id = c.cancel_id <span class="sql-reserved">OR</span> c.linked_lines = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linked_lines = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.cancel = <span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> cancel_lines = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.id</td></tr>
   <tr><td>165</td><td>finance/amortization/wizard/generate/generate_data.inc:1982</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancel_totals(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(cancel_date) cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(cancel_date) max_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_total) cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(tax_credit_total) tax_cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">1</span>, credit_total, <span class="sql-number">0</span>)) cancel_total1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">2</span>, credit_total, <span class="sql-number">0</span>)) cancel_total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">3</span>, credit_total, <span class="sql-number">0</span>)) cancel_total3<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> cancel_totals(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(cancel_date) <span class="sql-reserved">AS</span> cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(cancel_date) <span class="sql-reserved">AS</span> max_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_total) <span class="sql-reserved">AS</span> cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(tax_credit_total) <span class="sql-reserved">AS</span> tax_cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">1</span>, credit_total, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> cancel_total1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">2</span>, credit_total, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> cancel_total2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-reserved">IF</span>(sort = <span class="sql-number">3</span>, credit_total, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> cancel_total3<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td></tr>
   <tr><td>166</td><td>finance/amortization/wizard/generate/generate_data.inc:2009</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> standard_not_order_month_temp(<span class="sql-reserved">PRIMARY KEY</span>(om_order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opt.order_id om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_period_total opt,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opt.sub_product_type_id = <span class="sql-number">11</span> <span class="sql-reserved">AND</span> opt.order_id = d.order_id <span class="sql-reserved">AND</span> opt.period_month != d.order_month <span class="sql-reserved">AND</span> d.order_date &lt; <span class="sql-string">'2009-01-01'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> standard_not_order_month_temp(<span class="sql-reserved">PRIMARY KEY</span>(om_order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opt.order_id <span class="sql-reserved">AS</span> om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_period_total opt,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$old_amortization_db.order_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opt.sub_product_type_id = <span class="sql-number">11</span> <span class="sql-reserved">AND</span> opt.order_id = d.order_id <span class="sql-reserved">AND</span> opt.period_month != d.order_month <span class="sql-reserved">AND</span> d.order_date &lt; <span class="sql-string">'2009-01-01'</span></td></tr>
   <tr><td>167</td><td>finance/amortization/wizard/generate/generate_data.inc:2020</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> standard_order_month(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> standard_not_order_month_temp t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.om_order_id = t.om_order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2009-01-01'</span> <span class="sql-reserved">AND</span> t.om_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.om_order_id != <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> standard_order_month(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> standard_not_order_month_temp t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id = t.om_order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &lt; <span class="sql-string">'2009-01-01'</span> <span class="sql-reserved">AND</span> t.om_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.om_order_id != <span class="sql-number">0</span></td></tr>
   <tr><td>168</td><td>finance/amortization/wizard/generate/generate_data.inc:2035</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;real_order_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_end_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(amortization_group_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.sub_program_id sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.orig_program_id orig_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) real_order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(od.start_date, <span class="sql-string">'%Y-%m-01'</span>) start_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(od.end_date) &lt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(od.end_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%Y-%m-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) amortization_start_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) amortization_end_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">12</span> total_months,<br/>&nbsp;&nbsp;&nbsp;&nbsp;discounted_total per_month_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.om_order_id line_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_date1<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(order_details od, orders o)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_info_summary odis <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;real_order_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_end_month <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(amortization_group_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.sub_program_id <span class="sql-reserved">AS</span> sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.orig_program_id <span class="sql-reserved">AS</span> orig_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> real_order_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(od.start_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> start_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(od.end_date) &lt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(od.end_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%Y-%m-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_deliverable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> amortization_start_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(o.order_date, <span class="sql-string">'%Y-%m-01'</span>) <span class="sql-reserved">AS</span> amortization_end_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">12</span> <span class="sql-reserved">AS</span> total_months,<br/>&nbsp;&nbsp;&nbsp;&nbsp;discounted_total <span class="sql-reserved">AS</span> per_month_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.om_order_id <span class="sql-reserved">AS</span> line_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_date1<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(order_details od, orders o)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_info_summary odis <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id</td></tr>
   <tr><td>169</td><td>finance/amortization/wizard/generate/generate_data.inc:2073</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(c.cancel_date, <span class="sql-string">'|'</span>, c.cancel_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) linked_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.cancel_date) linked_cancel_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(order_details od)<br/><span class="sql-reserved">INNER JOIN</span> cancels c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = c.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id = c.cancel_id <span class="sql-reserved">OR</span> c.credit_type = <span class="sql-string">'F'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment">#AND c.cancel_date&gt;'2014-01-01'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.cancel = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(c.cancel_date, <span class="sql-string">'|'</span>, c.cancel_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> linked_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.cancel_date) <span class="sql-reserved">AS</span> linked_cancel_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/><span class="sql-reserved">INNER JOIN</span> cancels c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = c.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id = c.cancel_id <span class="sql-reserved">OR</span> c.credit_type = <span class="sql-string">'F'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.cancel = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td></tr>
   <tr><td>170</td><td>finance/amortization/wizard/generate/generate_data.inc:2287</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_amortization(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_detail_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(pd_event_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(line_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;per_month_total period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month orig_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;per_month_total orig_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000000000</span> pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">100000</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">100000</span> change_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> keep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> projected,<br/>&nbsp;&nbsp;&nbsp;&nbsp;om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_dates<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;total_months = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_amortization(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_detail_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(pd_event_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(line_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month <span class="sql-reserved">AS</span> period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;per_month_total <span class="sql-reserved">AS</span> period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_start_month <span class="sql-reserved">AS</span> orig_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;per_month_total <span class="sql-reserved">AS</span> orig_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000000000</span> <span class="sql-reserved">AS</span> pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">100000</span> <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">100000</span> <span class="sql-reserved">AS</span> change_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> <span class="sql-reserved">AS</span> keep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span> <span class="sql-reserved">AS</span> projected,<br/>&nbsp;&nbsp;&nbsp;&nbsp;om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_dates<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;total_months = <span class="sql-number">1</span></td></tr>
   <tr><td>171</td><td>finance/amortization/wizard/generate/generate_data.inc:2372</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;prior_years_pd_events pe<br/><span class="sql-reserved">LEFT JOIN</span> tmp_py_event_order_details_refresh pey <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pey.order_detail_id = pe.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pey.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.event_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;prior_years_pd_events pe<br/><span class="sql-reserved">LEFT JOIN</span> tmp_py_event_order_details_refresh pey <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pey.order_detail_id = pe.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pey.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.event_id</td></tr>
   <tr><td>172</td><td>finance/amortization/wizard/generate/generate_data.inc:2466</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events_sort(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(total_records)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(*) total_records,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) all_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_events<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events_sort(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(total_records)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(*) <span class="sql-reserved">AS</span> total_records,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> all_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_events<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td></tr>
   <tr><td>173</td><td>finance/amortization/wizard/generate/generate_data.inc:2495</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events_sort2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(pd_event_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.<span class="sql-variable">`online`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> <span class="sql-variable">@cur_detail_online_sort</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_events<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>) pe<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = pe.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pre_2015_pd_sort_orders exo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exo.order_id = o.order_id<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.academic_year_id &gt;= <span class="sql-number">27</span> <span class="sql-reserved">AND</span> exo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_events_sort2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(pd_event_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.<span class="sql-variable">`online`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> <span class="sql-variable">@cur_detail_online_sort</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRank</span> := <span class="sql-variable">@curRank</span> + <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.pd_sort<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sort<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_events<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_event_id<br/>) pe<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = pe.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pre_2015_pd_sort_orders exo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exo.order_id = o.order_id<br/><span class="sql-reserved">CROSS JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-variable">@cur_detail_online_sort</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRank</span> := <span class="sql-number">0</span><br/>) r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pe.academic_year_id &gt;= <span class="sql-number">27</span> <span class="sql-reserved">AND</span> exo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td></tr>
   <tr><td>174</td><td>finance/amortization/wizard/generate/generate_data.inc:2511</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_pd_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_detail_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(pd_event_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_events e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pre_2015_pd_sort_orders exo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exo.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = e.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> od.academic_year_id = e.academic_year_id <span class="sql-reserved">AND</span> od.sort = e.sort <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id &lt; <span class="sql-number">27</span> <span class="sql-reserved">OR</span> exo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.online = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> od.pd_deliverable = <span class="sql-string">'Y'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_pd_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_detail_id, line_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(pd_event_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pd_events e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pre_2015_pd_sort_orders exo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exo.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = e.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> od.academic_year_id = e.academic_year_id <span class="sql-reserved">AND</span> od.sort = e.sort <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id &lt; <span class="sql-number">27</span> <span class="sql-reserved">OR</span> exo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.online = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> od.pd_deliverable = <span class="sql-string">'Y'</span></td></tr>
   <tr><td>175</td><td>finance/amortization/wizard/generate/generate_data.inc:2866</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_cancels$loop(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_month<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id$loop cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING</span>(od.cancel_date$loop, <span class="sql-number">1</span>, <span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$sum_str not_recognized_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop / $sum_str &gt; <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop / $sum_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">8</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop - $sum_str &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop - $sum_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">8</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.line_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = a.order_detail_id <span class="sql-reserved">AND</span> c.cancel_id = od.cancel_id$loop <span class="sql-reserved">AND</span> od.cancel_total$loop != <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.line_id = a.line_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_cancels$loop(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_month<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.orig_cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id$loop <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING</span>(od.cancel_date$loop, <span class="sql-number">1</span>, <span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop <span class="sql-reserved">AS</span> cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$sum_str <span class="sql-reserved">AS</span> not_recognized_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop / $sum_str &gt; <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop / $sum_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">8</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop - $sum_str &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_total$loop - $sum_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">8</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> cancel_remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.amortization_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.line_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_om_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancels c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = a.order_detail_id <span class="sql-reserved">AND</span> c.cancel_id = od.cancel_id$loop <span class="sql-reserved">AND</span> od.cancel_total$loop != <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.line_id = a.line_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id</td></tr>
   <tr><td>176</td><td>finance/amortization/wizard/generate/generate_data.inc:2956</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> keep_backup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id2 <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda,<br/>&nbsp;&nbsp;&nbsp;&nbsp;keep_amortization k<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id = k.order_id <span class="sql-reserved">AND</span> k.credit != <span class="sql-string">'Y'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> keep_backup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id2 <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda,<br/>&nbsp;&nbsp;&nbsp;&nbsp;keep_amortization k<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id = k.order_id <span class="sql-reserved">AND</span> k.credit != <span class="sql-string">'Y'</span></td></tr>
   <tr><td>177</td><td>finance/amortization/wizard/generate/generate_data.inc:3027</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_level_changes(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_orders_changed<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> lock_month &lt; <span class="sql-string">'$lock_month'</span> <span class="sql-reserved">AND</span> order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">14227</span>, <span class="sql-number">15451</span>) <span class="sql-comment">/*open '14 orders manually excluded by Nechama 09/30/2014*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_level_changes(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization_orders_changed<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> lock_month &lt; <span class="sql-string">'$lock_month'</span> <span class="sql-reserved">AND</span> order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">14227</span>, <span class="sql-number">15451</span>) <span class="sql-comment">/*open '14 orders manually excluded by Nechama 09/30/2014*/</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>178</td><td>finance/amortization/wizard/generate/generate_data.inc:3048</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> locked_amortization_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> cancel_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> order_detail_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> sub_product_type_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> amortization_group_id,<br/><span class="sql-keyword">SUM</span>(period_total) locked_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda<br/><span class="sql-reserved">LEFT JOIN</span> order_level_changes ox <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ox.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt;= <span class="sql-string">'$lock_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> locked_amortization_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> cancel_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> order_detail_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sub_product_type_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> amortization_group_id,<br/><span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> locked_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda<br/><span class="sql-reserved">LEFT JOIN</span> order_level_changes ox <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ox.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt;= <span class="sql-string">'$lock_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span></td></tr>
   <tr><td>179</td><td>finance/amortization/wizard/generate/generate_data.inc:3070</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> new_amortization_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> cancel_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> order_detail_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> sub_product_type_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> amortization_group_id,<br/><span class="sql-keyword">SUM</span>(period_total) new_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda<br/><span class="sql-reserved">LEFT JOIN</span> order_level_changes ox <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ox.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt;= <span class="sql-string">'$lock_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> new_amortization_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> cancel_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> order_detail_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sub_product_type_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> amortization_group_id,<br/><span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> new_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda<br/><span class="sql-reserved">LEFT JOIN</span> order_level_changes ox <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ox.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt;= <span class="sql-string">'$lock_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> oda.cancel_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> order_detail_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> sub_product_type_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ox.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> amortization_group_id <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span></td></tr>
   <tr><td>180</td><td>finance/amortization/wizard/generate/generate_data.inc:3205</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> recognized_summary(<span class="sql-reserved">PRIMARY KEY</span>(<span class="sql-keyword">YEAR</span>, <span class="sql-keyword">MONTH</span>)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(period_month) <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) recognized_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = o.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(period_month)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> recognized_summary(<span class="sql-reserved">PRIMARY KEY</span>(<span class="sql-keyword">YEAR</span>, <span class="sql-keyword">MONTH</span>))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) <span class="sql-reserved">AS</span> <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(period_month) <span class="sql-reserved">AS</span> <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> recognized_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = o.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(period_month)</td></tr>
   <tr><td>181</td><td>finance/amortization/wizard/generate/generate_data.inc:3272</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_prior_year_orders_edited_pd_totals_curr(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, month_year)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>) month_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(oda.pd_event_id) cnt_pd_events,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) sum_revenue_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders upyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;upyo.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt; <span class="sql-string">'{$report_year}-01-01'</span> <span class="sql-reserved">AND</span> oda.pd_event_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>);</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_prior_year_orders_edited_pd_totals_curr(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, month_year)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>) <span class="sql-reserved">AS</span> month_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(oda.pd_event_id) <span class="sql-reserved">AS</span> cnt_pd_events,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> sum_revenue_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization oda<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders upyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;upyo.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt; <span class="sql-string">'{$report_year}-01-01'</span> <span class="sql-reserved">AND</span> oda.pd_event_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>)</td></tr>
   <tr><td>182</td><td>finance/amortization/wizard/generate/generate_data.inc:3293</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_prior_year_orders_edited_pd_totals_past(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, month_year)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>) month_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(oda.pd_event_id) cnt_pd_events,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) sum_revenue_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_ { $lock_month_string } oda<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_amort_prior_years_updated_orders upyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;upyo.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month &lt; <span class="sql-string">'{$report_year}-01-01'</span> <span class="sql-reserved">AND</span> oda.pd_event_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(oda.period_month, <span class="sql-string">'%m/%y'</span>);</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_prior_year_orders_edited_pd_totals_past(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, month_year)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>183</td><td>cron/update_account_ns_id.php:19</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.accounts_get_ns_id(<span class="sql-reserved">KEY</span>(account_id, new_ns_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.customer_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.ns_id old_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.ns_id new_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;county_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MDR_accounts_to_delete<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns_id &lt;&gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;county_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state_code<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(account_id) = <span class="sql-number">1</span><br/>) b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name = b.account_name <span class="sql-reserved">AND</span> a.state_code = b.state_code <span class="sql-reserved">AND</span> a.county_id = b.county_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_name = a.account_name <span class="sql-reserved">AND</span> c.state_code = a.state_code <span class="sql-reserved">AND</span> c.county_id = a.county_id <span class="sql-reserved">AND</span> c.account_id &lt;&gt; a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.date_entered &gt; <span class="sql-keyword">ADDDATE</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">WEEK</span>) <span class="sql-reserved">AND</span> a.ns_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.accounts_get_ns_id(<span class="sql-reserved">KEY</span>(account_id, new_ns_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_ns_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_ns_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.customer_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.ns_id <span class="sql-reserved">AS</span> old_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.ns_id <span class="sql-reserved">AS</span> new_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;county_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MDR_accounts_to_delete<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns_id &lt;&gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;county_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state_code<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(account_id) = <span class="sql-number">1</span><br/>) b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name = b.account_name <span class="sql-reserved">AND</span> a.state_code = b.state_code <span class="sql-reserved">AND</span> a.county_id = b.county_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_name = a.account_name <span class="sql-reserved">AND</span> c.state_code = a.state_code <span class="sql-reserved">AND</span> c.county_id = a.county_id <span class="sql-reserved">AND</span> c.account_id &lt;&gt; a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.date_entered &gt; <span class="sql-keyword">ADDDATE</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">WEEK</span>) <span class="sql-reserved">AND</span> a.ns_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td></tr>
   <tr><td>184</td><td>reports/finance/annual_retention/annual_retention_index.php:60</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.$lock_table <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'1'</span> col1;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.$lock_table</td><td style="border-bottom: solid 1px black;">col1 <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'1'</span> <span class="sql-reserved">AS</span> col1</td></tr>
   <tr><td>185</td><td>reports/finance/change_notification/generate_data.php:41</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_last_log_order_review(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(date_reviewed) date_reviewed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_review<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;review_type = <span class="sql-string">'cancel_notify'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_last_log_order_review(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_reviewed <span class="sql-keyword">DATETIME</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(date_reviewed) <span class="sql-reserved">AS</span> date_reviewed<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_review<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;review_type = <span class="sql-string">'cancel_notify'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>186</td><td>reports/finance/change_notification/generate_data.php:55</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_orders_need_review(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;logc.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_cancel_new_renew logc<br/><span class="sql-reserved">INNER JOIN</span> commissions.credits c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.c_id = logc.c_id <span class="sql-reserved">AND</span> c.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cmr_last_log_order_review lor<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lor.order_id = logc.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered &gt; <span class="sql-variable">@log_start</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lor.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> lor.date_reviewed &lt; logc.date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.ctype = <span class="sql-string">'cancel'</span> <span class="sql-reserved">OR</span> c.is_bad_debt = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;logc.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(log_id) &gt; <span class="sql-variable">@log_start</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_orders_need_review(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;logc.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_cancel_new_renew logc<br/><span class="sql-reserved">INNER JOIN</span> commissions.credits c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.c_id = logc.c_id <span class="sql-reserved">AND</span> c.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cmr_last_log_order_review lor<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;lor.order_id = logc.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered &gt; <span class="sql-variable">@log_start</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lor.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> lor.date_reviewed &lt; logc.date_entered<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.ctype = <span class="sql-string">'cancel'</span> <span class="sql-reserved">OR</span> c.is_bad_debt = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;logc.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(log_id) &gt; <span class="sql-variable">@log_start</span></td></tr>
   <tr><td>187</td><td>reports/finance/change_notification/generate_data.php:74</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_order_cancel_tcv_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id, order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(new_total) tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(renew_total) tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total_acv_no_tax) acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(new_total_acv) acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(renew_total_acv) acv_renew<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_total_acv acv<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cmr_order_cancel_tcv_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id, order_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">89</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) <span class="sql-reserved">AS</span> tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(new_total) <span class="sql-reserved">AS</span> tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(renew_total) <span class="sql-reserved">AS</span> tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sales_tax) <span class="sql-reserved">AS</span> tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total_acv_no_tax) <span class="sql-reserved">AS</span> acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(new_total_acv) <span class="sql-reserved">AS</span> acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(renew_total_acv) <span class="sql-reserved">AS</span> acv_renew<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_total_acv acv<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv.cancel_id</td></tr>
   <tr><td>188</td><td>reports/finance/change_notification/generate_data.php:97</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(c_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> c.ctype = <span class="sql-string">'CANCEL'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Revenue Credit'</span> <span class="sql-reserved">WHEN</span> c.is_bad_debt = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Bad Debt Comm Credit'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Commission Credit'</span><br/><span class="sql-keyword">END</span> credit_type,<br/>c.c_id,<br/>c.cancel_id,<br/>c.invoice_id,<br/>c.cancel_date,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> c.ctype = <span class="sql-string">'cancel'</span> <span class="sql-reserved">THEN</span> c.entry_date <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> date_entered,<br/>c.credit * <span class="sql-number">-1</span> credit,<br/>c.credit * <span class="sql-number">-1</span> tcv_total,<br/>c.new_credit * <span class="sql-number">-1</span> tcv_new,<br/>c.renew_credit * <span class="sql-number">-1</span> tcv_renew,<br/>c.tax_credit * <span class="sql-number">-1</span> tcv_sales_tax,<br/>ot.acv_total acv_total,<br/>ot.acv_new acv_new,<br/>ot.acv_renew acv_renew,<br/><span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> rebook_order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebook_order_id<br/>) rebook_orders,<br/>cr.cancel_reason_name,<br/>oc.additional_notes cancel_notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.credits c<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id <span class="sql-reserved">AND</span> o.cmonth = c.cmonth<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_orders_need_review revo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;revo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = c.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = c.cancel_id <span class="sql-reserved">AND</span> rebooks.order_id = c.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.cancel_id = c.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.cancel_reasons cr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cr.cancel_reason_id = oc.cancel_reason<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.c_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(c_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;c_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">23</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">23</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rebook_orders <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_reason_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_notes <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> c.ctype = <span class="sql-string">'CANCEL'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Revenue Credit'</span> <span class="sql-reserved">WHEN</span> c.is_bad_debt = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Bad Debt Comm Credit'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Commission Credit'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> credit_type,<br/>c.c_id,<br/>c.cancel_id,<br/>c.invoice_id,<br/>c.cancel_date,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> c.ctype = <span class="sql-string">'cancel'</span> <span class="sql-reserved">THEN</span> c.entry_date <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> date_entered,<br/>c.credit * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> credit,<br/>c.credit * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> tcv_total,<br/>c.new_credit * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> tcv_new,<br/>c.renew_credit * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> tcv_renew,<br/>c.tax_credit * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> tcv_sales_tax,<br/>ot.acv_total <span class="sql-reserved">AS</span> acv_total,<br/>ot.acv_new <span class="sql-reserved">AS</span> acv_new,<br/>ot.acv_renew <span class="sql-reserved">AS</span> acv_renew,<br/><span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> rebook_order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebook_order_id<br/>) <span class="sql-reserved">AS</span> rebook_orders,<br/>cr.cancel_reason_name,<br/>oc.additional_notes <span class="sql-reserved">AS</span> cancel_notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.credits c<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id <span class="sql-reserved">AND</span> o.cmonth = c.cmonth<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_orders_need_review revo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;revo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = c.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = c.cancel_id <span class="sql-reserved">AND</span> rebooks.order_id = c.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id <span class="sql-reserved">AND</span> oc.cancel_id = c.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.cancel_reasons cr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cr.cancel_reason_id = oc.cancel_reason<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.c_id</td></tr>
   <tr><td>189</td><td>reports/finance/change_notification/generate_data.php:132</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.opportunity_owner <span class="sql-variable">`Opportunity Owner`</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.orders o<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = o.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;Opportunity <span class="sql-keyword">OWNER</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.opportunity_owner <span class="sql-reserved">AS</span> <span class="sql-variable">`Opportunity Owner`</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.orders o<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = o.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>190</td><td>reports/finance/change_notification/generate_data.php:148</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_rebook_orders(<span class="sql-reserved">PRIMARY KEY</span>(rebook_order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id rebook_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.opportunity_owner <span class="sql-variable">`Opportunity Owner`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id orig_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = cc.cancel_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = oi.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_rebook_orders(<span class="sql-reserved">PRIMARY KEY</span>(rebook_order_id))</td><td style="border-bottom: solid 1px black;">rebook_order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tcv_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;Opportunity <span class="sql-keyword">OWNER</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id <span class="sql-reserved">AS</span> rebook_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.tcv_sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.acv_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.opportunity_owner <span class="sql-reserved">AS</span> <span class="sql-variable">`Opportunity Owner`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id <span class="sql-reserved">AS</span> orig_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = cc.cancel_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = oi.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cmr_order_cancel_tcv_acv ot<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id = o.order_id <span class="sql-reserved">AND</span> ot.cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>191</td><td>reports/finance/change_notification/generate_data.php:164</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_cancels_log(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<span class="sql-keyword">LOG</span>.date_entered) min_log_date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<span class="sql-keyword">LOG</span>.date_entered) max_log_date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> commissions.log_cancel_new_renew <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.c_id = cc.c_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_cancels_log(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_log_date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_log_date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<span class="sql-keyword">LOG</span>.date_entered) <span class="sql-reserved">AS</span> min_log_date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<span class="sql-keyword">LOG</span>.date_entered) <span class="sql-reserved">AS</span> max_log_date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> commissions.log_cancel_new_renew <span class="sql-keyword">LOG</span><br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LOG</span>.c_id = cc.c_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id</td></tr>
   <tr><td>192</td><td>reports/finance/change_notification/generate_data.php:176</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_qc_changes(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.date_entered &lt; c.min_log_date_entered <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qc.date_entered = c.min_log_date_entered <span class="sql-reserved">AND</span> qc.date_entered = <span class="sql-variable">@log_start</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> log_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) log_id_before_cancel,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.date_entered &gt;= c.min_log_date_entered <span class="sql-reserved">AND</span> qc.date_entered &gt; <span class="sql-variable">@log_start</span> <span class="sql-reserved">THEN</span> log_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) log_id_after_cancel<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_user_qc qc<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels_log c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = qc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.user_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_qc_changes(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;log_id_before_cancel <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;log_id_after_cancel <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.date_entered &lt; c.min_log_date_entered <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qc.date_entered = c.min_log_date_entered <span class="sql-reserved">AND</span> qc.date_entered = <span class="sql-variable">@log_start</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> log_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> log_id_before_cancel,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.date_entered &gt;= c.min_log_date_entered <span class="sql-reserved">AND</span> qc.date_entered &gt; <span class="sql-variable">@log_start</span> <span class="sql-reserved">THEN</span> log_id <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> log_id_after_cancel<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_user_qc qc<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels_log c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = qc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.user_id</td></tr>
   <tr><td>193</td><td>reports/finance/change_notification/generate_data.php:190</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_user_qc(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<span class="sql-keyword">CONCAT</span>(log_id, <span class="sql-string">'|'</span>, quota_credit)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quota_credit<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_user_qc qc<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_user_qc(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quota_credit <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">26</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(log_id, <span class="sql-string">'|'</span>, quota_credit)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quota_credit<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.log_order_user_qc qc<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id</td></tr>
   <tr><td>194</td><td>reports/finance/change_notification/generate_data.php:203</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TRIM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) user_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_month_cp_termination_date termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.comp_plan_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqb.quota_credit QC_Before,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) QC_Current,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) - ouqb.quota_credit &lt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) - ouqb.quota_credit <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> QC_Reduction,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ouqaft.quota_credit <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'NO'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'YES'</span><br/><span class="sql-keyword">END</span> Has_QC_Change_After_Credits,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> next_month_cp_termination_date = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id &lt;&gt; <span class="sql-number">1484</span> <span class="sql-reserved">AND</span> ou.comp_plan_type <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'RESELLER'</span>, <span class="sql-string">'RENEW'</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> user_notify<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.order_users ou<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ou.user_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id = ou.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = ou.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_qc_changes qc_change<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc_change.order_id = ou.order_id <span class="sql-reserved">AND</span> qc_change.user_id = ou.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_user_qc ouqb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqb.log_id = qc_change.log_id_before_cancel<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_user_qc ouqaft<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.log_id = qc_change.log_id_after_cancel<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_user_qc ouq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.order_id = ou.order_id <span class="sql-reserved">AND</span> ouq.user_id = ou.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#HAVING user_notify=1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;;;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_order_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;termination_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;comp_plan_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;QC_Before <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;QC_Current <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">26</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;QC_Reduction <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">23</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;Has_QC_Change_After_Credits <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_notify <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TRIM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> user_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_month_cp_termination_date <span class="sql-reserved">AS</span> termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.comp_plan_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqb.quota_credit <span class="sql-reserved">AS</span> QC_Before,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> QC_Current,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) - ouqb.quota_credit &lt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.quota_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit<br/>&nbsp;&nbsp;&nbsp;&nbsp;) - ouqb.quota_credit <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> QC_Reduction,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ouqaft.quota_credit <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'NO'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'YES'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> Has_QC_Change_After_Credits,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> next_month_cp_termination_date = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id &lt;&gt; <span class="sql-number">1484</span> <span class="sql-reserved">AND</span> ou.comp_plan_type <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'RESELLER'</span>, <span class="sql-string">'RENEW'</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> user_notify<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.order_users ou<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ou.user_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.order_id = ou.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = ou.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_qc_changes qc_change<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qc_change.order_id = ou.order_id <span class="sql-reserved">AND</span> qc_change.user_id = ou.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_user_qc ouqb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqb.log_id = qc_change.log_id_before_cancel<br/><span class="sql-reserved">LEFT JOIN</span> commissions.log_order_user_qc ouqaft<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouqaft.log_id = qc_change.log_id_after_cancel<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_user_qc ouq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.order_id = ou.order_id <span class="sql-reserved">AND</span> ouq.user_id = ou.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id</td></tr>
   <tr><td>195</td><td>reports/finance/change_notification/generate_data.php:233</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_rebook_order_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(rebook_order_id, user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id rebook_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) user_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_month_cp_termination_date termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.comp_plan_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit QC,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> next_month_cp_termination_date = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id &lt;&gt; <span class="sql-number">1484</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> user_notify,<br/>cc.order_id orig_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = cc.cancel_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_users ou<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id = o.order_id <span class="sql-reserved">AND</span> ou.cmonth = o.cmonth<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ou.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_user_qc ouq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.order_id = ou.order_id <span class="sql-reserved">AND</span> ouq.user_id = ou.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> commissions.tmp_cc_ntfy_rebook_order_users(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(rebook_order_id, user_id)<br/>)</td><td style="border-bottom: solid 1px black;">rebook_order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;termination_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;comp_plan_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;QC <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">26</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_notify <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id <span class="sql-reserved">AS</span> rebook_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) <span class="sql-reserved">AS</span> user_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_month_cp_termination_date <span class="sql-reserved">AS</span> termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.comp_plan_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.quota_credit <span class="sql-reserved">AS</span> QC,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> next_month_cp_termination_date = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> u.user_id &lt;&gt; <span class="sql-number">1484</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> user_notify,<br/>cc.order_id <span class="sql-reserved">AS</span> orig_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.tmp_cc_ntfy_cancels cc<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_cancel_rebook_summary rebooks<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.cancel_id = cc.cancel_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rebooks.rebook_order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.order_users ou<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.order_id = o.order_id <span class="sql-reserved">AND</span> ou.cmonth = o.cmonth<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ou.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.tmp_cc_ntfy_order_user_qc ouq<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ouq.order_id = ou.order_id <span class="sql-reserved">AND</span> ouq.user_id = ou.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cmonth = <span class="sql-variable">@cmonth</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ou.user_id</td></tr>
   <tr><td>196</td><td>reports/tbs/index.php:193</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_districts <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_summary d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts child,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_summary s $fromStr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = child.parent_account_id <span class="sql-reserved">AND</span> child.account_id = s.account_id <span class="sql-string">".str_replace("</span> <span class="sql-reserved">TABLE</span> <span class="sql-string">","</span> child <span class="sql-string">",$whereStr)."</span> <span class="sql-reserved">AND</span> s.reason_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-3</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> s.post_end <span class="sql-reserved">AND</span> d.academic_year_id = s.academic_year_id <span class="sql-reserved">AND</span> child.customer_status = <span class="sql-string">'Current Customer'</span> <span class="sql-reserved">AND</span> d.account_id &lt;&gt; <span class="sql-number">175985</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_districts</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>197</td><td>reports/tbs/index.php:234</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_account_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbs_accounts t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tbs_districts td <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(t.account_id = td.account_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> t.account_id = o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.account_id = d.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id = d.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.academic_year_id = <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;td.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> o.order_id = os.order_id <span class="sql-reserved">AND</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.total_trainings = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-SE-%'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MONTH</span>(o.order_date) = <span class="sql-number">7</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(o.order_date) = <span class="sql-number">2011</span><br/>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_account_orders</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_academic_year_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_ids <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbs_accounts t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tbs_districts td <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = td.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> t.account_id = o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.account_id = d.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id = d.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.academic_year_id = <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;td.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> o.order_id = os.order_id <span class="sql-reserved">AND</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.total_trainings = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-SE-%'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MONTH</span>(o.order_date) = <span class="sql-number">7</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(o.order_date) = <span class="sql-number">2011</span><br/>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_academic_year_id</td></tr>
   <tr><td>198</td><td>reports/tbs/index.php:311</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $launch_categories) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Welcome'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type<br/>&nbsp;&nbsp;&nbsp;&nbsp;) template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-keyword">DISTANCE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) priority,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(a.order_end, a.order_start) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;communications m,<br/>&nbsp;&nbsp;&nbsp;&nbsp;templates t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.template_id = m.template_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type <span class="sql-reserved">IN</span>(<span class="sql-string">'Welcome'</span>, <span class="sql-string">'Setup'</span>) <span class="sql-reserved">OR</span> t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $launch_categories) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = m.account_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = m.account_id <span class="sql-reserved">AND</span> a.parent_account_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.order_date &lt; m.communication_date <span class="sql-reserved">AND</span> m.communication_date <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-3</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.post_end<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $launch_categories) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Welcome'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $launch_categories) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Welcome'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-keyword">DISTANCE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.communication_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> priority,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATEDIFF</span>(a.order_end, a.order_start) / <span class="sql-number">30</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;communications m,<br/>&nbsp;&nbsp;&nbsp;&nbsp;templates t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.template_id = m.template_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type <span class="sql-reserved">IN</span>(<span class="sql-string">'Welcome'</span>, <span class="sql-string">'Setup'</span>) <span class="sql-reserved">OR</span> t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $launch_categories) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = m.account_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = m.account_id <span class="sql-reserved">AND</span> a.parent_account_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.order_date &lt; m.communication_date <span class="sql-reserved">AND</span> m.communication_date <span class="sql-reserved">BETWEEN</span> <span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-3</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.post_end<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.category_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $launch_categories) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Welcome'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.template_type<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.communication_id</td></tr>
   <tr><td>199</td><td>reports/tbs/index.php:342</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(priority) priority<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;template_type</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(priority) <span class="sql-reserved">AS</span> priority<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;template_type</td></tr>
   <tr><td>200</td><td>reports/tbs/index.php:351</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications3 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(c1.communication_date) communication_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications c1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications2 c2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id = c2.account_id <span class="sql-reserved">AND</span> c1.academic_year_id = c2.academic_year_id <span class="sql-reserved">AND</span> c1.template_type = c2.template_type <span class="sql-reserved">AND</span> c1.priority = c2.priority<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.template_type</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_communications3</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.template_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(c1.communication_date) <span class="sql-reserved">AS</span> communication_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications c1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_communications2 c2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id = c2.account_id <span class="sql-reserved">AND</span> c1.academic_year_id = c2.academic_year_id <span class="sql-reserved">AND</span> c1.template_type = c2.template_type <span class="sql-reserved">AND</span> c1.priority = c2.priority<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c1.template_type</td></tr>
   <tr><td>201</td><td>reports/tbs/index.php:364</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_contacts2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.contact_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> c.contact_id) contact_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> c.contact_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.contact_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';&lt;br&gt;'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) contact_names<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_contacts c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.contact_type_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_contacts2</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_ids <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_names <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.contact_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> c.contact_id) <span class="sql-reserved">AS</span> contact_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> c.contact_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.contact_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';&lt;br&gt;'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> contact_names<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_contacts c<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.contact_type_id</td></tr>
   <tr><td>202</td><td>reports/tbs/index.php:459</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_accounts_filtered <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tbs_accounts t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span> <span class="sql-reserved">AND</span> t.account_id = a.account_id $whereStr</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tbs_accounts_filtered</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>203</td><td>cron/daily/expiring_orders.php:13</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $my_table <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a1.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' - '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) subscription_period<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a1<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id = op.opportunity_id <span class="sql-reserved">AND</span> ro.order_id = o.order_id <span class="sql-reserved">AND</span> o.account_id = a1.account_id <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(o.end_date) = <span class="sql-keyword">CURDATE</span>()<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND DATE(o.end_date) = '2010-06-15'*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> op.order_id = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $my_table</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_period <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">23</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a1.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' - '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DAY</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'/'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> subscription_period<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a1<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id = op.opportunity_id <span class="sql-reserved">AND</span> ro.order_id = o.order_id <span class="sql-reserved">AND</span> o.account_id = a1.account_id <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(o.end_date) = <span class="sql-keyword">CURDATE</span>() <span class="sql-comment">/*AND DATE(o.end_date) = '2010-06-15'*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> op.order_id = <span class="sql-number">0</span></td></tr>
   <tr><td>204</td><td>cron/summary/new_renew.php:17</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_detail_new_renew_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = InnoDB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts<br/><span class="sql-keyword">END</span> price,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.pro_rated_credits<br/><span class="sql-keyword">END</span> pro_rated_credits,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) new_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) renew_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv_fin.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent_fin,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) new_percent_fin,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv_fin.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent_fin,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) renew_percent_fin,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> has_override,<br/><span class="sql-number">0</span> new_total,<br/><span class="sql-number">0</span> renew_total,<br/><span class="sql-number">0</span> new_total_fin,<br/><span class="sql-number">0</span> renew_total_fin<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> v.commissions_override_only = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">END</span> new_percent_fin,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> v.commissions_override_only = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>)<br/><span class="sql-keyword">END</span> renew_percent_fin<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id<br/>) ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv_fin<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv_fin.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv_fin.order_detail_id <span class="sql-reserved">AND</span> odv_fin.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = os.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_detail_new_renew_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = InnoDB</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pro_rated_credits <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">24</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_percent_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_percent_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;has_override <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total_fin <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total_fin <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> price,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.pro_rated_credits<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> pro_rated_credits,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> new_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> renew_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv_fin.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent_fin,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> new_percent_fin,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv_fin.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent_fin,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> renew_percent_fin,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> has_override,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_total,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> renew_total,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_total_fin,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> renew_total_fin<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> v.commissions_override_only = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> new_percent_fin,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> v.commissions_override_only = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(v.new_total + v.renew_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> renew_percent_fin<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id<br/>) ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv_fin<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv_fin.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv_fin.order_detail_id <span class="sql-reserved">AND</span> odv_fin.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = os.order_id</td></tr>
   <tr><td>205</td><td>cron/summary/new_renew.php:91</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_detail_new_renew_fin_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = InnoDB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts<br/><span class="sql-keyword">END</span> price,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.pro_rated_credits<br/><span class="sql-keyword">END</span> pro_rated_credits,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) new_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) renew_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> has_override,<br/><span class="sql-number">0</span> new_total,<br/><span class="sql-number">0</span> renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(os.order_total - os.sales_tax),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(os.order_total - os.sales_tax),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) renew_percent<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date) <span class="sql-reserved">AND</span> v.commissions_override_only = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.order_id<br/>) ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv.order_detail_id <span class="sql-reserved">AND</span> odv.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = os.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_order_detail_new_renew_fin_summary(<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">30</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id)<br/>) <span class="sql-keyword">ENGINE</span> = InnoDB</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pro_rated_credits <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">24</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;has_override <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> price,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> os.order_total - os.sales_tax = <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> nr.pro_rated_credits<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> pro_rated_credits,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> new_percent,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;odv.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.renew_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> order_renewal_status != <span class="sql-string">'New'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> renew_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> has_override,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_total,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total /(os.order_total - os.sales_tax),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total /(os.order_total - os.sales_tax),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> renew_percent<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date) <span class="sql-reserved">AND</span> v.commissions_override_only = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.order_id<br/>) ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides odv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = odv.order_id <span class="sql-reserved">AND</span> nr.order_detail_id = odv.order_detail_id <span class="sql-reserved">AND</span> odv.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = os.order_id</td></tr>
   <tr><td>206</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:32</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total <span class="sql-reserved">AS</span> order_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(c.salesreps, <span class="sql-string">''</span>) &lt;&gt; <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.salesreps,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.salesreps<br/>&nbsp;&nbsp;&nbsp;&nbsp;) salesrep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.invoice_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.total_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.accrued_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.total_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.accrued_comm_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_commissions c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = c.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> billing.commission_credits cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = cc.il_order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = r.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oda.order_id <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(oda.period_month) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">IFNULL</span>(last_cancel_date, <span class="sql-number">0</span>)) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">IFNULL</span>(cc.invoice_date, <span class="sql-number">0</span>)) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> c.accrued_comm_bonus <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> <span class="sql-number">-.05</span> <span class="sql-reserved">AND</span> <span class="sql-number">.05</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> order_date &lt;= <span class="sql-string">'$report_end_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total <span class="sql-reserved">AS</span> order_revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(c.salesreps, <span class="sql-string">''</span>) &lt;&gt; <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.salesreps,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.salesreps<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> salesrep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.invoice_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.total_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.accrued_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.total_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.accrued_comm_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_commissions c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id<br/><span class="sql-reserved">LEFT JOIN</span> billing.commission_credits cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = cc.il_order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_revenue r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = r.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oda.order_id <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(oda.period_month) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">IFNULL</span>(last_cancel_date, <span class="sql-number">0</span>)) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">IFNULL</span>(cc.invoice_date, <span class="sql-number">0</span>)) &gt;= <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> c.accrued_comm_bonus <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> <span class="sql-number">-.05</span> <span class="sql-reserved">AND</span> <span class="sql-number">.05</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> order_date &lt;= <span class="sql-string">'$report_end_date'</span></td></tr>
   <tr><td>207</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:59</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>208</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:70</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>209</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:82</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>210</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:93</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>211</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:104</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_future_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) future_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_future_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(comm_bonus_period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> future_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>212</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:117</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_future_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) future_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_amort_future_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> future_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>213</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:128</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_revenue_defer(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contracted_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) recognized_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.defer_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) deferred_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - b.defer_total contracted_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = b.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_revenue_defer(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contracted_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> recognized_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.defer_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> deferred_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - b.defer_total <span class="sql-reserved">AS</span> contracted_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = b.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id</td></tr>
   <tr><td>214</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:143</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_commissions_defer(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contracted_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) recognized_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) recognized_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) recognized_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(oc.invoice_commissions) - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) deferred_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(oc.bonus_total) - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) deferred_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.invoice_commissions + oc.bonus_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) deferred_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) short_term_defer_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) short_term_defer_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) short_term_defer_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*bonus is never contracted*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.total_commissions - oc.invoice_commissions contracted_commissions<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule c<br/><span class="sql-reserved">INNER JOIN</span> order_commissions oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = c.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> com_commissions_defer(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferred_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;short_term_defer_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contracted_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> recognized_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> recognized_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> recognized_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.invoice_commissions - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> deferred_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.bonus_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> deferred_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.invoice_commissions + oc.bonus_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> deferred_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> short_term_defer_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> short_term_defer_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$next_month_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$next_year_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> short_term_defer_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.total_commissions - oc.invoice_commissions <span class="sql-reserved">AS</span> contracted_commissions<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commission_schedule c<br/><span class="sql-reserved">INNER JOIN</span> order_commissions oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = c.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id</td></tr>
   <tr><td>215</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:201</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $com_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $com_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>216</td><td>finance/amortization/wizard/generate/generate_commissions_report.inc:204</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $amort_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $amort_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>217</td><td>reports/finance/pd_data/index.php:60</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_standalone_initial(<span class="sql-reserved">PRIMARY KEY</span>(product_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.sub_product_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) is_pd_only,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) is_pd_product<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">INNER JOIN</span> products p <span class="sql-reserved">USING</span>(product_id)<br/><span class="sql-reserved">LEFT JOIN</span> sub_product_types spt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> spt.sub_product_type_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;is_pd_only = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> is_pd_product = <span class="sql-number">1</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_standalone_initial(<span class="sql-reserved">PRIMARY KEY</span>(product_id))</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_pd_only <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_pd_product <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.sub_product_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> is_pd_only,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> is_pd_product<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">INNER JOIN</span> products p <span class="sql-reserved">USING</span>(product_id)<br/><span class="sql-reserved">LEFT JOIN</span> sub_product_types spt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">OR</span> spt.sub_product_type_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;is_pd_only = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> is_pd_product = <span class="sql-number">1</span></td></tr>
   <tr><td>218</td><td>reports/finance/pd_data/index.php:78</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.order_details_pd_standalone(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_details od<br/><span class="sql-reserved">INNER JOIN</span> tech.pd_standalone_initial pd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.product_id = pd.product_id);</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.order_details_pd_standalone(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, order_detail_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_details od<br/><span class="sql-reserved">INNER JOIN</span> tech.pd_standalone_initial pd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = pd.product_id</td></tr>
   <tr><td>219</td><td>reports/finance/pd_data/index.php:91</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_costs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_event_id <span class="sql-reserved">INT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_date <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_event_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_num <span class="sql-reserved">INT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> e.event_name = <span class="sql-string">'Satisfied PD'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Expired'</span> <span class="sql-reserved">WHEN</span> e.event_date &lt;= <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">THEN</span> <span class="sql-string">'Delivered'</span> <span class="sql-reserved">WHEN</span> e.event_date &gt; <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">THEN</span> <span class="sql-string">'Projected'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> del_state, e.event_name, <span class="sql-number">0</span> we_care_event_id, <span class="sql-string">''</span> we_care_date, <span class="sql-string">''</span> we_care_event_name, <span class="sql-number">0</span> row_num<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_sort = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Initial'</span> <span class="sql-reserved">WHEN</span> spt.pd_sort = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Follow-up'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> pd_type,<br/>spt.sub_product_type_name,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.cancel_id = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> period_month <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(pd_event_id) pd_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(a.cancel_id) cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> b.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'N'</span><br/><span class="sql-keyword">END</span> pd_standalone<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od <span class="sql-reserved">USING</span>(order_id, order_detail_id)<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id = spt.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tech.order_details_pd_standalone b <span class="sql-reserved">USING</span>(order_id, order_detail_id)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>) od<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pd_events e<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.pd_event_id = e.pd_event_id);</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_costs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_event_id <span class="sql-reserved">INT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_date <span class="sql-keyword">DATE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;we_care_event_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_num <span class="sql-reserved">INT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>220</td><td>reports/finance/pd_data/index.php:125</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.expired_events(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_row_num<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-variable">@row_id</span> = <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-variable">@row_num</span> := <span class="sql-variable">@row_num</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@row_num</span> := <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> temp_row_num,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-variable">@row_id</span> != <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>) <span class="sql-reserved">THEN</span> <span class="sql-variable">@row_id</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>) <span class="sql-reserved">ELSE</span> <span class="sql-variable">@row_id</span> := <span class="sql-variable">@row_id</span><br/><span class="sql-keyword">END</span> set_row_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.pd_costs<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> del_state = <span class="sql-string">'Expired'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>) d<br/><span class="sql-reserved">CROSS JOIN</span>(<br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@row_id</span> := <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@row_num</span> := <span class="sql-number">0</span><br/>) a;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.expired_events(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_row_num<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>221</td><td>reports/finance/pd_data/index.php:151</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.we_care_days(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_num<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-variable">@row_id</span> = <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-variable">@row_num</span> := <span class="sql-variable">@row_num</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@row_num</span> := <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> row_num,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-variable">@row_id</span> != <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span><br/>) <span class="sql-reserved">THEN</span> <span class="sql-variable">@row_id</span> := <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span><br/>) <span class="sql-reserved">ELSE</span> <span class="sql-variable">@row_id</span> := <span class="sql-variable">@row_id</span><br/><span class="sql-keyword">END</span> set_row_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-variable">`online`</span> = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/><span class="sql-keyword">END</span> sub_product_type_id,<br/><span class="sql-string">'Initial'</span> pd_type<br/><span class="sql-reserved">FROM</span> <span class="sql-keyword">EVENTS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.pd_type_id = <span class="sql-string">".$PD_TYPES["</span> we care initial <span class="sql-string">"]."</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> event_type_id = <span class="sql-number">1</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`online`</span><br/>) d<br/><span class="sql-reserved">CROSS JOIN</span>(<br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@row_id</span> := <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@row_num</span> := <span class="sql-number">0</span><br/>) a;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.we_care_days(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_num<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>222</td><td>reports/finance/pd_data/index.php:180</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.order_pd_info(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(co.state, a.state_code) state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;coi.opportunity_owner,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(co.order_total, os.order_total) order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;co.credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) sum_onsite_days,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) price_onsite,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) sum_online_days,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) price_online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = od.order_id)<br/><span class="sql-reserved">INNER JOIN</span> tech.pd_costs ods<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ods.order_id <span class="sql-reserved">AND</span> od.order_detail_id = ods.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = co.order_id <span class="sql-reserved">AND</span> co.cmonth = <span class="sql-string">'$cmonth'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> commissions.order_info coi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = coi.order_id <span class="sql-reserved">AND</span> coi.cmonth = <span class="sql-string">'$cmonth'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = os.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = o.account_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-variable">@min_order_date_start</span> $whereStr<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.order_pd_info(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>223</td><td>reports/finance/pd_data/index.php:215</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_data(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date <span class="sql-variable">`Order Date`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_name <span class="sql-variable">`Account Name`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.state <span class="sql-variable">`State`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_owner <span class="sql-variable">`Opportunity Owner`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total <span class="sql-variable">`Order Total`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.credit_total <span class="sql-variable">`Credit Total`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date <span class="sql-variable">`Start Date`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date <span class="sql-variable">`End Date`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.sum_onsite_days <span class="sql-variable">`# of Onsite Days`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.price_onsite <span class="sql-variable">`Total Price Onsite PD`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.sum_online_days <span class="sql-variable">`# of Online Days`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.price_online <span class="sql-variable">`Total Price Online PD`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.pd_type <span class="sql-variable">`Type`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> od.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-string">'N'</span> <span class="sql-reserved">WHEN</span> od.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-string">'Y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> <span class="sql-variable">`Online`</span>,<br/>od.period_month <span class="sql-variable">`Date Of PD Recognition`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> e.event_name = <span class="sql-string">'Satisfied PD'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Expired'</span> <span class="sql-reserved">WHEN</span> e.event_date &lt;= <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">THEN</span> <span class="sql-string">'Delivered'</span> <span class="sql-reserved">WHEN</span> e.event_date &gt; <span class="sql-keyword">CURDATE</span>() <span class="sql-reserved">THEN</span> <span class="sql-string">'Projected'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> <span class="sql-variable">`Delivered/Expired`</span>, e.event_name <span class="sql-variable">`Event Name`</span>, od.order_detail_id, od.academic_year_name <span class="sql-variable">`Academic Year`</span>, od.period_total <span class="sql-variable">`Price`</span>, od.pd_standalone <span class="sql-variable">`PD Standalone`</span>, od.order_detail_end <span class="sql-variable">`Order Detail End`</span>, od.we_care_event_name <span class="sql-variable">`We Care Event Name`</span>, <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> od.we_care_date = <span class="sql-string">'0000-00-00'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">''</span> <span class="sql-reserved">ELSE</span> od.we_care_date<br/><span class="sql-keyword">END</span> <span class="sql-variable">`We Care Date`</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.order_pd_info o<br/><span class="sql-reserved">INNER JOIN</span> tech.pd_costs od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> amortization.pd_events e<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.pd_event_id = e.pd_event_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> $RevenueWhereStr;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tech.pd_data(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>224</td><td>util/function/new_renew.php:629</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> od_list_price_changes(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.list_price orig_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.sub_product_units<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = a.account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = a.state_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span><br/><span class="sql-reserved">INNER JOIN</span> tmp_only_pd_prods pdp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.product_id = od.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.is_domestic = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2014-01-01'</span> <span class="sql-reserved">AND</span> od.price &gt; pdp.list_price;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> od_list_price_changes(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.list_price <span class="sql-reserved">AS</span> orig_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.sub_product_units<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = a.account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = a.state_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span><br/><span class="sql-reserved">INNER JOIN</span> tmp_only_pd_prods pdp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pdp.product_id = od.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.is_domestic = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_date &gt;= <span class="sql-string">'2014-01-01'</span> <span class="sql-reserved">AND</span> od.price &gt; pdp.list_price</td></tr>
   <tr><td>225</td><td>util/function/new_renew.php:646</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sp_list_price_changes(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">4</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> *(od.price - od.orig_list_price) / sub_product_units + sp.list_price price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od_list_price_changes od<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sp_list_price_changes(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_qty <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">48</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">4</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> *(od.price - od.orig_list_price) / sub_product_units + sp.list_price <span class="sql-reserved">AS</span> price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od_list_price_changes od<br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_products sp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span><br/><span class="sql-reserved">INNER JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = sp.sub_product_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span></td></tr>
   <tr><td>226</td><td>cron/daily/new_orders_yest.php:20</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.finalAmount <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(os.order_total) - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(oc.credit_amount, <span class="sql-number">0</span>)) <span class="sql-string">'final'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_summary os <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.finalAmount</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(os.order_total) - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(oc.credit_amount, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> <span class="sql-string">'final'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_summary os <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>227</td><td>cron/daily/new_orders_yest.php:39</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.prices <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * d.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sub_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-number">28</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * d.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = o.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.prices</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * d.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sub_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-number">28</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * d.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = o.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>228</td><td>cron/daily/new_orders_yest.php:59</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hl_00645622 <span class="sql-reserved">SELECT</span><br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<span class="sql-string">' '</span>, u.first_name, u.last_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">','</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) EnteredBy,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a.account_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(b.account_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.account_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) parent_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(p.product_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.sub_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;f.final,<br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<span class="sql-string">' '</span>, us.first_name, us.last_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">','</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) SalesRep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = o.order_id <span class="sql-reserved">AND</span> d.product_id = <span class="sql-number">2</span><br/><span class="sql-reserved">JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = o.entered_by<br/><span class="sql-reserved">LEFT JOIN</span> user_orders ua <span class="sql-reserved">JOIN</span> users us <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id = us.user_id<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.order_id = o.order_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.finalAmount f<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.prices tp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>) <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">REGEXP</span> <span class="sql-string">'spt|imp'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hl_00645622</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<span class="sql-string">' '</span>, u.first_name, u.last_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">','</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> EnteredBy,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a.account_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(b.account_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.account_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> parent_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(p.product_name, <span class="sql-string">','</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.sub_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;f.final,<br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<span class="sql-string">' '</span>, us.first_name, us.last_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">','</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> SalesRep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = o.order_id <span class="sql-reserved">AND</span> d.product_id = <span class="sql-number">2</span><br/><span class="sql-reserved">JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = o.entered_by<br/><span class="sql-reserved">LEFT JOIN</span> user_orders ua <span class="sql-reserved">JOIN</span> users us <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id = us.user_id <span class="sql-reserved">AND</span> ua.order_id = o.order_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.finalAmount f<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.prices tp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tp.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$dateRange <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>) <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">REGEXP</span> <span class="sql-string">'spt|imp'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>229</td><td>finance/invoices/import/after_import_summary.php:68</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> min_dates(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(invoice_date) min_invoice_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(order_date) min_order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id <span class="sql-reserved">AND</span> <span class="sql-keyword">IO</span>.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> min_dates(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(invoice_date) <span class="sql-reserved">AS</span> min_invoice_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(order_date) <span class="sql-reserved">AS</span> min_order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id <span class="sql-reserved">AND</span> <span class="sql-keyword">IO</span>.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id</td></tr>
   <tr><td>230</td><td>finance/invoices/import/after_import_summary.php:130</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_summary(<span class="sql-reserved">PRIMARY KEY</span>(<span class="sql-keyword">YEAR</span>, <span class="sql-keyword">MONTH</span>)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(i.invoice_date) <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(i.invoice_date) <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IO</span>.invoice_amount - i.sales_tax) billing_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(i.invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(i.invoice_date)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_summary(<span class="sql-reserved">PRIMARY KEY</span>(<span class="sql-keyword">YEAR</span>, <span class="sql-keyword">MONTH</span>))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(i.invoice_date) <span class="sql-reserved">AS</span> <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(i.invoice_date) <span class="sql-reserved">AS</span> <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IO</span>.invoice_amount - i.sales_tax<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billing_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_orders <span class="sql-keyword">IO</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.invoice_id = i.invoice_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(i.invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(i.invoice_date)</td></tr>
   <tr><td>231</td><td>finance/invoices/import/insert_invoices_do.php:74</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> map_invoices(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.il_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_total - <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> cancel_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">LEFT JOIN</span> invoice_orders <span class="sql-keyword">IO</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id = <span class="sql-keyword">IO</span>.ns_invoice_id <span class="sql-reserved">AND</span> i.invoice_id = <span class="sql-keyword">IO</span>.invoice_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">236</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6438</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">5546</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">214</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071281</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71369</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">245</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6537</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">244</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6535</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">5373</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">200</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071949</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71985</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">804111</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070651</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">932</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">936</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6392</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">119</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071567</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71735</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10081039</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070153</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070103</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6254</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070127</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> i.date_entered &gt; <span class="sql-string">'2010-01-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> i.invoice_total <span class="sql-number">-1</span> <span class="sql-reserved">AND</span> i.invoice_total <span class="sql-number">+1</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> map_invoices(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.om_order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.il_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_total - <span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> cancel_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;invoices i<br/><span class="sql-reserved">LEFT JOIN</span> invoice_orders <span class="sql-keyword">IO</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id = <span class="sql-keyword">IO</span>.ns_invoice_id <span class="sql-reserved">AND</span> i.invoice_id = <span class="sql-keyword">IO</span>.invoice_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.ns_invoice_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">236</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6438</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">5546</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">214</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071281</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71369</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">245</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6537</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">244</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6535</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">5373</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">200</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071949</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71985</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">804111</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070651</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">932</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">936</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6392</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">119</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10071567</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">71735</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10081039</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070153</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070103</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">6254</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10070127</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> i.date_entered &gt; <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">IO</span>.invoice_amount, <span class="sql-number">0</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> i.invoice_total - <span class="sql-number">1</span> <span class="sql-reserved">AND</span> i.invoice_total + <span class="sql-number">1</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_account_name</td></tr>
   <tr><td>232</td><td>reports/iplans/index.php:173</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ip_info_table(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.iplan_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.reporting_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;g.group_name reporting_group_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.parent_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.parent_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pa.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip.iplan_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Create'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Exists'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) iplan_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.doc_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.iplan_version,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ip.uploaded = <span class="sql-number">1</span>, <span class="sql-string">'Yes'</span>, <span class="sql-string">''</span>) uploaded,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.roster_upload_classes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.roster_upload_notes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip.publish_roster_notes = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) publish_roster_notes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) trainer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.addtl_contact_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.addtl_contact_email,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.addtl_contact_phone,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.school_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.school_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.teacher_school_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.teacher_school_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.school_start_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.school_end_time,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.semester_end_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.teacher_only_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.pre_test_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.pre_test_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.interim_test_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.interim_test_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip.dev_reader_interim = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) dev_reader_interim,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip.interim_test_none = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) interim_test_none,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.post_test_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.post_test_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(ip.post_test_none = <span class="sql-number">1</span>, <span class="sql-string">'Yes'</span>, <span class="sql-string">'No'</span>) post_test_none,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.target_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.instructional_day_structure,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.school_focus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.student_usage_goal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.teacher_goal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.leadership_actions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.college_readiness_goal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.parent_goal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.incentive_goal,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.centralized_notes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.pls_notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(accounts a $addtl_tables)<br/><span class="sql-reserved">LEFT JOIN</span> accounts pa <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pa.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> iplans ip <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ip.account_id = a.account_id <span class="sql-reserved">AND</span> ip.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'$ay_filter'</span>)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.reporting_groups g<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;g.reporting_group_id = ip.reporting_group_id <span class="sql-reserved">AND</span> g.status = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> user_accounts au <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;au.account_id = a.account_id <span class="sql-reserved">AND</span> au.role_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $ROLE[$DEPARTMENT["</span> implementation <span class="sql-string">"]]["</span> trainer <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> au.account_owner = <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> user_accounts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id = a.account_id <span class="sql-reserved">AND</span> c.role_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $ROLE[$DEPARTMENT["</span> implementation <span class="sql-string">"]]["</span> area_manager <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.account_owner = <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = a.account_id <span class="sql-reserved">AND</span> ua.role_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $ROLE[$DEPARTMENT["</span> implementation <span class="sql-string">"]]["</span> rvp <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> ua.account_owner = <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = au.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users rvp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rvp.user_id = ua.user_id <span class="sql-reserved">AND</span> u.status = <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = ip.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.customer_status = <span class="sql-string">'Current Customer'</span> $filter_string<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(g.reporting_group_id, <span class="sql-number">0</span>)<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ip_info_table(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>233</td><td>reports/opportunities/top_20_index.php:268</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $history_log_table <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'opportunities'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $history_log_table</td><td style="border-bottom: solid 1px black;">history_log_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TABLE_NAME</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;record_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COLUMN_NAME</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;column_title <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;approved_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;approval_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;notes <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;change_src <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;entered_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'opportunities'</span></td></tr>
   <tr><td>234</td><td>reports/qcpr/renewals/generate_data_2018.php:121</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(il_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(nvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(vp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(rvp_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*Manager/User Group Data*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) nvp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No NVP'</span>) nvp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.nvp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) nvp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) vp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No VP'</span>) vp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.vp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) vp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp_id, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span>(<span class="sql-number">8</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) rvp_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'No RVP'</span>) rvp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<span class="sql-keyword">NULLIF</span>(u.rvp_area_sort, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>) rvp_area_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.area_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.<span class="sql-variable">`area`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id il_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_f_last renewal_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.status user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.renewal_qcpr_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.termination_date termination_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> u.area_comp_plan_type <span class="sql-reserved">IN</span>(<span class="sql-string">'nvp'</span>, <span class="sql-string">'vp'</span>, <span class="sql-string">'rvp'</span>, <span class="sql-string">'dm'</span>, <span class="sql-string">'a3k'</span>) <span class="sql-reserved">THEN</span> u.area_comp_plan_type <span class="sql-reserved">ELSE</span> <span class="sql-string">'renewal_user'</span><br/><span class="sql-keyword">END</span> comp_plan_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.users_cp u<br/><span class="sql-reserved">LEFT JOIN</span> commissions.compensation_plans cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id = u.comp_plan_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.areas a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.area_id = cp.area_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.qcpr_manager_permissions m<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;m.manager_id = <span class="sql-string">'$curr_user_id'</span> <span class="sql-reserved">AND</span> m.user_id = u.user_id <span class="sql-reserved">AND</span> m.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> u.year = $year <span class="sql-reserved">AND</span> u.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> u.renewal_qcpr_status = <span class="sql-number">0</span> <span class="sql-comment">#Has current year order/QC/credit OR non-terminated rep with quota</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$user_where<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.sales_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.comp_plan_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(il_user_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(nvp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(vp_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(rvp_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>235</td><td>reports/qcpr/renewals/generate_data_2018.php:167</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source_copy(<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_user_data_source</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_user_data_source_copy(<span class="sql-reserved">PRIMARY KEY</span>(renewal_user_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_user_data_source</td></tr>
   <tr><td>236</td><td>reports/qcpr/renewals/generate_data_2018.php:180</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_trainers(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;trainer_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_rvp_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uad.role_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> uad.role_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uad.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>) trainer_user_id,<br/><span class="sql-string">''</span> trainer_user_name,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uad.role_id = <span class="sql-number">7</span> <span class="sql-reserved">THEN</span> uad.user_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) imp_rvp_user_id,<br/><span class="sql-string">''</span> imp_rvp_user_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.user_account_dates uad<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = uad.account_id <span class="sql-reserved">AND</span> rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.rank = <span class="sql-number">1</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = uad.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@month_end</span> <span class="sql-reserved">BETWEEN</span> uad.start_date <span class="sql-reserved">AND</span> uad.end_date <span class="sql-reserved">AND</span> uad.account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> uad.role_id <span class="sql-reserved">IN</span>(<span class="sql-number">7</span>, <span class="sql-number">4</span>, <span class="sql-number">5</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uad.account_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_trainers(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;trainer_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_rvp_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;trainer_user_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">23</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;trainer_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_rvp_user_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_rvp_user_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">0</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uad.role_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> uad.role_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uad.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>) <span class="sql-reserved">AS</span> trainer_user_id,<br/><span class="sql-string">''</span> <span class="sql-reserved">AS</span> trainer_user_name,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uad.role_id = <span class="sql-number">7</span> <span class="sql-reserved">THEN</span> uad.user_id <span class="sql-reserved">ELSE</span> <span class="sql-reserved">NULL</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> imp_rvp_user_id,<br/><span class="sql-string">''</span> <span class="sql-reserved">AS</span> imp_rvp_user_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.user_account_dates uad<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = uad.account_id <span class="sql-reserved">AND</span> rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.rank = <span class="sql-number">1</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = uad.user_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@month_end</span> <span class="sql-reserved">BETWEEN</span> uad.start_date <span class="sql-reserved">AND</span> uad.end_date <span class="sql-reserved">AND</span> uad.account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> uad.role_id <span class="sql-reserved">IN</span>(<span class="sql-number">7</span>, <span class="sql-number">4</span>, <span class="sql-number">5</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uad.account_id</td></tr>
   <tr><td>237</td><td>reports/qcpr/renewals/generate_data_2018.php:211</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_districts(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_id <span class="sql-reserved">ELSE</span> <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) district_account_id,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_name <span class="sql-reserved">ELSE</span> <span class="sql-string">'-- No District --'</span><br/><span class="sql-keyword">END</span><br/>) district_account_name,<br/><span class="sql-keyword">COALESCE</span>(d1.state_code, a.state_code) district_state_code,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> d1.account_id <span class="sql-reserved">OR</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> has_district,<br/>tat.trainer_user_name account_trainer,<br/>tat.imp_rvp_user_name account_imp_rvp<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts d1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id = a.parent_account_id <span class="sql-reserved">AND</span> d1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span><br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_trainers tat <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tat.account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.rank = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_districts(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_id <span class="sql-reserved">ELSE</span> <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> district_account_id,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_name <span class="sql-reserved">ELSE</span> <span class="sql-string">'-- No District --'</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> district_account_name,<br/><span class="sql-keyword">COALESCE</span>(d1.state_code, a.state_code) <span class="sql-reserved">AS</span> district_state_code,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> d1.account_id <span class="sql-reserved">OR</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> has_district,<br/>tat.trainer_user_name <span class="sql-reserved">AS</span> account_trainer,<br/>tat.imp_rvp_user_name <span class="sql-reserved">AS</span> account_imp_rvp<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts d1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id = a.parent_account_id <span class="sql-reserved">AND</span> d1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span><br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_trainers tat <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tat.account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.rank = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td></tr>
   <tr><td>238</td><td>reports/qcpr/renewals/generate_data_2018.php:235</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_renewal_quotas(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quota<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rank = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_renewal_quotas(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;base_user_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quota <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quota<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rank = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td></tr>
   <tr><td>239</td><td>reports/qcpr/renewals/generate_data_2018.php:252</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;/ * * * * * * * <span class="sql-keyword">USER</span> INFO * * * * * * <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.orig_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.is_primary_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;/ * * * * * * * <span class="sql-keyword">ACCOUNT</span> PROGRAM INFO * * * * * * <span class="sql-comment">*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_name district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code district_state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.has_district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_name account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'z'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'n'</span><br/><span class="sql-keyword">END</span> on_target_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Within Quota'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Not Within Quota'</span><br/><span class="sql-keyword">END</span> on_target,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> orig_on_target,<br/>base.purchaser_level purchaser_level_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.purchaser_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District Purchase'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'School Purchase'</span><br/><span class="sql-keyword">END</span> purchaser_level,<br/>base.program_id,<br/>op.opportunity_product_name program,<br/>/ * * * * * * * EXPIRING <span class="sql-keyword">ACCOUNT</span> * * * * * * <span class="sql-comment">*/</span><br/><span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'p'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id<br/>) expiring_account_id,<br/>tad.account_name expiring_account,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> orig_expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> expiring_school_count,<br/><span class="sql-number">0</span> expiring_license_count,<br/>rb.renewal_quota_updated orig_expiring_order_account_value,<br/>(base.renewal_quota_updated) expiring_order_account_value,<br/>base.non_quota_account,<br/>district_re_allocated,<br/>/ * * * * * * * <span class="sql-keyword">NEW</span> <span class="sql-reserved">ORDER</span> * * * * * * <span class="sql-comment">*/</span><br/>base.rank,<br/>base.school_rank,<br/>base.order_id booked_order_id,<br/>base.order_id booked_order,<br/>co.cancel,<br/><span class="sql-keyword">IFNULL</span>(base.orig_school_count, <span class="sql-number">0</span>) orig_booked_school_count,<br/><span class="sql-keyword">IFNULL</span>(base.school_count, <span class="sql-number">0</span>) booked_school_count,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.school_count / <span class="sql-keyword">LEAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base.user_quota_include,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base.on_target<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) booked_school_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rqt.booked_target_year = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> single_year_value <span class="sql-reserved">ELSE</span> base.all_yr_value<br/><span class="sql-keyword">END</span> booked_order_account_value,<br/>/ * * * * * * QC * * * * * <span class="sql-comment">*/</span><br/>qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.qc_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) qc_percent,<br/>upsell_qc_total,<br/>qc_total + upsell_qc_total acv_upsell_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(qc_total + upsell_qc_total) / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) acv_upsell_qc_percent,<br/>/ * * * * * * ACV * * * * * <span class="sql-comment">*/</span><br/>base.single_year_value,<br/>acv_total acv_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) acv_percent,<br/>/ * * * * * * Target <span class="sql-keyword">EXPANSION</span> * * * * * <span class="sql-comment">*/</span><br/>target_more_years + more_products_more_years target_more_years,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1<br/>) -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>) target_school_upsell,<br/><span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) + more_schools_more_years more_schools_all_yr,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_value + more_products_yr_1 + more_schools_yr_1 + target_more_years + more_products_more_years + more_schools_more_years<br/>) -(acv_total) total_expansion,<br/>expansion_qc_total expansion_qc,<br/>/ * * * * * * * <span class="sql-keyword">ACCOUNT</span> <span class="sql-keyword">LEVEL</span> ADDTL INFO * * * * * * <span class="sql-comment">*/</span><br/>aps.year_value booked_account_value,<br/>aps.percent_target percent_account_target,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> aps.expiring_orders <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> expiring_orders,<br/>tad.account_trainer,<br/>tad.account_imp_rvp<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users base<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.account_id = base.account_id <span class="sql-reserved">AND</span> rb.order_id = base.order_id <span class="sql-reserved">AND</span> rb.user_id = base.user_id <span class="sql-reserved">AND</span> rb.program_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;co.order_id = base.order_id <span class="sql-reserved">AND</span> co.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products op<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_districts tad <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.users_cp cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id = base.user_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_quota_types rqt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rqt.renewal_user_id = base.base_user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_account_program_summary aps<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aps.account_id = base.account_id <span class="sql-reserved">AND</span> aps.program_id = base.program_id <span class="sql-reserved">AND</span> aps.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rqt.renewal_user_id <span class="sql-reserved">THEN</span> aps.renewal_type_id = rqt.renewal_type_id <span class="sql-reserved">ELSE</span> aps.renewal_type_id = <span class="sql-number">1</span><br/><span class="sql-keyword">END</span><br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_renewal_quotas rq <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id = rq.account_id <span class="sql-reserved">AND</span> base.user_id = rq.user_id <span class="sql-reserved">AND</span> base.base_user_id = rq.base_user_id <span class="sql-reserved">AND</span> base.program_id = rq.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> base.user_id = base.base_user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#TESTING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#LIMIT 100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.comp_plan_id <span class="sql-reserved">AS</span> renewal_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.orig_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.is_primary_user,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id <span class="sql-reserved">AS</span> district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_name <span class="sql-reserved">AS</span> district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code <span class="sql-reserved">AS</span> district_state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_state_code <span class="sql-reserved">AS</span> district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.has_district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_name <span class="sql-reserved">AS</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code <span class="sql-reserved">AS</span> state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.state_code <span class="sql-reserved">AS</span> state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'z'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'y'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'n'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> on_target_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> tad.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District'</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Within Quota'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Not Within Quota'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> on_target,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> orig_on_target,<br/>base.purchaser_level <span class="sql-reserved">AS</span> purchaser_level_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.purchaser_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District Purchase'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'School Purchase'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> purchaser_level,<br/>base.program_id,<br/>op.opportunity_product_name <span class="sql-reserved">AS</span> program,<br/><span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'p'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id<br/>) <span class="sql-reserved">AS</span> expiring_account_id,<br/>tad.account_name <span class="sql-reserved">AS</span> expiring_account,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> orig_expiring_school_count,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> tad.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> expiring_school_count,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> expiring_license_count,<br/>rb.renewal_quota_updated <span class="sql-reserved">AS</span> orig_expiring_order_account_value,<br/>base.renewal_quota_updated <span class="sql-reserved">AS</span> expiring_order_account_value,<br/>base.non_quota_account,<br/>district_re_allocated,<br/>base.rank,<br/>base.school_rank,<br/>base.order_id <span class="sql-reserved">AS</span> booked_order_id,<br/>base.order_id <span class="sql-reserved">AS</span> booked_order,<br/>co.cancel,<br/><span class="sql-keyword">IFNULL</span>(base.orig_school_count, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> orig_booked_school_count,<br/><span class="sql-keyword">IFNULL</span>(base.school_count, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> booked_school_count,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.school_count / <span class="sql-keyword">LEAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base.user_quota_include,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base.on_target<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> booked_school_percent,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rqt.booked_target_year = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> single_year_value <span class="sql-reserved">ELSE</span> base.all_yr_value<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> booked_order_account_value,<br/>qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.qc_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> qc_percent,<br/>upsell_qc_total,<br/>qc_total + upsell_qc_total <span class="sql-reserved">AS</span> acv_upsell_qc_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(qc_total + upsell_qc_total) / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> acv_upsell_qc_percent,<br/>base.single_year_value,<br/>acv_total <span class="sql-reserved">AS</span> acv_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.acv_total / rq.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> acv_percent,<br/>target_more_years + more_products_more_years <span class="sql-reserved">AS</span> target_more_years,<br/>single_year_value + more_products_yr_1 -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_acv + more_products_acv<br/>) <span class="sql-reserved">AS</span> target_school_upsell,<br/><span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;more_schools_yr_1 - more_schools_acv,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) + more_schools_more_years <span class="sql-reserved">AS</span> more_schools_all_yr,<br/>single_year_value + more_products_yr_1 + more_schools_yr_1 + target_more_years + more_products_more_years + more_schools_more_years - acv_total <span class="sql-reserved">AS</span> total_expansion,<br/>expansion_qc_total <span class="sql-reserved">AS</span> expansion_qc,<br/>aps.year_value <span class="sql-reserved">AS</span> booked_account_value,<br/>aps.percent_target <span class="sql-reserved">AS</span> percent_account_target,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> base.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> aps.expiring_orders <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> expiring_orders,<br/>tad.account_trainer,<br/>tad.account_imp_rvp<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users base<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> rb.account_id = base.account_id <span class="sql-reserved">AND</span> rb.order_id = base.order_id <span class="sql-reserved">AND</span> rb.user_id = base.user_id <span class="sql-reserved">AND</span> rb.program_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders co<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;co.order_id = base.order_id <span class="sql-reserved">AND</span> co.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products op<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = base.program_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_districts tad <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.users_cp cp<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cp.user_id = base.user_id <span class="sql-reserved">AND</span> cp.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> cp.year = $year<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_quota_types rqt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rqt.renewal_user_id = base.base_user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_account_program_summary aps<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aps.account_id = base.account_id <span class="sql-reserved">AND</span> aps.program_id = base.program_id <span class="sql-reserved">AND</span> aps.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rqt.renewal_user_id <span class="sql-reserved">THEN</span> aps.renewal_type_id = rqt.renewal_type_id <span class="sql-reserved">ELSE</span> aps.renewal_type_id = <span class="sql-number">1</span><br/><span class="sql-keyword">END</span><br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_renewal_quotas rq <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id = rq.account_id <span class="sql-reserved">AND</span> base.user_id = rq.user_id <span class="sql-reserved">AND</span> base.base_user_id = rq.base_user_id <span class="sql-reserved">AND</span> base.program_id = rq.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cmonth = <span class="sql-string">'$report_month_filter'</span> <span class="sql-reserved">AND</span> base.user_id = base.base_user_id <span class="sql-comment">#TESTING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#LIMIT 100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
   <tr><td>240</td><td>reports/qcpr/renewals/generate_data_2018.php:348</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source_copy(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_qc_data_source</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> interlink.temp_renew_qcpr_qc_data_source_copy(<br/>&nbsp;&nbsp;&nbsp;&nbsp;row_id <span class="sql-reserved">INT</span> <span class="sql-reserved">UNSIGNED</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(renewal_user_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.temp_renew_qcpr_qc_data_source</td></tr>
   <tr><td>241</td><td>reports/qcpr/renewals/generate_data_2018.php:568</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;an.area_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">INNER JOIN</span> interlink.user_account_dates ua<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = a.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> ua.account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$cmonth_end'</span> <span class="sql-reserved">BETWEEN</span> ua.start_date <span class="sql-reserved">AND</span> ua.end_date<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = a.account_id <span class="sql-reserved">AND</span> rb.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ua.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.area_users au<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;au.user_id = ua.user_id <span class="sql-reserved">AND</span> <span class="sql-string">'$cmonth_end'</span> <span class="sql-reserved">BETWEEN</span> au.start_date <span class="sql-reserved">AND</span> au.end_date<br/><span class="sql-reserved">LEFT JOIN</span> commissions.areas an<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;an.area_id = au.area_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;area_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">250</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) <span class="sql-reserved">AS</span> account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;an.area_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">INNER JOIN</span> interlink.user_account_dates ua<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = a.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> ua.account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$cmonth_end'</span> <span class="sql-reserved">BETWEEN</span> ua.start_date <span class="sql-reserved">AND</span> ua.end_date<br/><span class="sql-reserved">INNER JOIN</span> commissions.renewal_report_base rb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rb.account_id = a.account_id <span class="sql-reserved">AND</span> rb.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = ua.user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.area_users au<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;au.user_id = ua.user_id <span class="sql-reserved">AND</span> <span class="sql-string">'$cmonth_end'</span> <span class="sql-reserved">BETWEEN</span> au.start_date <span class="sql-reserved">AND</span> au.end_date<br/><span class="sql-reserved">LEFT JOIN</span> commissions.areas an<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;an.area_id = au.area_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td></tr>
   <tr><td>242</td><td>reports/qcpr/renewals/generate_data_2018.php:588</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_renewal_export_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<span class="sql-keyword">USER</span>, <span class="sql-variable">`account id`</span>, <span class="sql-variable">`booked order`</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.last_name <span class="sql-variable">`User`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name <span class="sql-variable">`Renewal Rep User`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account_id <span class="sql-variable">`District ID`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account <span class="sql-variable">`District`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_state <span class="sql-variable">`District State`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_id <span class="sql-variable">`Account ID`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_name <span class="sql-variable">`Account`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tier.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_tier.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-variable">`Account Tier Jan $year`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.state <span class="sql-variable">`State`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> qc.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'District'</span> <span class="sql-reserved">WHEN</span> qc.account_level = <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'School'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Account Type`</span>,<br/>qc.program <span class="sql-variable">`Program`</span>,<br/>qc.purchaser_level <span class="sql-variable">`Purchaser Level`</span>,<br/><span class="sql-comment"># qc.orig_expiring_order_account_value  `Expiring Renewal Quota`,</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rou.renewal_quota_updated <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Renewal Quota`</span>,<br/>qc.expiring_orders <span class="sql-variable">`Expiring Orders`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> qc.orig_expiring_school_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring # Schools`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> qc.orig_booked_school_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Booked # Schools`</span>,<br/><span class="sql-comment">/*school count can be overridden to 1 even if not on target*/</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.orig_on_target = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> qc.booked_school_count = <span class="sql-number">0</span><br/>) <span class="sql-reserved">THEN</span> <span class="sql-string">''</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = rou.base_user_id <span class="sql-reserved">AND</span> qcu.comp_plan_type = <span class="sql-string">'renewal_user'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> rou.is_primary_user = <span class="sql-number">1</span><br/>) <span class="sql-reserved">AND</span> rou.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.rank <span class="sql-reserved">ELSE</span><br/><span class="sql-comment">/*non primary rank*/</span> <span class="sql-string">'1+'</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Order Count (Target Acct)`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rou.on_target = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rou.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rou.school_rank = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = rou.base_user_id <span class="sql-reserved">AND</span> qcu.comp_plan_type = <span class="sql-string">'renewal_user'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> rou.is_primary_school_rank = <span class="sql-number">1</span><br/>) <span class="sql-reserved">AND</span> rou.user_quota_include = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`School Count (Target Acct)`</span>,<br/>rou.single_year_acv <span class="sql-variable">`Target ACV`</span>,<br/>rou.more_products_acv <span class="sql-variable">`More Products ACV`</span>,<br/>rou.more_schools_acv <span class="sql-variable">`More Schools ACV`</span>,<br/>qc.acv_total <span class="sql-variable">`ACV Total`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = rou.base_user_id <span class="sql-reserved">AND</span> qcu.comp_plan_type = <span class="sql-string">'renewal_user'</span><br/>) <span class="sql-reserved">OR</span> rou.is_primary_user = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> qc.acv_percent <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`ACV Total %`</span>,<br/>qc.qc_total <span class="sql-variable">`QC Total`</span>,<br/>qc.qc_percent <span class="sql-variable">`QC %`</span>,<br/>rou.single_year_value - rou.single_year_acv <span class="sql-variable">`Target Acct Upsell  $year - $year_to`</span>,<br/>rou.more_products_yr_1 - rou.more_products_acv <span class="sql-variable">`More Products Upsell  $year - $year_to Year`</span>,<br/>rou.target_more_years <span class="sql-variable">`Target Acct Addt'l Years`</span>,<br/>rou.more_products_more_years <span class="sql-variable">`More Products Addt'l Years`</span>,<br/>rou.more_schools_yr_1 - rou.more_schools_acv <span class="sql-variable">`More Schools  $year - $year_to Year`</span>,<br/>rou.more_schools_more_years <span class="sql-variable">`More Schools Addt'l Years`</span>,<br/><span class="sql-string">".($year &gt;= 2019 ?
                    "</span> rou.upsell_qc_total <span class="sql-variable">`Target School Upsell QC`</span>,<br/>rou.qc_total + rou.upsell_qc_total <span class="sql-variable">`ACV + Upsell QC`</span>,<br/>qc.acv_upsell_qc_percent <span class="sql-variable">`ACV + Upsell QC %`</span>,<br/><span class="sql-string">"
                :
                    "</span> rou.expansion_qc_total <span class="sql-variable">`Expansion QC Total`</span>,<br/><span class="sql-string">"
            )."</span> qc.booked_order_account_value <span class="sql-variable">`Booked Order Account Total`</span>,<br/>qc.booked_order_id <span class="sql-variable">`Booked Order`</span>,<br/>qc.on_target <span class="sql-variable">`Quota Bucket`</span>,<br/>o.order_date <span class="sql-variable">`Order Date`</span>,<br/>o.start_date <span class="sql-variable">`Start Date`</span>,<br/>o.end_date <span class="sql-variable">`End Date`</span>,<br/><span class="sql-string">". ( $year &gt;= 2019 ? "</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.increase_due_to_overage = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Increase due to Overage`</span>,<br/><span class="sql-string">" : "" ) ."</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.Cancel = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Is Cancelled`</span>,<br/>o.order_total <span class="sql-variable">`Order Total`</span>,<br/>oi.credit_revenue_total + oi.bad_debt_total <span class="sql-variable">`Credits (Cancels/Bad Debt)`</span>,<br/>o.sales_rep <span class="sql-variable">`Opportunity Owner`</span>,<br/>oi.order_renewal_rep <span class="sql-variable">`Renewal Rep`</span>,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(oi.order_field_rep, <span class="sql-string">''</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.account_sales_rep<br/>) <span class="sql-variable">`Field Rep`</span>,<br/><span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oi.order_field_region,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'National Renewal Region'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.area_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>) <span class="sql-variable">`Region`</span>,<br/>qc.account_trainer <span class="sql-variable">`Account Trainer`</span>,<br/>qc.account_imp_rvp <span class="sql-variable">`Account Imp. RVP`</span>,<br/>rou.po_total <span class="sql-variable">`PO Total`</span>,<br/>rou.year_po_total <span class="sql-variable">`$year - $year_to PO Total`</span> <span class="sql-string">"
            .($corporate_report?
            "</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> l.is_domestic = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> l.location_code <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> international<br/><span class="sql-comment">-- EXPIRING</span><br/>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_conf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Conf`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_pre_conf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Pre-Conf`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd + rxb.imf <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_summer + rxb.imf_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_summer <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Summer`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rxb.smarty_ants_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rxb.smarty_ants_count<br/><span class="sql-keyword">END</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_conf_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Conf Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.nls_pre_conf_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring NLS Pre-Conf Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.levelset_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Levelset Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.bae_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring BAE Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rxb.smarty_ants_summer_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rxb.smarty_ants_summer_count<br/><span class="sql-keyword">END</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.literacy_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Literacy Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.smarty_ants_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Smarty Ants Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.actively_learn_misc_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Actively Learn Misc Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.science_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Science Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.onsite_pd_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Onsite PD Summer Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.online_pd_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring Online PD Summer Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> $distinct_expiring_filter <span class="sql-reserved">THEN</span> rxb.pm_summer_count <span class="sql-reserved">ELSE</span> <span class="sql-string">''</span><br/><span class="sql-keyword">END</span> <span class="sql-variable">`Expiring PM Summer Count`</span><br/><span class="sql-comment">-- BOOKED</span><br/>,<br/>rbb.literacy <span class="sql-variable">`Literacy`</span>,<br/>rbb.levelset <span class="sql-variable">`Levelset`</span>,<br/>rbb.bae <span class="sql-variable">`BAE`</span>,<br/>rbb.smarty_ants <span class="sql-variable">`Smarty Ants`</span>,<br/>rbb.actively_learn <span class="sql-variable">`Actively Learn`</span>,<br/>rbb.nls_conf <span class="sql-variable">`NLS Conf`</span>,<br/>rbb.nls_pre_conf <span class="sql-variable">`NLS Pre-Conf`</span>,<br/>rbb.literacy_misc <span class="sql-variable">`Literacy Misc`</span>,<br/>rbb.smarty_ants_misc <span class="sql-variable">`Smarty Ants Misc`</span>,<br/>rbb.actively_learn_misc <span class="sql-variable">`Actively Learn Misc`</span>,<br/>rbb.science <span class="sql-variable">`Science`</span>,<br/>rbb.onsite_pd + rbb.imf <span class="sql-variable">`Onsite PD`</span>,<br/>rbb.online_pd <span class="sql-variable">`Online PD`</span>,<br/>rbb.pm <span class="sql-variable">`PM`</span>,<br/>rbb.literacy_summer <span class="sql-variable">`Literacy Summer`</span>,<br/>rbb.levelset_summer <span class="sql-variable">`Levelset Summer`</span>,<br/>rbb.bae_summer <span class="sql-variable">`BAE Summer`</span>,<br/>rbb.smarty_ants_summer <span class="sql-variable">`Smarty Ants Summer`</span>,<br/>rbb.actively_learn_summer <span class="sql-variable">`Actively Learn Summer`</span>,<br/>rbb.literacy_misc_summer <span class="sql-variable">`Literacy Misc Summer`</span>,<br/>rbb.smarty_ants_misc_summer <span class="sql-variable">`Smarty Ants Misc Summer`</span>,<br/>rbb.actively_learn_misc_summer <span class="sql-variable">`Actively Learn Misc Summer`</span>,<br/>rbb.science_summer <span class="sql-variable">`Science Summer`</span>,<br/>rbb.onsite_pd_summer + rbb.imf_summer <span class="sql-variable">`Onsite PD Summer`</span>,<br/>rbb.online_pd_summer <span class="sql-variable">`Online PD Summer`</span>,<br/>rbb.pm_summer <span class="sql-variable">`PM Summer`</span>,<br/>rbb.literacy_count <span class="sql-variable">`Literacy License Count`</span>,<br/>rbb.levelset_count <span class="sql-variable">`Levelset License Count`</span>,<br/>rbb.bae_count <span class="sql-variable">`BAE License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rbb.smarty_ants_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rbb.smarty_ants_count<br/><span class="sql-keyword">END</span> <span class="sql-variable">`Smarty Ants License Count`</span>,<br/>rbb.actively_learn_count <span class="sql-variable">`Actively Learn License Count`</span>,<br/>rbb.nls_conf_count <span class="sql-variable">`NLS Conf Count`</span>,<br/>rbb.nls_pre_conf_count <span class="sql-variable">`NLS Pre-Conf Count`</span>,<br/>rbb.literacy_misc_count <span class="sql-variable">`Literacy Misc Count`</span>,<br/>rbb.smarty_ants_misc_count <span class="sql-variable">`Smarty Ants Misc Count`</span>,<br/>rbb.actively_learn_misc_count <span class="sql-variable">`Actively Learn Misc Count`</span>,<br/>rbb.science_count <span class="sql-variable">`Science License Count`</span>,<br/>rbb.onsite_pd_count <span class="sql-variable">`Onsite PD Count`</span>,<br/>rbb.online_pd_count <span class="sql-variable">`Online PD Count`</span>,<br/>rbb.pm_count <span class="sql-variable">`PM Count`</span>,<br/>rbb.literacy_summer_count <span class="sql-variable">`Literacy Summer License Count`</span>,<br/>rbb.levelset_summer_count <span class="sql-variable">`Levelset Summer License Count`</span>,<br/>rbb.bae_summer_count <span class="sql-variable">`BAE Summer License Count`</span>,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> rbb.smarty_ants_summer_count = <span class="sql-string">'UNLIMITED'</span> <span class="sql-reserved">THEN</span> $SA_Unlimited_License_Count <span class="sql-reserved">ELSE</span> rbb.smarty_ants_summer_count<br/><span class="sql-keyword">END</span> <span class="sql-variable">`Smarty Ants Summer License Count`</span>,<br/>rbb.actively_learn_summer_count <span class="sql-variable">`Actively Learn Summer License Count`</span>,<br/>rbb.literacy_misc_summer_count <span class="sql-variable">`Literacy Misc Summer Count`</span>,<br/>rbb.smarty_ants_misc_summer_count <span class="sql-variable">`Smarty Ants Misc Summer Count`</span>,<br/>rbb.actively_learn_misc_summer_count <span class="sql-variable">` Actively Learn Misc Summer Count`</span>,<br/>rbb.science_summer_count <span class="sql-variable">`Science Summer License Count`</span>,<br/>rbb.onsite_pd_summer_count <span class="sql-variable">`Onsite PD Summer Count`</span>,<br/>rbb.online_pd_summer_count <span class="sql-variable">`Online PD Summer Count`</span>,<br/>rbb.pm_summer_count <span class="sql-variable">`PM Summer Count`</span> <span class="sql-string">"
            : "")
            ."</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.renewal_order_users rou<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = rou.account_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_tiers tier<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = tier.account_id <span class="sql-reserved">AND</span> tier.cmonth = <span class="sql-keyword">CONCAT</span>(<span class="sql-string">'$year-01-01'</span>)<br/><span class="sql-reserved">LEFT JOIN</span> commissions.account_tiers d_tier<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d_tier.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> d_tier.cmonth = <span class="sql-keyword">CONCAT</span>(<span class="sql-string">'$year-01-01'</span>)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.temp_renew_qcpr_qc_data_source qc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.order_id = qc.booked_order_id <span class="sql-reserved">AND</span> rou.account_id = qc.account_id <span class="sql-reserved">AND</span> rou.program_id = qc.program_id <span class="sql-reserved">AND</span> rou.base_user_id = qc.user_id<br/><span class="sql-reserved">INNER JOIN</span> commissions.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.base_user_id = u.user_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.temp_renew_qcpr_user_data_source qcu<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.user_id = qcu.il_user_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = rou.order_id <span class="sql-reserved">AND</span> o.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.order_info oi<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id = rou.order_id <span class="sql-reserved">AND</span> oi.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.tmp_account_sales_rep asr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;asr.account_id = rou.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span> <span class="sql-string">".($corporate_report?
            "</span><br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_user_order_booked_buckets rbb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rbb.order_id = rou.order_id <span class="sql-reserved">AND</span> rbb.account_id = rou.account_id <span class="sql-reserved">AND</span> rbb.user_id = rou.user_id <span class="sql-reserved">AND</span> rbb.program_id = rou.program_id <span class="sql-reserved">AND</span> rbb.base_user_id = rou.base_user_id <span class="sql-reserved">AND</span> rbb.ay_bucket_id = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> rbb.cmonth = rou.cmonth<br/><span class="sql-reserved">LEFT JOIN</span> commissions.renewal_user_account_expiring_buckets rxb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rxb.account_id = rou.account_id <span class="sql-reserved">AND</span> rxb.user_id = rou.user_id <span class="sql-reserved">AND</span> rxb.program_id = rou.program_id <span class="sql-reserved">AND</span> rxb.base_user_id = rou.base_user_id <span class="sql-reserved">AND</span> rxb.cmonth = rou.cmonth <span class="sql-string">": "</span> <span class="sql-string">").
            "</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rou.cmonth = <span class="sql-string">'$report_month_filter'</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_state_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.has_district<br/><span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.district_account,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.on_target_id<br/><span class="sql-reserved">DESC</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qc.booked_order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_renewal_export_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<span class="sql-keyword">USER</span>, <span class="sql-variable">`account id`</span>, <span class="sql-variable">`booked order`</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>243</td><td>util/db/pd_queries.php:124</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_pd <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.quantity * sp.sub_product_qty) pd_purchased<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.product_id = sp.product_id <span class="sql-reserved">AND</span> od.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $academic_years) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $pd_sub_product_types) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id = od.order_iD <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_pd</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_purchased <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">36</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> pd_purchased<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.product_id = sp.product_id <span class="sql-reserved">AND</span> od.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $academic_years) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', $pd_sub_product_types) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id = od.order_iD <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td></tr>
   <tr><td>244</td><td>cron/monthly/renewals.php:126</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_only_products(<span class="sql-reserved">KEY</span>(product_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>)<br/><span class="sql-reserved">JOIN</span> sub_product_types spt <span class="sql-reserved">USING</span>(sub_product_type_id)<br/><span class="sql-reserved">LEFT JOIN</span> sub_products sp2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp2.product_id = p.product_id <span class="sql-reserved">AND</span> sp2.sub_product_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>, <span class="sql-number">6</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp2.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pd_only_products(<span class="sql-reserved">KEY</span>(product_id))</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;description <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_set_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;package_code <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">PARTIAL</span> <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">UPGRADE</span> <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imf_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;support_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;display_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;domain_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;partner_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;teacher_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_licenses <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_licenses <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;revenue <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_order_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_order_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_default <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;standard <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sf_product_id <span class="sql-reserved">CHAR</span>(<span class="sql-number">18</span>),<br/><span class="sql-keyword">STATUS</span> <span class="sql-reserved">TINYINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;exclude_pd <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;entered_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_modified <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>)<br/><span class="sql-reserved">JOIN</span> sub_product_types spt <span class="sql-reserved">USING</span>(sub_product_type_id)<br/><span class="sql-reserved">LEFT JOIN</span> sub_products sp2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp2.product_id = p.product_id <span class="sql-reserved">AND</span> sp2.sub_product_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>, <span class="sql-number">6</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp2.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td></tr>
   <tr><td>245</td><td>cron/monthly/renewals.php:135</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_future_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(o.order_date) max_booked_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(o.order_id) order_string,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(os.order_total) max_order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes <span class="sql-keyword">X</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = <span class="sql-keyword">X</span>.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND (aos.student_licenses &gt; 0 OR p.sku LIKE '%site%' OR (p.product_group_id = '" . $PRODUCT_GROUPS["program pricing"] . "' AND p.sku NOT LIKE '%PD%'))</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">0</span> <span class="sql-comment">/* avoid these products so that summer orders won't prevent a renewal */</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> bod.expiring_year = $next_year <span class="sql-reserved">AND</span> o.end_date &gt; <span class="sql-string">'$today'</span> <span class="sql-reserved">AND</span> o.se_0_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND pop.product_id IS NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND IFNULL(pr.program_name, pl.product_line_str) IS NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_future_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(o.order_date) <span class="sql-reserved">AS</span> max_booked_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(o.order_id) <span class="sql-reserved">AS</span> order_string,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(os.order_total) <span class="sql-reserved">AS</span> max_order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes <span class="sql-keyword">X</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = <span class="sql-keyword">X</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span> <span class="sql-comment">#AND (aos.student_licenses &gt; 0 OR p.sku LIKE '%site%' OR (p.product_group_id = '" . $PRODUCT_GROUPS["program pricing"] . "' AND p.sku NOT LIKE '%PD%'))</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">0</span> <span class="sql-comment">/* avoid these products so that summer orders won't prevent a renewal */</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> bod.expiring_year = $next_year <span class="sql-reserved">AND</span> o.end_date &gt; <span class="sql-string">'$today'</span> <span class="sql-reserved">AND</span> o.se_0_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-comment">#AND pop.product_id IS NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND IFNULL(pr.program_name, pl.product_line_str) IS NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>246</td><td>cron/monthly/renewals.php:176</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_future_opps <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.order_id expiring_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products.product_group_id = <span class="sql-number">31</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_line_str<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_map opm,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = products.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = products.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = products.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> products.product_id = qd.product_id <span class="sql-reserved">AND</span> p.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.opportunity_id = opm.opportunity_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.probability_id &gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(p.date_entered) = <span class="sql-string">'" . date(Y,strtotime($today)) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">OR</span> qd.academic_year_id = <span class="sql-string">'$current_academic_year_id_summer'</span> <span class="sql-reserved">OR</span> qd.end_date &gt; <span class="sql-string">'$expire_end_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> products.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> products.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span> <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products.product_group_id = <span class="sql-number">31</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_future_opps</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_str <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.order_id <span class="sql-reserved">AS</span> expiring_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products.product_group_id = <span class="sql-number">31</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_line_str<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_map opm,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = products.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = products.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = products.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> products.product_id = qd.product_id <span class="sql-reserved">AND</span> p.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.opportunity_id = opm.opportunity_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.probability_id &gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(p.date_entered) = <span class="sql-string">'" . date(Y,strtotime($today)) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">OR</span> qd.academic_year_id = <span class="sql-string">'$current_academic_year_id_summer'</span> <span class="sql-reserved">OR</span> qd.end_date &gt; <span class="sql-string">'$expire_end_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> products.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> products.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span> <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products.product_group_id = <span class="sql-number">31</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span></td></tr>
   <tr><td>247</td><td>cron/monthly/renewals.php:207</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_details <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2.contact_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c2.status contact_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac2.contact_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac2.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) activation_contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.end_date expiration_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $USERS["renewal_sales"] . "'</span> sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.lead_source_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.sku <span class="sql-reserved">LIKE</span> <span class="sql-string">'%BAE%'</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>) bae<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> order_summary os <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">INNER JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = pr.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = pop.product_id<br/><span class="sql-reserved">LEFT JOIN</span> renewal_future_orders r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = r.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = r.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = r.product_line_str <span class="sql-reserved">AND</span> r.max_booked_order_date &gt;= o.order_date <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.max_order_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> os.order_total = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id <span class="sql-reserved">AND</span> c.contact_type_id = <span class="sql-number">3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts c2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.contact_id = c2.contact_id <span class="sql-comment">/*AND c2.account_id = o.account_id*/</span> <span class="sql-reserved">AND</span> c2.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts ac <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ac.order_id <span class="sql-reserved">AND</span> ac.contact_type_id = <span class="sql-number">5</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts ac2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ac.contact_id = ac2.contact_id <span class="sql-comment">/*AND ac2.account_id = o.account_id*/</span> <span class="sql-reserved">AND</span> ac2.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_future_opps rp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = rp.expiring_order_id <span class="sql-reserved">AND</span> od.account_id = rp.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = rp.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = rp.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes <span class="sql-keyword">X</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = <span class="sql-keyword">X</span>.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunities op <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = op.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.account_id = a.account_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> bod.expiring_year = $year <span class="sql-reserved">AND</span> r.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> rp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> discount <span class="sql-string">"] . "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> fee <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.se_0_order = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND o.billing_account_id = 4437*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> a.closed &lt;&gt; <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_details</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>248</td><td>cron/monthly/renewals.php:279</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_details_non_pd_non_pm <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details e<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.product_id = p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products po <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = po.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;po.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-comment">#not a PD product</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">REGEXP</span>(<span class="sql-string">'IMP|SPT'</span>) <span class="sql-comment">#not fees</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">31</span> <span class="sql-comment">#not a project management product</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> discount <span class="sql-string">"] . "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> fee <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_details_non_pd_non_pm</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>249</td><td>cron/monthly/renewals.php:311</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_details_hold_products <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_hold_products h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id = h.product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_details_hold_products</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_hold_products h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id = h.product_id</td></tr>
   <tr><td>250</td><td>cron/monthly/renewals.php:326</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_orders <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;activation_contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_renewal_group,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_length expiring_order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(bae) bae<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_orders</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_status <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activation_contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_renewal_group <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bae <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;activation_contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_renewal_group,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_length <span class="sql-reserved">AS</span> expiring_order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(bae) <span class="sql-reserved">AS</span> bae<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>251</td><td>cron/monthly/renewals.php:400</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_orders_summer_only <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = od.order_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> discount <span class="sql-string">"] . "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> fee <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> summer_type_id) <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%0%'</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_orders_summer_only</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>252</td><td>cron/monthly/renewals.php:412</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(expiration_date) expiration_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_dates</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiration_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(expiration_date) <span class="sql-reserved">AS</span> expiration_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>253</td><td>cron/monthly/renewals.php:431</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_order_2_buyers <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> oc.contact_id) num_contacts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_id = c.contact_id <span class="sql-reserved">AND</span> contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts &gt; <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_order_2_buyers</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> oc.contact_id) <span class="sql-reserved">AS</span> num_contacts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_id = c.contact_id <span class="sql-reserved">AND</span> contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts &gt; <span class="sql-number">1</span></td></tr>
   <tr><td>254</td><td>cron/monthly/renewals.php:449</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_order_2_act_contacts <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> oc.contact_id) num_contacts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_id = c.contact_id <span class="sql-reserved">AND</span> contact_type_id = <span class="sql-number">5</span> <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts &gt; <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_order_2_act_contacts</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> oc.contact_id) <span class="sql-reserved">AS</span> num_contacts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_id = c.contact_id <span class="sql-reserved">AND</span> contact_type_id = <span class="sql-number">5</span> <span class="sql-reserved">AND</span> c.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;num_contacts &gt; <span class="sql-number">1</span></td></tr>
   <tr><td>255</td><td>cron/monthly/renewals.php:552</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_total_schools <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> accounts.account_id) total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id = accounts.parent_account_id <span class="sql-reserved">AND</span> summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_total_schools</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_schools <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> accounts.account_id) <span class="sql-reserved">AS</span> total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id = accounts.parent_account_id <span class="sql-reserved">AND</span> summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td></tr>
   <tr><td>256</td><td>cron/monthly/renewals.php:570</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_pp_orders <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span> <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">IN</span>(<span class="sql-number">26</span>, <span class="sql-number">44</span>) <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_pp_orders</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders eo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;eo.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span> <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">IN</span>(<span class="sql-number">26</span>, <span class="sql-number">44</span>) <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span></td></tr>
   <tr><td>257</td><td>cron/monthly/renewals.php:638</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_account_usage <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(program_id = <span class="sql-number">2</span>, <span class="sql-number">2</span>, <span class="sql-number">1</span>) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_students) / <span class="sql-keyword">SUM</span>(student_licenses) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;report_start_date = <span class="sql-string">'$report_start_date'</span> <span class="sql-reserved">AND</span> report_end_date = <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_account_usage</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;perc_usage <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(program_id = <span class="sql-number">2</span>, <span class="sql-number">2</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_students) / <span class="sql-keyword">SUM</span>(student_licenses) * <span class="sql-number">100</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_primary_report<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;report_start_date = <span class="sql-string">'$report_start_date'</span> <span class="sql-reserved">AND</span> report_end_date = <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id</td></tr>
   <tr><td>258</td><td>cron/monthly/renewals.php:695</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_account_usage <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span> <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> o.opportunity_product_id = u.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_account_usage</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;perc_usage <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">32</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = od.account_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span> <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> o.opportunity_product_id = u.opportunity_product_id</td></tr>
   <tr><td>259</td><td>cron/monthly/renewals.php:709</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_usage <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">AVG</span>(u.perc_usage) perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_account_usage u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.no_usage_data = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_id = u.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> expiring_order_usage</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;perc_usage <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">39</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">AVG</span>(u.perc_usage) <span class="sql-reserved">AS</span> perc_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.no_usage_data = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_id = u.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>260</td><td>cron/monthly/renewals.php:838</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_details <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.year_round,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p2.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0000-00-00'</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0000-00-00'</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(<span class="sql-keyword">CURDATE</span>()),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start) next_subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> new_opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.expiring_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details current_details<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p1.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p1.product_line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p1.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> renewal_future_orders r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = r.account_id <span class="sql-reserved">AND</span> e.opportunity_product_id = r.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = r.product_line_str <span class="sql-reserved">AND</span> r.max_booked_order_date &gt;= e.expiring_order_date <span class="sql-reserved">AND</span> r.max_order_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_mapping pm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id = pm.old_product_id <span class="sql-reserved">AND</span> pm.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> products p2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.product_id = pm.new_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_groups pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.product_group_id = pg.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> renewal_future_opps rp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = rp.expiring_order_id <span class="sql-reserved">AND</span> od.account_id = rp.account_id <span class="sql-reserved">AND</span> e.opportunity_product_id = rp.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = rp.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod2.order_detail_id = current_details.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p1.product_id <span class="sql-reserved">AND</span> od.account_id = a.account_id <span class="sql-reserved">AND</span> od.account_id = current_details.account_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$today'</span> <span class="sql-reserved">BETWEEN</span> current_details.start_date <span class="sql-reserved">AND</span> current_details.end_date <span class="sql-reserved">OR</span> current_details.academic_year_id = <span class="sql-string">'$current_academic_year_id'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod2.expiring_year = <span class="sql-string">'$year'</span> <span class="sql-reserved">AND</span> bod2.summer = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p1.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'". $PRODUCT_GROUPS["fee"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'". $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%JMP%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-UPSE-%'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND e.no_quote_reasons = 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.status <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> pg.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> r.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> rp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.product_id != <span class="sql-string">'" . $PRODUCTS["remove pd"] . "'</span> <span class="sql-reserved">AND</span> a.closed &lt;&gt; <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_details</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.year_round,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id <span class="sql-reserved">AS</span> expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p2.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.summer_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">0</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> subscription_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0000-00-00'</span> <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0000-00-00'</span> <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(<span class="sql-keyword">CURDATE</span>()),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_start) <span class="sql-reserved">AS</span> next_subscription_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.expiring_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details current_details<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p1.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p1.product_line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p1.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> renewal_future_orders r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = r.account_id <span class="sql-reserved">AND</span> e.opportunity_product_id = r.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = r.product_line_str <span class="sql-reserved">AND</span> r.max_booked_order_date &gt;= e.expiring_order_date <span class="sql-reserved">AND</span> r.max_order_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_mapping pm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id = pm.old_product_id <span class="sql-reserved">AND</span> pm.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> products p2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.product_id = pm.new_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_groups pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p2.product_group_id = pg.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> renewal_future_opps rp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = rp.expiring_order_id <span class="sql-reserved">AND</span> od.account_id = rp.account_id <span class="sql-reserved">AND</span> e.opportunity_product_id = rp.opportunity_product_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p1.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = rp.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod2.order_detail_id = current_details.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_id = p1.product_id <span class="sql-reserved">AND</span> od.account_id = a.account_id <span class="sql-reserved">AND</span> od.account_id = current_details.account_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$today'</span> <span class="sql-reserved">BETWEEN</span> current_details.start_date <span class="sql-reserved">AND</span> current_details.end_date <span class="sql-reserved">OR</span> current_details.academic_year_id = <span class="sql-string">'$current_academic_year_id'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod2.expiring_year = <span class="sql-string">'$year'</span> <span class="sql-reserved">AND</span> bod2.summer = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p1.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'". $PRODUCT_GROUPS["fee"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'". $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%IMP%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%SPT%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%JMP%'</span> <span class="sql-reserved">AND</span> p1.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-UPSE-%'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-comment">/*AND e.no_quote_reasons = 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.status <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> pg.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> r.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> rp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.product_id != <span class="sql-string">'" . $PRODUCTS["remove pd"] . "'</span> <span class="sql-reserved">AND</span> a.closed &lt;&gt; <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td></tr>
   <tr><td>261</td><td>cron/monthly/renewals.php:907</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_program_pricing <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">IN</span>(<span class="sql-number">26</span>, <span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_pricing<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = r.expiring_product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_program_pricing</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_pricing <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">IN</span>(<span class="sql-number">26</span>, <span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> program_pricing<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = r.expiring_product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td></tr>
   <tr><td>262</td><td>cron/monthly/renewals.php:939</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pp_lit_licenses(<span class="sql-reserved">KEY</span>(order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id = d.expiring_product_id <span class="sql-reserved">AND</span> p1.product_group_id = <span class="sql-number">26</span> <span class="sql-reserved">AND</span> p2.product_id = d2.product_id <span class="sql-reserved">AND</span> p2.product_id = sp2.product_id <span class="sql-reserved">AND</span> p2.student_licenses &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p2.product_id = sp2.product_id <span class="sql-reserved">AND</span> sp2.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">22</span>, <span class="sql-number">25</span>) <span class="sql-reserved">AND</span> o.order_id = d.order_id <span class="sql-reserved">AND</span> o2.order_id = d2.order_id <span class="sql-reserved">AND</span> o.no_renewal_group = o2.no_renewal_group <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> d.order_id = d2.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = o2.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = o2.opportunity_product_id <span class="sql-reserved">AND</span> o.contact_id = o2.contact_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> pp_lit_licenses(<span class="sql-reserved">KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p1.product_id = d.expiring_product_id <span class="sql-reserved">AND</span> p1.product_group_id = <span class="sql-number">26</span> <span class="sql-reserved">AND</span> p2.product_id = d2.product_id <span class="sql-reserved">AND</span> p2.product_id = sp2.product_id <span class="sql-reserved">AND</span> p2.student_licenses &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p2.product_id = sp2.product_id <span class="sql-reserved">AND</span> sp2.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">22</span>, <span class="sql-number">25</span>) <span class="sql-reserved">AND</span> o.order_id = d.order_id <span class="sql-reserved">AND</span> o2.order_id = d2.order_id <span class="sql-reserved">AND</span> o.no_renewal_group = o2.no_renewal_group <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> d.order_id = d2.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = o2.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = o2.opportunity_product_id <span class="sql-reserved">AND</span> o.contact_id = o2.contact_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>263</td><td>cron/monthly/renewals.php:988</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders_no_mapping <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> d.order_id = ro.order_id <span class="sql-reserved">AND</span> p.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.probability_id &gt; <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders_no_mapping</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;year_round <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price_discountable <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_subscription_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_str <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_year <span class="sql-reserved">BIGINT</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> d.order_id = ro.order_id <span class="sql-reserved">AND</span> p.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.probability_id &gt; <span class="sql-number">1</span></td></tr>
   <tr><td>264</td><td>cron/monthly/renewals.php:1051</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_unique_products <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>) <span class="sql-reserved">AND</span> product_id &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_unique_products</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>) <span class="sql-reserved">AND</span> product_id &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>265</td><td>cron/monthly/renewals.php:1059</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_product_prices <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.discountable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(list_price * sub_product_qty),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) price_discountable<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_unique_products r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_product_prices</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">39</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price_discountable <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">39</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.discountable = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_price * sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> price_discountable<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_unique_products r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id</td></tr>
   <tr><td>266</td><td>cron/monthly/renewals.php:1070</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_expiring_products <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_expiring_products</td><td style="border-bottom: solid 1px black;">expiring_product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_product_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details</td></tr>
   <tr><td>267</td><td>cron/monthly/renewals.php:1076</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_expiring_product_prices <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.opportunity_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fee_price.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(r.price + fee_price.price)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(sp.list_price * sub_product_qty) price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_expiring_products e<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.expiring_product_id = p.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.imf_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.support_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.expiring_product_id<br/>) fee_price <span class="sql-reserved">USING</span>(expiring_product_id)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_expiring_product_prices</td><td style="border-bottom: solid 1px black;">opportunity_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_price <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.opportunity_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fee_price.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.price + fee_price.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_price<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">LEFT JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> expiring_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.list_price * sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> price<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_expiring_products e<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.expiring_product_id = p.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.imf_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.support_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.expiring_product_id<br/>) fee_price <span class="sql-reserved">USING</span>(expiring_product_id)</td></tr>
   <tr><td>268</td><td>cron/monthly/renewals.php:1130</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_min_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(a.start_date, <span class="sql-string">'|'</span>, summer)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) min_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(a.start_date, <span class="sql-string">'|'</span>, summer)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">12</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) summer<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.academic_year_id = a.academic_year_id <span class="sql-reserved">AND</span> r.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_min_dates</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(a.start_date, <span class="sql-string">'|'</span>, summer)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> min_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(a.start_date, <span class="sql-string">'|'</span>, summer)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">12</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> summer<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.academic_year_id = a.academic_year_id <span class="sql-reserved">AND</span> r.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td></tr>
   <tr><td>269</td><td>cron/monthly/renewals.php:1148</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_next_start <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(a.start_date) min_next_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_opportunity_min_dates t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = t.order_id <span class="sql-reserved">AND</span> e.order_id = r.order_id <span class="sql-reserved">AND</span> r.next_subscription_start <span class="sql-reserved">BETWEEN</span> a.start_date <span class="sql-reserved">AND</span> a.end_date <span class="sql-reserved">AND</span> r.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> t.summer = a.summer <span class="sql-reserved">AND</span> r.year_round = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_next_start</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(a.start_date) <span class="sql-reserved">AS</span> min_next_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_opportunity_min_dates t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = t.order_id <span class="sql-reserved">AND</span> e.order_id = r.order_id <span class="sql-reserved">AND</span> r.next_subscription_start <span class="sql-reserved">BETWEEN</span> a.start_date <span class="sql-reserved">AND</span> a.end_date <span class="sql-reserved">AND</span> r.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> t.summer = a.summer <span class="sql-reserved">AND</span> r.year_round = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td></tr>
   <tr><td>270</td><td>cron/monthly/renewals.php:1175</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_next_start2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(min_next_start) min_next_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_opportunity_next_start<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_opportunity_next_start2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(min_next_start) <span class="sql-reserved">AS</span> min_next_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_opportunity_next_start<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>271</td><td>cron/monthly/renewals.php:1230</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_year_round_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(r.start_date) min_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.year_round = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_year_round_dates</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(r.start_date) <span class="sql-reserved">AS</span> min_start<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.year_round = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td></tr>
   <tr><td>272</td><td>cron/monthly/renewals.php:1316</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_delete_details <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.* <span class="sql-comment">#r.opportunity_detail_id</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes <span class="sql-keyword">X</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = <span class="sql-keyword">X</span>.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = o.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> r.account_id = od.account_id <span class="sql-reserved">AND</span> r.new_academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> r.product_line_str = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND (p.student_licenses &gt; 0 OR p.sku LIKE '%site%' OR (p.product_group_id = '26' AND p.sku NOT LIKE '%PD%'))</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.opportunity_product_id = r.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_delete_details</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;year_round <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price_discountable <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_subscription_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_str <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_year <span class="sql-reserved">BIGINT</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes <span class="sql-keyword">X</span> <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = <span class="sql-keyword">X</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products pop <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id = p.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = o.order_id <span class="sql-reserved">AND</span> od.product_id = p.product_id <span class="sql-reserved">AND</span> r.account_id = od.account_id <span class="sql-reserved">AND</span> r.new_academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">X</span>.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> r.product_line_str = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(p.product_group_id = <span class="sql-number">31</span>, <span class="sql-string">'PM'</span>, <span class="sql-string">''</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;&gt; <span class="sql-string">''</span> <span class="sql-comment">#AND (p.student_licenses &gt; 0 OR p.sku LIKE '%site%' OR (p.product_group_id = '26' AND p.sku NOT LIKE '%PD%'))</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.opportunity_product_id = r.opportunity_product_id</td></tr>
   <tr><td>273</td><td>cron/monthly/renewals.php:1436</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_orders_expiring_products <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r.account_id = od.account_id <span class="sql-reserved">AND</span> r.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> r.expiring_product_id = od.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.expiring_year = $year <span class="sql-reserved">AND</span> bod.summer = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_orders_expiring_products</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_fin_bob_order_details bod <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bod.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r.account_id = od.account_id <span class="sql-reserved">AND</span> r.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span> r.expiring_product_id = od.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.end_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_end_date'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bod.expiring_year = $year <span class="sql-reserved">AND</span> bod.summer = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>274</td><td>cron/monthly/renewals.php:1466</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_after_next_year <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay1.academic_year_id = r.new_academic_year_id <span class="sql-reserved">AND</span> ay2.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay2.end_date<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(ay1.start_date) &gt;= ay2.end_date</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_after_next_year</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay1.academic_year_id = r.new_academic_year_id <span class="sql-reserved">AND</span> ay2.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay2.end_date<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(ay1.start_date) &gt;= ay2.end_date</td></tr>
   <tr><td>275</td><td>cron/monthly/renewals.php:1552</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opp_details_licenses <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.product_id = p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> pd_only_products po <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = po.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;po.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-comment">#not a PD product</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">REGEXP</span>(<span class="sql-string">'IMP|SPT'</span>) <span class="sql-comment">#not fees</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">31</span> <span class="sql-comment">#not a project management product</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> discount <span class="sql-string">"] . "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . $PRODUCT_GROUPS["</span> fee <span class="sql-string">"] . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opp_details_licenses</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>276</td><td>cron/monthly/renewals.php:1621</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_length <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> new_academic_year_id) contract_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ay.summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_length</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> new_academic_year_id) <span class="sql-reserved">AS</span> contract_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ay.summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>277</td><td>cron/monthly/renewals.php:1644</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_length2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(r.contract_length) contract_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_length r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_length2</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(r.contract_length) <span class="sql-reserved">AS</span> contract_length<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_length r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td></tr>
   <tr><td>278</td><td>cron/monthly/renewals.php:1705</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> end_date &lt;&gt; <span class="sql-string">''</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_dates</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) <span class="sql-reserved">AS</span> end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date &lt;&gt; <span class="sql-string">''</span> <span class="sql-reserved">AND</span> end_date &lt;&gt; <span class="sql-string">''</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>279</td><td>cron/monthly/renewals.php:1754</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_total_schools <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.account_id) opp_total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = o.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> od.account_id = a.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND no_quote_reasons &gt; 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_total_schools</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opp_total_schools <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> od.account_id) <span class="sql-reserved">AS</span> opp_total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = o.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> od.account_id = a.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-comment">/*AND no_quote_reasons &gt; 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td></tr>
   <tr><td>280</td><td>cron/monthly/renewals.php:1795</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_num_schools <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> r.account_id) num_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.account_id = a.account_id <span class="sql-reserved">AND</span> a.parent_account_id = e.account_id <span class="sql-reserved">AND</span> r.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> r.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_num_schools</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_schools <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> r.account_id) <span class="sql-reserved">AS</span> num_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = r.order_id <span class="sql-reserved">AND</span> r.account_id = a.account_id <span class="sql-reserved">AND</span> a.parent_account_id = e.account_id <span class="sql-reserved">AND</span> r.price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> r.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> e.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.opportunity_product_id</td></tr>
   <tr><td>281</td><td>cron/monthly/renewals.php:1870</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_payment_terms <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pmap.mapped_payment_term_option_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) payment_term<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(expiring_orders, orders)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.renewal_payment_term_option_mapping pmap<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pmap.payment_term_option_id = orders.payment_term<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.order_id = orders.order_id <span class="sql-reserved">AND</span> orders.payment_term != <span class="sql-string">''</span> <span class="sql-reserved">AND</span> expiring_orders.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_payment_terms</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_term <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pmap.mapped_payment_term_option_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> payment_term<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(expiring_orders, orders)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.renewal_payment_term_option_mapping pmap<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pmap.payment_term_option_id = orders.payment_term<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.order_id = orders.order_id <span class="sql-reserved">AND</span> orders.payment_term != <span class="sql-string">''</span> <span class="sql-reserved">AND</span> expiring_orders.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td></tr>
   <tr><td>282</td><td>cron/monthly/renewals.php:2078</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_tax_rates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(contact_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tax_rate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(d.discount_percent, <span class="sql-number">0</span>)) discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_tax t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_address aa<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> rwl_opportunity_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_group_id = <span class="sql-string">'". $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> discounts d <span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id = p.product_id <span class="sql-reserved">AND</span> p.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">BETWEEN</span> p.start_date <span class="sql-reserved">AND</span> p.end_date<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(d.product_id = od.product_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> a.state_code = t.state_code <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.county_id = a.county_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(t.city, <span class="sql-string">' T.B.D.'</span>, <span class="sql-string">''</span>) = aa.city <span class="sql-reserved">OR</span> t.city = <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(t.city = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> t.county_id = <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> t.end_date <span class="sql-reserved">AND</span> a.account_id = aa.account_id <span class="sql-reserved">AND</span> aa.address_type = <span class="sql-string">'M'</span> <span class="sql-reserved">AND</span> o.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id, o.contact_id, o.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_tax_rates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(contact_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tax_rate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(d.discount_percent, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.no_renewal_group<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_tax t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_address aa<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> rwl_opportunity_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> od.product_group_id = <span class="sql-string">'". $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">LEFT JOIN</span> discounts d <span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id = p.product_id <span class="sql-reserved">AND</span> p.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$expire_start_date'</span> <span class="sql-reserved">BETWEEN</span> p.start_date <span class="sql-reserved">AND</span> p.end_date <span class="sql-reserved">AND</span> d.product_id = od.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> a.state_code = t.state_code <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.county_id = a.county_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(t.city, <span class="sql-string">' T.B.D.'</span>, <span class="sql-string">''</span>) = aa.city <span class="sql-reserved">OR</span> t.city = <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(t.city = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> t.county_id = <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> t.start_date <span class="sql-reserved">AND</span> t.end_date <span class="sql-reserved">AND</span> a.account_id = aa.account_id <span class="sql-reserved">AND</span> aa.address_type = <span class="sql-string">'M'</span> <span class="sql-reserved">AND</span> o.no_renewal_group = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id, o.contact_id, o.opportunity_product_id</td></tr>
   <tr><td>283</td><td>cron/monthly/renewals.php:2179</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_totals <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(price * quantity) total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_opportunity_totals</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(price * quantity) <span class="sql-reserved">AS</span> total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>284</td><td>cron/monthly/renewals.php:2215</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunities <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> expiring_orders.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(bae) bae,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $expire_year . " RENEWAL '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(op.opportunity_product_name, <span class="sql-string">' '</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-string">'%m%d%y'</span>)) opportunity_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.activation_contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">16</span> probability_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(projected_total) projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_district_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opp_total_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(contract_length) contract_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(expiring_orders.start_date, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(expiring_orders.end_date) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(expiration_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) expected_close,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">7</span> lead_source_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;door_opener,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_advocacy_executive,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_associate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reseller,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(non_standard_order) non_standard_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(old_products) old_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(future_order) future_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(partial_expire) partial_expire,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(overage) overage,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(upgrade_products) upgrade_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(summer_order) summer_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_usage_data) no_usage_data,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(kb100_old_order) kb100_old_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(famis_order) famis_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_license_products_no_contact) no_license_products_no_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(products_reallocated) products_reallocated,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_quote_details) no_quote_details,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(program_pricing) program_pricing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(program_pricing_only) program_pricing_only,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(small_district_pricing) small_district_pricing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(expiring_order_date) expiring_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_po_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_po_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) expiring_order_po_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(t.tax_rate, <span class="sql-number">0</span>) tax_rate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(t.sales_tax_id, <span class="sql-number">0</span>) sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> new_opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(expiring_orders, accounts)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> opportunity_products op <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = expiring_orders.opportunity_product_id <span class="sql-reserved">AND</span> op.opportunity_product_id &gt; <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> rwl_tax_rates t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> t.account_id = expiring_orders.account_id <span class="sql-reserved">AND</span> t.contact_id = expiring_orders.contact_id <span class="sql-reserved">AND</span> t.opportunity_product_id = expiring_orders.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id = accounts.account_id <span class="sql-reserved">AND</span> expiring_orders.no_renewal_group = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunities</td><td style="border-bottom: solid 1px black;">order_ids <span class="sql-keyword">TEXT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bae <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">147</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;activation_contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;probability_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_district_schools <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_schools <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opp_total_schools <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_term <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expected_close <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;lead_source_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;door_opener <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_advocacy_executive <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_associate <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reseller <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_standard_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_products <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;partial_expire <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;overage <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;upgrade_products <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_usage_data <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;kb100_old_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;famis_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_license_products_no_contact <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;products_reallocated <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_quote_details <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_pricing <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_pricing_only <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;small_district_pricing <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_po_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tax_rate <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> expiring_orders.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(bae) <span class="sql-reserved">AS</span> bae,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $expire_year . " RENEWAL '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(op.opportunity_product_name, <span class="sql-string">' '</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(<span class="sql-keyword">CURDATE</span>(), <span class="sql-string">'%m%d%y'</span>)) <span class="sql-reserved">AS</span> opportunity_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.activation_contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">16</span> <span class="sql-reserved">AS</span> probability_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(projected_total) <span class="sql-reserved">AS</span> projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_district_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opp_total_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(contract_length) <span class="sql-reserved">AS</span> contract_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(expiring_orders.start_date, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(expiring_orders.end_date) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(expiration_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">-1</span> <span class="sql-keyword">MONTH</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> expected_close,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">7</span> <span class="sql-reserved">AS</span> lead_source_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;door_opener,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_advocacy_executive,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sales_associate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reseller,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(non_standard_order) <span class="sql-reserved">AS</span> non_standard_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(old_products) <span class="sql-reserved">AS</span> old_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(future_order) <span class="sql-reserved">AS</span> future_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(partial_expire) <span class="sql-reserved">AS</span> partial_expire,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(overage) <span class="sql-reserved">AS</span> overage,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(upgrade_products) <span class="sql-reserved">AS</span> upgrade_products,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(summer_order) <span class="sql-reserved">AS</span> summer_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_usage_data) <span class="sql-reserved">AS</span> no_usage_data,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(kb100_old_order) <span class="sql-reserved">AS</span> kb100_old_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(famis_order) <span class="sql-reserved">AS</span> famis_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_license_products_no_contact) <span class="sql-reserved">AS</span> no_license_products_no_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(products_reallocated) <span class="sql-reserved">AS</span> products_reallocated,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(no_quote_details) <span class="sql-reserved">AS</span> no_quote_details,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(program_pricing) <span class="sql-reserved">AS</span> program_pricing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(program_pricing_only) <span class="sql-reserved">AS</span> program_pricing_only,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(small_district_pricing) <span class="sql-reserved">AS</span> small_district_pricing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(expiring_order_date) <span class="sql-reserved">AS</span> expiring_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_po_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_order_po_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> expiring_order_po_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(t.tax_rate, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> tax_rate,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(t.sales_tax_id, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(expiring_orders, accounts)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> opportunity_products op <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_product_id = expiring_orders.opportunity_product_id <span class="sql-reserved">AND</span> op.opportunity_product_id &gt; <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> rwl_tax_rates t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.no_renewal_group = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> t.account_id = expiring_orders.account_id <span class="sql-reserved">AND</span> t.contact_id = expiring_orders.contact_id <span class="sql-reserved">AND</span> t.opportunity_product_id = expiring_orders.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id = accounts.account_id <span class="sql-reserved">AND</span> expiring_orders.no_renewal_group = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders.opportunity_product_id</td></tr>
   <tr><td>285</td><td>cron/monthly/renewals.php:2284</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opps_no_quote <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_ids expiring_orders<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*upgrade_products &gt; 0
		OR*/</span> summer_order &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> kb100_old_order &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_quote_details &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_license_products_no_contact &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> projected_total = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opps_no_quote</td><td style="border-bottom: solid 1px black;">expiring_orders <span class="sql-keyword">TEXT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">65535</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_ids <span class="sql-reserved">AS</span> expiring_orders<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*upgrade_products &gt; 0
		OR*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_order &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> kb100_old_order &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_quote_details &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> no_license_products_no_contact &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> projected_total = <span class="sql-number">0</span></td></tr>
   <tr><td>286</td><td>cron/monthly/renewals.php:2296</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> old_opps_no_quote <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> ro.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ro.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) expiring_orders<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> quotes q <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> rwl_opportunities p2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = p2.new_opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id = p.opportunity_id <span class="sql-reserved">AND</span> q.opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> p2.new_opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.probability_id &gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(p.date_entered) = <span class="sql-string">'" . date(Y) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(p.close_date) = <span class="sql-string">'$expire_year'</span> <span class="sql-reserved">AND</span> p.order_id = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> old_opps_no_quote</td><td style="border-bottom: solid 1px black;">opportunity_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_orders <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> ro.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ro.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> expiring_orders<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> quotes q <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> rwl_opportunities p2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = p2.new_opportunity_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id = p.opportunity_id <span class="sql-reserved">AND</span> q.opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> p2.new_opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.probability_id &gt; <span class="sql-number">1</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">YEAR</span>(p.date_entered) = <span class="sql-string">'" . date(Y) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(p.close_date) = <span class="sql-string">'$expire_year'</span> <span class="sql-reserved">AND</span> p.order_id = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id</td></tr>
   <tr><td>287</td><td>cron/monthly/renewals.php:2505</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() quote_date, start_date, end_date, contract_length, payment_term, total_district_schools, num_schools, <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_products = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> overage = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> partial_expire = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;famis_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND upgrade_products = 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> summer_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> kb100_old_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> no_quote_details = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> no_license_products_no_contact = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> projected_total &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes</td><td style="border-bottom: solid 1px black;">new_quote_id <span class="sql-reserved">BIGINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_date <span class="sql-keyword">DATETIME</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_term <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_district_schools <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;num_schools <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;final <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;famis_order <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">6</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() <span class="sql-reserved">AS</span> quote_date, start_date, end_date, contract_length, payment_term, total_district_schools, num_schools, <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_products = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> overage = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> partial_expire = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;famis_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_opportunity_id &gt; <span class="sql-number">0</span> <span class="sql-comment">/*AND upgrade_products = 0*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> summer_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> kb100_old_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> no_quote_details = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> no_license_products_no_contact = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> projected_total &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>288</td><td>cron/monthly/renewals.php:2590</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_3year <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id single_year_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(q.end_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">YEAR</span>) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$PAYMENT_TERMS["payment_plan"]."'</span> payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> new_quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id = q.quote_id <span class="sql-reserved">AND</span> contract_length = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> r.final = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> r.opportunity_product_id &lt;&gt; <span class="sql-number">2</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_3year</td><td style="border-bottom: solid 1px black;">opportunity_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;single_year_quote_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_term <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">34</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id <span class="sql-reserved">AS</span> single_year_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_ADD</span>(q.end_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">2</span> <span class="sql-keyword">YEAR</span>) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$PAYMENT_TERMS["payment_plan"]."'</span> <span class="sql-reserved">AS</span> payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id = q.quote_id <span class="sql-reserved">AND</span> contract_length = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> r.final = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> r.opportunity_product_id &lt;&gt; <span class="sql-number">2</span></td></tr>
   <tr><td>289</td><td>cron/monthly/renewals.php:2655</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_details_3year <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price_discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.new_academic_year_id academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> add_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<span class="sql-number">0</span> <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">17</span>, <span class="sql-number">8</span>)) discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_3year r1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id = r2.new_opportunity_id <span class="sql-reserved">AND</span> r2.product_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r2.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>) <span class="sql-reserved">AND</span> r2.product_id &lt;&gt; <span class="sql-string">'" . SALES_TAX . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_details_3year</td><td style="border-bottom: solid 1px black;">new_quote_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price_discountable <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;add_years <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;discount_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price_discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.new_academic_year_id <span class="sql-reserved">AS</span> academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> add_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<span class="sql-number">0</span> <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">17</span>, <span class="sql-number">8</span>)) <span class="sql-reserved">AS</span> discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_3year r1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id = r2.new_opportunity_id <span class="sql-reserved">AND</span> r2.product_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r2.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>) <span class="sql-reserved">AND</span> r2.product_id &lt;&gt; <span class="sql-string">'" . SALES_TAX . "'</span></td></tr>
   <tr><td>290</td><td>cron/monthly/renewals.php:2700</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_3year_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) quote_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) quote_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_3year<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_3year_dates</td><td style="border-bottom: solid 1px black;">new_quote_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) <span class="sql-reserved">AS</span> quote_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) <span class="sql-reserved">AS</span> quote_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_3year<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id</td></tr>
   <tr><td>291</td><td>cron/monthly/renewals.php:2805</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_1year <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id multi_year_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span>(contract_length <span class="sql-number">-1</span>) <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length multi_year_contract_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) min_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) max_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) max_summer_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> new_quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id = q.quote_id <span class="sql-reserved">AND</span> contract_length &gt; <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND r.final = 1*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = qd.product_id <span class="sql-reserved">AND</span> qd.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_1year</td><td style="border-bottom: solid 1px black;">opportunity_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_quote_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_term <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_contract_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;min_academic_year <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_academic_year <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;max_summer_academic_year <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id <span class="sql-reserved">AS</span> multi_year_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> contract_length - <span class="sql-number">1</span> <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> payment_term,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.sales_tax_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contract_length <span class="sql-reserved">AS</span> multi_year_contract_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> min_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> max_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> max_summer_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> new_quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.new_quote_id = q.quote_id <span class="sql-reserved">AND</span> contract_length &gt; <span class="sql-number">1</span> <span class="sql-comment">/*AND r.final = 1*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = qd.product_id <span class="sql-reserved">AND</span> qd.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>292</td><td>cron/monthly/renewals.php:2877</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_details_1year <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price_discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.min_academic_year academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span>(multi_year_contract_length <span class="sql-number">-1</span>) <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span>(multi_year_contract_length <span class="sql-number">-1</span>) <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<span class="sql-number">0</span> <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">17</span>, <span class="sql-number">8</span>)) discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_1year r1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id = r2.new_opportunity_id <span class="sql-reserved">AND</span> r2.product_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r2.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>) <span class="sql-reserved">AND</span> r2.new_academic_year_id = r1.max_academic_year <span class="sql-reserved">AND</span> r2.product_id &lt;&gt; <span class="sql-string">'" . SALES_TAX . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quote_details_1year</td><td style="border-bottom: solid 1px black;">new_quote_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_type_id <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;price_discountable <span class="sql-reserved">DOUBLE</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-reserved">CHAR</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-reserved">CHAR</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;discount_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r2.price_discountable,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.min_academic_year <span class="sql-reserved">AS</span> academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> multi_year_contract_length - <span class="sql-number">1</span> <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_SUB</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r2.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> multi_year_contract_length - <span class="sql-number">1</span> <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<span class="sql-number">0</span> <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">17</span>, <span class="sql-number">8</span>)) <span class="sql-reserved">AS</span> discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_1year r1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunity_details r2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r1.opportunity_id = r2.new_opportunity_id <span class="sql-reserved">AND</span> r2.product_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r2.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>) <span class="sql-reserved">AND</span> r2.new_academic_year_id = r1.max_academic_year <span class="sql-reserved">AND</span> r2.product_id &lt;&gt; <span class="sql-string">'" . SALES_TAX . "'</span></td></tr>
   <tr><td>293</td><td>cron/monthly/renewals.php:2892</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_summer_years <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay1.academic_year_id summer_year_before,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay2.academic_year_id summer_year_after<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(academic_years ay)<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay1 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay1.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay1.start_date &lt; ay.end_date <span class="sql-reserved">AND</span> ay1.end_date &gt; ay.start_date <span class="sql-reserved">AND</span> ay1.end_date &lt; ay.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay2.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay2.start_date &lt; ay.end_date <span class="sql-reserved">AND</span> ay2.end_date &gt; ay.start_date <span class="sql-reserved">AND</span> ay2.end_date &gt; ay.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_summer_years</td><td style="border-bottom: solid 1px black;">academic_year_id <span class="sql-reserved">SMALLINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_year_before <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer_year_after <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay1.academic_year_id <span class="sql-reserved">AS</span> summer_year_before,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay2.academic_year_id <span class="sql-reserved">AS</span> summer_year_after<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay1 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay1.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay1.start_date &lt; ay.end_date <span class="sql-reserved">AND</span> ay1.end_date &gt; ay.start_date <span class="sql-reserved">AND</span> ay1.end_date &lt; ay.end_date<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay2.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay2.start_date &lt; ay.end_date <span class="sql-reserved">AND</span> ay2.end_date &gt; ay.start_date <span class="sql-reserved">AND</span> ay2.end_date &gt; ay.end_date<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">0</span></td></tr>
   <tr><td>294</td><td>cron/monthly/renewals.php:2925</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_1year_dates <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) quote_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) quote_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_1year<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> renewal_quotes_1year_dates</td><td style="border-bottom: solid 1px black;">new_quote_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) <span class="sql-reserved">AS</span> quote_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(end_date) <span class="sql-reserved">AS</span> quote_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quotes_1year<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;new_quote_id</td></tr>
   <tr><td>295</td><td>cron/monthly/renewals.php:3054</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_totals <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.new_opportunity_id opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.quantity * qd.price) quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.new_opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> q.final = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opportunity_totals</td><td style="border-bottom: solid 1px black;">opportunity_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.new_opportunity_id <span class="sql-reserved">AS</span> opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.quantity * qd.price) <span class="sql-reserved">AS</span> quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rwl_opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.new_opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> q.final = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id</td></tr>
   <tr><td>296</td><td>cron/monthly/renewals.php:3089</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opp_notes_special <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> p.summer_type_id) summer_types,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id = <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Summer products were on expiring order for a summer school, there are no summer products on this quote'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Summer extension was part of expiring order, there are no summer products on this quote'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interlink.renewal_opportunities ro<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ro.order_id = od.order_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> interlink.products p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id <span class="sql-reserved">AND</span> p.summer_type_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id<br/><span class="sql-reserved">LEFT JOIN</span> quotes q <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = ro.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> quote_details qd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id = q.quote_id<br/><span class="sql-reserved">LEFT JOIN</span> products p2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p2.product_id = qd.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ro.date_entered &gt; <span class="sql-string">'$today'</span> <span class="sql-reserved">AND</span> ro.entered_by = <span class="sql-string">".$USERS["</span> system_generated <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> q.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p2.summer_type_id) = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> rwl_opp_notes_special</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>297</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:17</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_order_detail_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id) <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "")."</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".($show_detail_account ? "</span> od.account_id detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" : "")."</span> <span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(ocd.cancel_id, ocf.cancel_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ocd.cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ocf.cancel_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) cancel_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels ocf<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ocf.order_id = o.order_id <span class="sql-reserved">AND</span> ocf.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ocf.cancel_date &lt;= <span class="sql-variable">@end_date</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels ocd<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ocd.cancel_id = od.cancel_id <span class="sql-reserved">AND</span> ocd.cancel_date &lt;= <span class="sql-variable">@end_date</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.mh_orders mho<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;mho.order_id = o.order_id <span class="sql-reserved">AND</span> mho.is_post_integration_order = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ocf.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> ocd.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> mho.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_order_detail_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id) <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "")."</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>298</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:35</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_amort_revenue_by_component(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>, <span class="sql-number">6</span>, <span class="sql-number">7</span>, <span class="sql-number">8</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) license_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) onsite_pd_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">14</span>, <span class="sql-number">24</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) online_pd_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">6</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) imf_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">7</span>, <span class="sql-number">8</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) pm_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_amort_revenue_by_component(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">INT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;revenue_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;license_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_pd_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_pd_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imf_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pm_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>, <span class="sql-number">6</span>, <span class="sql-number">7</span>, <span class="sql-number">8</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> license_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> onsite_pd_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">14</span>, <span class="sql-number">24</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> online_pd_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">6</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> imf_revenue,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">7</span>, <span class="sql-number">8</span>) <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> pm_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>299</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:94</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_bae_order_site_counts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".($show_detail_account ? "</span> od.account_id detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" : "")."</span> revised_academic_year_id academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> account_id) bae_site_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_info_summary odi<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.sub_program_id = <span class="sql-number">12</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revised_academic_year_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_bae_order_site_counts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>300</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:106</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_order_bae_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(row_num)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@n</span> := <span class="sql-variable">@n</span> + <span class="sql-number">1</span> row_num,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> site_cancel_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".($show_detail_account ? "</span> od.detail_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" : "")."</span> revised_academic_year_id academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_pl_ay_order_detail_linked_cancels od<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> interlink.order_detail_info_summary odi<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odi.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CROSS JOIN</span>(<span class="sql-reserved">SELECT</span> <span class="sql-variable">@n</span> := <span class="sql-number">0</span>) r<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.sub_program_id = <span class="sql-number">12</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span><br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/>) b;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_order_bae_linked_cancels(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-string">".($show_detail_account ? "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detail_account_id <span class="sql-string">" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(row_num)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>301</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:171</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_bae_lit_license_counts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revised_academic_year_id academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> license_count <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) literacy_license_count,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">THEN</span> license_count <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) bae_license_count,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) has_literacy,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) has_bae,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) has_bae_student_site_expander,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'teacher expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) has_bae_teacher_expander,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'teacher expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> od.quantity <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) bae_teacher_expander_qty<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_info_summary odi<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_pl_ay_order_detail_linked_cancels odc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odc.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revised_academic_year_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_ay_bae_lit_license_counts(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revised_academic_year_id <span class="sql-reserved">AS</span> academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> license_count <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> literacy_license_count,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">THEN</span> license_count <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> bae_license_count,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> has_literacy,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> has_bae,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> has_bae_student_site_expander,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'teacher expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> has_bae_teacher_expander,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> sub_program_id = <span class="sql-number">12</span> <span class="sql-reserved">AND</span> expander_type = <span class="sql-string">'teacher expander'</span> <span class="sql-reserved">AND</span> odc.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> od.quantity <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> bae_teacher_expander_qty<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_info_summary odi<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_pl_ay_order_detail_linked_cancels odc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odc.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revised_academic_year_id</td></tr>
   <tr><td>302</td><td>reports/finance/ay_product_line_values/generate_query_data.inc:427</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_filtered_order_list(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odi.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_detail_info_summary odi<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odi.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = odi.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts oa<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oa.account_id = o.account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.accounts od_a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od_a.account_id = od.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts ob_a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ob_a.account_id = o.billing_account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = odi.revised_academic_year_id<br/><span class="sql-reserved">INNER JOIN</span> amortization.booking_report_order_w_discounts bo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bo.order_id = odi.order_id <span class="sql-reserved">AND</span> bo.cancel_id = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> $selected_academic_year_where $selected_district_where $selected_sub_programs_components_where <span class="sql-string">".(($orders &gt; "") ? "</span> <span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">IN</span>($orders) <span class="sql-string">" : "")."</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_pl_filtered_order_list(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>303</td><td>reports/renewal/candidate_index.php:207</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_targets_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) account_owner,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.renewal_quota,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_old t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> region_states rs <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs.state_code = a.state_code <span class="sql-reserved">AND</span> rs.region_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", array_keys(get_region_list($DEPARTMENT["</span> sales <span class="sql-string">"]))) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id = a.parent_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.user_id = t.account_owner_user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.date_entered = <span class="sql-string">'$target_version'</span> <span class="sql-reserved">AND</span> t.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.account_id = t.account_id $whereStr<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_targets_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>304</td><td>reports/renewal/candidate_index.php:233</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(b.end_date) = <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> p.product_id = sp.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(b.end_date) = <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> p.product_id = sp.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td></tr>
   <tr><td>305</td><td>reports/renewal/candidate_index.php:257</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(od.end_date) = <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(od.end_date) = <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td></tr>
   <tr><td>306</td><td>reports/renewal/candidate_index.php:275</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> target_renewal_opportunities_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = ro.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> target_renewal_opportunities_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = ro.order_id</td></tr>
   <tr><td>307</td><td>reports/renewal/candidate_index.php:299</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> quotes_future_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.probability_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.date_entered<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_map opm,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_opportunities ro <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> ro.order_id = o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> target_renewal_opportunities_$table_suffix tro <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = tro.opportunity_id <span class="sql-reserved">AND</span> o.account_id = tro.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> user_orders uo <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = uo.opportunity_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uo.user_id = ua.user_id <span class="sql-reserved">AND</span> ua.account_id = b.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">25</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> orders o2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o2.order_id = c.order_id <span class="sql-reserved">AND</span> o2.date_entered &lt;= <span class="sql-string">'$run_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id = b.quote_id <span class="sql-reserved">AND</span> c.opportunity_id = a.opportunity_id <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND ((o.licenses = 1 AND sp.sub_product_type_id = 1)
                OR (o.licenses = 0 AND nl.product_group_id = p.product_group_id))*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.lead_source_id = <span class="sql-number">7</span> <span class="sql-reserved">OR</span> ua.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> b.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">AND</span> c.opportunity_id = opm.opportunity_id <span class="sql-reserved">AND</span> o.opportunity_product_id = opm.opportunity_product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ro.opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> tro.opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.order_id &lt;&gt; c.order_id <span class="sql-reserved">AND</span> a.date_entered &lt;= <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> o2.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> quotes_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>308</td><td>reports/renewal/candidate_index.php:380</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> probability_history1_$table_suffix(<span class="sql-reserved">KEY</span>(opportunity_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.new_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) probability_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = h.record_id <span class="sql-reserved">AND</span> h.table_name = <span class="sql-string">'opportunities'</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'probability_id'</span> <span class="sql-reserved">AND</span> h.date_entered &lt;= <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> probability_history1_$table_suffix(<span class="sql-reserved">KEY</span>(opportunity_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.new_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> probability_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = h.record_id <span class="sql-reserved">AND</span> h.table_name = <span class="sql-string">'opportunities'</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'probability_id'</span> <span class="sql-reserved">AND</span> h.date_entered &lt;= <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td></tr>
   <tr><td>309</td><td>reports/renewal/candidate_index.php:397</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> probability_history2_$table_suffix(<span class="sql-reserved">KEY</span>(opportunity_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.old_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) probability_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = h.record_id <span class="sql-reserved">AND</span> h.table_name = <span class="sql-string">'opportunities'</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'probability_id'</span> <span class="sql-reserved">AND</span> h.date_entered &gt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> probability_history2_$table_suffix(<span class="sql-reserved">KEY</span>(opportunity_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.old_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> probability_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = h.record_id <span class="sql-reserved">AND</span> h.table_name = <span class="sql-string">'opportunities'</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'probability_id'</span> <span class="sql-reserved">AND</span> h.date_entered &gt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td></tr>
   <tr><td>310</td><td>reports/renewal/candidate_index.php:417</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_date renewal_order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> orders od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = q.renewal_order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.probability_id = q.probability_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> q.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m,strtotime($run_date))-3, 1, date(Y,strtotime($run_date)))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> od.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id <span class="sql-reserved">AS</span> renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_date <span class="sql-reserved">AS</span> renewal_order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes_future_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> orders od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = q.renewal_order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.probability_id = q.probability_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> q.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m,strtotime($run_date))-3, 1, date(Y,strtotime($run_date)))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id</td></tr>
   <tr><td>311</td><td>reports/renewal/candidate_index.php:467</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_to_delete_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'0'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_to_delete_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'0'</span></td></tr>
   <tr><td>312</td><td>reports/renewal/candidate_index.php:517</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> district_school_opps_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(p.status) school_opp_status<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = p.order_id <span class="sql-reserved">AND</span> a1.account_id = t.account_id <span class="sql-reserved">AND</span> a1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a2.account_id = p.account_id <span class="sql-reserved">AND</span> a2.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.opportunity_product_id = p.opportunity_product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> district_school_opps_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(p.status) <span class="sql-reserved">AS</span> school_opp_status<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = p.order_id <span class="sql-reserved">AND</span> a1.account_id = t.account_id <span class="sql-reserved">AND</span> a1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a2.account_id = p.account_id <span class="sql-reserved">AND</span> a2.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.opportunity_product_id = p.opportunity_product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id</td></tr>
   <tr><td>313</td><td>reports/renewal/candidate_index.php:541</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> district_opps_future_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_school_opps_$table_suffix d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = p.order_id <span class="sql-reserved">AND</span> d.school_opp_status = p.status</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> district_opps_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_school_opps_$table_suffix d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = p.order_id <span class="sql-reserved">AND</span> d.school_opp_status = p.status</td></tr>
   <tr><td>314</td><td>reports/renewal/candidate_index.php:556</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price * qd.quantity)) quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price * qd.quantity)) multi_year_quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.quote_id = qd.quote_id <span class="sql-reserved">AND</span> p.account_id = qd.account_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> ay.academic_year_id = qd.academic_year_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-string">" . ($report_id == $REPORTS["</span> renewal_progress <span class="sql-string">"] ? "" : "</span> <span class="sql-reserved">AND</span> p.status &gt; <span class="sql-number">10</span> <span class="sql-string">") . "</span> <span class="sql-reserved">AND</span> p.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>315</td><td>reports/renewal/candidate_index.php:590</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_1_year_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price * qd.quantity)) quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.quote_id = qd.quote_id <span class="sql-reserved">AND</span> t.account_id = qd.account_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> qd.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">AND</span> t.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_1_year_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price * qd.quantity) <span class="sql-reserved">AS</span> quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.quote_id = qd.quote_id <span class="sql-reserved">AND</span> t.account_id = qd.account_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> qd.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">AND</span> t.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.account_id</td></tr>
   <tr><td>316</td><td>reports/renewal/candidate_index.php:631</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quotes_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_id &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quotes_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_id &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>317</td><td>reports/renewal/candidate_index.php:641</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_totals_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price * qd.quantity)) quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> q.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.renewal_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price * qd.quantity) <span class="sql-reserved">AS</span> quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> q.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.quote_id</td></tr>
   <tr><td>318</td><td>reports/renewal/candidate_index.php:665</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price) * <span class="sql-number">-1</span>) total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(qd.price) * <span class="sql-number">-1</span>) /(q.quote_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> q.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price) * <span class="sql-number">-1</span> / q.quote_total <span class="sql-reserved">AS</span> discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> pr.product_id = qd.product_id <span class="sql-reserved">AND</span> pr.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> q.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>319</td><td>reports/renewal/candidate_index.php:696</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> credits_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(oc.credit_amount) credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_cancels oc<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(q.quote_id = d.quote_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.renewal_order_id = oc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> credits_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(oc.credit_amount) <span class="sql-reserved">AS</span> credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_cancels oc<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = d.quote_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.renewal_order_id = oc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>320</td><td>reports/renewal/candidate_index.php:722</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_discounts_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total account_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total * d.discount_percent<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> pt.quote_total &lt;&gt; pt.multi_year_quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.multi_year_quote_total -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.multi_year_quote_total * d.discount_percent<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.multi_year_quote_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N/A'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) multi_year_projected_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_$table_suffix pt<br/><span class="sql-reserved">LEFT JOIN</span> discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(d.quote_id = pt.quote_id)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_discounts_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total <span class="sql-reserved">AS</span> account_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total - pt.quote_total * d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> pt.quote_total &lt;&gt; pt.multi_year_quote_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.multi_year_quote_total - pt.multi_year_quote_total * d.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.multi_year_quote_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N/A'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> multi_year_projected_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_$table_suffix pt<br/><span class="sql-reserved">LEFT JOIN</span> discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.quote_id = pt.quote_id</td></tr>
   <tr><td>321</td><td>reports/renewal/candidate_index.php:737</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_by_status_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_discounts_$table_suffix pt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = op.account_id <span class="sql-reserved">AND</span> t.order_id = op.order_id <span class="sql-reserved">AND</span> op.quote_id = pt.quote_id <span class="sql-reserved">AND</span> op.account_id = pt.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.status</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_by_status_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt.quote_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quote_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_discounts_$table_suffix pt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = op.account_id <span class="sql-reserved">AND</span> t.order_id = op.order_id <span class="sql-reserved">AND</span> op.quote_id = pt.quote_id <span class="sql-reserved">AND</span> op.account_id = pt.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.status</td></tr>
   <tr><td>322</td><td>reports/renewal/candidate_index.php:753</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> user_accounts_renewal_rep_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) renewal_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = ua.account_id <span class="sql-reserved">AND</span> u.user_id = ua.user_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["sales"]]["renewal_rep"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> user_accounts_renewal_rep_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) <span class="sql-reserved">AS</span> renewal_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = ua.account_id <span class="sql-reserved">AND</span> u.user_id = ua.user_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["sales"]]["renewal_rep"] . "'</span></td></tr>
   <tr><td>323</td><td>reports/renewal/candidate_index.php:764</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> user_accounts_sales_rep_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = ua.account_id <span class="sql-reserved">AND</span> u.user_id = ua.user_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["sales"]]["sales_rep"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> user_accounts_sales_rep_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(u.first_name, <span class="sql-string">' '</span>, u.last_name) <span class="sql-reserved">AS</span> sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id = ua.account_id <span class="sql-reserved">AND</span> u.user_id = ua.user_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["sales"]]["sales_rep"] . "'</span></td></tr>
   <tr><td>324</td><td>reports/renewal/candidate_index.php:871</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_progress_data_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(d.renewal_target) renewal_target,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.max_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.projected_total_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.projected_total) projected_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_candidate_data_$table_suffix d<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.projected_total_quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_progress_data_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(d.renewal_target) <span class="sql-reserved">AS</span> renewal_target,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.max_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.projected_total_quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.projected_total) <span class="sql-reserved">AS</span> projected_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_candidate_data_$table_suffix d<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.projected_total_quote_id</td></tr>
   <tr><td>325</td><td>reports/renewal/candidate_index.php:884</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_orders_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.renewal_order_id order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_candidate_data_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix op<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.account_id = o.account_id <span class="sql-reserved">AND</span> op.order_id = o.order_id <span class="sql-reserved">AND</span> op.renewal_order_id &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> renewal_orders_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.renewal_order_id <span class="sql-reserved">AS</span> order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_candidate_data_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opps_future_$table_suffix op<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.account_id = o.account_id <span class="sql-reserved">AND</span> op.order_id = o.order_id <span class="sql-reserved">AND</span> op.renewal_order_id &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>326</td><td>reports/renewal/candidate_index.php:895</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> expansion_orders_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_orders uo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_orders_$table_suffix ro <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = ro.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> accounts p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id = a.parent_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">AND</span> a.account_id = od.account_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = t.district_account_id <span class="sql-reserved">AND</span> ro.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.order_id = uo.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> o.account_id = ua.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">25</span> <span class="sql-reserved">AND</span> uo.user_id = ua.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(o.order_date) &gt;= <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> o.date_entered &lt;= <span class="sql-string">'$run_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> expansion_orders_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_targets_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_orders uo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_orders_$table_suffix ro <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ro.order_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.account_id = a.parent_account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.academic_year_id = <span class="sql-string">'$next_academic_year_id'</span> <span class="sql-reserved">AND</span> a.account_id = od.account_id <span class="sql-reserved">AND</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = t.district_account_id <span class="sql-reserved">AND</span> ro.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> o.order_id = uo.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> o.account_id = ua.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-number">25</span> <span class="sql-reserved">AND</span> uo.user_id = ua.user_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(o.order_date) &gt;= <span class="sql-string">'$target_year'</span> <span class="sql-reserved">AND</span> o.date_entered &lt;= <span class="sql-string">'$run_date'</span></td></tr>
   <tr><td>327</td><td>reports/renewal/candidate_index.php:922</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_account_totals_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(od.price * od.quantity)) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_account_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id</td></tr>
   <tr><td>328</td><td>reports/renewal/candidate_index.php:938</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(od.price * od.quantity)) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id</td></tr>
   <tr><td>329</td><td>reports/renewal/candidate_index.php:950</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_discounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;discount_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(od.price) * <span class="sql-number">-1</span>) total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(od.price) * <span class="sql-number">-1</span>) /(o.order_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_discounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;discount_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price) * <span class="sql-number">-1</span> / o.order_total <span class="sql-reserved">AS</span> discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products pr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> pr.product_id = od.product_id <span class="sql-reserved">AND</span> pr.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>330</td><td>reports/renewal/candidate_index.php:966</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_credits_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(oc.credit_amount) credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_cancels oc<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = d.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_credits_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(oc.credit_amount) <span class="sql-reserved">AS</span> credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.total_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_cancels oc<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_discounts_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oc.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>331</td><td>reports/renewal/candidate_index.php:992</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_discounts_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total account_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total * od.discount_percent<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_account_totals_$table_suffix ot<br/><span class="sql-reserved">LEFT JOIN</span> order_discounts_$table_suffix od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.order_id = ot.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_progress_data_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) = ot.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_discounts_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total <span class="sql-reserved">AS</span> account_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total - ot.order_total * od.discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_account_totals_$table_suffix ot<br/><span class="sql-reserved">LEFT JOIN</span> order_discounts_$table_suffix od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = ot.order_id<br/><span class="sql-reserved">LEFT JOIN</span> renewal_progress_data_$table_suffix d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.district_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) = ot.account_id</td></tr>
   <tr><td>332</td><td>reports/renewal/candidate_index.php:1024</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_grp_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(order_total) order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_discounts_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$group_by_str</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_grp_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(order_total) <span class="sql-reserved">AS</span> order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_discounts_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$group_by_str</td></tr>
   <tr><td>333</td><td>reports/renewal/candidate_index.php:1040</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> expansion_schools_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ot.account_id) total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_totals_discounts_$table_suffix ot,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_targets_$table_suffix t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = t.account_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = ot.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$group_by_str</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> expansion_schools_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ot.account_id) <span class="sql-reserved">AS</span> total_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_totals_discounts_$table_suffix ot,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_targets_$table_suffix t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = t.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = ot.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> t.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$group_by_str</td></tr>
   <tr><td>334</td><td>reports/renewal/candidate_index.php:1061</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> renewal_progress_grp_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> district_account_id) total_districts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_account_id &lt;&gt; <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_schools,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(renewal_target) total_renewal_target,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_order = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> max_opportunity_status &gt; <span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) opportunity_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> max_opportunity_status = <span class="sql-number">10</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projected_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) lost_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_order = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_order_districts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renewal_order = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> school_account_id &lt;&gt; <span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;school_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_order_schools<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_progress_data_$table_suffix d<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$group_by_str</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> renewal_progress_grp_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>335</td><td>cron/il_sync/orders.php:184</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_new_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.$id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * <span class="sql-keyword">MIN</span>(p.student_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["program pricing"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(p.start_date) &gt;= <span class="sql-number">2013</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CEIL</span>(d.quantity / <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-keyword">MIN</span>(p.teacher_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * <span class="sql-keyword">MIN</span>(p.parent_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) parent_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.domain_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.partner_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pe.edition_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.edition_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) edition_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pc.course_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.course_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) course_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_editions pe <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = pe.product_id)<br/><span class="sql-reserved">LEFT JOIN</span> product_courses pc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = pc.product_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span> d.account_id = a.account_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $sub_products) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.date_entered &gt; <span class="sql-string">'$last_start_time'</span> <span class="sql-reserved">AND</span> d.date_entered &lt;= <span class="sql-string">'$start_time'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_new_orders</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>336</td><td>cron/il_sync/orders.php:290</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_cancel_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.$id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span> a.account_id = d.account_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $sub_products) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.date_modified &gt; <span class="sql-string">'$last_start_time'</span> <span class="sql-reserved">AND</span> o.date_modified &lt;= <span class="sql-string">'$start_time'</span> <span class="sql-reserved">AND</span> d.date_entered &lt;= <span class="sql-string">'$order_last_start'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_cancel_orders</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>337</td><td>cron/il_sync/orders.php:365</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_update_orders <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.$id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * <span class="sql-keyword">MIN</span>(p.student_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["program pricing"] . "'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(p.start_date) &gt;= <span class="sql-number">2013</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CEIL</span>(d.quantity / <span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-keyword">MIN</span>(p.teacher_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.quantity * <span class="sql-keyword">MIN</span>(p.parent_licenses)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) parent_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.column_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.domain_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pe.edition_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.edition_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) edition_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pc.course_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.course_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) course_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.partner_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.old_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) old_value,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(h.date_entered, <span class="sql-string">'|'</span>, h.new_value)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) new_value<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> sub_products sp2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h.column_name = <span class="sql-string">'product_id'</span> <span class="sql-reserved">AND</span> h.old_value = sp2.product_id <span class="sql-reserved">AND</span> sp2.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $sub_products) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> product_editions pe <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = pe.product_id)<br/><span class="sql-reserved">LEFT JOIN</span> product_courses pc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = pc.product_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span> d.account_id = a.account_id <span class="sql-reserved">AND</span> h.table_name = <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> h.column_name <span class="sql-reserved">NOT IN</span>(<span class="sql-string">'price'</span>, <span class="sql-string">'status'</span>) <span class="sql-reserved">AND</span> d.order_detail_id = h.record_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $sub_products) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> h.date_entered &gt; <span class="sql-string">'$order_last_start'</span> <span class="sql-reserved">AND</span> h.date_entered &lt;= <span class="sql-string">'$start_time'</span> <span class="sql-reserved">AND</span> o.date_entered &lt;= <span class="sql-string">'$last_start_time'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp2.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> h.column_name != <span class="sql-string">'product_id'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" . ($sync_type == "</span> sa <span class="sql-string">" ? "</span> <span class="sql-reserved">AND</span> h.column_name <span class="sql-reserved">IN</span>(<span class="sql-string">'end_date'</span>, <span class="sql-string">'post_end'</span>, <span class="sql-string">'account_id'</span>) <span class="sql-string">" : "") . "</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.column_name<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.date_entered</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> { $sync_type } _sync_update_orders</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>338</td><td>reports/finance/booking_totals.php:181</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.tmp_booking_detail_product_lines(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> odis.sub_program_id <span class="sql-reserved">IN</span>(<span class="sql-number">10</span>, <span class="sql-number">12</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">COALESCE</span>(odis.sub_program_id, <span class="sql-number">0</span>)<br/><span class="sql-keyword">END</span> sub_program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.products p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.programs pr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_info_summary odis<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> od.academic_year_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.tmp_booking_detail_product_lines(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_str <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> odis.sub_program_id <span class="sql-reserved">IN</span>(<span class="sql-number">10</span>, <span class="sql-number">12</span>) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">COALESCE</span>(odis.sub_program_id, <span class="sql-number">0</span>)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sub_program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.products p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.programs pr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_info_summary odis<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odis.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> od.academic_year_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td></tr>
   <tr><td>339</td><td>reports/finance/booking_totals.php:255</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_detail_totals(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.order_date) fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oid.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oid.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(product_total) list_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(after_my_total - product_total) my_spread_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(after_std_total - after_my_total) std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - after_std_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(discounted_total) order_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> discounted_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) non_recurring_line_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> discounted_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) pd_line_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details oid<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = oid.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = oid.academic_year_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.zero_dollar_order_discounts zo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;zo.order_id = od.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.order_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$end_date'</span> <span class="sql-reserved">AND</span> zo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.order_detail_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_detail_totals(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.order_date) <span class="sql-reserved">AS</span> fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oid.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oid.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(product_total) <span class="sql-reserved">AS</span> list_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(after_my_total - product_total) <span class="sql-reserved">AS</span> my_spread_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after_std_total - after_my_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discounted_total - after_std_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(discounted_total) <span class="sql-reserved">AS</span> order_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> discounted_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> non_recurring_line_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> discounted_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> pd_line_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details oid<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = oid.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = oid.academic_year_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.zero_dollar_order_discounts zo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;zo.order_id = od.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.order_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'$start_date'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$end_date'</span> <span class="sql-reserved">AND</span> zo.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> od.order_detail_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td></tr>
   <tr><td>340</td><td>reports/finance/booking_totals.php:389</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_cancel_detail_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;m.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(m.cancel_date) yr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> odt.list_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) list_cancel_total,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> odt.std_discount_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) std_discount_cancel_total,<br/>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(m.cancel_total) -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odt.list_total + odt.std_discount_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">SUM</span>(m.cancel_total) * <span class="sql-number">-1</span><br/><span class="sql-keyword">END</span><br/>) non_std_discount_cancel_total,<br/><span class="sql-keyword">SUM</span>(m.cancel_total * <span class="sql-number">-1</span>) cancel_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> cancel_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) non_recurring_cancel_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> cancel_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) pd_cancel_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.tmp_cancels_merge m<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id = m.line_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = m.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details oid<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oid.order_detail_id = m.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id = m.cancel_id <span class="sql-reserved">AND</span> oc.order_id = m.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.booking_detail_totals odt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odt.order_detail_id = m.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_cancel_detail_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;m.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;m.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(m.cancel_date) <span class="sql-reserved">AS</span> yr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> odt.list_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> list_cancel_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>) <span class="sql-reserved">THEN</span> odt.std_discount_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> std_discount_cancel_total,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oid.cancel_id = m.cancel_id <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> oc.credit_type = <span class="sql-string">'F'</span> <span class="sql-reserved">AND</span> oid.cancel_id = <span class="sql-number">0</span><br/>) <span class="sql-reserved">THEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(m.cancel_total) -(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odt.list_total + odt.std_discount_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-keyword">SUM</span>(m.cancel_total) * <span class="sql-number">-1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> non_std_discount_cancel_total,<br/><span class="sql-keyword">SUM</span>(m.cancel_total * <span class="sql-number">-1</span>) <span class="sql-reserved">AS</span> cancel_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> cancel_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> non_recurring_cancel_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> cancel_total * <span class="sql-number">-1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> pd_cancel_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.tmp_cancels_merge m<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.line_id = m.line_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = od.sub_product_type_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = m.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details oid<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oid.order_detail_id = m.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels oc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id = m.cancel_id <span class="sql-reserved">AND</span> oc.order_id = m.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.booking_detail_totals odt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;odt.order_detail_id = m.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>341</td><td>reports/finance/booking_totals.php:474</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_order_account_base(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(list_total) list_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(my_spread_total) my_spread_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(std_discount_total) std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_std_discount_total) non_std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_recurring_line_total) non_recurring_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(pd_line_total) pd_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(product_details, <span class="sql-string">''</span>) product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.tmp_merge_all_order_level_pre<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_order_account_base(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(list_total) <span class="sql-reserved">AS</span> list_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(my_spread_total) <span class="sql-reserved">AS</span> my_spread_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(std_discount_total) <span class="sql-reserved">AS</span> std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_std_discount_total) <span class="sql-reserved">AS</span> non_std_discount_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) <span class="sql-reserved">AS</span> line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_recurring_line_total) <span class="sql-reserved">AS</span> non_recurring_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(pd_line_total) <span class="sql-reserved">AS</span> pd_line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(product_details, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.tmp_merge_all_order_level_pre<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;fiscal_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id</td></tr>
   <tr><td>342</td><td>reports/finance/booking_totals.php:488</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_product_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_detail_totals od<br/><span class="sql-reserved">LEFT JOIN</span> tech.tmp_booking_detail_product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/><span class="sql-reserved">UNION ALL</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_cancel_detail_totals od<br/><span class="sql-reserved">LEFT JOIN</span> tech.tmp_booking_detail_product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_product_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_details <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_detail_totals od<br/><span class="sql-reserved">LEFT JOIN</span> tech.tmp_booking_detail_product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/><span class="sql-reserved">UNION ALL</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_cancel_detail_totals od<br/><span class="sql-reserved">LEFT JOIN</span> tech.tmp_booking_detail_product_lines pl<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = pl.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>343</td><td>reports/finance/booking_totals.php:555</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_order_detail_new_renew_percent_unlocked(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.new_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) percent_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.renew_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) percent_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) detail_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) non_recurring_detail_period_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) pd_detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_summary r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = a.sub_product_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_order_detail_new_renew_percent_unlocked(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">INT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_period_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_recurring_detail_period_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_detail_period_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">41</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.new_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> percent_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.renew_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> percent_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) <span class="sql-reserved">AS</span> detail_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> non_recurring_detail_period_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> pd_detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.order_detail_amortization a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_summary r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = a.sub_product_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id</td></tr>
   <tr><td>344</td><td>reports/finance/booking_totals.php:614</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> booking_total_account_districts(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(d1.account_id, a.account_id) district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> d1.account_id <span class="sql-reserved">OR</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> has_district,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> a.account_id = $HSBC_ID <span class="sql-reserved">OR</span> d1.account_id = $HSBC_ID <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_individual<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts d1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id = a.parent_account_id <span class="sql-reserved">AND</span> d1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> booking_total_account_districts(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(d1.account_id, a.account_id) <span class="sql-reserved">AS</span> district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> d1.account_id <span class="sql-reserved">OR</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> has_district,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> a.account_id = $HSBC_ID <span class="sql-reserved">OR</span> d1.account_id = $HSBC_ID <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_individual<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.accounts a<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts d1<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d1.account_id = a.parent_account_id <span class="sql-reserved">AND</span> d1.account_level = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td></tr>
   <tr><td>345</td><td>reports/finance/booking_totals.php:629</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_first_acv<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_recurring_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_recurring_sales_tax_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_annualized_factor <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">4</span>, <span class="sql-number">2</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id ordering_district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date orig_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(c.cancel_date, o.order_date) booking_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad_detail.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_ext.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_ext.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_summer_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(ay_ext.sort, ay.sort) non_summer_academic_year_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> toay.is_partial<br/><span class="sql-keyword">END</span> is_partial,<br/>toay.is_leading_partial,<br/>toay.is_od_il_partial,<br/>base.sub_program_id,<br/>pg.program_name sub_program_name,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> acvy.order_id <span class="sql-reserved">AND</span> acvy.is_first_acv = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_first_acv,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> acvy.order_id <span class="sql-reserved">AND</span> acvy.is_first_acv = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_first_acv_no_credit,<br/><span class="sql-number">0</span> is_arr_acv,<br/><span class="sql-number">0</span> is_myo,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> md.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_first_detail,<br/><span class="sql-keyword">IFNULL</span>(base.list_total, <span class="sql-number">0</span>) list_total,<br/><span class="sql-keyword">IFNULL</span>(base.my_spread_total, <span class="sql-number">0</span>) my_spread_total,<br/><span class="sql-keyword">IFNULL</span>(base.std_discount_total, <span class="sql-number">0</span>) std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.non_std_discount_total, <span class="sql-number">0</span>) non_std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.non_std_discount_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(base.my_spread_total, <span class="sql-number">0</span>) adjusted_non_std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) line_total_no_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) line_total,<br/><span class="sql-keyword">IFNULL</span>(nr.line_new_total, <span class="sql-number">0</span>) new_total,<br/><span class="sql-keyword">IFNULL</span>(nr.line_renew_total, <span class="sql-number">0</span>) renew_total,<br/><span class="sql-number">0</span> sales_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> line_total_acv_no_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.line_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.line_renew_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> renew_total_acv,<br/><span class="sql-number">0</span> sales_tax_acv,<br/>base.non_recurring_line_total non_recurring_line_total,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_new_total, <span class="sql-number">0</span>) non_recurring_new_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.non_recurring_renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) non_recurring_renew_total,<br/><span class="sql-number">0</span> non_recurring_sales_tax,<br/>base.non_recurring_line_total / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> non_recurring_line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> non_recurring_new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.non_recurring_renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> non_recurring_renew_total_acv,<br/><span class="sql-number">0</span> non_recurring_sales_tax_acv,<br/>base.pd_line_total pd_line_total_tcv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_new_total, <span class="sql-number">0</span>) pd_new_total_tcv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_renew_total, <span class="sql-number">0</span>) pd_renew_total_tcv,<br/>base.pd_line_total / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> pd_line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> pd_new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_renew_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> pd_renew_total_acv,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> acv_annualized_factor,<br/><span class="sql-comment">/*2 columns for archived but stored retention report does not include tax*/</span><br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> line_total_w_acv_factor_no_tax,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> non_recurring_line_total_w_acv_factor,<br/><span class="sql-keyword">IFNULL</span>(ls.lead_source_name, <span class="sql-string">''</span>) lead_source,<br/><span class="sql-keyword">IFNULL</span>(ls.is_pilot, <span class="sql-number">0</span>) is_pilot,<br/>tad_detail.is_individual,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ls.is_pilot = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> tad_detail.is_individual = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> retention_exclude,<br/><span class="sql-keyword">IFNULL</span>(ls.reseller_name, <span class="sql-string">''</span>) reseller_name,<br/>base.product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_order_account_base base<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> booking_total_account_districts tad <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> booking_total_account_districts tad_detail <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad_detail.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = base.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay_ext<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay_ext.sort = ay.sort <span class="sql-number">+1</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_bookings_order_ay toay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id = toay.order_id <span class="sql-reserved">AND</span> base.academic_year_id = toay.academic_year_id <span class="sql-reserved">AND</span> toay.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_partial_year_orders pyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.booking_total_acv_year acvy<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acvy.order_id = base.order_id <span class="sql-reserved">AND</span> acvy.academic_year_id = base.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_ay_new_renew nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = base.order_id <span class="sql-reserved">AND</span> nr.academic_year_id = base.academic_year_id <span class="sql-reserved">AND</span> nr.account_id = base.account_id <span class="sql-reserved">AND</span> nr.cancel_id = base.cancel_id <span class="sql-reserved">AND</span> nr.sub_program_id = base.sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> order_min_details md <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;md.order_id = base.order_id <span class="sql-reserved">AND</span> base.cancel_id = md.cancel_id <span class="sql-reserved">AND</span> base.account_id = md.min_account_id <span class="sql-reserved">AND</span> base.academic_year_id = md.min_ay_id <span class="sql-reserved">AND</span> base.sub_program_id = md.min_sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id = base.cancel_id <span class="sql-reserved">AND</span> c.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_order_level_info ls <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ls.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.programs pg<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id = base.sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.mh_orders mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;mh.order_id = o.order_id <span class="sql-reserved">AND</span> mh.is_post_integration_order = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment"># AND os.order_total&gt;0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment"># AND IFNULL(c.cancel_date,o.order_date)&gt;='2010-01-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_first_acv<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_summer_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_recurring_sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;non_recurring_sales_tax_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>, <span class="sql-number">14</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_annualized_factor <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">4</span>, <span class="sql-number">2</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id <span class="sql-reserved">AS</span> ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.district_account_id <span class="sql-reserved">AS</span> ordering_district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date <span class="sql-reserved">AS</span> orig_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(c.cancel_date, o.order_date) <span class="sql-reserved">AS</span> booking_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tad_detail.district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_ext.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_ext.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_summer_academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(ay_ext.sort, ay.sort) <span class="sql-reserved">AS</span> non_summer_academic_year_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> toay.is_partial<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_partial,<br/>toay.is_leading_partial,<br/>toay.is_od_il_partial,<br/>base.sub_program_id,<br/>pg.program_name <span class="sql-reserved">AS</span> sub_program_name,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> acvy.order_id <span class="sql-reserved">AND</span> acvy.is_first_acv = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_first_acv,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> acvy.order_id <span class="sql-reserved">AND</span> acvy.is_first_acv = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_first_acv_no_credit,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> is_arr_acv,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> is_myo,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> md.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_first_detail,<br/><span class="sql-keyword">IFNULL</span>(base.list_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> list_total,<br/><span class="sql-keyword">IFNULL</span>(base.my_spread_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> my_spread_total,<br/><span class="sql-keyword">IFNULL</span>(base.std_discount_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.non_std_discount_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> non_std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.non_std_discount_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(base.my_spread_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> adjusted_non_std_discount_total,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> line_total_no_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> line_total,<br/><span class="sql-keyword">IFNULL</span>(nr.line_new_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> new_total,<br/><span class="sql-keyword">IFNULL</span>(nr.line_renew_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> renew_total,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> sales_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> line_total_acv_no_tax,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.line_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.line_renew_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> renew_total_acv,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> sales_tax_acv,<br/>base.non_recurring_line_total <span class="sql-reserved">AS</span> non_recurring_line_total,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_new_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> non_recurring_new_total,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.non_recurring_renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> non_recurring_renew_total,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> non_recurring_sales_tax,<br/>base.non_recurring_line_total / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> non_recurring_line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> non_recurring_new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.non_recurring_renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> non_recurring_renew_total_acv,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> non_recurring_sales_tax_acv,<br/>base.pd_line_total <span class="sql-reserved">AS</span> pd_line_total_tcv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_new_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> pd_new_total_tcv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_renew_total, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> pd_renew_total_tcv,<br/>base.pd_line_total / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> pd_line_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_new_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> pd_new_total_acv,<br/><span class="sql-keyword">IFNULL</span>(nr.pd_renew_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> pd_renew_total_acv,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> acv_annualized_factor,<br/><span class="sql-keyword">IFNULL</span>(base.line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> line_total_w_acv_factor_no_tax,<br/><span class="sql-keyword">IFNULL</span>(nr.non_recurring_line_total, <span class="sql-number">0</span>) / <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> non_recurring_line_total_w_acv_factor,<br/><span class="sql-keyword">IFNULL</span>(ls.lead_source_name, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> lead_source,<br/><span class="sql-keyword">IFNULL</span>(ls.is_pilot, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> is_pilot,<br/>tad_detail.is_individual,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> ls.is_pilot = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> tad_detail.is_individual = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> retention_exclude,<br/><span class="sql-keyword">IFNULL</span>(ls.reseller_name, <span class="sql-string">''</span>) <span class="sql-reserved">AS</span> reseller_name,<br/>base.product_details<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_order_account_base base<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> booking_total_account_districts tad <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> booking_total_account_districts tad_detail <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tad_detail.account_id = base.account_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = base.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay_ext<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay_ext.sort = ay.sort + <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_bookings_order_ay toay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.order_id = toay.order_id <span class="sql-reserved">AND</span> base.academic_year_id = toay.academic_year_id <span class="sql-reserved">AND</span> toay.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_partial_year_orders pyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.booking_total_acv_year acvy<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;acvy.order_id = base.order_id <span class="sql-reserved">AND</span> acvy.academic_year_id = base.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_account_ay_new_renew nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_id = base.order_id <span class="sql-reserved">AND</span> nr.academic_year_id = base.academic_year_id <span class="sql-reserved">AND</span> nr.account_id = base.account_id <span class="sql-reserved">AND</span> nr.cancel_id = base.cancel_id <span class="sql-reserved">AND</span> nr.sub_program_id = base.sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> order_min_details md <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;md.order_id = base.order_id <span class="sql-reserved">AND</span> base.cancel_id = md.cancel_id <span class="sql-reserved">AND</span> base.account_id = md.min_account_id <span class="sql-reserved">AND</span> base.academic_year_id = md.min_ay_id <span class="sql-reserved">AND</span> base.sub_program_id = md.min_sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_cancels c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id = base.cancel_id <span class="sql-reserved">AND</span> c.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_order_level_info ls <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ls.order_id = base.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.programs pg<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id = base.sub_program_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.mh_orders mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;mh.order_id = o.order_id <span class="sql-reserved">AND</span> mh.is_post_integration_order = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-comment"># AND os.order_total&gt;0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment"># AND IFNULL(c.cancel_date,o.order_date)&gt;='2010-01-01'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
   <tr><td>346</td><td>reports/finance/booking_totals.php:1101</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_bookings_order_ay(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, ay_sort, ay_summer)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) min_od_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) max_od_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.start_date ay_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date ay_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.sort ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">MIN</span>(od.start_date)) &gt; <span class="sql-keyword">YEAR</span>(ay.start_date) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">AND</span> sy.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(od.start_date) = ood.order_start_date <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_leading_partial,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">MIN</span>(od.start_date)) &gt; <span class="sql-keyword">YEAR</span>(ay.start_date) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_partial,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_partial_span,<br/><span class="sql-keyword">MAX</span>(od.partial) is_od_il_partial<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_order_dates ood<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ood.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_single_year_orders sy<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sy.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment"># AND os.order_total&gt;0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_bookings_order_ay(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, ay_sort, ay_summer)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) <span class="sql-reserved">AS</span> min_od_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) <span class="sql-reserved">AS</span> max_od_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.start_date <span class="sql-reserved">AS</span> ay_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date <span class="sql-reserved">AS</span> ay_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer <span class="sql-reserved">AS</span> ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.sort <span class="sql-reserved">AS</span> ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">MIN</span>(od.start_date)) &gt; <span class="sql-keyword">YEAR</span>(ay.start_date) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">AND</span> sy.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(od.start_date) = ood.order_start_date <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_leading_partial,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">MIN</span>(od.start_date)) &gt; <span class="sql-keyword">YEAR</span>(ay.start_date) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_partial,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">DATEDIFF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date)<br/>) &lt;= <span class="sql-number">212</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_partial_span,<br/><span class="sql-keyword">MAX</span>(od.partial) <span class="sql-reserved">AS</span> is_od_il_partial<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> amortization.tmp_order_dates ood<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ood.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_details od<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_single_year_orders sy<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sy.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-comment"># AND os.order_total&gt;0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td></tr>
   <tr><td>347</td><td>reports/finance/booking_totals.php:1170</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_sorted_order_ay(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_num <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_leading_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.min_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> order_id <span class="sql-reserved">WHEN</span> <span class="sql-variable">@curOrder</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRow</span> := <span class="sql-variable">@curRow</span> + <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRow</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@curOrder</span> := order_id<br/><span class="sql-keyword">END</span> sort,<br/><span class="sql-number">0</span> ay_num<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_leading_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_partial<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.tmp_order_ay ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRow</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curOrder</span> := <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) r<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_sort<br/>) sorted_ay;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.tmp_sorted_order_ay(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_num <span class="sql-reserved">INT</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_leading_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sorted_ay.min_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> order_id <span class="sql-reserved">WHEN</span> <span class="sql-variable">@curOrder</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@curRow</span> := <span class="sql-variable">@curRow</span> + <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@curRow</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<span class="sql-variable">@curOrder</span> := order_id)<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> sort,<br/><span class="sql-number">0</span> <span class="sql-reserved">AS</span> ay_num<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.ay_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_leading_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_partial<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.tmp_order_ay ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curRow</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@curOrder</span> := <span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) r<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_partial_span,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_od_il_partial,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_sort<br/>) sorted_ay</td></tr>
   <tr><td>348</td><td>reports/finance/booking_totals.php:1251</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_acv_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_annualized_factor <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">3</span>, <span class="sql-number">2</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id <span class="sql-reserved">OR</span> ay_acv.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) is_first_acv,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1.0</span><br/><span class="sql-keyword">END</span><br/>) acv_annualized_factor<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details base<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = base.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = base.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#Determine academic year after summer</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay_ext<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay_ext.sort = ay.sort <span class="sql-number">+1</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_bookings_order_ay toay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = toay.order_id <span class="sql-reserved">AND</span> base.academic_year_id = toay.academic_year_id <span class="sql-reserved">AND</span> toay.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_order_acv_ay ay_acv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ay_acv.order_id <span class="sql-reserved">AND</span> base.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_acv.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_acv.summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_single_year_orders syo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_partial_year_orders pyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.order_acv_overrides ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = o.order_id <span class="sql-reserved">AND</span> ov.remove_booking_acv = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment"># AND os.order_total&gt;0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id <span class="sql-reserved">OR</span> ay_acv.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amortization.booking_total_acv_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, academic_year_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_annualized_factor <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">3</span>, <span class="sql-number">2</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id <span class="sql-reserved">OR</span> ay_acv.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> is_first_acv,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> pyo.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">.7</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">1.0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> acv_annualized_factor<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_details base<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = base.order_id <span class="sql-reserved">AND</span> base.academic_year_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = base.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.academic_years ay_ext<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ay_ext.sort = ay.sort + <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_bookings_order_ay toay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = toay.order_id <span class="sql-reserved">AND</span> base.academic_year_id = toay.academic_year_id <span class="sql-reserved">AND</span> toay.account_id = base.account_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_order_acv_ay ay_acv<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ay_acv.order_id <span class="sql-reserved">AND</span> base.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_acv.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay_acv.summer_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_single_year_orders syo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> amortization.tmp_partial_year_orders pyo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pyo.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.order_acv_overrides ov<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = o.order_id <span class="sql-reserved">AND</span> ov.remove_booking_acv = <span class="sql-number">1</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-comment"># AND os.order_total&gt;0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syo.order_id <span class="sql-reserved">OR</span> ay_acv.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;base.academic_year_id</td></tr>
   <tr><td>349</td><td>reports/finance/booking_totals.php:1300</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_book_order_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_total) acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_new_total) acv_new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_renew_total) acv_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_acv_detail_lock<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_book_order_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">63</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) <span class="sql-reserved">AS</span> line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_total) <span class="sql-reserved">AS</span> acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_new_total) <span class="sql-reserved">AS</span> acv_new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_renew_total) <span class="sql-reserved">AS</span> acv_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_acv_detail_lock<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>350</td><td>reports/finance/booking_totals.php:1312</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_book_order_acv_backup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_total) acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_new_total) acv_new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_renew_total) acv_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_acv_detail_lock_backup<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_book_order_acv_backup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;line_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">63</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;acv_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(line_total) <span class="sql-reserved">AS</span> line_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_total) <span class="sql-reserved">AS</span> acv_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_new_total) <span class="sql-reserved">AS</span> acv_new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(acv_renew_total) <span class="sql-reserved">AS</span> acv_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.booking_acv_detail_lock_backup<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>351</td><td>util/function/product_lines.php:148</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $product_line_licenses_table <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<span class="sql-reserved">IF</span>(student_licenses &gt; <span class="sql-number">0</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>)) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(sort) sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(program_id) min_program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(product_line_id) product_line_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$product_line_table<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . ($group_by ? implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $group_by). "</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" : "") .
            "</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $product_line_licenses_table</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>352</td><td>cron/daily/new_po_pending_orders.php:13</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hp_00831360 <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> payment_terms pt <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> payment_term_details ptd <span class="sql-reserved">USING</span>(payment_term_id)<br/><span class="sql-reserved">JOIN</span> payment_term_status_list pl <span class="sql-reserved">USING</span>(payment_term_status_id)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> a.state_code = <span class="sql-string">'NY'</span> <span class="sql-reserved">AND</span> a.county_id <span class="sql-reserved">IN</span>(<span class="sql-number">2024</span>, <span class="sql-number">2045</span>, <span class="sql-number">2052</span>, <span class="sql-number">2062</span>, <span class="sql-number">2064</span>) <span class="sql-reserved">AND</span> a.account_type <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">4</span>, <span class="sql-number">6</span>, <span class="sql-number">16</span>)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = d.account_id <span class="sql-reserved">AND</span> a2.state_code = <span class="sql-string">'NY'</span> <span class="sql-reserved">AND</span> a2.county_id <span class="sql-reserved">IN</span>(<span class="sql-number">2024</span>, <span class="sql-number">2045</span>, <span class="sql-number">2052</span>, <span class="sql-number">2062</span>, <span class="sql-number">2064</span>) <span class="sql-reserved">AND</span> a2.account_type <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">4</span>, <span class="sql-number">6</span>, <span class="sql-number">16</span>)<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-FA-%'</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ptd.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(o.date_entered) = <span class="sql-keyword">CURDATE</span>() - <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span> <span class="sql-reserved">AND</span> payment_term_status_name <span class="sql-reserved">LIKE</span> <span class="sql-string">'PO Pending%'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> a2.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hp_00831360</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> payment_terms pt <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> payment_term_details ptd <span class="sql-reserved">USING</span>(payment_term_id)<br/><span class="sql-reserved">JOIN</span> payment_term_status_list pl <span class="sql-reserved">USING</span>(payment_term_status_id)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> a.state_code = <span class="sql-string">'NY'</span> <span class="sql-reserved">AND</span> a.county_id <span class="sql-reserved">IN</span>(<span class="sql-number">2024</span>, <span class="sql-number">2045</span>, <span class="sql-number">2052</span>, <span class="sql-number">2062</span>, <span class="sql-number">2064</span>) <span class="sql-reserved">AND</span> a.account_type <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">4</span>, <span class="sql-number">6</span>, <span class="sql-number">16</span>)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = d.account_id <span class="sql-reserved">AND</span> a2.state_code = <span class="sql-string">'NY'</span> <span class="sql-reserved">AND</span> a2.county_id <span class="sql-reserved">IN</span>(<span class="sql-number">2024</span>, <span class="sql-number">2045</span>, <span class="sql-number">2052</span>, <span class="sql-number">2062</span>, <span class="sql-number">2064</span>) <span class="sql-reserved">AND</span> a2.account_type <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">4</span>, <span class="sql-number">6</span>, <span class="sql-number">16</span>)<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%-FA-%'</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">4</span>, <span class="sql-number">5</span>, <span class="sql-number">14</span>, <span class="sql-number">24</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ptd.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(o.date_entered) = <span class="sql-keyword">CURDATE</span>() - <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span> <span class="sql-reserved">AND</span> payment_term_status_name <span class="sql-reserved">LIKE</span> <span class="sql-string">'PO Pending%'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> a2.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>353</td><td>cron/daily/new_po_pending_orders.php:101</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hp_00839015(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> payment_terms pt <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> payment_term_details ptd <span class="sql-reserved">USING</span>(payment_term_id)<br/><span class="sql-reserved">JOIN</span> payment_term_status_list pl <span class="sql-reserved">USING</span>(payment_term_status_id)<br/><span class="sql-reserved">JOIN</span> history_log h <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.record_id = ptd.payment_term_detail_id<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai1 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai1.account_id = o.billing_account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai2.account_id = d.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ptd.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'payment_term_status_id'</span> <span class="sql-reserved">AND</span> h.new_value = <span class="sql-number">200</span> <span class="sql-reserved">AND</span> h.old_value <span class="sql-reserved">IN</span>(<span class="sql-number">201</span>, <span class="sql-number">208</span>, <span class="sql-number">209</span>, <span class="sql-number">210</span>) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(h.date_entered) = <span class="sql-keyword">CURDATE</span>() - <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span> <span class="sql-reserved">AND</span> <span class="sql-number">75</span> <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai.info_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai1.info_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai2.info_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.hp_00839015(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> payment_terms pt <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">JOIN</span> payment_term_details ptd <span class="sql-reserved">USING</span>(payment_term_id)<br/><span class="sql-reserved">JOIN</span> payment_term_status_list pl <span class="sql-reserved">USING</span>(payment_term_status_id)<br/><span class="sql-reserved">JOIN</span> history_log h <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.record_id = ptd.payment_term_detail_id<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai.account_id = o.account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai1 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai1.account_id = o.billing_account_id<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ai2.account_id = d.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ptd.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> h.column_name = <span class="sql-string">'payment_term_status_id'</span> <span class="sql-reserved">AND</span> h.new_value = <span class="sql-number">200</span> <span class="sql-reserved">AND</span> h.old_value <span class="sql-reserved">IN</span>(<span class="sql-number">201</span>, <span class="sql-number">208</span>, <span class="sql-number">209</span>, <span class="sql-number">210</span>) <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE</span>(h.date_entered) = <span class="sql-keyword">CURDATE</span>() - <span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">DAY</span> <span class="sql-reserved">AND</span> <span class="sql-number">75</span> <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai.info_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai1.info_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai2.info_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>354</td><td>cron/weekly/smartyants_report.php:11</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> p.program_id) program,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_name <span class="sql-string">'district'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name <span class="sql-string">'state'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'order_ids'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'order_dates'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'product'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name <span class="sql-string">'account_tier'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts s<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = s.account_id<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = s.parent_account_id<br/><span class="sql-reserved">JOIN</span> locations l <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = s.state_code<br/><span class="sql-reserved">JOIN</span> regions r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_id = s.implementation_region_id<br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = s.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> od.start_date <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>, <span class="sql-number">27</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;program = <span class="sql-string">'".SMARTY_ANTS_PROGRAM."'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;district <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;region_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_ids <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_dates <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_tier <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> p.program_id) <span class="sql-reserved">AS</span> program,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_name <span class="sql-reserved">AS</span> <span class="sql-string">'district'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name <span class="sql-reserved">AS</span> <span class="sql-string">'state'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'order_ids'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'order_dates'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'product'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name <span class="sql-reserved">AS</span> <span class="sql-string">'account_tier'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts s<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = s.account_id<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = s.parent_account_id<br/><span class="sql-reserved">JOIN</span> locations l <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = s.state_code<br/><span class="sql-reserved">JOIN</span> regions r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_id = s.implementation_region_id<br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = s.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> od.start_date <span class="sql-reserved">AND</span> od.end_date <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">28</span>, <span class="sql-number">32</span>, <span class="sql-number">27</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;program = <span class="sql-string">'".SMARTY_ANTS_PROGRAM."'</span></td></tr>
   <tr><td>355</td><td>cron/weekly/smartyants_report.php:36</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_2 <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">7</span>, <span class="sql-number">1</span>) <span class="sql-string">'RVP'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">4</span>, <span class="sql-number">1</span>) <span class="sql-string">'CIM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">26</span>, <span class="sql-number">1</span>) <span class="sql-string">'RIS'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">27</span>, <span class="sql-number">1</span>) <span class="sql-string">'RM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">6</span>, <span class="sql-number">1</span>) <span class="sql-string">'account_sales_rep'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">25</span>, <span class="sql-number">1</span>) <span class="sql-string">'account_renewal_rep'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476 h<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = h.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">7</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RVP'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">4</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'CIM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">26</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RIS'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">27</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">6</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'account_sales_rep'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">25</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'account_renewal_rep'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476 h<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = h.account_id</td></tr>
   <tr><td>356</td><td>cron/weekly/smartyants_report.php:46</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_final <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-string">'district_id'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RVP,<br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RIS,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'unlimited_licenses?'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#, IFNULL(NULLIF(sum(if(aos.student_licenses = 9999, NULL, student_licenses)), 0), '')'purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_2 h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_final</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">AS</span> <span class="sql-string">'district_id'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RVP,<br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RIS,<br/>&nbsp;&nbsp;&nbsp;&nbsp;RM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'unlimited_licenses?'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_2 h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td></tr>
   <tr><td>357</td><td>cron/weekly/smartyants_report.php:62</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_final_2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.<span class="sql-variable">`unlimited_licenses?`</span> = <span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_final f<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = f.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_final_2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.<span class="sql-variable">`unlimited_licenses?`</span> = <span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_final f<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = f.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td></tr>
   <tr><td>358</td><td>cron/weekly/smartyants_report.php:81</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_sa <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">28</span><br/><span class="sql-reserved">JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_sa</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>359</td><td>cron/weekly/smartyants_report.php:99</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_both <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name <span class="sql-string">'account_tier'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id <span class="sql-string">'district_id'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_name <span class="sql-string">'district'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name <span class="sql-string">'state'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.implementation_region_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_sa h<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = h.account_id<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">JOIN</span> sub_products s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.product_id = p.product_id <span class="sql-reserved">AND</span> s.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">2</span>, <span class="sql-number">3</span>, <span class="sql-number">9</span>, <span class="sql-number">16</span>, <span class="sql-number">17</span>, <span class="sql-number">18</span>, <span class="sql-number">20</span>, <span class="sql-number">22</span>, <span class="sql-number">25</span>, <span class="sql-number">26</span>)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = h.parent_account_id<br/><span class="sql-reserved">JOIN</span> locations l <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = h.state_code<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = h.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_both</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name <span class="sql-reserved">AS</span> <span class="sql-string">'account_tier'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id <span class="sql-reserved">AS</span> <span class="sql-string">'district_id'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_name <span class="sql-reserved">AS</span> <span class="sql-string">'district'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name <span class="sql-reserved">AS</span> <span class="sql-string">'state'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.implementation_region_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_sa h<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = h.account_id<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">JOIN</span> sub_products s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.product_id = p.product_id <span class="sql-reserved">AND</span> s.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">9</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">16</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">17</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">20</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">22</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">25</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">26</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts a2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a2.account_id = h.parent_account_id<br/><span class="sql-reserved">JOIN</span> locations l <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_code = h.state_code<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = h.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span></td></tr>
   <tr><td>360</td><td>cron/weekly/smartyants_report.php:118</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_2 <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'order_ids'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> o.order_date) <span class="sql-string">'order_dates'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'product'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">7</span>, <span class="sql-number">1</span>) <span class="sql-string">'RVP'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">4</span>, <span class="sql-number">1</span>) <span class="sql-string">'CIM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">26</span>, <span class="sql-number">1</span>) <span class="sql-string">'RIS'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">27</span>, <span class="sql-number">1</span>) <span class="sql-string">'RM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">6</span>, <span class="sql-number">1</span>) <span class="sql-string">'account_sales_rep'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">25</span>, <span class="sql-number">1</span>) <span class="sql-string">'account_renewal_rep'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_both h<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = h.account_id<br/><span class="sql-reserved">JOIN</span> regions r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_id = h.implementation_region_id<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = h.account_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date) <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">19</span>, <span class="sql-number">50</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> o.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'order_ids'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> o.order_date) <span class="sql-reserved">AS</span> <span class="sql-string">'order_dates'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> pl.product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product_line_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'product'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">7</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RVP'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">4</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'CIM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">26</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RIS'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">27</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'RM'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">6</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'account_sales_rep'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;get_account_user(h.account_id, <span class="sql-number">25</span>, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> <span class="sql-string">'account_renewal_rep'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_both h<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.account_id = h.account_id<br/><span class="sql-reserved">JOIN</span> regions r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.region_id = h.implementation_region_id<br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = h.account_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">19</span>, <span class="sql-number">50</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id</td></tr>
   <tr><td>361</td><td>cron/weekly/smartyants_report.php:138</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_all_licenses <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses &lt;&gt; <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'all_purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_2 h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_all_licenses</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses &lt;&gt; <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'all_purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_2 h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id</td></tr>
   <tr><td>362</td><td>cron/weekly/smartyants_report.php:150</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_final <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.order_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.product,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RVP,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.CIM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RIS,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'unlimited_licenses?'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.all_purchased_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_all_licenses h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">28</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_final</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_tier,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.region_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.order_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.order_dates,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.product,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RVP,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.CIM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RIS,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.RM,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'unlimited_licenses?'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;h.all_purchased_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_all_licenses h<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = h.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">'.SMARTY_ANTS_PROGRAM.'</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">28</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;h.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td></tr>
   <tr><td>363</td><td>cron/weekly/smartyants_report.php:165</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_final_2 <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.<span class="sql-variable">`unlimited_licenses?`</span> = <span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'SA_purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_final f<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = f.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">28</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.sa_00821476_ideal_final_2</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">NULLIF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.<span class="sql-variable">`unlimited_licenses?`</span> = <span class="sql-string">'yes'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'SA_purchased_licenses'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.sa_00821476_ideal_final f<br/><span class="sql-reserved">LEFT JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = f.account_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> order_details d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> <span class="sql-keyword">NOW</span>() <span class="sql-reserved">BETWEEN</span> d.start_date <span class="sql-reserved">AND</span> d.end_date<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = d.product_id <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">'.SMARTY_ANTS_PROGRAM.'</span><br/><span class="sql-reserved">JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sp.product_id = p.product_id <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">28</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;f.account_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;CIM, state, district, account_name</td></tr>
   <tr><td>364</td><td>finance/amortization/wizard/generate/generate_report.inc:49</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span> this_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(oda.period_month) max_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> m.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> has_billing,<br/>o.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization oda<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span> <span class="sql-reserved">AS</span> this_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(oda.period_month) <span class="sql-reserved">AS</span> max_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> m.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> has_billing,<br/>o.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization oda</td></tr>
   <tr><td>365</td><td>finance/amortization/wizard/generate/generate_report.inc:72</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_credits(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(cancel_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date this_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total + c.tax_credit_total <span class="sql-reserved">AS</span> credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(oda.period_month) max_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> has_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(cancels c, orders o)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_amortization oda <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id = oda.cancel_id <span class="sql-reserved">AND</span> c.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = o.order_id <span class="sql-reserved">AND</span> c.cancel_date &lt;= <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_credits(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_date <span class="sql-reserved">AS</span> this_cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.credit_total + c.tax_credit_total <span class="sql-reserved">AS</span> credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.tax_credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_om_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(oda.period_month) <span class="sql-reserved">AS</span> max_period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AS</span> has_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(cancels c, orders o)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_amortization oda <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id = oda.cancel_id <span class="sql-reserved">AND</span> c.order_id = oda.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.order_id = o.order_id <span class="sql-reserved">AND</span> c.cancel_date &lt;= <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.cancel_id</td></tr>
   <tr><td>366</td><td>finance/amortization/wizard/generate/generate_report.inc:87</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_merge(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_orders<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_credits<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_merge(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_orders<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_credits<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>367</td><td>finance/amortization/wizard/generate/generate_report.inc:102</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_user_lock_summary(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uos.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> uos.user_id <span class="sql-reserved">ELSE</span> uoa.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) sales_rep_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uos<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uos.order_id = o.order_id <span class="sql-reserved">AND</span> uos.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uoa<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uoa.order_id = o.order_id <span class="sql-reserved">AND</span> uoa.role_id = <span class="sql-number">31</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_user_lock_summary(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uos.user_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> uos.user_id <span class="sql-reserved">ELSE</span> uoa.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> sales_rep_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uos<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uos.order_id = o.order_id <span class="sql-reserved">AND</span> uos.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uoa<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uoa.order_id = o.order_id <span class="sql-reserved">AND</span> uoa.role_id = <span class="sql-number">31</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>368</td><td>finance/amortization/wizard/generate/generate_report.inc:115</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_column_list_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;list_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.after_prod_total) list_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id = spt.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_column_list_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;list_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.after_prod_total) <span class="sql-reserved">AS</span> list_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.sub_product_type_id = spt.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td></tr>
   <tr><td>369</td><td>finance/amortization/wizard/generate/generate_report.inc:124</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_column_disc_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;discounted_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) discounted_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id = spt.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_column_disc_totals(<br/>&nbsp;&nbsp;&nbsp;&nbsp;discounted_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> discounted_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id = spt.sub_product_type_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td></tr>
   <tr><td>370</td><td>finance/amortization/wizard/generate/generate_report.inc:137</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> comm_override_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) projected_order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> $order_detail_amortization a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.commissions_override_only = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> comm_override_orders(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id <span class="sql-reserved">AS</span> cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;v.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) <span class="sql-reserved">AS</span> projected_order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.v_qc_overrides v<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> $order_detail_amortization a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = v.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.new_total + v.renew_total + os.sales_tax - os.order_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(v.new_total, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(v.renew_total, <span class="sql-number">0</span>) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.commissions_override_only = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> v.year = <span class="sql-keyword">YEAR</span>(o.order_date)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;v.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id</td></tr>
   <tr><td>371</td><td>finance/amortization/wizard/generate/generate_report.inc:153</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_order_type(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> l.is_domestic = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> l.location_code <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Domestic'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'International'</span><br/><span class="sql-keyword">END</span> domestic,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oi.order_date &gt; <span class="sql-string">'2020-01-01'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span> oi.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> oi.opportunity_product_id = <span class="sql-number">3</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> oi.opportunity_product_id<br/><span class="sql-keyword">END</span> program_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oi.order_date &gt; <span class="sql-string">'2020-01-01'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">''</span> <span class="sql-reserved">WHEN</span> onames.opportunity_product_name <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> onames.opportunity_product_id = <span class="sql-number">3</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Literacy'</span> <span class="sql-reserved">ELSE</span> onames.opportunity_product_name<br/><span class="sql-keyword">END</span> program<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders oi<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products onames<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;onames.opportunity_product_id = oi.opportunity_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_order_type(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;domestic <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">13</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> l.is_domestic = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> l.location_code <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Domestic'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'International'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> domestic,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oi.order_date &gt; <span class="sql-string">'2020-01-01'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span> oi.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> oi.opportunity_product_id = <span class="sql-number">3</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> oi.opportunity_product_id<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> program_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> oi.order_date &gt; <span class="sql-string">'2020-01-01'</span> <span class="sql-reserved">THEN</span> <span class="sql-string">''</span> <span class="sql-reserved">WHEN</span> onames.opportunity_product_name <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> onames.opportunity_product_id = <span class="sql-number">3</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Literacy'</span> <span class="sql-reserved">ELSE</span> onames.opportunity_product_name<br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> program<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders oi<br/><span class="sql-reserved">LEFT JOIN</span> interlink.accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.locations l<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'s'</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.opportunity_products onames<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;onames.opportunity_product_id = oi.opportunity_product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oi.order_id</td></tr>
   <tr><td>372</td><td>finance/amortization/wizard/generate/generate_report.inc:172</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_new_renew_percent_unlocked(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.new_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) percent_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.renew_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) percent_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) detail_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) non_recurring_detail_period_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) pd_detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_summary r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = a.sub_product_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_new_renew_percent_unlocked(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.new_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> percent_new,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(r.renew_percent_fin, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> percent_renew,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(a.period_total) <span class="sql-reserved">AS</span> detail_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.recurring_yearly = <span class="sql-string">'N'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> non_recurring_detail_period_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> spt.pd_deliverable = <span class="sql-string">'Y'</span> <span class="sql-reserved">THEN</span> a.period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> pd_detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_summary r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.sub_product_types spt<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id = a.sub_product_type_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id</td></tr>
   <tr><td>373</td><td>finance/amortization/wizard/generate/generate_report.inc:191</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_od_ay_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summer<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nr.line_list_price) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.new_percent <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) new_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.renew_percent <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data nr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> nr.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> comm_override_orders ov <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = od.order_id <span class="sql-reserved">AND</span> ov.cancel_id = od.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides nro<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = nro.order_id <span class="sql-reserved">AND</span> od.order_detail_id = nro.order_detail_id <span class="sql-reserved">AND</span> nro.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> os.new_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.renew_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_od_ay_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summer<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.summer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.new_percent <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> new_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_fees, <span class="sql-number">0</span>) + <span class="sql-keyword">IFNULL</span>(nr.pro_rated_discounts, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.renew_percent <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.academic_years ay<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data nr<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_detail_id = od.order_detail_id <span class="sql-reserved">AND</span> nr.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> comm_override_orders ov <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = od.order_id <span class="sql-reserved">AND</span> ov.cancel_id = od.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides nro<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = nro.order_id <span class="sql-reserved">AND</span> od.order_detail_id = nro.order_detail_id <span class="sql-reserved">AND</span> nro.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> os.new_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.renew_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td></tr>
   <tr><td>374</td><td>finance/amortization/wizard/generate/generate_report.inc:218</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_od_ay_new_renew_period_month(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, period_month)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> tmp_od_ay_new_renew ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id = a.order_id <span class="sql-reserved">AND</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.period_month <span class="sql-reserved">BETWEEN</span> ay.start_date <span class="sql-reserved">AND</span> ay.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_od_ay_new_renew_period_month(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, period_month)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> tmp_od_ay_new_renew ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id = a.order_id <span class="sql-reserved">AND</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.period_month <span class="sql-reserved">BETWEEN</span> ay.start_date <span class="sql-reserved">AND</span> ay.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month</td></tr>
   <tr><td>375</td><td>finance/amortization/wizard/generate/generate_report.inc:230</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_new_renew_percent(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.new_percent <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> ov.new_total /(ov.new_total + ov.renew_total) <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.new_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">WHEN</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> ay.new_total /(ay.new_total + ay.renew_total) <span class="sql-reserved">ELSE</span> os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) percent_new,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.renew_percent <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> ov.renew_total /(ov.new_total + ov.renew_total) <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.renew_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">WHEN</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> ay.renew_total /(ay.new_total + ay.renew_total) <span class="sql-reserved">ELSE</span> os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18</span><br/>),<br/><span class="sql-number">0</span><br/>) percent_renew,<br/><span class="sql-keyword">SUM</span>(a.period_total) detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_od_ay_new_renew_period_month ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id = a.order_id <span class="sql-reserved">AND</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.period_month = ay.period_month<br/><span class="sql-reserved">LEFT JOIN</span> comm_override_orders ov <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = a.order_id <span class="sql-reserved">AND</span> ov.cancel_id = a.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides nro<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = nro.order_id <span class="sql-reserved">AND</span> a.order_detail_id = nro.order_detail_id <span class="sql-reserved">AND</span> nro.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_detail_new_renew_percent(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_new <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percent_renew <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">18</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.new_percent <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> ov.new_total /(ov.new_total + ov.renew_total) <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.new_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">WHEN</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> ay.new_total /(ay.new_total + ay.renew_total) <span class="sql-reserved">ELSE</span> os.new_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> percent_new,<br/><span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> nro.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> nro.renew_percent <span class="sql-reserved">WHEN</span> ov.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> ov.renew_total /(ov.new_total + ov.renew_total) <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">WHEN</span> r.order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.new_total = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.renew_total &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">WHEN</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> ay.renew_total /(ay.new_total + ay.renew_total) <span class="sql-reserved">ELSE</span> os.renew_total /(os.new_total + os.renew_total)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">18</span><br/>),<br/><span class="sql-number">0</span><br/>) <span class="sql-reserved">AS</span> percent_renew,<br/><span class="sql-keyword">SUM</span>(a.period_total) <span class="sql-reserved">AS</span> detail_period_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = a.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_od_ay_new_renew_period_month ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.order_id = a.order_id <span class="sql-reserved">AND</span> a.order_detail_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.period_month = ay.period_month<br/><span class="sql-reserved">LEFT JOIN</span> comm_override_orders ov <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ov.order_id = a.order_id <span class="sql-reserved">AND</span> ov.cancel_id = a.cancel_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides nro<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = nro.order_id <span class="sql-reserved">AND</span> a.order_detail_id = nro.order_detail_id <span class="sql-reserved">AND</span> nro.commissions_override_only = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id</td></tr>
   <tr><td>376</td><td>finance/amortization/wizard/generate/generate_report.inc:260</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) order_total_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total * percent_new),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total * percent_renew),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>) this_year_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_new<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) this_year_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_renew<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) this_year_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) recognized_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_new<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) recognized_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_renew<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) recognized_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_months_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total * percent_new <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_months_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total * percent_renew <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_months_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_years_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total * percent_new <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_years_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total * percent_renew <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) future_years_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> amortization.order_detail_new_renew_percent r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id <span class="sql-reserved">AND</span> a.cancel_id = r.cancel_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_total_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years_renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> order_total_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total * percent_new),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total * percent_renew),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> this_year_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_new<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> this_year_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &lt;&gt; $report_year <span class="sql-reserved">OR</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_renew<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> this_year_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> recognized_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_new<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> recognized_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">0</span> <span class="sql-reserved">ELSE</span> period_total * percent_renew<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> recognized_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_months_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total * percent_new <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_months_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) = $report_year <span class="sql-reserved">AND</span> a.period_month &gt; <span class="sql-string">'$report_end_date'</span> <span class="sql-reserved">THEN</span> period_total * percent_renew <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_months_renew_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_years_total_amount,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total * percent_new <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_years_new_total,<br/><span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(a.period_month) &gt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">THEN</span> period_total * percent_renew <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>),<br/><span class="sql-number">2</span><br/>) <span class="sql-reserved">AS</span> future_years_renew_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock a<br/><span class="sql-reserved">INNER JOIN</span> amortization.order_detail_new_renew_percent r<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_detail_id = r.order_detail_id <span class="sql-reserved">AND</span> a.order_id = r.order_id <span class="sql-reserved">AND</span> a.cancel_id = r.cancel_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id</td></tr>
   <tr><td>377</td><td>finance/amortization/wizard/generate/generate_report.inc:302</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_prev_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> prev_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &lt; <span class="sql-string">'$report_year'</span> <span class="sql-reserved">OR</span> period_month = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>378</td><td>finance/amortization/wizard/generate/generate_report.inc:312</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_this_year_sum(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_this_year_sum(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>379</td><td>finance/amortization/wizard/generate/generate_report.inc:323</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_this_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;this_year_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization_column_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;spt.amortization_column_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> this_year_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$data_db.sub_product_types spt<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sub_product_type_id = spt.sub_product_type_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span> <span class="sql-reserved">AND</span> period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">3</span></td></tr>
   <tr><td>380</td><td>finance/amortization/wizard/generate/generate_report.inc:344</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $column_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $column_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>381</td><td>finance/amortization/wizard/generate/generate_report.inc:403</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_future(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) future_months,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &gt; <span class="sql-string">'$report_year'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) future_years<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_future(<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_months <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_years <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) = <span class="sql-string">'$report_year'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> future_months,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(period_month) &gt; <span class="sql-string">'$report_year'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> future_years<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month &gt; <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>382</td><td>finance/amortization/wizard/generate/generate_report.inc:417</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_recognized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) recognized_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_recognized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) <span class="sql-reserved">AS</span> recognized_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month &lt;= <span class="sql-string">'$report_end_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td></tr>
   <tr><td>383</td><td>finance/amortization/wizard/generate/generate_report.inc:427</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_billing(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;prior_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing + month_billing prior_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing + month_billing + future_billing total_billing<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing.billing_monthly b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = b.order_id <span class="sql-reserved">AND</span> month_date = <span class="sql-string">'$report_start_month'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_billing(<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;prior_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_billing <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;future_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;month_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing + month_billing <span class="sql-reserved">AS</span> prior_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;past_billing + month_billing + future_billing <span class="sql-reserved">AS</span> total_billing<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.billing_monthly b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = b.order_id <span class="sql-reserved">AND</span> month_date = <span class="sql-string">'$report_start_month'</span></td></tr>
   <tr><td>384</td><td>finance/amortization/wizard/generate/generate_report.inc:446</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_billing_credits(<br/>&nbsp;&nbsp;&nbsp;&nbsp;billed_credit <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;not_billed_credit <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.credit_total - o.tax_credit_total credit_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(total_billing, <span class="sql-number">0</span>) billed_credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.credit_total - o.tax_credit_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) + <span class="sql-keyword">IFNULL</span>(total_billing, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> not_billed_credit<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amort_merge o<br/><span class="sql-reserved">LEFT JOIN</span> amort_billing m <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = m.order_id <span class="sql-reserved">AND</span> o.cancel_id = m.cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span> o.cancel_id &lt;&gt; <span class="sql-number">0</span> $deferred_where <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(total_billing, <span class="sql-number">0</span>) &lt;&gt; credit_total * <span class="sql-number">-1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> amort_billing_credits(<br/>&nbsp;&nbsp;&nbsp;&nbsp;billed_credit <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;not_billed_credit <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>385</td><td>finance/amortization/wizard/generate/generate_report.inc:465</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> next_year_revenue(<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_year_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(period_total),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">2</span>) next_year_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_detail_amortization<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">',$next_month)."'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DATE_ADD</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INTERVAL</span> <span class="sql-number">1</span> <span class="sql-keyword">YEAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> next_year_revenue(<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_year_revenue <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>, <span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>386</td><td>finance/amortization/wizard/generate/generate_report.inc:481</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> ytd_sales(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;$order_date order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>($order_date) = $report_year <span class="sql-reserved">AND</span> $order_date &lt;= <span class="sql-string">'$report_end_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) sold_ytd</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> ytd_sales(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>387</td><td>finance/amortization/wizard/generate/generate_report.inc:503</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> future_month_years_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.cancel_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> future_month_years_new_renew(<br/>&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_TYPE_STR <span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>388</td><td>finance/amortization/wizard/generate/generate_report.inc:916</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $defer_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-keyword">ROW_FORMAT</span> = <span class="sql-keyword">DYNAMIC</span> <span class="sql-keyword">ENGINE</span> = InnoDB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;State state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;District district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;School school,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Bill To`</span> billto,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Order Date`</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Start Date`</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`End Date`</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Order Total`</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Orig Order Total`</span> orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Cancel cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Credit credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Recognized Revenue`</span> recognized_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>) next_year_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Prev Billing`</span> + <span class="sql-variable">`This Month Billing`</span> <span class="sql-string">'billed_to_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Prev Billed Tax`</span> + <span class="sql-variable">`This Month Billed Tax`</span> tax_billed_to_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Future Billing`</span> future_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Deferred Revenue`</span> deferred_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>) &gt; <span class="sql-variable">`Deferred Revenue`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Deferred Revenue`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) deferred_short_term_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$table_name r<br/><span class="sql-reserved">LEFT JOIN</span> next_year_revenue s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = s.order_id <span class="sql-reserved">AND</span> r.cancel_id = s.cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-variable">`Deferred Revenue`</span>) &lt;&gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $defer_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id, cancel_id)<br/>) <span class="sql-keyword">ROW_FORMAT</span> = <span class="sql-keyword">DYNAMIC</span> <span class="sql-keyword">ENGINE</span> = InnoDB</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;State <span class="sql-reserved">AS</span> state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;District <span class="sql-reserved">AS</span> district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;School <span class="sql-reserved">AS</span> school,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Bill To`</span> <span class="sql-reserved">AS</span> billto,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Order Date`</span> <span class="sql-reserved">AS</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Start Date`</span> <span class="sql-reserved">AS</span> start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`End Date`</span> <span class="sql-reserved">AS</span> end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Order Total`</span> <span class="sql-reserved">AS</span> order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Orig Order Total`</span> <span class="sql-reserved">AS</span> orig_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Cancel <span class="sql-reserved">AS</span> cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Credit <span class="sql-reserved">AS</span> credit,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Recognized Revenue`</span> <span class="sql-reserved">AS</span> recognized_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>) <span class="sql-reserved">AS</span> next_year_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Prev Billing`</span> + <span class="sql-variable">`This Month Billing`</span> <span class="sql-reserved">AS</span> <span class="sql-string">'billed_to_date'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Prev Billed Tax`</span> + <span class="sql-variable">`This Month Billed Tax`</span> <span class="sql-reserved">AS</span> tax_billed_to_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Future Billing`</span> <span class="sql-reserved">AS</span> future_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Deferred Revenue`</span> <span class="sql-reserved">AS</span> deferred_revenue,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>) &gt; <span class="sql-variable">`Deferred Revenue`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`Deferred Revenue`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(next_year_revenue, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> deferred_short_term_revenue<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$table_name r<br/><span class="sql-reserved">LEFT JOIN</span> next_year_revenue s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = s.order_id <span class="sql-reserved">AND</span> r.cancel_id = s.cancel_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-variable">`Deferred Revenue`</span>) &lt;&gt; <span class="sql-number">0</span></td></tr>
   <tr><td>389</td><td>finance/amortization/wizard/generate/generate_report.inc:948</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span></td></tr>
   <tr><td>390</td><td>finance/amortization/wizard/generate/generate_report.inc:967</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id, order_date)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span> <span class="sql-comment">#between -1 and 1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id, order_date)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span></td></tr>
   <tr><td>391</td><td>finance/amortization/wizard/generate/generate_report.inc:987</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span> <span class="sql-comment">#between -1 and 1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span></td></tr>
   <tr><td>392</td><td>finance/amortization/wizard/generate/generate_report.inc:1006</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id, <span class="sql-keyword">YEAR</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(order_date) <span class="sql-keyword">YEAR</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(order_date)<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span> <span class="sql-comment">#between -1 and 1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> defer_delete(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(billing_account_id, <span class="sql-keyword">YEAR</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(order_date) <span class="sql-reserved">AS</span> <span class="sql-keyword">YEAR</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$defer_table_name<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">2517</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(order_date)<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(deferred_revenue)) = <span class="sql-number">0</span></td></tr>
   <tr><td>393</td><td>finance/amortization/wizard/generate/generate_report.inc:1186</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_revenue_generate_csv <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$table_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_revenue_generate_csv</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$table_name</td></tr>
   <tr><td>394</td><td>reports/commissions/combined/bulk_generate/index.php:41</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $bckup_payroll_lock_table_name <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.payroll_lock_staging pls<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pls.cmonth = <span class="sql-string">'$commissions_month'</span> <span class="sql-reserved">AND</span> pls.payroll_date = <span class="sql-string">'$payroll_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $bckup_payroll_lock_table_name</td><td style="border-bottom: solid 1px black;">cmonth<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payroll_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;comp_plan_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rate_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rate_type_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;rate <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;percentage <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payment_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payroll_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;display <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.payroll_lock_staging pls<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pls.cmonth = <span class="sql-string">'$commissions_month'</span> <span class="sql-reserved">AND</span> pls.payroll_date = <span class="sql-string">'$payroll_date'</span></td></tr>
   <tr><td>395</td><td>reports/commissions/combined/bulk_generate/index.php:53</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $bckup_payroll_details_lock_table_name <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.payroll_lock_details_staging<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$commissions_month'</span> <span class="sql-reserved">AND</span> payroll_date = <span class="sql-string">'$payroll_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $bckup_payroll_details_lock_table_name</td><td style="border-bottom: solid 1px black;">cmonth<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payroll_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_invc_trans_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cust_commissionable_paid <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;due_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;prior_paid_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;payroll_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.payroll_lock_details_staging<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$commissions_month'</span> <span class="sql-reserved">AND</span> payroll_date = <span class="sql-string">'$payroll_date'</span></td></tr>
   <tr><td>396</td><td>reports/sales/sales_activity_history_index.php:70</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_events_table <span class="sql-reserved">AS</span> <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$report_tmp_table</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $tmp_events_table</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$report_tmp_table</td></tr>
   <tr><td>397</td><td>cron/ns_sync/accounts_sync.php:202</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(first_name, <span class="sql-string">' '</span>, last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_accounts s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = s.account_id <span class="sql-reserved">AND</span> a.user_id = u.user_id <span class="sql-reserved">AND</span> role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">101</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(first_name, <span class="sql-string">' '</span>, last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_accounts s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = s.account_id <span class="sql-reserved">AND</span> a.user_id = u.user_id <span class="sql-reserved">AND</span> role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td></tr>
   <tr><td>398</td><td>cron/ns_sync/accounts_sync.php:210</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_addresses(<span class="sql-reserved">INDEX</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;city,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;zip,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name country<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_address aa,<br/>&nbsp;&nbsp;&nbsp;&nbsp;locations l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = aa.account_id <span class="sql-reserved">AND</span> aa.country_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'C'</span> <span class="sql-reserved">AND</span> aa.address_type = <span class="sql-string">'M'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_addresses(<span class="sql-reserved">INDEX</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;address_type <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;address <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">255</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;address2 <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">255</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;city <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">255</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;zip <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;country <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address,<br/>&nbsp;&nbsp;&nbsp;&nbsp;address2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;city,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;zip,<br/>&nbsp;&nbsp;&nbsp;&nbsp;l.location_name <span class="sql-reserved">AS</span> country<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_address aa,<br/>&nbsp;&nbsp;&nbsp;&nbsp;locations l<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = aa.account_id <span class="sql-reserved">AND</span> aa.country_code = l.location_code <span class="sql-reserved">AND</span> l.location_type = <span class="sql-string">'C'</span> <span class="sql-reserved">AND</span> aa.address_type = <span class="sql-string">'M'</span></td></tr>
   <tr><td>399</td><td>cron/summary/populate_tables.inc:89</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_pending_order_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_pd_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pending = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_pending_order_details(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_pd_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pending = <span class="sql-number">1</span></td></tr>
   <tr><td>400</td><td>cron/summary/populate_tables.inc:105</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_orders_all(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*o.start_date, o.end_date,*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(od.start_date) start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(od.end_date) end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-string">" . ($refresh_orders ? "</span> <span class="sql-reserved">AND</span> o.order_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $refresh_orders) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "") . "</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_orders_all(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>401</td><td>cron/summary/populate_tables.inc:128</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_details_all(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.post_end = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.post_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.link_order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_details_all(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quantity <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;post_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;link_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.quantity,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.post_end = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.post_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.link_order_detail_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span></td></tr>
   <tr><td>402</td><td>cron/summary/populate_tables.inc:192</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_Id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) placeholder<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> o.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_Id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;placeholder <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.start_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_start<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(o.end_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'-'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.school_end<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> placeholder<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> o.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td></tr>
   <tr><td>403</td><td>cron/summary/populate_tables.inc:210</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_info_tmp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_account_info s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_info_tmp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">parent_account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_account_info s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.parent_account_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>404</td><td>cron/summary/populate_tables.inc:238</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id purchasing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date detail_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.link_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10000</span> student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> total_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_initial_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_followup_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*1000.0 fulfilled_initial_pd, 1000.0 fulfilled_followup_pd, */</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> fulfilled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> fulfilled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> expired_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*1000.0 scheduled_initial_pd, 1000.0 scheduled_followup_pd, */</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> days_removed,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> reallocated,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id origin_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND d.product_id = s.product_id</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchasing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;post_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;link_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">BIGINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_purchased_pd <span class="sql-reserved">BIGINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_followup_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;days_removed <span class="sql-reserved">BIGINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;origin_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id <span class="sql-reserved">AS</span> purchasing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date <span class="sql-reserved">AS</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date <span class="sql-reserved">AS</span> order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date <span class="sql-reserved">AS</span> order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date <span class="sql-reserved">AS</span> detail_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.end_date <span class="sql-reserved">AS</span> detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.post_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.link_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10000</span> <span class="sql-reserved">AS</span> student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> <span class="sql-reserved">AS</span> total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> <span class="sql-reserved">AS</span> total_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_initial_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_followup_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> fulfilled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> fulfilled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> expired_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000.0</span> <span class="sql-reserved">AS</span> scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1000</span> <span class="sql-reserved">AS</span> days_removed,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> reallocated,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id <span class="sql-reserved">AS</span> origin_order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-comment">#AND d.product_id = s.product_id</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id</td></tr>
   <tr><td>405</td><td>cron/summary/populate_tables.inc:300</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_student_licenses_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(p.student_licenses * od.quantity) student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_id = s.product_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%BIO%'</span> <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">6889</span>, <span class="sql-number">6892</span>, <span class="sql-number">6890</span>, <span class="sql-number">7761</span>) <span class="sql-comment"># solutions products that should be excluded</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> s.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">22</span>, <span class="sql-number">25</span>, <span class="sql-number">28</span>) <span class="sql-reserved">AND</span> s.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.sub_product_type_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_student_licenses_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">36</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses * od.quantity<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products s<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_id = s.product_id <span class="sql-reserved">AND</span> p.sku <span class="sql-reserved">NOT</span> <span class="sql-reserved">LIKE</span> <span class="sql-string">'%BIO%'</span> <span class="sql-reserved">AND</span> p.product_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">6889</span>, <span class="sql-number">6892</span>, <span class="sql-number">6890</span>, <span class="sql-number">7761</span>) <span class="sql-comment"># solutions products that should be excluded</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> s.sub_product_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">22</span>, <span class="sql-number">25</span>, <span class="sql-number">28</span>) <span class="sql-reserved">AND</span> s.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.sub_product_type_id</td></tr>
   <tr><td>406</td><td>cron/summary/populate_tables.inc:316</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_student_licenses(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_student_licenses_pre<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_student_licenses(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> student_licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_student_licenses_pre<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id</td></tr>
   <tr><td>407</td><td>cron/summary/populate_tables.inc:358</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_pd_info(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> trainer training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_initial_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_followup_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all od<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products_use odspu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = odspu.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products odsp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odspu.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> sub_product_types spt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_pd_info(<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>408</td><td>cron/summary/populate_tables.inc:425</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_reallocation_sum(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, online)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_detail_id order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(quantity) total_trainings<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_reallocation_sum(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_detail_id, online)<br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">26</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_detail_id <span class="sql-reserved">AS</span> order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(quantity) <span class="sql-reserved">AS</span> total_trainings<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;online</td></tr>
   <tr><td>409</td><td>cron/summary/populate_tables.inc:527</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(a.is_primary) is_primary,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_day,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.pd_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.total_attendees total_contacts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> u.user_id) total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0000</span> total_overall_attendees,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'C'</span> training_type<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">EVENTS</span> e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_users u<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = a.event_id <span class="sql-reserved">AND</span> e.event_id = u.event_id <span class="sql-reserved">AND</span> e.event_type_id = <span class="sql-string">'".$EVENTS["training"]."'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND e.event_status != 'X'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . ($refresh_orders ? "</span> <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $refresh_orders) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "") . "</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>410</td><td>cron/summary/populate_tables.inc:553</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_all_attendees(<span class="sql-reserved">PRIMARY KEY</span>(event_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_contacts) total_attendees<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_all_attendees(<span class="sql-reserved">PRIMARY KEY</span>(event_id))</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_attendees <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_contacts) <span class="sql-reserved">AS</span> total_attendees<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id</td></tr>
   <tr><td>411</td><td>cron/summary/populate_tables.inc:586</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info_school(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info_school(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id)<br/>)</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_primary <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_contacts <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_overall_attendees <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span></td></tr>
   <tr><td>412</td><td>cron/summary/populate_tables.inc:611</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_min_order_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.order_date) order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.start_date) order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(o.end_date) order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.start_date) detail_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.end_date) detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.post_end) post_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>) <span class="sql-reserved">AND</span> o.start_date &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.start_date &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_min_order_dates(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;post_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.order_date) <span class="sql-reserved">AS</span> order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.start_date) <span class="sql-reserved">AS</span> order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(o.end_date) <span class="sql-reserved">AS</span> order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.start_date) <span class="sql-reserved">AS</span> detail_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.end_date) <span class="sql-reserved">AS</span> detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(d.post_end) <span class="sql-reserved">AS</span> post_end<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>) <span class="sql-reserved">AND</span> o.start_date &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.start_date &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>413</td><td>cron/summary/populate_tables.inc:638</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_trainings - days_removed) total_trainings<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_trainings - days_removed) <span class="sql-reserved">AS</span> total_trainings<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>414</td><td>cron/summary/populate_tables.inc:659</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(e.total_trainers) total_fulfilled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.account_id = o.account_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> o.account_level != <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">43</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(e.total_trainers) <span class="sql-reserved">AS</span> total_fulfilled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.account_id = o.account_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> o.account_level != <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online</td></tr>
   <tr><td>415</td><td>cron/summary/populate_tables.inc:678</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span> e.account_level = o.account_level <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span> e.account_level = o.account_level <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span></td></tr>
   <tr><td>416</td><td>cron/summary/populate_tables.inc:727</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_closed(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status = <span class="sql-string">'S'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(closed_amount - we_care_amount),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_satisfied,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status &lt;&gt; <span class="sql-string">'S'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closed_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(closed_amount - we_care_amount),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_satisfied_onsite,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status &lt;&gt; <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closed_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_fulfilled_onsite,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(closed_amount - we_care_amount),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_satisfied_online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deliver_status &lt;&gt; <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closed_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_fulfilled_online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;closed_deliverables<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>) <span class="sql-reserved">AND</span> sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" . ($refresh_orders ? "</span> <span class="sql-reserved">AND</span> order_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">",$refresh_orders) ."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "") . "</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_closed(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>417</td><td>cron/summary/populate_tables.inc:762</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info_shared(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(shared_event_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_event_info_shared(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(event_id, account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(shared_event_id)<br/>)</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_primary <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pd_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_contacts <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_overall_attendees <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day = <span class="sql-number">1</span></td></tr>
   <tr><td>418</td><td>cron/summary/populate_tables.inc:771</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_incomplete_reallocated_shared_wcd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id orig_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id orig_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.shared_event_id = e.event_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.account_id &lt;&gt; o.account_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND e.event_date &gt;= '$run_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> e.shared_day = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> e.pd_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care initial"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care followup"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span> <span class="sql-reserved">AND</span> o.reallocated = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_incomplete_reallocated_shared_wcd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;orig_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id <span class="sql-reserved">AS</span> orig_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id <span class="sql-reserved">AS</span> orig_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.shared_event_id = e.event_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.account_id &lt;&gt; o.account_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-comment">#AND e.event_date &gt;= '$run_date'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> e.shared_day = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> e.pd_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care initial"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care followup"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span> <span class="sql-reserved">AND</span> o.reallocated = <span class="sql-number">0</span></td></tr>
   <tr><td>419</td><td>cron/summary/populate_tables.inc:824</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_incomplete_past_shared_wcd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_incomplete_reallocated_shared_wcd r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(r.event_id = e.event_id)<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.shared_event_id = e.event_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.account_id = o.account_id <span class="sql-reserved">OR</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.academic_year_id &lt; <span class="sql-number">27</span> <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.shared_day = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> e.pd_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care initial"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care followup"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> r.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_incomplete_past_shared_wcd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span><br/>)</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_incomplete_reallocated_shared_wcd r <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.event_id = e.event_id<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.shared_event_id = e.event_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.account_id = o.account_id <span class="sql-reserved">OR</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.academic_year_id &lt; <span class="sql-number">27</span> <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.shared_day = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> s.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> e.pd_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care initial"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PD_TYPES["we care followup"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> r.event_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td></tr>
   <tr><td>420</td><td>cron/summary/populate_tables.inc:858</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_fulfilled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_fulfilled) total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_pd) expired_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_fulfilled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_fulfilled) <span class="sql-reserved">AS</span> total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_pd) <span class="sql-reserved">AS</span> expired_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td></tr>
   <tr><td>421</td><td>cron/summary/populate_tables.inc:881</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchasing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;post_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;link_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">INT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_purchased_pd <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_followup_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;days_removed <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;origin_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info</td></tr>
   <tr><td>422</td><td>cron/summary/populate_tables.inc:888</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.shared_event_id = s.event_id <span class="sql-reserved">AND</span> s.is_primary = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_order_detail_info2 o2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o2.order_detail_id <span class="sql-reserved">AND</span> s.account_id = o2.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.account_id = o.account_id <span class="sql-reserved">AND</span> o2.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> s.account_id = o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-reserved">PRIMARY KEY</span> <span class="sql-keyword">AUTO_INCREMENT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;online<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_event_info_shared s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_event_id = s.event_id <span class="sql-reserved">AND</span> s.is_primary = <span class="sql-number">1</span><br/><span class="sql-reserved">LEFT JOIN</span> summary_order_detail_info2 o2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o2.order_detail_id <span class="sql-reserved">AND</span> s.account_id = o2.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.account_id = o.account_id <span class="sql-reserved">AND</span> o2.order_detail_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> s.account_id = o.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online</td></tr>
   <tr><td>423</td><td>cron/summary/populate_tables.inc:904</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_day,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span> o.account_level = e.account_level <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_day,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id <span class="sql-reserved">AND</span> e.academic_year_id = o.academic_year_id <span class="sql-reserved">AND</span> o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span> <span class="sql-reserved">AND</span> o.account_level = e.account_level <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span></td></tr>
   <tr><td>424</td><td>cron/summary/populate_tables.inc:952</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_scheduled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_scheduled) total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_scheduled(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_scheduled) <span class="sql-reserved">AS</span> total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td></tr>
   <tr><td>425</td><td>cron/summary/populate_tables.inc:973</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_district_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings - o.total_fulfilled - o.days_removed<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_initial_pd + o.total_followup_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - o.fulfilled_onsite_pd - o.days_removed<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_initial_online_pd + o.total_online_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - o.fulfilled_online_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_trainings) total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_fulfilled) total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.fulfilled_onsite_pd) fulfilled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.fulfilled_online_pd) fulfilled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_scheduled) total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.scheduled_onsite_pd) scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.scheduled_online_pd) scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_pd) expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_onsite_pd) expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_online_pd) expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_district_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">37</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_onsite_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">36</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">31</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">33</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings - o.total_fulfilled - o.days_removed<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_initial_pd + o.total_followup_pd - o.fulfilled_onsite_pd - o.days_removed<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.total_initial_online_pd + o.total_online_pd - o.fulfilled_online_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_trainings) <span class="sql-reserved">AS</span> total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_fulfilled) <span class="sql-reserved">AS</span> total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.fulfilled_onsite_pd) <span class="sql-reserved">AS</span> fulfilled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.fulfilled_online_pd) <span class="sql-reserved">AS</span> fulfilled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.total_scheduled) <span class="sql-reserved">AS</span> total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.scheduled_onsite_pd) <span class="sql-reserved">AS</span> scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.scheduled_online_pd) <span class="sql-reserved">AS</span> scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_pd) <span class="sql-reserved">AS</span> expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_onsite_pd) <span class="sql-reserved">AS</span> expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(o.expired_online_pd) <span class="sql-reserved">AS</span> expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id</td></tr>
   <tr><td>426</td><td>cron/summary/populate_tables.inc:1012</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id owning_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_district_centralized o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = d.order_id) <span class="sql-reserved">AND</span> o.account_id != d.account_id <span class="sql-reserved">AND</span> d.account_level = <span class="sql-string">'2'</span> <span class="sql-reserved">AND</span> o.academic_year_id = d.academic_year_id<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id owning_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_district_centralized2 o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all2 d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_order_detail_info e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = e.expansion_order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(e.order_id = d.order_id) <span class="sql-reserved">AND</span> o.account_id != d.account_id <span class="sql-reserved">AND</span> d.account_level = <span class="sql-string">'2'</span> <span class="sql-reserved">AND</span> o.academic_year_id = d.academic_year_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;owning_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">37</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_onsite_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">36</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">31</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">33</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">29</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id <span class="sql-reserved">AS</span> owning_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_district_centralized o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> o.account_id != d.account_id <span class="sql-reserved">AND</span> d.account_level = <span class="sql-string">'2'</span> <span class="sql-reserved">AND</span> o.academic_year_id = d.academic_year_id<br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id <span class="sql-reserved">AS</span> owning_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_district_centralized2 o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all2 d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_order_detail_info e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = e.expansion_order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id = d.order_id <span class="sql-reserved">AND</span> o.account_id != d.account_id <span class="sql-reserved">AND</span> d.account_level = <span class="sql-string">'2'</span> <span class="sql-reserved">AND</span> o.academic_year_id = d.academic_year_id</td></tr>
   <tr><td>427</td><td>cron/summary/populate_tables.inc:1061</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info_expansion(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(expansion_order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id &gt; <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_info_expansion(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(expansion_order_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchasing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;post_end <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;link_order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">INT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_purchased_pd <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_followup_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_onsite_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">7</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;days_removed <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;origin_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id &gt; <span class="sql-number">0</span></td></tr>
   <tr><td>428</td><td>cron/summary/populate_tables.inc:1086</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_child_account_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.account_id owning_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_onsite_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_online_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.scheduled_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.scheduled_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.expired_onsite_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.expired_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_district_centralized i,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . ($refresh_orders ? "</span> orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d <span class="sql-string">" : "</span> summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d <span class="sql-string">") . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> summary_account_centralized c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = c.account_id <span class="sql-reserved">AND</span> i.order_id = c.order_id <span class="sql-reserved">AND</span> i.order_detail_id = c.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.account_id = a.parent_account_id <span class="sql-reserved">AND</span> a.account_id = d.account_id <span class="sql-reserved">AND</span> d.order_id = o.order_id <span class="sql-reserved">AND</span> i.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> c.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-string">" . ($refresh_orders ? "</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.academic_year_id &gt; <span class="sql-number">0</span> <span class="sql-string">" : "")</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_child_account_centralized(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>429</td><td>cron/summary/populate_tables.inc:1117</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_centralized) total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_scheduled) total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_account_centralized<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized2(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">59</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">51</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_centralized) <span class="sql-reserved">AS</span> total_centralized,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_scheduled) <span class="sql-reserved">AS</span> total_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_account_centralized<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>430</td><td>cron/summary/populate_tables.inc:1137</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_dedicated_events(<span class="sql-reserved">PRIMARY KEY</span>(event_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) total_accounts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) &lt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(e.total_contacts) &lt;= <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(o.account_level) != <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_dedicated_events(<span class="sql-reserved">PRIMARY KEY</span>(event_id))</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_accounts <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) <span class="sql-reserved">AS</span> total_accounts<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_info o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_detail_id = o.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) &lt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> e.account_id) = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(e.total_contacts) &lt;= <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">MIN</span>(o.account_level) != <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>431</td><td>cron/summary/populate_tables.inc:1162</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_dedicated_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> event_id) total_dedicated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type = <span class="sql-string">'D'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'C'</span>, <span class="sql-string">'S'</span>) <span class="sql-reserved">OR</span> total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_dedicated_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_dedicated <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> event_id) <span class="sql-reserved">AS</span> total_dedicated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type = <span class="sql-string">'D'</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'C'</span>, <span class="sql-string">'S'</span>) <span class="sql-reserved">OR</span> total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>432</td><td>cron/summary/populate_tables.inc:1185</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> event_id) total_centralized<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type <span class="sql-reserved">IN</span>(<span class="sql-string">'C'</span>) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> event_date &lt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_centralized_pd(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> event_id) <span class="sql-reserved">AS</span> total_centralized<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_type <span class="sql-reserved">IN</span>(<span class="sql-string">'C'</span>) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> event_date &lt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>433</td><td>cron/summary/populate_tables.inc:1207</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_last_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(e.event_date) event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.event_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.user_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(e.event_date) first_training<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = u.event_id <span class="sql-reserved">AND</span> e.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_last_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">16</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;first_training <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(e.event_date) <span class="sql-reserved">AS</span> event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.event_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.user_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(e.event_date) <span class="sql-reserved">AS</span> first_training<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = u.event_id <span class="sql-reserved">AND</span> e.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>) <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id</td></tr>
   <tr><td>434</td><td>cron/summary/populate_tables.inc:1239</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_next_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(e.event_date) event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.user_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = u.event_id <span class="sql-reserved">AND</span> e.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>) <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_next_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">16</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(e.event_date) <span class="sql-reserved">AS</span> event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.event_date, <span class="sql-string">'|'</span>, u.user_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e,<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_users u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = u.event_id <span class="sql-reserved">AND</span> e.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>) <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.academic_year_id</td></tr>
   <tr><td>435</td><td>cron/summary/populate_tables.inc:1265</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_data_setup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(date_entered) last_data_upload,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(date_entered, <span class="sql-string">'|'</span>, data_status)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) data_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) last_uploaded_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_students) total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_teachers) total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(student_ids) student_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;data_setup<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_data_setup(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_data_upload <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;data_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_uploaded_students <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_students <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_teachers <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">28</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_ids <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(date_entered) <span class="sql-reserved">AS</span> last_data_upload,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(date_entered, <span class="sql-string">'|'</span>, data_status)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> data_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> last_uploaded_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_students) <span class="sql-reserved">AS</span> total_students,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_teachers) <span class="sql-reserved">AS</span> total_teachers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(student_ids) <span class="sql-reserved">AS</span> student_ids<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;data_setup<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id</td></tr>
   <tr><td>436</td><td>cron/summary/populate_tables.inc:1297</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_low_usage(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> low_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;week_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $four_week_start)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">AVG</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mc_students / associated_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">.05</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COUNT</span>(week_date) = <span class="sql-number">4</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_low_usage(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;low_usage <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AS</span> low_usage<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_usage u<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;week_date <span class="sql-reserved">BETWEEN</span> <span class="sql-string">'".date("Y-m-d", $four_week_start)."'</span> <span class="sql-reserved">AND</span> <span class="sql-string">'$run_date'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">AVG</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mc_students / associated_students<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">.05</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COUNT</span>(week_date) = <span class="sql-number">4</span></td></tr>
   <tr><td>437</td><td>cron/summary/populate_tables.inc:1310</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, customer_since)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.start_date) customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = a.account_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span> <span class="sql-reserved">OR</span> a.parent_account_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> d.academic_year_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, customer_since)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_since <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.start_date) <span class="sql-reserved">AS</span> customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = a.account_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["school"]."'</span> <span class="sql-reserved">OR</span> a.parent_account_id &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> d.academic_year_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id</td></tr>
   <tr><td>438</td><td>cron/summary/populate_tables.inc:1350</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, customer_since)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.start_date) customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = a.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, customer_since)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_since <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(o.start_date) <span class="sql-reserved">AS</span> customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = a.account_id <span class="sql-reserved">AND</span> a.account_level = <span class="sql-string">'".$ACCOUNT_LEVEL["district"]."'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id</td></tr>
   <tr><td>439</td><td>cron/summary/populate_tables.inc:1383</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_children(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(customer_since) customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_since<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_children(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_since <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(customer_since) <span class="sql-reserved">AS</span> customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_since<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>440</td><td>cron/summary/populate_tables.inc:1414</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_all(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-keyword">ENGINE</span> = InnoDB <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(customer_since) customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_since<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_since_all(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-keyword">ENGINE</span> = InnoDB</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_since <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(customer_since) <span class="sql-reserved">AS</span> customer_since<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_since<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>441</td><td>cron/summary/populate_tables.inc:1459</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_training_request_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.deferral,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_requests t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;training_request_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.training_request_id = d.training_request_id <span class="sql-reserved">AND</span> t.event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> t.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">".implode("</span>, <span class="sql-string">", $academic_years)."</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_training_request_info(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;contact_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;deferral <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;end_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.contact_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.deferral,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.end_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> end_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;training_requests t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;training_request_dates d<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.training_request_id = d.training_request_id <span class="sql-reserved">AND</span> t.event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> t.academic_year_id <span class="sql-reserved">IN</span>(<span class="sql-string">'.implode('</span>, <span class="sql-string">', $academic_years).'</span>)</td></tr>
   <tr><td>442</td><td>cron/summary/populate_tables.inc:1477</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_deferred_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) start_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_training_request_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date &gt;= <span class="sql-keyword">CURDATE</span>()<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id, academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<span class="sql-keyword">CONCAT</span>(start_date, <span class="sql-string">'|'</span>, deferral)),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_deferred_trainings(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(start_date) <span class="sql-reserved">AS</span> start_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_training_request_info<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;start_date &gt;= <span class="sql-keyword">CURDATE</span>()<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id, academic_year_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(start_date, <span class="sql-string">'|'</span>, deferral)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) = <span class="sql-number">1</span></td></tr>
   <tr><td>443</td><td>cron/summary/populate_tables.inc:1753</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_status_pre(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.status_rank) status_rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.status_rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.customer_status<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) customer_status<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_status c<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.parent_account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id <span class="sql-reserved">IN</span>(b.account_id, a.account_id)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_customer_status_pre(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;status_rank <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">34</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id <span class="sql-reserved">AS</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(c.status_rank) <span class="sql-reserved">AS</span> status_rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.status_rank,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.customer_status<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> customer_status<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_customer_status c<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.parent_account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.account_id <span class="sql-reserved">IN</span>(b.account_id, a.account_id)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id</td></tr>
   <tr><td>444</td><td>cron/summary/populate_tables.inc:1776</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_summer_dates_extended,<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_acv<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;annual_retention_metric_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span> &gt;=(<span class="sql-keyword">YEAR</span>(<span class="sql-keyword">NOW</span>()) - <span class="sql-number">1</span>) <span class="sql-reserved">AND</span> report_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">2</span>) <span class="sql-reserved">AND</span> current_acv <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_account_acv(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span> <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_type_id <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_summer_dates_extended <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;report_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_summer_dates_extended,<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_acv<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;annual_retention_metric_summary<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span> &gt;= <span class="sql-keyword">YEAR</span>(<span class="sql-keyword">NOW</span>()) - <span class="sql-number">1</span> <span class="sql-reserved">AND</span> report_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">2</span>) <span class="sql-reserved">AND</span> current_acv <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span></td></tr>
   <tr><td>445</td><td>cron/summary/populate_tables.inc:1895</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, ay_year),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(od.start_date, od.date_entered)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date) ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">STRAIGHT_JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">USING</span>(account_id)<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">CURDATE</span>() &gt;= ay.start_date</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_details(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, ay_year),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(od.start_date, od.date_entered)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(ay.end_date) <span class="sql-reserved">AS</span> ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">STRAIGHT_JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">USING</span>(account_id)<br/><span class="sql-reserved">JOIN</span> orders o <span class="sql-reserved">USING</span>(order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">CURDATE</span>() &gt;= ay.start_date</td></tr>
   <tr><td>446</td><td>cron/summary/populate_tables.inc:1919</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_details_edits(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<span class="sql-keyword">MAX</span>(h.date_entered)) change_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">JOIN</span> summary_imp_start_details <span class="sql-reserved">ON</span> record_id = order_detail_id <span class="sql-reserved">AND</span> new_value = account_id<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COLUMN_NAME</span> = <span class="sql-string">'account_id'</span> <span class="sql-reserved">AND</span> old_value &lt;&gt; new_value<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_details_edits(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;change_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE</span>(<span class="sql-keyword">MAX</span>(h.date_entered)) <span class="sql-reserved">AS</span> change_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log h<br/><span class="sql-reserved">JOIN</span> summary_imp_start_details <span class="sql-reserved">ON</span> record_id = order_detail_id <span class="sql-reserved">AND</span> new_value = account_id<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">COLUMN_NAME</span> = <span class="sql-string">'account_id'</span> <span class="sql-reserved">AND</span> old_value &lt;&gt; new_value<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>447</td><td>cron/summary/populate_tables.inc:1941</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_by_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, ay_year)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start_by_year(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, ay_year)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_details<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year</td></tr>
   <tr><td>448</td><td>cron/summary/populate_tables.inc:1955</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, ay_year),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_by_year<br/><span class="sql-reserved">JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(ay_year) ay_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_by_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>) b <span class="sql-reserved">USING</span>(account_id, ay_year)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_imp_start(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id, ay_year),<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year <span class="sql-reserved">INT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;imp_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_year<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_by_year<br/><span class="sql-reserved">JOIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(ay_year) <span class="sql-reserved">AS</span> ay_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_imp_start_by_year<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/>) b <span class="sql-reserved">USING</span>(account_id, ay_year)</td></tr>
   <tr><td>449</td><td>cron/summary/populate_tables.inc:2266</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> account_order_counts_pre_cancel_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`account_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`academic_year_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`order_detail_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`reallocated`</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id, order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.reallocated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos<br/><span class="sql-reserved">INNER JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(aos.order_id = o.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.reallocated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_counts_pre_cancel aos<br/><span class="sql-reserved">INNER JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id = od.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(aos.order_id = o.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(od.status = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> o.status = <span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> account_order_counts_pre_cancel_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`account_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`academic_year_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`order_detail_id`</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">`reallocated`</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id, order_detail_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_detail_id)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id <span class="sql-reserved">INT</span>(<span class="sql-number">11</span>),<br/><span class="sql-keyword">STATUS</span> <span class="sql-reserved">BIGINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;purchased_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;initial_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;followup_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;initial_online_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_purchased_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.reallocated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos<br/><span class="sql-reserved">INNER JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">UNION</span><br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AS</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.reallocated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_counts_pre_cancel aos<br/><span class="sql-reserved">INNER JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id = o.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> o.status = <span class="sql-number">1</span></td></tr>
   <tr><td>450</td><td>cron/summary/populate_tables.inc:2377</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_info(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial training <span class="sql-string">"]."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> trainer training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_initial_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> followup training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_followup_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> initial online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_initial_online_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".$SUB_PRODUCT_TYPES["</span> online training <span class="sql-string">"]."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.quantity * <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_qty,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_qty<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_orders_all o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_order_details_all od<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products_use odspu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = odspu.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_detail_sub_products odsp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = odsp.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> sub_products sp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = sp.product_id <span class="sql-reserved">AND</span> sp.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> odspu.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> sub_product_types spt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spt.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;odsp.sub_product_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> spt.pd_deliverable = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_info(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>451</td><td>cron/summary/populate_tables.inc:2408</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_reallocated_data(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(quantity) reallocated_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id &lt;&gt; new_order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_reallocated_data(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">26</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(quantity) <span class="sql-reserved">AS</span> reallocated_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id &lt;&gt; new_order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_order_id</td></tr>
   <tr><td>452</td><td>cron/summary/populate_tables.inc:2425</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_reallocated_breakdown_data(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &gt;= <span class="sql-keyword">CURDATE</span>(), e.event_id, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) scheduled_reallocated_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &lt; <span class="sql-keyword">CURDATE</span>(), e.event_id, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) fulfilled_reallocated_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id &lt;&gt; r.new_order_id <span class="sql-reserved">AND</span> e.account_id = r.new_account_id <span class="sql-reserved">AND</span> e.order_id = r.old_order_id <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r.new_academic_year_id = e.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_reallocated_breakdown_data(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_reallocated_pd <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_reallocated_pd <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &gt;= <span class="sql-keyword">CURDATE</span>(), e.event_id, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> scheduled_reallocated_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &lt; <span class="sql-keyword">CURDATE</span>(), e.event_id, <span class="sql-reserved">NULL</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> fulfilled_reallocated_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id &lt;&gt; r.new_order_id <span class="sql-reserved">AND</span> e.account_id = r.new_account_id <span class="sql-reserved">AND</span> e.order_id = r.old_order_id <span class="sql-reserved">AND</span> e.is_primary = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> r.new_academic_year_id = e.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id</td></tr>
   <tr><td>453</td><td>cron/summary/populate_tables.inc:2451</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_day,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &gt;= <span class="sql-string">'$run_date'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;shared_day <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.shared_day,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date &gt;= <span class="sql-string">'$run_date'</span></td></tr>
   <tr><td>454</td><td>cron/summary/populate_tables.inc:2461</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_days_scheduled_pre e<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_scheduled(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_onsite_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_scheduled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">46</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_onsite_scheduled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.shared_day = <span class="sql-number">1</span>, <span class="sql-number">.5</span>, <span class="sql-number">1</span>) * e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_online_scheduled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_days_scheduled_pre e<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td></tr>
   <tr><td>455</td><td>cron/summary/populate_tables.inc:2482</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled_pre(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainers <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online <span class="sql-reserved">CHAR</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.online<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_event_info e<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.event_status <span class="sql-reserved">IN</span>(<span class="sql-string">'S'</span>, <span class="sql-string">'C'</span>) <span class="sql-reserved">OR</span> e.total_overall_attendees &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> e.event_date &lt; <span class="sql-string">'$run_date'</span> <span class="sql-reserved">AND</span> e.shared_event_id = <span class="sql-number">0</span></td></tr>
   <tr><td>456</td><td>cron/summary/populate_tables.inc:2494</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(e.total_trainers) total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.online = <span class="sql-string">'N'</span>, e.total_trainers, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(e.online = <span class="sql-string">'Y'</span>, e.total_trainers, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_fulfilled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_days_fulfilled_pre e<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_fulfilled(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">43</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_onsite_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">43</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_fulfilled <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">43</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(e.total_trainers) <span class="sql-reserved">AS</span> total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'N'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_onsite_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.online = <span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.total_trainers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_online_fulfilled<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_days_fulfilled_pre e<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id</td></tr>
   <tr><td>457</td><td>cron/summary/populate_tables.inc:2515</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_closed(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cd.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status = <span class="sql-string">'S'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_satisfied,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_satisfied,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_online_satisfied,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CURDATE</span>() &lt;= od.end_date,(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_satisfied_avail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status = <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">CURDATE</span>() &lt;= od.end_date,(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) total_online_satisfied_avail,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status &lt;&gt; <span class="sql-string">'S'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) total_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status &lt;&gt; <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) total_onsite_fulfilled,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.deliver_status &lt;&gt; <span class="sql-string">'S'</span> <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.closed_amount - cd.we_care_amount<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) total_online_fulfilled<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closed_deliverables cd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = cd.order_detail_id <span class="sql-reserved">AND</span> cd.sub_product_type_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["followup training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["online training"]."'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'".$SUB_PRODUCT_TYPES["initial online training"]."'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" . ($refresh_orders ? "</span> <span class="sql-reserved">AND</span> cd.order_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $refresh_orders) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">" : "") . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_days_closed(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>458</td><td>cron/summary/populate_tables.inc:2567</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.order_summary_backup(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.order_summary_backup(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_followup_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_remaining_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_remaining_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_renew_order_override <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_renew_fin_order_override <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary</td></tr>
   <tr><td>459</td><td>cron/summary/populate_tables.inc:2618</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_updated_order_totals(<span class="sql-reserved">PRIMARY KEY</span>(opportunity_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.total old_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) new_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(os.order_id = oc.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = p.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_total &lt;&gt; new_total</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_updated_order_totals(<span class="sql-reserved">PRIMARY KEY</span>(opportunity_id))</td><td style="border-bottom: solid 1px black;">opportunity_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">37</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.total <span class="sql-reserved">AS</span> old_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total - <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = oc.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = p.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;old_total &lt;&gt; new_total</td></tr>
   <tr><td>460</td><td>cron/summary/populate_tables.inc:2679</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.order_summary_backup(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.order_summary_backup(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_tax <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_trainings <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_followup_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_initial_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_online_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_reallocated_pd <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_scheduled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_fulfilled_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_expired_pd <span class="sql-reserved">FLOAT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;onsite_remaining_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;online_remaining_pd <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">9</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_renew_order_override <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renew_total_fin <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_renew_fin_order_override <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary</td></tr>
   <tr><td>461</td><td>cron/summary/populate_tables.inc:2732</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders_regenerate_new_renew(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;osb.order_total backup_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.quantity * price) interlink_order_detail_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;) detail_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> detail_override.new_percent <span class="sql-reserved">WHEN</span> comm_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> comm_override.new_total /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) detail_new_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> detail_override.renew_percent <span class="sql-reserved">WHEN</span> comm_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> comm_override.renew_total /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) detail_renew_total,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> detail_override.system_generated = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) has_overrides,<br/>comm_override.order_id override_order_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(o.order_date) &gt;= $fiscal_year <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_current_fiscal_year,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_override.system_generated<br/>) detail_override_system_generated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = os.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary_backup osb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;osb.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data rn<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rn.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.v_qc_overrides comm_override<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rn.order_Id = comm_override.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) -(os.order_total - os.sales_tax)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">2</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides detail_override<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rn.order_id = detail_override.order_id <span class="sql-reserved">AND</span> rn.order_detail_id = detail_override.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> os.order_total &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total - sales_tax - detail_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">ABS</span>(new_total - detail_new_total) &gt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">ABS</span>(renew_total - detail_renew_total) &gt; <span class="sql-number">2</span>;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> orders_regenerate_new_renew(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.sales_tax,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.new_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.renew_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;osb.order_total <span class="sql-reserved">AS</span> backup_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.quantity * price) <span class="sql-reserved">AS</span> interlink_order_detail_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> detail_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> detail_override.new_percent <span class="sql-reserved">WHEN</span> comm_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> comm_override.new_total /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'new'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> detail_new_total,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_list_price + pro_rated_fees + pro_rated_discounts<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> detail_override.renew_percent <span class="sql-reserved">WHEN</span> comm_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> comm_override.renew_total /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">WHEN</span> order_renewal_status = <span class="sql-string">'renewal'</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> detail_renew_total,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> detail_override.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> detail_override.system_generated = <span class="sql-number">0</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> has_overrides,<br/>comm_override.order_id <span class="sql-reserved">AS</span> override_order_id,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">YEAR</span>(o.order_date) &gt;= $fiscal_year <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_current_fiscal_year,<br/><span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;detail_override.system_generated<br/>) <span class="sql-reserved">AS</span> detail_override_system_generated<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_details od<br/><span class="sql-reserved">INNER JOIN</span> interlink.orders o<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id = os.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_summary_backup osb<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;osb.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_new_renewal_data rn<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rn.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> commissions.v_qc_overrides comm_override<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rn.order_Id = comm_override.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_override.new_total + comm_override.renew_total -(os.order_total - os.sales_tax)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">2</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.order_detail_new_renew_overrides detail_override<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;rn.order_id = detail_override.order_id <span class="sql-reserved">AND</span> rn.order_detail_id = detail_override.order_detail_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date &gt;= <span class="sql-string">'2010-01-01'</span> <span class="sql-reserved">AND</span> os.order_total &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total - sales_tax - detail_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">ABS</span>(new_total - detail_new_total) &gt; <span class="sql-number">2</span> <span class="sql-reserved">OR</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renew_total - detail_renew_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">2</span></td></tr>
   <tr><td>462</td><td>cron/summary/populate_tables.inc:2947</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_nr_replacement_run_year(<span class="sql-reserved">PRIMARY KEY</span>(run_year)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$run_year run_year</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_nr_replacement_run_year(<span class="sql-reserved">PRIMARY KEY</span>(run_year))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;$run_year <span class="sql-reserved">AS</span> run_year</td></tr>
   <tr><td>463</td><td>cron/summary/populate_tables.inc:2991</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_cmr_smry_order_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uos.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uo.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uoa.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uos<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uos.order_id = o.order_id <span class="sql-reserved">AND</span> uos.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders uo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uo.order_id = o.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uoa<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uoa.order_id = o.order_id <span class="sql-reserved">AND</span> uoa.role_id = <span class="sql-number">31</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tmp_cmr_smry_order_sales_rep(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">BIGINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uos.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uo.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uoa.user_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uos<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uos.order_id = o.order_id <span class="sql-reserved">AND</span> uos.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders uo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uo.order_id = o.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uoa<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uoa.order_id = o.order_id <span class="sql-reserved">AND</span> uoa.role_id = <span class="sql-number">31</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>464</td><td>cron/summary/populate_tables.inc:3038</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.mh_orders_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_post_integration_order<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uol_mh.order_id <span class="sql-reserved">OR</span> uo_mh.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_pre_integration_order,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.mh_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> is_post_integration_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uol_mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uol_mh.order_id = o.order_id <span class="sql-reserved">AND</span> uol_mh.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> uol_mh.user_id = <span class="sql-number">2238</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders uo_mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uo_mh.order_id = o.order_id <span class="sql-reserved">AND</span> uo_mh.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> uo_mh.user_id = <span class="sql-number">2238</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.mh_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">TRIM</span>(o.mh_order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0'</span>) <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> uol_mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> uo_mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.mh_orders_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_post_integration_order<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_pre_integration_order <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;is_post_integration_order <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> uol_mh.order_id <span class="sql-reserved">OR</span> uo_mh.order_id <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_pre_integration_order,<br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> o.mh_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> <span class="sql-number">1</span> <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> is_post_integration_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.orders o<br/><span class="sql-reserved">INNER JOIN</span> interlink.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders_lock uol_mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uol_mh.order_id = o.order_id <span class="sql-reserved">AND</span> uol_mh.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> uol_mh.user_id = <span class="sql-number">2238</span><br/><span class="sql-reserved">LEFT JOIN</span> interlink.user_orders uo_mh<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uo_mh.order_id = o.order_id <span class="sql-reserved">AND</span> uo_mh.role_id = <span class="sql-number">6</span> <span class="sql-reserved">AND</span> uo_mh.user_id = <span class="sql-number">2238</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.mh_order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">TRIM</span>(o.mh_order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'0'</span>) <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> uol_mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">OR</span> uo_mh.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>465</td><td>cron/summary/populate_tables.inc:3121</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_expiration_tmp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LEAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">MONTH</span>(od.start_date) = <span class="sql-number">8</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(od.start_date) = <span class="sql-number">9</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DAY</span>(od.start_date) &lt; <span class="sql-number">5</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-keyword">DATE_ADD</span>(od.start_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">91</span> <span class="sql-keyword">DAY</span>) <span class="sql-reserved">ELSE</span> <span class="sql-keyword">DATE_ADD</span>(od.start_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">61</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(o.order_date, od.end_date)<br/>) expire_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id = o.order_id <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> initial_online_purchased_pd &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_expiration_tmp(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;">order_detail_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expire_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LEAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> <span class="sql-keyword">MONTH</span>(od.start_date) = <span class="sql-number">8</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(od.start_date) = <span class="sql-number">9</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">DAY</span>(od.start_date) &lt; <span class="sql-number">5</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">THEN</span> <span class="sql-keyword">DATE_ADD</span>(od.start_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">91</span> <span class="sql-keyword">DAY</span>) <span class="sql-reserved">ELSE</span> <span class="sql-keyword">DATE_ADD</span>(od.start_date, <span class="sql-reserved">INTERVAL</span> <span class="sql-number">61</span> <span class="sql-keyword">DAY</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(o.order_date, od.end_date)<br/>) <span class="sql-reserved">AS</span> expire_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id = o.order_id <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.initial_purchased_pd &gt; <span class="sql-number">0</span> <span class="sql-reserved">OR</span> initial_online_purchased_pd &gt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>466</td><td>cron/summary/populate_tables.inc:3140</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_expiration(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_expiration_tmp</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_order_detail_expiration(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span><br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;summary_order_detail_expiration_tmp</td></tr>
   <tr><td>467</td><td>cron/summary/populate_tables.inc:3186</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_ultimate_parent_account(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(ultimate_parent_account_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_level parent_account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id ultimate_parent_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = b.account_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> summary_ultimate_parent_account(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(ultimate_parent_account_id)<br/>)</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ultimate_parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id <span class="sql-reserved">AS</span> parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_level <span class="sql-reserved">AS</span> parent_account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id <span class="sql-reserved">AS</span> ultimate_parent_account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = b.account_id</td></tr>
   <tr><td>468</td><td>reports/deliverables/index.php:327</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $trainer_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, order_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts.account_id = accounts.account_id <span class="sql-reserved">AND</span> user_id <span class="sql-reserved">IN</span> $trainer_ids <span class="sql-reserved">AND</span> account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> role_id = <span class="sql-number">4</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $trainer_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts.account_id = accounts.account_id <span class="sql-reserved">AND</span> user_id <span class="sql-reserved">IN</span>($trainer_ids) <span class="sql-reserved">AND</span> account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> role_id = <span class="sql-number">4</span></td></tr>
   <tr><td>469</td><td>reports/deliverables/index.php:367</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $rvp_table(<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = ua.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["implementation"]]["rvp"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $rvp_table(<span class="sql-reserved">PRIMARY KEY</span>(order_id, user_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ua.user_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts ua<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = ua.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["implementation"]]["rvp"] . "'</span></td></tr>
   <tr><td>470</td><td>reports/deliverables/index.php:384</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ic_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, order_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts.account_id = accounts.account_id <span class="sql-reserved">AND</span> user_id = $coordinator_id <span class="sql-reserved">AND</span> account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> role_id = <span class="sql-number">2</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ic_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(account_id, order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;user_accounts.account_id = accounts.account_id <span class="sql-reserved">AND</span> user_id = $coordinator_id <span class="sql-reserved">AND</span> account_owner = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> role_id = <span class="sql-number">2</span></td></tr>
   <tr><td>471</td><td>reports/deliverables/index.php:422</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverables_ultimate_parents(<span class="sql-reserved">PRIMARY KEY</span>(account_id)) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id ultimate_parent_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name ultimate_parent_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.parent_account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> accounts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.parent_account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> c.account_level = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverables_ultimate_parents(<span class="sql-reserved">PRIMARY KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ultimate_parent_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ultimate_parent_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id <span class="sql-reserved">AS</span> ultimate_parent_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name <span class="sql-reserved">AS</span> ultimate_parent_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/><span class="sql-reserved">JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.parent_account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> accounts c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.parent_account_id = a.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_level = <span class="sql-number">2</span> <span class="sql-reserved">AND</span> c.account_level = <span class="sql-number">1</span></td></tr>
   <tr><td>472</td><td>reports/deliverables/index.php:464</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.account_name <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billing_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pa.account_name parent_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.customer_since,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.no_pls_conversion,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.date_entered,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(s.total_trainings <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span>) - <span class="sql-keyword">CAST</span>(s.reallocated_pd <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span>) total_trainings,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.reallocated_pd pd_taken,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_initial_pd initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.total_followup_pd followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.total_initial_online_pd + s.total_online_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(s.fulfilled_pd <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span>) - <span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.fulfilled_reallocated_pd <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(s.scheduled_pd <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span>) - <span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.scheduled_reallocated_pd <span class="sql-reserved">AS</span> <span class="sql-keyword">SIGNED</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.onsite_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.online_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.onsite_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.online_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.onsite_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;s.online_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> reallocations,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.imp_special_category,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_id <span class="sql-comment">-- account itself is district</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHEN</span> pa.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> pa.account_id <span class="sql-comment">-- school account with district</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ELSE</span> <span class="sql-string">'0'</span><br/><span class="sql-keyword">END</span> sub_district_id,<br/><span class="sql-comment">-- school with no parent (private school)</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_name <span class="sql-comment">-- account itself is district</span><br/><span class="sql-reserved">WHEN</span> pa.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> pa.account_name <span class="sql-comment">-- school account with district</span><br/><span class="sql-reserved">ELSE</span> <span class="sql-string">'Private School'</span><br/><span class="sql-keyword">END</span> sub_district_name,<br/><span class="sql-comment">-- school with no parent (private school)</span><br/>u.ultimate_parent_id,<br/>u.ultimate_parent_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">JOIN</span> accounts a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> order_summary s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = s.order_id<br/><span class="sql-reserved">JOIN</span> account_details ad <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = ad.account_id $fromStr<br/><span class="sql-reserved">LEFT JOIN</span> accounts b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.account_id = o.billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts pa <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pa.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> order_reportable_excludes e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = e.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverables_ultimate_parents u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = a.tier_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> $whereStr <span class="sql-reserved">AND</span> <span class="sql-reserved">EXISTS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">USING</span>(product_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-string">" . ($academic_year_id ?  "</span> <span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $academic_year_id) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">"
		        : "</span> <span class="sql-reserved">AND</span> $current_date <span class="sql-reserved">BETWEEN</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">GREATEST</span>(d.post_end, d.end_date) <span class="sql-reserved">AND</span> d.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-string">") ."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">LIMIT</span> <span class="sql-number">1</span><br/>) <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.draft = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>473</td><td>reports/deliverables/index.php:600</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_order_deliverable_pd <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.purchased_pd) purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.fulfilled_pd + ao.scheduled_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) fulfilled_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary ao<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ao.order_id <span class="sql-reserved">AND</span> ao.reallocated = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ao.order_id &lt;&gt; ao.origin_order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_order_deliverable_pd</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.purchased_pd) <span class="sql-reserved">AS</span> purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.fulfilled_pd + ao.scheduled_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> fulfilled_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary ao<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = ao.order_id <span class="sql-reserved">AND</span> ao.reallocated = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> ao.order_id &lt;&gt; ao.origin_order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>474</td><td>reports/deliverables/index.php:630</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_products(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.exclude_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">LEFT JOIN</span> product_editions pe <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.product_id = pe.product_id)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_products(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>)</td><td style="border-bottom: solid 1px black;">product_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_group_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;teacher_licenses <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;editions <span class="sql-reserved">INT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;exclude_pd <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_line_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.teacher_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> editions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.exclude_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">LEFT JOIN</span> product_editions pe <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = pe.product_id</td></tr>
   <tr><td>475</td><td>reports/deliverables/index.php:638</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_programs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(p.program_id) program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.program_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_programs(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(p.program_id) <span class="sql-reserved">AS</span> program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.program_id &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id</td></tr>
   <tr><td>476</td><td>reports/deliverables/index.php:650</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_odetails <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.sort pr_sort,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;rg.group_name reporting_group,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.customer_since,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pa.account_name parent_account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.no_pls_conversion,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*min(d.start_date) start_date, max(d.end_date) end_date,*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(uc.first_name, <span class="sql-number">1</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uc.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) coordinator_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_training_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(lu.first_name, <span class="sql-number">1</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lu.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) last_trainer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ev.shared_day last_training_shared,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_training_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTR</span>(nu.first_name, <span class="sql-number">1</span>, <span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nu.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_trainer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> aio.option_name <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) implementation_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(e.first_name, <span class="sql-string">' '</span>, e.last_name) escalation_owner,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> p.product_group_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">','</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_group_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> ay.academic_year_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> ay.academic_year_id) academic_year_ids,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(d.start_date) impl_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(ay.academic_year_id) min_ay_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ad.imp_special_category,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_id <span class="sql-comment">-- account itself is district</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHEN</span> pa.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> pa.account_id <span class="sql-comment">-- school account with district</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ELSE</span> <span class="sql-string">'0'</span><br/><span class="sql-keyword">END</span> sub_district_id,<br/><span class="sql-comment">-- school with no parent (private school)</span><br/><span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> a.account_level = <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> a.account_name <span class="sql-comment">-- account itself is district</span><br/><span class="sql-reserved">WHEN</span> pa.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">THEN</span> pa.account_name <span class="sql-comment">-- school account with district</span><br/><span class="sql-reserved">ELSE</span> <span class="sql-string">'Private School'</span><br/><span class="sql-keyword">END</span> sub_district_name,<br/><span class="sql-comment">-- school with no parent (private school)</span><br/>u.ultimate_parent_id,<br/>u.ultimate_parent_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_summary s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_details ad<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts pa <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pa.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverables_ultimate_parents u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.tier_id = a.tier_id<br/><span class="sql-reserved">LEFT JOIN</span> users lu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.last_trainer = lu.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> users nu <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(s.next_trainer = nu.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> <span class="sql-keyword">EVENTS</span> ev <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(ev.event_id = s.last_event_id)<br/><span class="sql-reserved">LEFT JOIN</span> account_info ai <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai.account_id = a.account_id <span class="sql-reserved">AND</span> ai.info_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", array_keys(get_account_info_options_list('implementation_status'))) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> account_info_options aio <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ai.info_id = aio.info_id <span class="sql-reserved">AND</span> aio.status = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts ua <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = ua.account_id <span class="sql-reserved">AND</span> ua.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["implementation"]]["escalation_owner"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> users e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(e.user_id = ua.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts uac <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = uac.account_id <span class="sql-reserved">AND</span> uac.role_id = <span class="sql-string">'" . $ROLE[$DEPARTMENT["implementation"]]["coordinator"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> users uc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(uc.user_id = uac.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.schools sc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = sc.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.reporting_group_users rgu<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sc.school_id = rgu.school_id <span class="sql-reserved">AND</span> rgu.class_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> rgu.user_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> rgu.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> rgu.start_date &lt; ay.end_date <span class="sql-reserved">AND</span> rgu.end_date &gt; ay.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $db_pick.reporting_groups rg<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rg.reporting_group_id = rgu.reporting_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = pg.order_id <span class="sql-reserved">AND</span> a.account_id = pg.account_id <span class="sql-reserved">AND</span> d.academic_year_id = pg.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> a.account_id = ad.account_id $esc_owner_filter $imp_status_filter <span class="sql-reserved">AND</span> d.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> d.account_id = a.account_id <span class="sql-string">"
				.($academic_year_id ?  "</span> <span class="sql-reserved">AND</span> d.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $academic_year_id) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">"
                    : "</span> <span class="sql-reserved">AND</span> $current_date <span class="sql-reserved">BETWEEN</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">GREATEST</span>(d.post_end, d.end_date) <span class="sql-reserved">AND</span> d.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-string">").
		"</span> <span class="sql-reserved">AND</span> d.account_id = s.account_id <span class="sql-reserved">AND</span> d.academic_year_id = s.academic_year_id <span class="sql-reserved">AND</span> ay.academic_year_id = d.academic_year_id <span class="sql-reserved">AND</span> p.product_id = d.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_odetails</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>477</td><td>reports/deliverables/index.php:759</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_no_order_states <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_odetails d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> o.state_code = d.state_code<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_no_order_states</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_odetails d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span> o.state_code = d.state_code<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span></td></tr>
   <tr><td>478</td><td>reports/deliverables/index.php:769</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_order_states <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_no_order_states n <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = n.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.state_code <span class="sql-reserved">IN</span> $state_codes <span class="sql-reserved">AND</span> n.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.state_code <span class="sql-reserved">IN</span> $state_codes <span class="sql-reserved">AND</span> n.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_order_states</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_no_order_states n <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = n.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = d.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.state_code <span class="sql-reserved">IN</span>($state_codes) <span class="sql-reserved">AND</span> n.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.state_code <span class="sql-reserved">IN</span>($state_codes) <span class="sql-reserved">AND</span> n.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>479</td><td>reports/deliverables/index.php:937</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_order_summary_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.program_id = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = pg.order_id <span class="sql-reserved">AND</span> d.account_id = pg.account_id <span class="sql-reserved">AND</span> od.academic_year_id = pg.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = d.account_id <span class="sql-reserved">AND</span> aos.order_id = d.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.exclude_pd = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_account_order_summary_program(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.program_id = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> program_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_order_summary aos,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = pg.order_id <span class="sql-reserved">AND</span> d.account_id = pg.account_id <span class="sql-reserved">AND</span> od.academic_year_id = pg.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id = d.account_id <span class="sql-reserved">AND</span> aos.order_id = d.order_id <span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.order_detail_id = aos.order_detail_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.exclude_pd = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.order_detail_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;aos.academic_year_id</td></tr>
   <tr><td>480</td><td>reports/deliverables/index.php:977</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_pd <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.purchased_pd) purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.initial_purchased_pd) initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.followup_purchased_pd) followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.initial_online_purchased_pd + ao.online_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.fulfilled_pd) fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.expired_pd) expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.scheduled_pd) scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_scheduled_pd) onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_scheduled_pd) online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_fulfilled_pd) onsite_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_fulfilled_pd) online_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_expired_pd) onsite_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_expired_pd) online_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_remaining_pd) onsite_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_remaining_pd) online_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.reallocated = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) reallocated_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.reallocated = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.fulfilled_pd + ao.scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) fulfilled_reallocated_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_account_order_summary_program ao,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od <span class="sql-comment">/*, tmp_deliverable_products p*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#LEFT JOIN tmp_deliverable_programs pg ON (d.order_id = pg.order_id AND d.account_id = pg.account_id AND ao.academic_year_id = pg.academic_year_id)</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = ao.order_id <span class="sql-reserved">AND</span> d.account_id = ao.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#".($academic_year_id ? "AND ao.academic_year_id IN (".implode(", ", $academic_year_id).")" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.order_detail_id = ao.order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#AND p.product_id = od.product_id</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.program_id = ao.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id <span class="sql-comment">#, d.academic_year_id</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_pd</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.purchased_pd) <span class="sql-reserved">AS</span> purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.initial_purchased_pd) <span class="sql-reserved">AS</span> initial_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.followup_purchased_pd) <span class="sql-reserved">AS</span> followup_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.initial_online_purchased_pd + ao.online_purchased_pd<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> online_purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.fulfilled_pd) <span class="sql-reserved">AS</span> fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.expired_pd) <span class="sql-reserved">AS</span> expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.scheduled_pd) <span class="sql-reserved">AS</span> scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_scheduled_pd) <span class="sql-reserved">AS</span> onsite_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_scheduled_pd) <span class="sql-reserved">AS</span> online_scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_fulfilled_pd) <span class="sql-reserved">AS</span> onsite_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_fulfilled_pd) <span class="sql-reserved">AS</span> online_fulfilled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_expired_pd) <span class="sql-reserved">AS</span> onsite_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_expired_pd) <span class="sql-reserved">AS</span> online_expired_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.onsite_remaining_pd) <span class="sql-reserved">AS</span> onsite_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(ao.online_remaining_pd) <span class="sql-reserved">AS</span> online_remaining_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.reallocated = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.purchased_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> reallocated_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.reallocated = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.fulfilled_pd + ao.scheduled_pd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> fulfilled_reallocated_pd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_account_order_summary_program ao,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = ao.order_id <span class="sql-reserved">AND</span> d.account_id = ao.account_id <span class="sql-comment">#".($academic_year_id ? "AND ao.academic_year_id IN (".implode(", ", $academic_year_id).")" : "")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ao.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.order_detail_id = ao.order_detail_id <span class="sql-comment">#AND p.product_id = od.product_id</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.program_id = ao.program_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id</td></tr>
   <tr><td>481</td><td>reports/deliverables/index.php:1030</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_pd_realloc(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'removed to'</span> direction,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id != r.new_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.new_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) realloc_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id != r.new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(r.quantity) / <span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> d.program_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = r.old_order_id <span class="sql-reserved">AND</span> d.account_id = r.old_account_id <span class="sql-reserved">AND</span> od.order_detail_id = r.old_order_detail_id <span class="sql-reserved">AND</span> a.account_id = r.new_account_id <span class="sql-reserved">AND</span> ay.academic_year_id = r.new_academic_year_id <span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = r.new_academic_year_id <span class="sql-reserved">OR</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;realloc_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_pd_realloc(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'removed to'</span> <span class="sql-reserved">AS</span> direction,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.old_order_id != r.new_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.new_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> realloc_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id != r.new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(r.quantity) / <span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> d.program_id)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quantity<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_reallocations r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = r.old_order_id <span class="sql-reserved">AND</span> d.account_id = r.old_account_id <span class="sql-reserved">AND</span> od.order_detail_id = r.old_order_detail_id <span class="sql-reserved">AND</span> a.account_id = r.new_account_id <span class="sql-reserved">AND</span> ay.academic_year_id = r.new_academic_year_id <span class="sql-reserved">AND</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;) &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = r.new_academic_year_id <span class="sql-reserved">OR</span> <span class="sql-keyword">FIND_IN_SET</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.new_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.academic_year_ids<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt;= <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;realloc_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year</td></tr>
   <tr><td>482</td><td>reports/deliverables/index.php:1062</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_totals <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) total_before_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = pg.order_id <span class="sql-reserved">AND</span> d.account_id = pg.account_id <span class="sql-reserved">AND</span> od.academic_year_id = pg.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = od.order_id <span class="sql-reserved">AND</span> d.account_id = od.account_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*".($academic_year_id ? "AND od.academic_year_id IN (".implode(", ", $academic_year_id).")" : "")."*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.program_id = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_deliverable_totals</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(od.price * od.quantity) <span class="sql-reserved">AS</span> total_before_discount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_products p<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = pg.order_id <span class="sql-reserved">AND</span> d.account_id = pg.account_id <span class="sql-reserved">AND</span> od.academic_year_id = pg.academic_year_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id = od.order_id <span class="sql-reserved">AND</span> d.account_id = od.account_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-comment">/*".($academic_year_id ? "AND od.academic_year_id IN (".implode(", ", $academic_year_id).")" : "")."*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> d.program_id = <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.program_id</td></tr>
   <tr><td>483</td><td>reports/deliverables/index.php:1151</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_program_licenses(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg.program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-string">'9999'</span> <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses = <span class="sql-string">'9999'</span> <span class="sql-reserved">AND</span> p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) unlimited<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_orders o<br/><span class="sql-reserved">JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">JOIN</span> tmp_deliverable_products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_detail_id = aos.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> tmp_deliverable_programs pg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = pg.order_id <span class="sql-reserved">AND</span> od.account_id = pg.account_id <span class="sql-reserved">AND</span> od.academic_year_id = pg.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.status = <span class="sql-number">0</span> <span class="sql-string">"
        .($academic_year_id ?  "</span> <span class="sql-reserved">AND</span> od.academic_year_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">".implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", $academic_year_id) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">"
           : "</span> <span class="sql-reserved">AND</span> $current_date <span class="sql-reserved">BETWEEN</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.pre_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.start_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">GREATEST</span>(od.post_end, od.end_date) <span class="sql-reserved">AND</span> od.academic_year_id &lt;&gt; <span class="sql-number">0</span> <span class="sql-string">").
		"</span> <span class="sql-reserved">AND</span> aos.student_licenses &gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_program_licenses(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(program_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>484</td><td>reports/deliverables/index.php:1335</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_district_grouping <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.state_code<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) state_code<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id = a.parent_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts gp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id = p.parent_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = d.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temporary  */</span> <span class="sql-reserved">TABLE</span> tmp_district_grouping</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gp.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.state_code,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.state_code<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> state_code<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_deliverable_odetails d,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.account_id = a.parent_account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts gp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;gp.account_id = p.parent_account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = d.account_id</td></tr>
   <tr><td>485</td><td>reports/renewal/discount_review.php:147</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exclude_orders_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = os.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> os.order_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*OR o.se_0_order = 1*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exclude_orders_$table_suffix</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = od.account_id <span class="sql-reserved">AND</span> od.order_id = os.order_id <span class="sql-reserved">AND</span> o.order_id = od.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_type = <span class="sql-number">16</span> <span class="sql-reserved">OR</span> os.order_total &lt; <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
   <tr><td>486</td><td>reports/renewal/discount_review.php:169</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ordering_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price * b.quantity) total_purchased,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.list_price * b.quantity) total_list_price,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(b.end_date) order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> c.user_id) user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ot.opportunity_type_name opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> user_orders c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = c.order_id <span class="sql-reserved">AND</span> c.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = e.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.order_id = a.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_types ot <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ot.opportunity_type_id = p.opportunity_type_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(bc.contact_id = oc.contact_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id $whereStr <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>487</td><td>reports/renewal/discount_review.php:222</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> prev_ay_$table_suffix(<span class="sql-reserved">KEY</span>(academic_year_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) prev_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id = ay2.academic_year_id <span class="sql-reserved">AND</span> ay.end_date &lt; ay2.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> prev_ay_$table_suffix(<span class="sql-reserved">KEY</span>(academic_year_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> prev_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id = ay2.academic_year_id <span class="sql-reserved">AND</span> ay.end_date &lt; ay2.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td></tr>
   <tr><td>488</td><td>reports/renewal/discount_review.php:239</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> next_ay_$table_suffix(<span class="sql-reserved">KEY</span>(academic_year_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) next_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id = ay2.academic_year_id <span class="sql-reserved">AND</span> ay.end_date &gt; ay2.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> next_ay_$table_suffix(<span class="sql-reserved">KEY</span>(academic_year_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> next_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay2<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id = ay2.academic_year_id <span class="sql-reserved">AND</span> ay.end_date &gt; ay2.end_date <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.academic_year_id</td></tr>
   <tr><td>489</td><td>reports/renewal/discount_review.php:265</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.sub_product_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) licenses<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span> <span class="sql-reserved">AND</span> p.product_id = sp.product_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> has_licenses_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>490</td><td>reports/renewal/discount_review.php:289</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date = o.order_detail_end <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">28</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> non_license_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id <span class="sql-reserved">AND</span> o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> o.account_id = od.account_id <span class="sql-reserved">AND</span> p.product_id = od.product_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> od.end_date = o.order_detail_end <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-number">28</span> <span class="sql-reserved">AND</span> p.product_group_id &lt;&gt; <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span></td></tr>
   <tr><td>491</td><td>reports/renewal/discount_review.php:307</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_future_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">DATE_FORMAT</span>(a.order_date, <span class="sql-string">'%c/%e/%y'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products pr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.order_id = e.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(p.order_id = a.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> pr.product_id = b.product_id <span class="sql-reserved">AND</span> pr.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = pr.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.se_0_order = o.se_0_order <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> b.academic_year_id = o.next_academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> orders,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">DATE_FORMAT</span>(a.order_date, <span class="sql-string">'%c/%e/%y'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.order_id <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> order_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products pr,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> exclude_orders_$table_suffix e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = e.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunities p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_id = a.order_id<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> a.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> pr.product_id = b.product_id <span class="sql-reserved">AND</span> pr.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = pr.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> a.se_0_order = o.se_0_order <span class="sql-reserved">AND</span> e.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> b.academic_year_id = o.next_academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td></tr>
   <tr><td>492</td><td>reports/renewal/discount_review.php:347</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-keyword">STATUS</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id = b.quote_id <span class="sql-reserved">AND</span> c.opportunity_id = a.opportunity_id <span class="sql-reserved">AND</span> c.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.probability_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">" . implode("</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">", array_keys($opportunity_probabilities)) . "</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> op.probability_id = c.probability_id <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = p.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.lead_source_id = <span class="sql-number">7</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> a.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m)-3, 1, date(Y))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> b.academic_year_id = o.next_academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opps_future_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(op.probability_percent * <span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'%'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span><br/><span class="sql-keyword">STATUS</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotes a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_products sp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.opportunity_id = opm.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> non_license_products_$table_suffix nl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nl.order_id <span class="sql-reserved">AND</span> o.account_id = nl.account_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.quote_id = b.quote_id <span class="sql-reserved">AND</span> c.opportunity_id = a.opportunity_id <span class="sql-reserved">AND</span> c.order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> c.probability_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' . implode('</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">', array_keys($opportunity_probabilities)) . '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> op.probability_id = c.probability_id <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_id = sp.product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">1</span> <span class="sql-reserved">AND</span> sp.sub_product_type_id = <span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.licenses = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> nl.product_group_id = p.product_group_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> c.lead_source_id = <span class="sql-number">7</span> <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.final = <span class="sql-number">1</span> <span class="sql-reserved">OR</span> a.date_entered &gt;= <span class="sql-string">'" . date("Y-m-d", mktime(0,0,0,date(m)-3, 1, date(Y))) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> o.account_id = b.account_id <span class="sql-reserved">AND</span> b.academic_year_id = o.next_academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opm.opportunity_product_id</td></tr>
   <tr><td>493</td><td>reports/renewal/discount_review.php:381</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_totals_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id</td></tr>
   <tr><td>494</td><td>reports/renewal/discount_review.php:391</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>)) order_total_plus_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>) total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_non_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) standard_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(order_total +(<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;) non_standard_discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> b.product_id = c.product_id <span class="sql-reserved">AND</span> product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> discounts_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> order_total_plus_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> <span class="sql-reserved">AS</span> total_non_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id &lt;&gt; <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> standard_discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(b.product_id = <span class="sql-number">2</span>, b.price, <span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_total + <span class="sql-keyword">SUM</span>(b.price) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> non_standard_discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_totals_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> b.product_id = c.product_id <span class="sql-reserved">AND</span> product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id</td></tr>
   <tr><td>495</td><td>reports/renewal/discount_review.php:423</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> exception_products_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.sku <span class="sql-reserved">LIKE</span> <span class="sql-string">'%bbcp%'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Blackbelt'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["pd"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'PD'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["project_management"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Project Management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["levelset"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Levelset'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.summer_type_id &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_group_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . implode("'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' ", $upgrade_product_groups) . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Upgrade'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) exception_product<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.order_id = b.order_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> b.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.product_id = b.product_id <span class="sql-reserved">AND</span> p.product_group_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'" . $PRODUCT_GROUPS["fee"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) $whereStr</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/*/</span> * $temp * <span class="sql-comment">/*/</span> <span class="sql-reserved">TABLE</span> exception_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>496</td><td>reports/renewal/discount_review.php:444</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> no_exception_products_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_product = <span class="sql-string">''</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> no_exception_products_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_product = <span class="sql-string">''</span></td></tr>
   <tr><td>497</td><td>reports/renewal/discount_review.php:473</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exception_orders_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> exception_product<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception_product <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' only'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> exception_orders_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> exception_product<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception_product <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'/'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' only'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> exception_reason<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;exception_products_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>498</td><td>reports/renewal/discount_review.php:610</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_years_$table_suffix <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_length total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date first_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date last_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-string">'$summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) ay_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = c.order_id <span class="sql-reserved">AND</span> b.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.order_id = os.order_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*HAVING total_years &gt; 1*/</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_years_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_length <span class="sql-reserved">AS</span> total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date <span class="sql-reserved">AS</span> order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date <span class="sql-reserved">AS</span> order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.start_date <span class="sql-reserved">AS</span> first_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.end_date <span class="sql-reserved">AS</span> last_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;os.order_total <span class="sql-reserved">AS</span> multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.summer = <span class="sql-string">'$summer'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> ay_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_years ay<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = c.order_id <span class="sql-reserved">AND</span> b.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> b.order_id = os.order_id <span class="sql-reserved">AND</span> ay.academic_year_id = od.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>499</td><td>reports/renewal/discount_review.php:626</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_discounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_summary os)<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = od.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunities op <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(op.order_id = o.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(bc.contact_id = oc.contact_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> orders_discounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">131</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;discount_percent <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">53</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) <span class="sql-reserved">AS</span> buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total + <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discount_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(orders o, order_summary os)<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = od.order_id<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">LEFT JOIN</span> opportunities op <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.order_id = o.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;op.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bc.contact_id = oc.contact_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id <span class="sql-reserved">AND</span> o.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>500</td><td>reports/renewal/discount_review.php:693</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> accounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id)<br/>) <span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> accounts_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-reserved">DISTINCT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;next_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix</td></tr>
   <tr><td>501</td><td>reports/renewal/discount_review.php:727</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> totals_2_years_ago_$table_suffix(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_2_years_ago<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = od.account_id <span class="sql-reserved">AND</span> o2.order_id = od.order_id <span class="sql-reserved">AND</span> o2.opportunity_product_id = o.opportunity_product_id <span class="sql-reserved">AND</span> o2.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.contact_id = oc.contact_id <span class="sql-reserved">AND</span> <span class="sql-keyword">CONCAT</span>(c.first_name, <span class="sql-string">' '</span>, c.last_name) = o.buyer_contact <span class="sql-reserved">AND</span> od.academic_year_id = o.prev_academic_year_id <span class="sql-reserved">AND</span> nr.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> totals_2_years_ago_$table_suffix(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_2_years_ago<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o2,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id = od.account_id <span class="sql-reserved">AND</span> o2.order_id = od.order_id <span class="sql-reserved">AND</span> o2.opportunity_product_id = o.opportunity_product_id <span class="sql-reserved">AND</span> o2.order_id = oc.order_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.contact_id = oc.contact_id <span class="sql-reserved">AND</span> <span class="sql-keyword">CONCAT</span>(c.first_name, <span class="sql-string">' '</span>, c.last_name) = o.buyer_contact <span class="sql-reserved">AND</span> od.academic_year_id = o.prev_academic_year_id <span class="sql-reserved">AND</span> nr.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>502</td><td>reports/renewal/discount_review.php:757</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> usage_data_$table_suffix(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pre_test_comp<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) pre_test_comp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;active_students_ytd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) active_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_licenses_ytd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_licenses_ytd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_by_program<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;report_end_date = <span class="sql-string">'$usage_end_date'</span> <span class="sql-reserved">AND</span> renewal_extension = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> usage_data_$table_suffix(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;student_licenses <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">39</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pre_test_comp <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">36</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;active_students_ytd <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">43</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_licenses_ytd <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">43</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;student_licenses<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pre_test_comp<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> pre_test_comp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;active_students_ytd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> active_students_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;academic_year,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_licenses_ytd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_licenses_ytd<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_usage_by_program<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;report_end_date = <span class="sql-string">'$usage_end_date'</span> <span class="sql-reserved">AND</span> renewal_extension = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>503</td><td>reports/renewal/discount_review.php:772</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_by_order_$table_suffix(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.opportunity_product_id != <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) product_line,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span> order_quote<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_discounts_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.account_id = od.account_id <span class="sql-reserved">AND</span> od.academic_year_id = a.next_academic_year_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(od.end_date) != <span class="sql-string">'" . date(Y, strtotime($end_date)) . "'</span> <span class="sql-reserved">AND</span> t.opportunity_product_id = a.opportunity_product_id <span class="sql-reserved">AND</span> t.buyer_contact = a.buyer_contact <span class="sql-reserved">AND</span> nr.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_by_order_$table_suffix(<span class="sql-reserved">KEY</span>(account_id), <span class="sql-reserved">KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.opportunity_product_id != <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> product_line,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr.line_list_price + nr.pro_rated_fees + nr.pro_rated_discounts + nr.pro_rated_credits,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'o'</span> <span class="sql-reserved">AS</span> order_quote<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_discounts_$table_suffix t,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details od,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_new_renewal_data nr<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = od.product_id<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;t.order_id = od.order_id <span class="sql-reserved">AND</span> od.status = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> a.account_id = od.account_id <span class="sql-reserved">AND</span> od.academic_year_id = a.next_academic_year_id <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(od.end_date) != <span class="sql-string">'" . date(Y, strtotime($end_date)) . "'</span> <span class="sql-reserved">AND</span> t.opportunity_product_id = a.opportunity_product_id <span class="sql-reserved">AND</span> t.buyer_contact = a.buyer_contact <span class="sql-reserved">AND</span> nr.order_detail_id = od.order_detail_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;product_line</td></tr>
   <tr><td>504</td><td>reports/renewal/discount_review.php:797</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_totals_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price * qd.quantity) quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> p.product_id = qd.product_id <span class="sql-reserved">AND</span> p.product_group_id != <span class="sql-number">32</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_totals_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id))</td><td style="border-bottom: solid 1px black;">quote_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;final <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_length <span class="sql-reserved">FLOAT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">42</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.order_length,<br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(qd.price * qd.quantity) <span class="sql-reserved">AS</span> quote_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quotes q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;products p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> p.product_id = qd.product_id <span class="sql-reserved">AND</span> p.product_group_id != <span class="sql-number">32</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>505</td><td>reports/renewal/discount_review.php:808</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_discounts_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total +(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ay.summer != <span class="sql-string">'$summer'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) min_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(quote_totals_$table_suffix q)<br/><span class="sql-reserved">LEFT JOIN</span> quote_details qd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(q.quote_id = qd.quote_id)<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = qd.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_discounts_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span> /(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.quote_total + <span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.product_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.price<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) * <span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> discount_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ay.summer != <span class="sql-string">'$summer'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> min_academic_year_id<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q<br/><span class="sql-reserved">LEFT JOIN</span> quote_details qd <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id<br/><span class="sql-reserved">LEFT JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.product_id = p.product_id <span class="sql-reserved">AND</span> p.product_group_id = <span class="sql-string">'" . $PRODUCT_GROUPS["discount"] . "'</span><br/><span class="sql-reserved">LEFT JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = qd.academic_year_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>506</td><td>reports/renewal/discount_review.php:820</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_fees_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(qd.price / q.quote_total) <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) fee_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.product_id = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_fees_$table_suffix(<span class="sql-reserved">KEY</span>(quote_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qd.price / q.quote_total <span class="sql-reserved">AS</span> <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">25</span>, <span class="sql-number">23</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> fee_percent<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_totals_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.product_id = <span class="sql-number">1</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id</td></tr>
   <tr><td>507</td><td>reports/renewal/discount_review.php:831</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opportunity_quotes_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(opm.opportunity_product_id, <span class="sql-number">1</span>) opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.notes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.min_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) min_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quote_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_discounts_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(bc.contact_id = oc.contact_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> op.probability_id = p.probability_id <span class="sql-reserved">AND</span> op.probability_percent <span class="sql-reserved">BETWEEN</span> <span class="sql-number">.10</span> <span class="sql-reserved">AND</span> <span class="sql-number">.90</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> opportunity_quotes_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;op.probability_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(opm.opportunity_product_id, <span class="sql-number">1</span>) <span class="sql-reserved">AS</span> opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(bc.first_name, <span class="sql-string">' '</span>, bc.last_name) <span class="sql-reserved">AS</span> buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;p.notes,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.min_academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> min_academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.final = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(q.order_length = <span class="sql-number">1</span>, <span class="sql-number">1</span>, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.quote_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> quote_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_discounts_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_probabilities op<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> opportunity_product_map opm <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = opm.opportunity_id<br/><span class="sql-reserved">LEFT JOIN</span> order_contacts oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span><br/><span class="sql-reserved">LEFT JOIN</span> contacts bc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;bc.contact_id = oc.contact_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id = q.opportunity_id <span class="sql-reserved">AND</span> op.probability_id = p.probability_id <span class="sql-reserved">AND</span> op.probability_percent <span class="sql-reserved">BETWEEN</span> <span class="sql-number">.10</span> <span class="sql-reserved">AND</span> <span class="sql-number">.90</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.opportunity_id</td></tr>
   <tr><td>508</td><td>reports/renewal/discount_review.php:850</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_no_buyer_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(a.buyer_contact) buyer_contact<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_quotes_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.buyer_contact <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> q.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.order_id = ro.order_id <span class="sql-reserved">AND</span> p.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.contact_id = oc.contact_id <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.account_id = a.account_id <span class="sql-reserved">AND</span> qd.academic_year_id = a.next_academic_year_id <span class="sql-reserved">AND</span> q.opportunity_product_id = a.opportunity_product_id <span class="sql-reserved">AND</span> a.buyer_contact = <span class="sql-keyword">CONCAT</span>(c.first_name, <span class="sql-string">' '</span>, c.last_name)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quote_no_buyer_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MIN</span>(a.buyer_contact) <span class="sql-reserved">AS</span> buyer_contact<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_quotes_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunities ro,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunities p,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_contacts oc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;contacts c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.buyer_contact <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> q.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> p.order_id = ro.order_id <span class="sql-reserved">AND</span> p.opportunity_id = oc.opportunity_id <span class="sql-reserved">AND</span> oc.contact_type_id = <span class="sql-number">3</span> <span class="sql-reserved">AND</span> c.contact_id = oc.contact_id <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> qd.account_id = a.account_id <span class="sql-reserved">AND</span> qd.academic_year_id = a.next_academic_year_id <span class="sql-reserved">AND</span> q.opportunity_product_id = a.opportunity_product_id <span class="sql-reserved">AND</span> a.buyer_contact = <span class="sql-keyword">CONCAT</span>(c.first_name, <span class="sql-string">' '</span>, c.last_name)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;q.quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id</td></tr>
   <tr><td>509</td><td>reports/renewal/discount_review.php:870</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quotes_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> pl.product_line_str) product_line_str,<br/>&nbsp;&nbsp;&nbsp;&nbsp;qd.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.probability_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) quote_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUBSTRING_INDEX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.probability_percent,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.final,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">LPAD</span>(q.quote_id, <span class="sql-number">7</span>, <span class="sql-string">'0'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.notes<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'|'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">-1</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts_$table_suffix a,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opportunity_quotes_$table_suffix q,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quote_details qd<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> products pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(pr.product_id = qd.product_id)<br/><span class="sql-reserved">LEFT JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = pr.product_line_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> projected_totals_by_order_$table_suffix p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = p.account_id <span class="sql-reserved">AND</span> a.opportunity_product_id = p.opportunity_product_id <span class="sql-reserved">AND</span> a.buyer_contact = p.buyer_contact <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id != <span class="sql-number">1</span> <span class="sql-reserved">OR</span> pl.product_line_str <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">OR</span> pl.product_line_str = p.product_line<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> orders_$table_suffix o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id <span class="sql-reserved">AND</span> a.opportunity_product_id = o.opportunity_product_id <span class="sql-reserved">AND</span> a.buyer_contact = o.buyer_contact<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> renewal_opportunities ro <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.opportunity_id = ro.opportunity_id <span class="sql-reserved">AND</span> ro.order_id = o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> quote_no_buyer_$table_suffix b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.buyer_contact <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> q.quote_id = b.quote_id <span class="sql-reserved">AND</span> a.account_id = b.account_id <span class="sql-reserved">AND</span> a.opportunity_product_id = b.opportunity_product_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id = q.opportunity_product_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.buyer_contact = q.buyer_contact <span class="sql-reserved">OR</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.quote_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> a.buyer_contact = b.buyer_contact<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> q.quote_id = qd.quote_id <span class="sql-reserved">AND</span> a.account_id = qd.account_id <span class="sql-reserved">AND</span> qd.academic_year_id = a.next_academic_year_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q.min_academic_year_id = a.next_academic_year_id <span class="sql-reserved">OR</span> q.quote_date &gt;= <span class="sql-string">'" . date('</span> <span class="sql-keyword">Y</span> - m - d <span class="sql-string">', mktime(0,0,0,date(m)-3,date(d),date(Y))) . "'</span> <span class="sql-reserved">OR</span> ro.opportunity_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> <span class="sql-keyword">YEAR</span>(qd.end_date) != <span class="sql-string">'" . date(Y, strtotime($end_date)) . "'</span> <span class="sql-reserved">AND</span> p.account_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.buyer_contact</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> quotes_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(quote_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(academic_year_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>510</td><td>reports/renewal/discount_review.php:935</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projected_total_before_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(projected_total_after_discount) projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> notes <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'|'</span>) notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_by_order_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> projected_totals_$table_suffix(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(account_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(opportunity_product_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">KEY</span>(buyer_contact)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projected_total_before_discount<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(projected_total_after_discount) <span class="sql-reserved">AS</span> projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> notes <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'|'</span>) <span class="sql-reserved">AS</span> notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;projected_totals_by_order_$table_suffix<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_contact</td></tr>
   <tr><td>511</td><td>reports/renewal/discount_review.php:945</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_details_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_level buyer_account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_name buyer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased) total_purchased_no_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(standard_discount_amount) standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_standard_discount_amount) non_standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_new) total_purchased_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_standard) total_purchased_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(order_detail_end) order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u.user_id) sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u2.user_id) account_sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(ur.first_name, <span class="sql-string">' '</span>, ur.last_name) renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u2.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u2.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u3.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u3.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) final_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;final_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.trainer_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;first_start multi_order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_end multi_order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*tiers.tier_name,*/</span> o.exception_reason,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.total_2_years_ago,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_enrollment,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.customers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.non_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.non_customers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) district_non_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.tier tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;usg.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;usg.pre_test_comp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usg.active_students_ytd &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> usg.total_licenses_ytd &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usg.active_students_ytd / usg.total_licenses_ytd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) avg_usage_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sf_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.notes opportunity_notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ordering_account_id = e.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d.account_id<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_user_id = u2.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.final_user_id = u3.user_id<br/><span class="sql-reserved">LEFT JOIN</span> order_years_$table_suffix nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = nr.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts uar <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = uar.account_id <span class="sql-reserved">AND</span> uar.role_id = <span class="sql-number">25</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-comment"># renewal rep</span><br/><span class="sql-reserved">LEFT JOIN</span> users ur <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(ur.user_id = uar.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> counties c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(c.county_id = a.county_id)<br/><span class="sql-reserved">LEFT JOIN</span> tiers <span class="sql-reserved">ON</span>(a.tier_id = tiers.tier_id)<br/><span class="sql-reserved">LEFT JOIN</span> totals_2_years_ago_$table_suffix t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = t.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">/*AND o.opportunity_product_id = t.opportunity_product_id
		AND o.buyer_contact = t.buyer_contact*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.order_id = t.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> bob_account_info i <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = i.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> bob_account_info p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(d.account_id = p.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> usage_data_$table_suffix usg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_id = usg.account_id)<br/><span class="sql-reserved">LEFT JOIN</span> projected_totals_$table_suffix pt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = pt.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = pt.opportunity_product_id <span class="sql-reserved">AND</span> o.buyer_contact = pt.buyer_contact<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> order_details_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.state_code <span class="sql-reserved">AS</span> state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_level <span class="sql-reserved">AS</span> buyer_account_level,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_id <span class="sql-reserved">AS</span> buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.account_name <span class="sql-reserved">AS</span> buyer_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased) <span class="sql-reserved">AS</span> total_purchased_no_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(standard_discount_amount) <span class="sql-reserved">AS</span> standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(non_standard_discount_amount) <span class="sql-reserved">AS</span> non_standard_discount_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_new) <span class="sql-reserved">AS</span> total_purchased_discounts,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(total_purchased_standard) <span class="sql-reserved">AS</span> total_purchased_standard_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MAX</span>(order_detail_end) <span class="sql-reserved">AS</span> order_detail_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u.user_id) <span class="sql-reserved">AS</span> sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> u2.user_id) <span class="sql-reserved">AS</span> account_sales_rep_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT</span>(ur.first_name, <span class="sql-string">' '</span>, ur.last_name) <span class="sql-reserved">AS</span> renewal_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u2.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u2.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> account_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_user_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.buyer_contact,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> u3.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u3.last_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> final_sales_rep,<br/>&nbsp;&nbsp;&nbsp;&nbsp;final_user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.trainer_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_years,<br/>&nbsp;&nbsp;&nbsp;&nbsp;nr.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;first_start <span class="sql-reserved">AS</span> multi_order_start,<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_end <span class="sql-reserved">AS</span> multi_order_end,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;multi_year_order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_opportunity_status,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_product_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.opportunity_type,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.se_0_order,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.exception_reason,<br/>&nbsp;&nbsp;&nbsp;&nbsp;t.total_2_years_ago,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.total_enrollment,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.customers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.account_level = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.non_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.non_customers<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> district_non_customers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;i.tier <span class="sql-reserved">AS</span> tier_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;usg.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;usg.pre_test_comp,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usg.active_students_ytd &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> usg.total_licenses_ytd &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usg.active_students_ytd / usg.total_licenses_ytd,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> avg_usage_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.sf_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total_before_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.projected_total_after_discount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pt.notes <span class="sql-reserved">AS</span> opportunity_notes<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounts a<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> accounts e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.ordering_account_id = e.account_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts d <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.parent_account_id = d.account_id<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u2 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_user_id = u2.user_id<br/><span class="sql-reserved">LEFT JOIN</span> users u3 <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.final_user_id = u3.user_id<br/><span class="sql-reserved">LEFT JOIN</span> order_years_$table_suffix nr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = nr.order_id<br/><span class="sql-reserved">LEFT JOIN</span> user_accounts uar <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = uar.account_id <span class="sql-reserved">AND</span> uar.role_id = <span class="sql-number">25</span><br/><span class="sql-reserved">LEFT JOIN</span> users ur <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ur.user_id = uar.user_id<br/><span class="sql-reserved">LEFT JOIN</span> counties c <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.county_id = a.county_id<br/><span class="sql-reserved">LEFT JOIN</span> tiers <span class="sql-reserved">ON</span> a.tier_id = tiers.tier_id<br/><span class="sql-reserved">LEFT JOIN</span> totals_2_years_ago_$table_suffix t <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = t.account_id <span class="sql-comment">/*AND o.opportunity_product_id = t.opportunity_product_id
		AND o.buyer_contact = t.buyer_contact*/</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">AND</span> o.order_id = t.order_id<br/><span class="sql-reserved">LEFT JOIN</span> bob_account_info i <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = i.account_id<br/><span class="sql-reserved">LEFT JOIN</span> bob_account_info p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;d.account_id = p.account_id<br/><span class="sql-reserved">LEFT JOIN</span> usage_data_$table_suffix usg <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = usg.account_id<br/><span class="sql-reserved">LEFT JOIN</span> projected_totals_$table_suffix pt <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = pt.account_id <span class="sql-reserved">AND</span> o.opportunity_product_id = pt.opportunity_product_id <span class="sql-reserved">AND</span> o.buyer_contact = pt.buyer_contact<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id = o.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;buyer_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.first_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name</td></tr>
   <tr><td>512</td><td>reports/renewal/discount_review.php:1026</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> product_lines_$table_suffix <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_str<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) products_on_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">JOIN</span> order_details b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = b.order_id <span class="sql-reserved">AND</span> o.account_id = b.account_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_id = b.academic_year_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = b.product_id<br/><span class="sql-reserved">JOIN</span> product_lines pl <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pl.product_line_id = p.product_line_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pr <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pr.program_id = p.program_id <span class="sql-reserved">AND</span> pl.product_line_id <span class="sql-reserved">IN</span>(<span class="sql-number">3</span>, <span class="sql-number">4</span>, <span class="sql-number">11</span>)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> product_lines_$table_suffix</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>513</td><td>reports/renewal/discount_review.php:1053</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> licenses_$table_suffix(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) literacy_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>, <span class="sql-number">10</span>, <span class="sql-number">11</span>, <span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>, <span class="sql-number">15</span>) <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> p.program_id = <span class="sql-number">11</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) literacy_summer_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id <span class="sql-reserved">IN</span>(<span class="sql-number">12</span>, <span class="sql-number">13</span>, <span class="sql-number">14</span>) <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) bae_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">10</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) levelset_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-number">2</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) science_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#If SmartyAnts licenses contain a 9999, then display 'Unlimited'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Unlimited'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id &lt;&gt; <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) smartyants_license_count,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &gt;= <span class="sql-number">9999</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Unlimited'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CAST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = <span class="sql-string">".SMARTY_ANTS_PROGRAM."</span> <span class="sql-reserved">AND</span> p.summer_type_id = <span class="sql-number">6</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aos.student_licenses,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-reserved">CHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) smartyants_summer_license_count<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders_$table_suffix o<br/><span class="sql-reserved">JOIN</span> account_order_summary aos <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = aos.order_id <span class="sql-reserved">AND</span> aos.account_id = o.account_id<br/><span class="sql-reserved">JOIN</span> order_details b <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_detail_id = aos.order_detail_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">JOIN</span> products p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.product_id = b.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.status = <span class="sql-number">0</span> $whereStr <span class="sql-reserved">AND</span> ay.academic_year_id = b.academic_year_id <span class="sql-reserved">AND</span> aos.reallocated = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ay.summer = <span class="sql-string">'$summer'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-comment">/* $temp */</span> <span class="sql-reserved">TABLE</span> licenses_$table_suffix(<span class="sql-reserved">KEY</span>(order_id), <span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>514</td><td>reports/renewal/discount_review.php:1090</td><td style="border-bottom: solid 1px black;">(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$run = = <span class="sql-number">0</span> <span class="sql-parameter">?</span> <span class="sql-string">"CREATE /* $temp */ TABLE bob_results (key(account_id),key(order_id),key(summer))"</span> <span class="sql-parameter">:</span> <span class="sql-string">"INSERT INTO bob_results"</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;).<span class="sql-string">"
	SELECT distinct if(school_id='',district_id,school_id) account_id,
	'$summer' summer,
	state , county_name, if(buyer_account_level=1,'District','School') buyer_account_level, buyer_account_id, buyer_name,  district_id district_account_id, district_name ,
        school_id  school_account_id, school_name, a.order_id,
        total_purchased_no_discounts,
	standard_discount_amount,
	non_standard_discount_amount,
        total_purchased_discounts,
        total_purchased_standard_discount,
        if (discount_percent, concat(round(discount_percent*100, 2), '%'), '0%') discount_percent,
        order_detail_end, sales_rep order_sales_rep, account_sales_rep, renewal_rep,
        concat(c.first_name, ' ', c.last_name) trainer, buyer_contact,
        /*if (total_years &gt; 1, total_years, '')*/ total_years,
        order_date,
        order_start_date,
        order_end_date,
        if (total_years &lt;= 1 and ay_count &lt;= 1, '', multi_order_start) multi_year_order_start,
        if (total_years &lt;= 1 and ay_count &lt;= 1, '', multi_order_end) multi_year_order_end,
        if (total_years &lt;= 1 and ay_count &lt;= 1, '', format(multi_year_order_total, 2)) multi_year_order_total,
        if (renewal_order = '', 'N', 'Y') has_renewal, renewal_order, renewal_order_date,
        if (renewal_order = '', if (renewal_opportunity_status &lt;&gt; '', renewal_opportunity_status, ''), 'N/A') renewal_opportunity_status,
	a.opportunity_id, a.opportunity_type,
	products_on_order,
	literacy_license_count,
	literacy_summer_license_count,
	bae_license_count,
	levelset_license_count,
	science_license_count,
	smartyants_license_count,
	smartyants_summer_license_count,
        ls.lead_source_name, op.opportunity_product_name, se_0_order, tier_name, exception_reason,
	total_2_years_ago, total_enrollment, district_customers, district_non_customers,
	student_licenses, pre_test_comp, avg_usage_licenses, sf_account_id,
	projected_total_before_discount, projected_total_after_discount, opportunity_notes
        FROM (order_details_$table_suffix a)
        LEFT JOIN discounts_$table_suffix b on a.order_id = b.order_id
        LEFT JOIN users c ON a.trainer_id = c.user_id
        LEFT JOIN opportunities p on (p.order_id = a.order_id)
        LEFT JOIN lead_sources ls on (ls.lead_source_id = p.lead_source_id)
        LEFT JOIN opportunity_products op ON (op.opportunity_product_id = a.opportunity_product_id)</span></td><td style="border-bottom: solid 1px black;">(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$run = = <span class="sql-number">0</span> <span class="sql-parameter">?</span> <span class="sql-string">"CREATE /* $temp */ TABLE bob_results (key(account_id),key(order_id),key(summer))"</span> <span class="sql-parameter">:</span> <span class="sql-string">"INSERT INTO bob_results"</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;).<span class="sql-string">"
	</span></td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>515</td><td>cron/dallas_isd_training.php:10</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_accounts(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id = <span class="sql-number">3388</span> <span class="sql-reserved">OR</span> account_id = <span class="sql-number">3388</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> customer_status = <span class="sql-string">'current customer'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_accounts(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_type <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ultimate_parent_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;implementation_region_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;state_code <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;county_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;phone <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fax <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;url <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">255</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;school_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_start <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;subscription_end <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;summer <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;year_round <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_status <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;customer_since <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_imp_start <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;reseller_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;kb_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">6</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sa_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">11</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;mdr_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;om_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;external_account_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;time_zone_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;origin_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SOURCE</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">15</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;complexity_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;risk_level <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;apr_withhold <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;apr_withhold_reason <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_pls_conversion <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;current_acv_summer <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_acv <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;prev_acv_summer <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;renewal_quota <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expiring_value <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tier_id <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;closed <span class="sql-reserved">TINYINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sf_account_id <span class="sql-reserved">CHAR</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sf_parent_account_id <span class="sql-reserved">CHAR</span>(<span class="sql-number">18</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;fi_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">36</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tax_exempt <span class="sql-reserved">TINYINT</span>(<span class="sql-number">4</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;change_src <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;entered_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sa_date_modified <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_modified <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;accounts<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_account_id = <span class="sql-number">3388</span> <span class="sql-reserved">OR</span> account_id = <span class="sql-number">3388</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> customer_status = <span class="sql-string">'current customer'</span></td></tr>
   <tr><td>516</td><td>cron/dallas_isd_training.php:20</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_account_events(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/><span class="sql-reserved">JOIN</span> tech.dallas_accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> <span class="sql-keyword">EVENTS</span> e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'2017-07-01'</span> <span class="sql-reserved">AND</span> e.event_status &lt;&gt; <span class="sql-string">'x'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ea.account_id) = <span class="sql-number">1</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_account_events(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_type_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">2</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_type_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/><span class="sql-reserved">JOIN</span> tech.dallas_accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> <span class="sql-keyword">EVENTS</span> e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'2017-07-01'</span> <span class="sql-reserved">AND</span> e.event_status &lt;&gt; <span class="sql-string">'x'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ea.account_id) = <span class="sql-number">1</span></td></tr>
   <tr><td>517</td><td>cron/dallas_isd_training.php:33</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_central_events(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/><span class="sql-reserved">JOIN</span> tech.dallas_accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> <span class="sql-keyword">EVENTS</span> e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>) <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'2017-07-01'</span> <span class="sql-reserved">AND</span> e.event_status &lt;&gt; <span class="sql-string">'x'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_account_events<br/>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_central_events(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">event_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;event_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;event_accounts ea<br/><span class="sql-reserved">JOIN</span> tech.dallas_accounts a<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id = a.account_id<br/><span class="sql-reserved">JOIN</span> <span class="sql-keyword">EVENTS</span> e <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;e.event_id = ea.event_id <span class="sql-reserved">AND</span> event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>) <span class="sql-reserved">AND</span> e.event_date &gt;= <span class="sql-string">'2017-07-01'</span> <span class="sql-reserved">AND</span> e.event_status &lt;&gt; <span class="sql-string">'x'</span> <span class="sql-reserved">AND</span> e.status = <span class="sql-number">0</span><br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id <span class="sql-reserved">NOT IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_account_events<br/>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ea.account_id</td></tr>
   <tr><td>518</td><td>cron/dallas_isd_training.php:46</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_semifinal(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_name, <span class="sql-string">','</span>, <span class="sql-string">' - '</span>) account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'training'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'project_management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'other'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> ce.event_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ce.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'centralized_days'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'total_account_training'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'total_project_management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ce.event_id) <span class="sql-string">'total_centralized_days'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_accounts a<br/><span class="sql-reserved">LEFT JOIN</span> tech.dallas_account_events ae<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ae.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.dallas_central_events ce<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ce.account_id = a.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_semifinal(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">180</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;training <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;project_management <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;other <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;centralized_days <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_account_training <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_project_management <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized_days <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id,<br/><span class="sql-reserved">REPLACE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(a.account_name, <span class="sql-string">','</span>, <span class="sql-string">' - '</span>) <span class="sql-reserved">AS</span> account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id = <span class="sql-number">1</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'training'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'project_management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">NOT IN</span>(<span class="sql-number">1</span>, <span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'other'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> ce.event_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ce.event_date <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">';'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'centralized_days'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'total_account_training'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_type_id <span class="sql-reserved">IN</span>(<span class="sql-number">13</span>, <span class="sql-number">17</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ae.event_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">NULL</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'total_project_management'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> ce.event_id) <span class="sql-reserved">AS</span> <span class="sql-string">'total_centralized_days'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_accounts a<br/><span class="sql-reserved">LEFT JOIN</span> tech.dallas_account_events ae<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ae.account_id = a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> tech.dallas_central_events ce<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ce.account_id = a.account_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.account_id</td></tr>
   <tr><td>519</td><td>cron/dallas_isd_training.php:64</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_final(<span class="sql-reserved">KEY</span>(account_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_account_training + total_centralized_days<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-string">'total_training_events'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_semifinal<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.dallas_final(<span class="sql-reserved">KEY</span>(account_id))</td><td style="border-bottom: solid 1px black;">account_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">180</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;training <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;project_management <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;other <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;centralized_days <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_account_training <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_project_management <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_centralized_days <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_training_events <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_account_training + total_centralized_days<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> <span class="sql-string">'total_training_events'</span><br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.dallas_semifinal<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id</td></tr>
   <tr><td>520</td><td>finance/invoices/import/import_do.php:161</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $invoice_taxes_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(ns_invoice_id, <span class="sql-keyword">TYPE</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TYPE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_total) tax_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.import_taxes<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ns_invoice_id != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TYPE</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $invoice_taxes_table(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(ns_invoice_id, <span class="sql-keyword">TYPE</span>)<br/>)</td><td style="border-bottom: solid 1px black;">ns_invoice_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TYPE</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;tax_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id <span class="sql-reserved">AS</span> ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TYPE</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_total) <span class="sql-reserved">AS</span> tax_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.import_taxes<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NOT NULL</span> <span class="sql-reserved">AND</span> ns_invoice_id != <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;ns_invoice_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TYPE</span></td></tr>
   <tr><td>521</td><td>finance/invoices/import/om/invoice_schedule.php:25</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> credit_link_orders_temp <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.real_order_id order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.link_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_link_orders c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> credit_link_orders_temp</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.real_order_id <span class="sql-reserved">AS</span> order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;c.link_order<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;credit_link_orders c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = c.order_id</td></tr>
   <tr><td>522</td><td>finance/invoices/import/om/invoice_schedule.php:697</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_outstanding <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_total - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(invoice_amount, <span class="sql-number">0</span>)) remainder<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> billing_full f <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = f.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> billing_schedule s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = s.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = o.order_id <span class="sql-reserved">AND</span> o.cancel != <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> o.credit != <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> f.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(b.order_total) &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_outstanding</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">AS</span> invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_total - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(invoice_amount, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> remainder<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_orders b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o<br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> billing_full f <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = f.order_id<br/><span class="sql-reserved">LEFT JOIN</span> billing_schedule s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = s.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = o.order_id <span class="sql-reserved">AND</span> o.cancel != <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> o.credit != <span class="sql-string">'Y'</span> <span class="sql-reserved">AND</span> f.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(b.order_total) &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>523</td><td>finance/invoices/import/om/invoice_schedule.php:1058</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> incomplete_billing <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) invoiced<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_schedule b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_full f<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = o.order_id <span class="sql-reserved">AND</span> b.order_id = f.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">#and o.cancel != 'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> o.order_total <span class="sql-number">-5</span> <span class="sql-reserved">AND</span> o.order_total <span class="sql-number">+5</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> incomplete_billing</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;district,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">AS</span> invoiced<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_schedule b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_full f<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id = o.order_id <span class="sql-reserved">AND</span> b.order_id = f.order_id <span class="sql-comment">#and o.cancel != 'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id<br/><span class="sql-reserved">HAVING</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">NOT</span> <span class="sql-reserved">BETWEEN</span> o.order_total - <span class="sql-number">5</span> <span class="sql-reserved">AND</span> o.order_total + <span class="sql-number">5</span></td></tr>
   <tr><td>524</td><td>finance/invoices/import/om/invoice_schedule.php:1081</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_outstanding <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(invoice_amount, <span class="sql-number">0</span>)) remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(amortization.orders o)<br/><span class="sql-reserved">LEFT JOIN</span> billing_full f <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = f.order_id)<br/><span class="sql-reserved">LEFT JOIN</span> billing_schedule s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = s.order_id)<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = o.real_order_id <span class="sql-reserved">AND</span> f.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_outstanding</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;state,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.start_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.end_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.om_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">AS</span> invoiced,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - <span class="sql-keyword">SUM</span>(<span class="sql-keyword">IFNULL</span>(invoice_amount, <span class="sql-number">0</span>)) <span class="sql-reserved">AS</span> remainder,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cancel,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.billing_account_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;amortization.orders o<br/><span class="sql-reserved">LEFT JOIN</span> billing_full f <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = f.order_id<br/><span class="sql-reserved">LEFT JOIN</span> billing_schedule s <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = s.order_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = o.real_order_id <span class="sql-reserved">AND</span> f.order_id <span class="sql-reserved">IS</span> <span class="sql-reserved">NULL</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ROUND</span>(o.order_total) &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>525</td><td>finance/invoices/import/om/invoice_schedule.php:1220</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_summary <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(invoice_date) <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(invoice_date) <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) billing_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_schedule<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(invoice_date)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> billing_summary</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(invoice_date) <span class="sql-reserved">AS</span> <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(invoice_date) <span class="sql-reserved">AS</span> <span class="sql-keyword">MONTH</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(invoice_amount) <span class="sql-reserved">AS</span> billing_total<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_schedule<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span>(invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">MONTH</span>(invoice_date)</td></tr>
   <tr><td>526</td><td>reports/renewal/renewal_book/index.php:41</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.renewal_bob_report_data_lock <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'1'</span> col1;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> interlink.renewal_bob_report_data_lock</td><td style="border-bottom: solid 1px black;">col1 <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">1</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'1'</span> <span class="sql-reserved">AS</span> col1</td></tr>
   <tr><td>527</td><td>util/function/orders.php:2261</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> history_log_records <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_a.account_name <span class="sql-keyword">ACCOUNT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_a.account_id account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_ay.academic_year_name <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_p.sku sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hl.new_value<br/>&nbsp;&nbsp;&nbsp;&nbsp;) new_val,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hl.old_value<br/>&nbsp;&nbsp;&nbsp;&nbsp;) old_val,<br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log hl<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">-- pull in order_details and relevant</span><br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.table_name <span class="sql-reserved">LIKE</span> <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> hl.record_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> products od_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = od_p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts od_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = od_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years od_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = od_ay.academic_year_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-comment">-- pull in history_log relevant tables</span><br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.entered_by = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years hln_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'academic_year_id'</span> <span class="sql-reserved">AND</span> hl.new_value = hln_ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts hln_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(hl.column_name = <span class="sql-string">'account_id'</span>) <span class="sql-reserved">AND</span> hl.new_value = hln_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> products hln_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(hl.column_name = <span class="sql-string">'product_id'</span>) <span class="sql-reserved">AND</span> hl.new_value = hln_p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years hlo_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'academic_year_id'</span> <span class="sql-reserved">AND</span> hl.old_value = hlo_ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts hlo_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(hl.column_name = <span class="sql-string">'account_id'</span>) <span class="sql-reserved">AND</span> hl.old_value = hlo_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> products hlo_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(hl.column_name = <span class="sql-string">'product_id'</span>) <span class="sql-reserved">AND</span> hl.old_value = hlo_p.product_id<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TABLE_NAME</span> = <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> record_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id = <span class="sql-variable">@order_id</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> history_log_records</td><td style="border-bottom: solid 1px black;">last_name <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">50</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ACCOUNT</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">60</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">YEAR</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sku <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">100</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_val <span class="sql-keyword">TEXT</span>(<span class="sql-number">196605</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_val <span class="sql-keyword">TEXT</span>(<span class="sql-number">196605</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">TABLE_NAME</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;record_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COLUMN_NAME</span> <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;column_title <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">40</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;old_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;new_value <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;approved_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;approval_date <span class="sql-keyword">DATE</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;notes <span class="sql-keyword">TEXT</span>(<span class="sql-number">65535</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;change_src <span class="sql-reserved">CHAR</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;entered_by <span class="sql-reserved">SMALLINT</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;date_entered <span class="sql-keyword">TIMESTAMP</span>(<span class="sql-number">19</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;u.last_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_a.account_name <span class="sql-reserved">AS</span> <span class="sql-keyword">ACCOUNT</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_a.account_id <span class="sql-reserved">AS</span> account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_ay.academic_year_name <span class="sql-reserved">AS</span> <span class="sql-keyword">YEAR</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;od_p.sku <span class="sql-reserved">AS</span> sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hln_p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hl.new_value<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> new_val,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COALESCE</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_a.account_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hlo_p.sku,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hl.old_value<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> old_val,<br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.*<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;history_log hl<br/><span class="sql-reserved">LEFT JOIN</span> order_details od <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.table_name <span class="sql-reserved">LIKE</span> <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> hl.record_id = od.order_detail_id<br/><span class="sql-reserved">LEFT JOIN</span> products od_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.product_id = od_p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts od_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.account_id = od_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years od_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;od.academic_year_id = od_ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> users u <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.entered_by = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years hln_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'academic_year_id'</span> <span class="sql-reserved">AND</span> hl.new_value = hln_ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts hln_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'account_id'</span> <span class="sql-reserved">AND</span> hl.new_value = hln_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> products hln_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'product_id'</span> <span class="sql-reserved">AND</span> hl.new_value = hln_p.product_id<br/><span class="sql-reserved">LEFT JOIN</span> academic_years hlo_ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'academic_year_id'</span> <span class="sql-reserved">AND</span> hl.old_value = hlo_ay.academic_year_id<br/><span class="sql-reserved">LEFT JOIN</span> accounts hlo_a <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'account_id'</span> <span class="sql-reserved">AND</span> hl.old_value = hlo_a.account_id<br/><span class="sql-reserved">LEFT JOIN</span> products hlo_p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;hl.column_name = <span class="sql-string">'product_id'</span> <span class="sql-reserved">AND</span> hl.old_value = hlo_p.product_id<br/><span class="sql-reserved">WHERE</span> <span class="sql-keyword">TABLE_NAME</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'order_details'</span> <span class="sql-reserved">AND</span> record_id <span class="sql-reserved">IN</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_detail_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_details<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id = <span class="sql-variable">@order_id</span><br/>)</td></tr>
   <tr><td>528</td><td>cron/ls_breakdown.php:13</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00628959_parent_program <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.assessment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(pp.program_id, p.program_id) program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) program_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a<br/><span class="sql-reserved">JOIN</span> tech.wu_assessment_dates b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = b.assessment_date_id <span class="sql-reserved">AND</span> b.assessment_date_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> tech.wu_account_usage c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.school_id = a.school_id <span class="sql-reserved">AND</span> c.academic_year_id = a.academic_year_id <span class="sql-reserved">AND</span> c.program_id = a.program_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">JOIN</span> programs p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = a.program_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.program_id = p.parent_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(pp.program_id, p.program_id)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00628959_parent_program</td><td style="border-bottom: solid 1px black;">school_id <span class="sql-reserved">VARCHAR</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">25</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;user_id <span class="sql-reserved">INT</span>(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">30</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;assessment_date_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;assessment_id <span class="sql-reserved">TINYINT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id <span class="sql-reserved">INT</span>(<span class="sql-number">3</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_name <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;ay.academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;b.assessment_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(pp.program_id, p.program_id) <span class="sql-reserved">AS</span> program_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.program_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.program_name<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> program_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.wu_assessment_completed a<br/><span class="sql-reserved">JOIN</span> tech.wu_assessment_dates b<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id = b.assessment_date_id <span class="sql-reserved">AND</span> b.assessment_date_id &lt;&gt; <span class="sql-number">0</span><br/><span class="sql-reserved">JOIN</span> tech.wu_account_usage c<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;c.school_id = a.school_id <span class="sql-reserved">AND</span> c.academic_year_id = a.academic_year_id <span class="sql-reserved">AND</span> c.program_id = a.program_id<br/><span class="sql-reserved">JOIN</span> academic_years ay <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id = ay.academic_year_id<br/><span class="sql-reserved">JOIN</span> programs p <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.program_id = a.program_id<br/><span class="sql-reserved">LEFT JOIN</span> programs pp <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;pp.program_id = p.parent_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;a.user_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;a.assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(pp.program_id, p.program_id)</td></tr>
   <tr><td>529</td><td>cron/ls_breakdown.php:31</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00628959_parent_program_final <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(user_id) <span class="sql-string">'users'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> assessment_id <span class="sql-reserved">WHEN</span> <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Pre'</span> <span class="sql-reserved">WHEN</span> <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Interim'</span> <span class="sql-reserved">WHEN</span> <span class="sql-number">4</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Post'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Other'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> <span class="sql-string">'ls_type'</span>,<br/>program_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00628959_parent_program<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> tech.fm_00628959_parent_program_final</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(user_id) <span class="sql-reserved">AS</span> <span class="sql-string">'users'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> assessment_id <span class="sql-reserved">WHEN</span> <span class="sql-number">1</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Pre'</span> <span class="sql-reserved">WHEN</span> <span class="sql-number">2</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Interim'</span> <span class="sql-reserved">WHEN</span> <span class="sql-number">4</span> <span class="sql-reserved">THEN</span> <span class="sql-string">'Post'</span> <span class="sql-reserved">ELSE</span> <span class="sql-string">'Other'</span><br/><span class="sql-keyword">END</span> <span class="sql-reserved">AS</span> <span class="sql-string">"ls_type"</span>,<br/>program_name<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;tech.fm_00628959_parent_program<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;assessment_date_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;program_id<br/><span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;school_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;academic_year_name</td></tr>
   <tr><td>530</td><td>cron/ns_sync/orders_sync.php:22</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.order_id = o.order_id <span class="sql-reserved">AND</span> os.order_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_orders(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">22</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id <span class="sql-reserved">MEDIUMINT</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_ns_id <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">1500</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">45</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;multiple_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;process_without_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">5</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;sales_rep <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">50</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id = <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;billing_account_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> billing_account_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;replacement_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">22</span>) <span class="sql-reserved">AS</span> replacement_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;expansion_order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">8</span>) <span class="sql-reserved">AS</span> expansion_ns_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">1500</span>) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">45</span>) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> multiple_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">5</span>) <span class="sql-reserved">AS</span> process_without_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SPACE</span>(<span class="sql-number">50</span>) <span class="sql-reserved">AS</span> sales_rep<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_summary os<br/><span class="sql-reserved">WHERE</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span> <span class="sql-reserved">AND</span> draft = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> om_order_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> ns_order_id = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> account_id &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> os.order_id = o.order_id <span class="sql-reserved">AND</span> os.order_total &gt; <span class="sql-number">0</span> <span class="sql-reserved">AND</span> date_entered &gt; <span class="sql-string">'2009-08-01'</span> <span class="sql-reserved">AND</span> date_entered &lt;= <span class="sql-string">'$start_time'</span></td></tr>
   <tr><td>531</td><td>cron/ns_sync/orders_sync.php:63</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> p.po_amount = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.po_date = <span class="sql-string">'0000-00-00'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(p.po_date, <span class="sql-string">'%m/%d/%y'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'\n'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(no_po &gt; <span class="sql-number">0</span>, <span class="sql-string">'Yes'</span>, <span class="sql-string">'No'</span>) no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span>(p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>) <span class="sql-reserved">OR</span> p.no_po &gt; <span class="sql-number">0</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> sync_order_po(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accounting_memo <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;po_numbers <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_po <span class="sql-reserved">BIGINT</span>(<span class="sql-number">21</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;no_po <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">3</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po = <span class="sql-string">''</span> <span class="sql-reserved">AND</span> p.po_amount = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> p.po_date = <span class="sql-string">'0000-00-00'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CONCAT_WS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">' '</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.po_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DATE_FORMAT</span>(p.po_date, <span class="sql-string">'%m/%d/%y'</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'
'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> accounting_memo,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(p.po) <span class="sql-reserved">AS</span> po_numbers,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(<span class="sql-reserved">DISTINCT</span> p.order_po_id) <span class="sql-reserved">AS</span> total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(no_po &gt; <span class="sql-number">0</span>, <span class="sql-string">'Yes'</span>, <span class="sql-string">'No'</span>) <span class="sql-reserved">AS</span> no_po<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;sync_orders s,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po p<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id = p.order_id <span class="sql-reserved">AND</span>(p.po <span class="sql-reserved">NOT IN</span>(<span class="sql-string">''</span>) <span class="sql-reserved">OR</span> p.no_po &gt; <span class="sql-number">0</span>)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;s.order_id</td></tr>
   <tr><td>532</td><td>cron/summary/cancels.php:66</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ranked_cancels_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;base.*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> base.order_id = <span class="sql-variable">@order_id</span> <span class="sql-reserved">THEN</span> <span class="sql-variable">@rank</span> := <span class="sql-variable">@rank</span> <span class="sql-number">+1</span> <span class="sql-reserved">ELSE</span> <span class="sql-variable">@rank</span> := <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-variable">@order_id</span> := base.order_id<br/><span class="sql-keyword">END</span> rank<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.credit_amount - oc.tax_credit_amount credit_amount,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_date<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_order_cancels oc<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> orders o <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = o.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INNER JOIN</span> tmp_order_totals os <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.order_id = oc.order_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-string">"
                    .($order_id? "</span> <span class="sql-reserved">AND</span> oc.order_id = $order_id <span class="sql-string">" : "</span> <span class="sql-string">")."</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oc.cancel_id<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_date,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_id<br/>) base<br/><span class="sql-reserved">CROSS JOIN</span>(<br/><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@rank</span> := <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-variable">@order_id</span> := <span class="sql-number">0</span><br/>) r;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> $ranked_cancels_table_name(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(cancel_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"></td></tr>
   <tr><td>533</td><td>finance/after_import.php:38</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_order_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_amount) cancel_amount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels oc<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_order_cancels(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;cancel_amount <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">36</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(credit_amount) <span class="sql-reserved">AS</span> cancel_amount<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;interlink.order_cancels oc<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>534</td><td>finance/after_import.php:74</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_po_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(po_amount) total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> po) all_pos<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;no_po = <span class="sql-number">0</span> <span class="sql-reserved">AND</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_po_total(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_po <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">34</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;all_pos <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(po_amount) <span class="sql-reserved">AS</span> total_po,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<span class="sql-reserved">DISTINCT</span> po) <span class="sql-reserved">AS</span> all_pos<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_po<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;no_po = <span class="sql-number">0</span> <span class="sql-reserved">AND</span><br/><span class="sql-keyword">STATUS</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id</td></tr>
   <tr><td>535</td><td>finance/after_import.php:91</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_trans_date(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(oc.cancel_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(cc.invoice_date, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(p.payment_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(i.invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> last_trans_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.invoice_orders <span class="sql-keyword">IO</span><br/><span class="sql-reserved">LEFT JOIN</span> billing.payments p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_id = <span class="sql-keyword">IO</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> billing.invoices i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id = <span class="sql-keyword">IO</span>.invoice_id <span class="sql-reserved">AND</span> i.type = <span class="sql-string">'Credit Memo'</span><br/><span class="sql-reserved">LEFT JOIN</span> billing.commission_credits cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.il_order_id = <span class="sql-keyword">IO</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = <span class="sql-keyword">IO</span>.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-keyword">TEMPORARY</span> <span class="sql-reserved">TABLE</span> temp_trans_date(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">INT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;last_trans_date <span class="sql-reserved">VARCHAR</span>(<span class="sql-number">10</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(oc.cancel_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(cc.invoice_date, <span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(p.payment_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<span class="sql-keyword">MAX</span>(i.invoice_date),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> last_trans_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.invoice_orders <span class="sql-keyword">IO</span><br/><span class="sql-reserved">LEFT JOIN</span> billing.payments p<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;p.order_id = <span class="sql-keyword">IO</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> billing.invoices i<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;i.invoice_id = <span class="sql-keyword">IO</span>.invoice_id <span class="sql-reserved">AND</span> i.type = <span class="sql-string">'Credit Memo'</span><br/><span class="sql-reserved">LEFT JOIN</span> billing.commission_credits cc<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cc.il_order_id = <span class="sql-keyword">IO</span>.order_id<br/><span class="sql-reserved">LEFT JOIN</span> order_cancels oc <span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;oc.order_id = <span class="sql-keyword">IO</span>.order_id <span class="sql-reserved">AND</span> oc.status = <span class="sql-number">0</span><br/><span class="sql-reserved">GROUP BY</span> <span class="sql-keyword">IO</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;.order_id</td></tr>
   <tr><td>536</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:7</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_revenue(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(o.order_total - os.sales_tax) - o.cancel_total<br/>&nbsp;&nbsp;&nbsp;&nbsp;) revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) salesreps<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.user_orders uo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = uo.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(uo.user_id = u.user_id)<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(o.order_id = os.order_id)<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_revenue(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.cancel_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_total - os.sales_tax - o.cancel_total <span class="sql-reserved">AS</span> revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">IFNULL</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(last_name)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">''</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> salesreps<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.user_orders uo<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = uo.order_id <span class="sql-reserved">AND</span> uo.role_id = <span class="sql-number">6</span><br/><span class="sql-reserved">LEFT JOIN</span> $data_db.users u<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;uo.user_id = u.user_id<br/><span class="sql-reserved">LEFT JOIN</span> $data_db.order_summary os<br/><span class="sql-reserved">ON</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = os.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>537</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:20</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_billing(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(all_defer, order_id)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(past_billing + month_billing) prior_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(past_billing + month_billing) defer_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - <span class="sql-keyword">SUM</span>(past_billing + month_billing) contracted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total &lt;= <span class="sql-keyword">SUM</span>(past_billing + month_billing) <span class="sql-number">+1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - <span class="sql-keyword">SUM</span>(past_billing + month_billing)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) all_defer<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.billing_monthly b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.month_date = <span class="sql-string">'$report_start_month'</span> <span class="sql-reserved">AND</span> r.order_id = b.order_id <span class="sql-reserved">AND</span> b.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_billing(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(all_defer, order_id)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(past_billing + month_billing) <span class="sql-reserved">AS</span> prior_billing,<br/>&nbsp;&nbsp;&nbsp;&nbsp;revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(past_billing + month_billing) <span class="sql-reserved">AS</span> defer_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - <span class="sql-keyword">SUM</span>(past_billing + month_billing) <span class="sql-reserved">AS</span> contracted_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total &lt;= <span class="sql-keyword">SUM</span>(past_billing + month_billing) + <span class="sql-number">1</span> <span class="sql-reserved">AND</span> <span class="sql-keyword">ABS</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_total - <span class="sql-keyword">SUM</span>(past_billing + month_billing)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) &lt; <span class="sql-number">.5</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'N'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> all_defer<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;billing.billing_monthly b,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;orders o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.month_date = <span class="sql-string">'$report_start_month'</span> <span class="sql-reserved">AND</span> r.order_id = b.order_id <span class="sql-reserved">AND</span> b.order_id = o.order_id<br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>538</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:44</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_revenue_schedule(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, deferred)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> defer_insert,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) / o.revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) revenue_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span> deferred<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oda.order_id <span class="sql-reserved">AND</span> o.order_id = b.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oda.cancel_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oda.change_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> oda.period_month &lt;= <span class="sql-string">'$report_start_month'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> b.all_defer = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_revenue_schedule(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, period_month),<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">INDEX</span>(order_id, deferred)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">AS</span> defer_insert,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;o.revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">ROUND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) / o.revenue_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">10</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> revenue_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Y'</span> <span class="sql-reserved">AS</span> deferred<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue o,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_detail_amortization_lock oda,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id = oda.order_id <span class="sql-reserved">AND</span> o.order_id = b.order_id <span class="sql-reserved">AND</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oda.cancel_id = <span class="sql-number">0</span> <span class="sql-reserved">AND</span> oda.change_id = <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">OR</span> oda.period_month &lt;= <span class="sql-string">'$report_start_month'</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AND</span> b.all_defer = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;oda.period_month</td></tr>
   <tr><td>539</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:72</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> check_defer_revenue(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) period_total_to_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = b.order_id <span class="sql-reserved">AND</span> b.all_defer = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> r.deferred = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> check_defer_revenue(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(period_total) <span class="sql-reserved">AS</span> period_total_to_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_billing b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = b.order_id <span class="sql-reserved">AND</span> b.all_defer = <span class="sql-string">'N'</span> <span class="sql-reserved">AND</span> r.deferred = <span class="sql-string">'Y'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>540</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:139</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_commissions(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;due_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pending_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span><br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<span class="sql-keyword">IFNULL</span>(last_name, <span class="sql-string">''</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) salesreps,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) invoice_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(due_commissions) due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(pending_commissions) pending_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - paid_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;) accrued_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> paid_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> accrued_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) total_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(due_commissions) paid_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - paid_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;) accrued_comm_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.commissions o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_commissions(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">PRIMARY KEY</span>(order_id),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;due_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;pending_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">20</span>, <span class="sql-number">2</span>) <span class="sql-reserved">DEFAULT</span> <span class="sql-number">0</span><br/>)</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;salesreps <span class="sql-keyword">TEXT</span>(<span class="sql-number">4096</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;due_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;pending_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_commissions <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">45</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_total <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_bonus <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_bonus <span class="sql-reserved">BIGINT</span>(<span class="sql-number">1</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;total_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">44</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_comm_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">45</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">GROUP_CONCAT</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">DISTINCT</span> <span class="sql-keyword">CONCAT</span>(<span class="sql-keyword">IFNULL</span>(last_name, <span class="sql-string">''</span>))<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">ORDER BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">1</span> <span class="sql-reserved">SEPARATOR</span> <span class="sql-string">'; '</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> salesreps,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> invoice_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(due_commissions) <span class="sql-reserved">AS</span> due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(pending_commissions) <span class="sql-reserved">AS</span> pending_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - paid_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> accrued_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> paid_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> accrued_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> total_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(due_commissions) <span class="sql-reserved">AS</span> paid_comm_bonus,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">IF</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termination_date &gt; <span class="sql-number">0</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;due_commissions,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) - paid_commissions<br/>&nbsp;&nbsp;&nbsp;&nbsp;) <span class="sql-reserved">AS</span> accrued_comm_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.commissions o<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;cmonth = <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;o.order_id</td></tr>
   <tr><td>541</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:161</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_bonuses(<span class="sql-reserved">PRIMARY KEY</span>(order_id)) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.bonus_total) bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> b.paid_date &lt;= last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">THEN</span> b.bonus_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) paid_bonus,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> b.paid_date &gt; last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">THEN</span> b.bonus_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) accrued_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.bonuses_per_order b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.bonus_date &lt;= last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">AND</span> b.cmonth = <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id;</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_bonuses(<span class="sql-reserved">PRIMARY KEY</span>(order_id))</td><td style="border-bottom: solid 1px black;">order_id <span class="sql-reserved">MEDIUMINT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="sql-number">8</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;bonus_total <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;paid_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;accrued_bonus <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">67</span>)</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(b.bonus_total) <span class="sql-reserved">AS</span> bonus_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> b.paid_date &lt;= last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">THEN</span> b.bonus_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> paid_bonus,<br/><span class="sql-keyword">SUM</span>(<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-reserved">CASE</span> <span class="sql-reserved">WHEN</span> b.paid_date &gt; last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">THEN</span> b.bonus_total <span class="sql-reserved">ELSE</span> <span class="sql-number">0</span><br/><span class="sql-keyword">END</span><br/>) <span class="sql-reserved">AS</span> accrued_bonus<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;commissions.bonuses_per_order b<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.bonus_date &lt;= last_day(<span class="sql-string">'$report_start_month'</span>) <span class="sql-reserved">AND</span> b.cmonth = <span class="sql-string">'$report_start_month'</span><br/><span class="sql-reserved">GROUP BY</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;b.order_id</td></tr>
   <tr><td>542</td><td>finance/amortization/wizard/generate/generate_commissions_data.inc:200</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_commission_schedule(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;perc_com_defer <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_to_date <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">18</span>, <span class="sql-number">10</span>)<br/>) <span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * total_commissions commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * bonus_total bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * total_comm_bonus comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.deferred rev_deferred,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> perc_com_defer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> recognized_to_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commissions c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = c.order_id</td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">CREATE</span> <span class="sql-reserved">TABLE</span> order_commission_schedule(<br/>&nbsp;&nbsp;&nbsp;&nbsp;id <span class="sql-reserved">INT</span> <span class="sql-keyword">AUTO_INCREMENT</span> <span class="sql-reserved">PRIMARY KEY</span>,<br/>&nbsp;&nbsp;&nbsp;&nbsp;perc_com_defer <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">12</span>, <span class="sql-number">10</span>),<br/>&nbsp;&nbsp;&nbsp;&nbsp;recognized_to_date <span class="sql-reserved">DECIMAL</span>(<span class="sql-number">18</span>, <span class="sql-number">10</span>)<br/>)</td><td style="border-bottom: solid 1px black;"></td><td style="border-bottom: solid 1px black;"><span class="sql-reserved">SELECT</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.period_month,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * total_commissions <span class="sql-reserved">AS</span> commission_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * bonus_total <span class="sql-reserved">AS</span> bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.revenue_perc * total_comm_bonus <span class="sql-reserved">AS</span> comm_bonus_period_total,<br/>&nbsp;&nbsp;&nbsp;&nbsp;r.deferred <span class="sql-reserved">AS</span> rev_deferred,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> perc_com_defer,<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-number">0</span> <span class="sql-reserved">AS</span> recognized_to_date<br/><span class="sql-reserved">FROM</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;order_revenue_schedule r,<br/>&nbsp;&nbsp;&nbsp;&nbsp;order_commissions c<br/><span class="sql-reserved">WHERE</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;r.order_id = c.order_id</td></tr>
</tbody>
<tfoot></tfoot>
</table>
